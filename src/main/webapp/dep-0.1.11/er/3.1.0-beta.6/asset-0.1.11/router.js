define("er/router",["require","./URL","eoo","mini-event/EventTarget","./locator","./events"],function(require){function e(e){for(var t=require("./URL").parse(e.url),i=t.getPath(),n=0;n<this.routes.length;n++){var a=this.routes[n];if(a.rule instanceof RegExp&&a.rule.test(i)||a.rule===i)return void a.handler.call(this,t)}if(this.backup)this.backup(t);this.getEventBus().fire("route",{url:t,router:this})}var exports={};exports.constructor=function(){this.routes=[],this.backup=null},exports.add=function(e,t){this.routes.push({rule:e,handler:t})},exports.setBackup=function(e){this.backup=e},exports.getLocator=function(){return this.locator},exports.setLocator=function(e){this.locator=e},exports.getEventBus=function(){return this.eventBus},exports.setEventBus=function(e){this.eventBus=e},exports.start=function(){this.getLocator().on("redirect",e,this)};var t=require("eoo").create(require("mini-event/EventTarget"),exports),i=new t;return i.setLocator(require("./locator")),i.setEventBus(require("./events")),i.Router=t,i});