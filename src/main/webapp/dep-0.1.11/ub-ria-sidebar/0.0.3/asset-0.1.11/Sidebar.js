define("ub-ria-sidebar/Sidebar",["require","underscore","esui/lib","esui","esui/Panel","etpl","text!./tpl/sidebar.tpl.html","esui/painters","eoo"],function(require){function e(e){var t=e.target;if(this.helper.isPart(t,"drop"))e.stopPropagation(),this.adjustExpandItem(this.expandItem,t.getAttribute("data-id"))}function t(){this.set("collapsed",!this.get("collapsed"))}var i=require("underscore"),n=require("esui/lib"),a=require("esui"),r=require("esui/Panel"),o=require("etpl"),s="sidebar-menu-item-expanded",l="sidebar-menu-item-active",exports={};exports.type="Sidebar",exports.listTemplate=require("text!./tpl/sidebar.tpl.html"),exports.initOptions=function(e){var t={toggleBtn:"",datasource:[],activeItems:[],expandItem:"",contents:[]};i.extend(t,e),this.setProperties(t),this.complier=o.compile(this.listTemplate)},exports.initEvents=function(){this.$super(arguments),this.helper.addDOMEvent(this.main,"click",e),this.helper.addDOMEvent(window,"resize",this._setContentPanelMaxHeight);var i=n.g(this.toggleBtn);i&&this.helper.addDOMEvent(i,"click",t)};var h=require("esui/painters").createRepaint(r.prototype.repaint,{name:"datasource",paint:function(e,t){var i=e._prepareData(t);e.disposeChildren(),e.main.innerHTML=e.complier({datasource:i}),e.initChildren(),e.adjustExpandItem("",e.expandItem),e.adjustActiveItems(null,e.activeItems),e.setContents(e.contents)}},{name:"collapsed",paint:function(e,t){if(t)e._clearContentPanelMaxHeight(),e.addState("collapsed"),n.addClass(e.toggleBtn,"sidebar-collapsed");else e._setContentPanelMaxHeight(),e.removeState("collapsed"),n.removeClass(e.toggleBtn,"sidebar-collapsed");e.fire("modechanged")}});exports.repaint=function(e,t){if(h.apply(this,arguments),t){if(t.activeItems)this.adjustActiveItems(t.activeItems.oldValue,t.activeItems.newValue);if(t.expandItem)this.adjustExpandItem(t.expandItem.oldValue,t.expandItem.newValue)}},exports.adjustExpandItem=function(e,t){this.expandItem=t;var i=this._getItemById(t);if(e!==t)this._clearContentPanelMaxHeight(),n.removeClass(this._getItemById(e),s),this._setContentPanelMaxHeight(),n.addClass(i,s);else n.toggleClass(i,s)},exports.adjustActiveItems=function(e,t){this.activeItems=t,i.each(e,function(e){n.removeClass(this._getItemById(e),l)},this),i.each(t,function(e){n.addClass(this._getItemById(e),l)},this)},exports.setContents=function(e){e=e instanceof Array?e:[e],i.each(e,function(e){var t=this.getChild(e.id+"-content");t.addChild(e.control),e.control.appendTo(t)},this)},exports._setContentPanelMaxHeight=function(){if(this.currentExpanded){var e=n.getChildren(this._getItemById(this.currentExpanded).parentNode),t=0;i.each(e,function(e){t+=e.offsetHeight});var a=this.main.clientHeight;this._getCurrentContentPanel().setStyle("maxHeight",Math.max(a-t,50)+"px")}},exports._clearContentPanelMaxHeight=function(){if(this.currentExpanded)this._getCurrentContentPanel().setStyle("maxHeight","")},exports._getItemById=function(e){return this.helper.getPart("item-"+e)},exports._getCurrentContentPanel=function(){return this.getChild(this.currentExpanded+"-content")},exports._prepareData=function(e){var t=[];return i.each(e,function(e){var n=i.escape(e.id),a=!e.isLeaf?"sidebar-menu-item-has-child ":"",r={id:n,domID:this.helper.getId("item-"+n),text:e.text,url:e.url,isLeaf:!!e.isLeaf,itemCls:a,dropCls:this.helper.getPartClassName("drop"),target:e.target||("#"===e.url.charAt(0)?"_self":"_blank"),items:e.isLeaf?null:e.items||[]};t.push(r),i.each(r.items,function(e){e.id=i.escape(e.id),e.domID=this.helper.getId("item-"+e.id)},this)},this),t};var d=require("eoo").create(r,exports);return a.register(d),d}),define("ub-ria-sidebar",["ub-ria-sidebar/Sidebar"],function(e){return e});