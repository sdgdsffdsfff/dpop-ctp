define(["require"],function(){function e(e,t,n,r){this._init(e,t,n,r)}return e.prototype._echartsContainer=null,e.prototype._map=null,e.prototype._ec=null,e.prototype._geoCoord=[],e.prototype._mapOffset=[0,0],e.prototype._init=function(e,t,n,r){function o(){}function a(){p("zoom")}function i(e){return function(){var t=f._echartsContainer.parentNode.parentNode.parentNode;f._mapOffset=[-parseInt(t.style.left)||0,-parseInt(t.style.top)||0],f._echartsContainer.style.left=f._mapOffset[0]+"px",f._echartsContainer.style.top=f._mapOffset[1]+"px",p(e)}}function d(e){return function(){var t=e?"disableDragging":"enableDragging";f._map[t]()}}function p(e){var t=f["on"+e];if(t)t();else f.refresh()}var f=this;f._map=e.constructor==t.Map?e:new t.Map(e,r),o.prototype=new t.Overlay,o.prototype.initialize=function(e){var t=e.getSize(),n=f._echartsContainer=document.createElement("div");return n.style.position="absolute",n.style.height=t.height+"px",n.style.width=t.width+"px",n.style.top=0,n.style.left=0,e.getPanes().labelPane.appendChild(n),n},o.prototype.draw=function(){};var s=new o;f.getEchartsContainer=function(){return f._echartsContainer},f.getMap=function(){return f._map},f.onmoving=null,f.onmoveend=null,f.onzoom=null,f.geoCoord2Pixel=function(e){var n=new t.Point(e[0],e[1]),r=f._map.pointToOverlayPixel(n);return[r.x,r.y]},f.pixel2GeoCoord=function(e){var t=f._map.overlayPixelToPoint({x:e[0],y:e[1]});return[t.lng,t.lat]},f.initECharts=function(){return f._ec=n.init.apply(f,arguments),f._bindEvent(),f._addMarkWrap(),f._ec},f._addMarkWrap=function(){function e(e,t,n){var r;if("markPoint"==n){var r=t.data;if(r&&r.length)for(var o in r)f._AddPos(r[o])}else if(r=t.data,r&&r.length)for(var o in r)f._AddPos(r[o][0]),f._AddPos(r[o][1]);f._ec._addMarkOri(e,t,n)}f._ec._addMarkOri=f._ec._addMark,f._ec._addMark=e},f.getECharts=function(){return f._ec},f.getMapOffset=function(){return f._mapOffset},f.setOption=function(e,t){for(var n,r=e.series||{},o=0;n=r[o++];){var a=n.geoCoord;if(a)for(var i in a)f._geoCoord[i]=a[i]}for(var n,o=0;n=r[o++];){var d=n.markPoint||{},p=n.markLine||{},s=d.data;if(s&&s.length)for(var i in s)f._AddPos(s[i]);if(s=p.data,s&&s.length)for(var i in s)f._AddPos(s[i][0]),f._AddPos(s[i][1])}f._ec.setOption(e,t)},f._AddPos=function(e){var t=this._geoCoord[e.name],n=this.geoCoord2Pixel(t);e.x=n[0]-f._mapOffset[0],e.y=n[1]-f._mapOffset[1]},f._bindEvent=function(){f._map.addEventListener("zoomend",a),f._map.addEventListener("moving",i("moving")),f._map.addEventListener("moveend",i("moveend")),f._ec.getZrender().on("dragstart",d(!0)),f._ec.getZrender().on("dragend",d(!1))},f.refresh=function(){if(f._ec){var e=f._ec.getOption();f._ec.clear(),f.setOption(e)}},f._map.addOverlay(s)},e});