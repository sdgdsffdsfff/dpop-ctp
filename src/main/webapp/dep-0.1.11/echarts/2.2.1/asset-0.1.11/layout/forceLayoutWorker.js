define("echarts/layout/forceLayoutWorker",["require","zrender/tool/vector"],function t(require){"use strict";function e(){this.subRegions=[],this.nSubRegions=0,this.node=null,this.mass=0,this.centerOfMass=null,this.bbox=new r(4),this.size=0}function i(){this.position=a.create(),this.force=a.create(),this.forcePrev=a.create(),this.speed=a.create(),this.speedPrev=a.create(),this.mass=1,this.inDegree=0,this.outDegree=0}function s(t,e){this.node1=t,this.node2=e,this.weight=1}function o(){this.barnesHutOptimize=!1,this.barnesHutTheta=1.5,this.repulsionByDegree=!1,this.preventNodeOverlap=!1,this.preventNodeEdgeOverlap=!1,this.strongGravity=!0,this.gravity=1,this.scaling=1,this.edgeWeightInfluence=1,this.center=[0,0],this.width=500,this.height=500,this.maxSpeedIncrease=1,this.nodes=[],this.edges=[],this.bbox=new r(4),this._rootRegion=new e,this._rootRegion.centerOfMass=a.create(),this._massArr=null,this._k=0}var a,n="undefined"==typeof window&&"undefined"==typeof require;if(n)a={create:function(t,e){var i=new Float32Array(2);return i[0]=t||0,i[1]=e||0,i},dist:function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)},len:function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},scaleAndAdd:function(t,e,i,s){return t[0]=e[0]+i[0]*s,t[1]=e[1]+i[1]*s,t},scale:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},sub:function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},normalize:function(t,e){var i=e[0],s=e[1],o=i*i+s*s;if(o>0)o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o;return t},negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,i){return t[0]=e,t[1]=i,t}};else a=require("zrender/tool/vector");var r="undefined"==typeof Float32Array?Array:Float32Array;if(e.prototype.beforeUpdate=function(){for(var t=0;t<this.nSubRegions;t++)this.subRegions[t].beforeUpdate();if(this.mass=0,this.centerOfMass)this.centerOfMass[0]=0,this.centerOfMass[1]=0;this.nSubRegions=0,this.node=null},e.prototype.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var t=0;t<this.nSubRegions;t++)this.subRegions[t].afterUpdate()},e.prototype.addNode=function(t){if(0===this.nSubRegions)if(null==this.node)return void(this.node=t);else this._addNodeToSubRegion(this.node),this.node=null;this._addNodeToSubRegion(t),this._updateCenterOfMass(t)},e.prototype.findSubRegion=function(t,e){for(var i=0;i<this.nSubRegions;i++){var s=this.subRegions[i];if(s.contain(t,e))return s}},e.prototype.contain=function(t,e){return this.bbox[0]<=t&&this.bbox[2]>=t&&this.bbox[1]<=e&&this.bbox[3]>=e},e.prototype.setBBox=function(t,e,i,s){this.bbox[0]=t,this.bbox[1]=e,this.bbox[2]=i,this.bbox[3]=s,this.size=(i-t+s-e)/2},e.prototype._newSubRegion=function(){var t=this.subRegions[this.nSubRegions];if(!t)t=new e,this.subRegions[this.nSubRegions]=t;return this.nSubRegions++,t},e.prototype._addNodeToSubRegion=function(t){var e=this.findSubRegion(t.position[0],t.position[1]),i=this.bbox;if(!e){var s=(i[0]+i[2])/2,o=(i[1]+i[3])/2,a=(i[2]-i[0])/2,n=(i[3]-i[1])/2,r=t.position[0]>=s?1:0,h=t.position[1]>=o?1:0,e=this._newSubRegion();e.setBBox(r*a+i[0],h*n+i[1],(r+1)*a+i[0],(h+1)*n+i[1])}e.addNode(t)},e.prototype._updateCenterOfMass=function(t){if(null==this.centerOfMass)this.centerOfMass=a.create();var e=this.centerOfMass[0]*this.mass,i=this.centerOfMass[1]*this.mass;e+=t.position[0]*t.mass,i+=t.position[1]*t.mass,this.mass+=t.mass,this.centerOfMass[0]=e/this.mass,this.centerOfMass[1]=i/this.mass},o.prototype.nodeToNodeRepulsionFactor=function(t,e,i){return i*i*t/e},o.prototype.edgeToNodeRepulsionFactor=function(t,e,i){return i*t/e},o.prototype.attractionFactor=function(t,e,i){return t*e/i},o.prototype.initNodes=function(t,e,s){this.temperature=1;var o=t.length/2;this.nodes.length=0;for(var a="undefined"!=typeof s,n=0;o>n;n++){var r=new i;if(r.position[0]=t[2*n],r.position[1]=t[2*n+1],r.mass=e[n],a)r.size=s[n];this.nodes.push(r)}if(this._massArr=e,a)this._sizeArr=s},o.prototype.initEdges=function(t,e){var i=t.length/2;this.edges.length=0;for(var o="undefined"!=typeof e,a=0;i>a;a++){var n=t[2*a],r=t[2*a+1],h=this.nodes[n],l=this.nodes[r];if(h&&l){h.outDegree++,l.inDegree++;var d=new s(h,l);if(o)d.weight=e[a];this.edges.push(d)}else;}},o.prototype.update=function(){var t=this.nodes.length;if(this.updateBBox(),this._k=.4*this.scaling*Math.sqrt(this.width*this.height/t),this.barnesHutOptimize){this._rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this._rootRegion.beforeUpdate();for(var e=0;t>e;e++)this._rootRegion.addNode(this.nodes[e]);this._rootRegion.afterUpdate()}else{var i=0,s=this._rootRegion.centerOfMass;a.set(s,0,0);for(var e=0;t>e;e++){var o=this.nodes[e];i+=o.mass,a.scaleAndAdd(s,s,o.position,o.mass)}if(i>0)a.scale(s,s,1/i)}this.updateForce(),this.updatePosition()},o.prototype.updateForce=function(){for(var t=this.nodes.length,e=0;t>e;e++){var i=this.nodes[e];a.copy(i.forcePrev,i.force),a.copy(i.speedPrev,i.speed),a.set(i.force,0,0)}if(this.updateNodeNodeForce(),this.gravity>0)this.updateGravityForce();if(this.updateEdgeForce(),this.preventNodeEdgeOverlap)this.updateNodeEdgeForce()},o.prototype.updatePosition=function(){for(var t=this.nodes.length,e=a.create(),i=0;t>i;i++){var s=this.nodes[i],o=s.speed;a.scale(s.force,s.force,1/30);var n=a.len(s.force)+.1,r=Math.min(n,500)/n;a.scale(s.force,s.force,r),a.add(o,o,s.force),a.scale(o,o,this.temperature),a.sub(e,o,s.speedPrev);var h=a.len(e);if(h>0){a.scale(e,e,1/h);var l=a.len(s.speedPrev);if(l>0)h=Math.min(h/l,this.maxSpeedIncrease)*l,a.scaleAndAdd(o,s.speedPrev,e,h)}var d=a.len(o),r=Math.min(d,100)/(d+.1);a.scale(o,o,r),a.add(s.position,s.position,o)}},o.prototype.updateNodeNodeForce=function(){for(var t=this.nodes.length,e=0;t>e;e++){var i=this.nodes[e];if(this.barnesHutOptimize)this.applyRegionToNodeRepulsion(this._rootRegion,i);else for(var s=e+1;t>s;s++){var o=this.nodes[s];this.applyNodeToNodeRepulsion(i,o,!1)}}},o.prototype.updateGravityForce=function(){for(var t=0;t<this.nodes.length;t++)this.applyNodeGravity(this.nodes[t])},o.prototype.updateEdgeForce=function(){for(var t=0;t<this.edges.length;t++)this.applyEdgeAttraction(this.edges[t])},o.prototype.updateNodeEdgeForce=function(){for(var t=0;t<this.nodes.length;t++)for(var e=0;e<this.edges.length;e++)this.applyEdgeToNodeRepulsion(this.edges[e],this.nodes[t])},o.prototype.applyRegionToNodeRepulsion=function(){var t=a.create();return function(e,i){if(e.node)this.applyNodeToNodeRepulsion(e.node,i,!0);else{if(0===e.mass&&0===i.mass)return;a.sub(t,i.position,e.centerOfMass);var s=t[0]*t[0]+t[1]*t[1];if(s>this.barnesHutTheta*e.size*e.size){var o=this._k*this._k*(i.mass+e.mass)/(s+1);a.scaleAndAdd(i.force,i.force,t,2*o)}else for(var n=0;n<e.nSubRegions;n++)this.applyRegionToNodeRepulsion(e.subRegions[n],i)}}}(),o.prototype.applyNodeToNodeRepulsion=function(){var t=a.create();return function(e,i,s){if(e!==i)if(0!==e.mass||0!==i.mass){a.sub(t,e.position,i.position);var o=t[0]*t[0]+t[1]*t[1];if(0!==o){var n,r=e.mass+i.mass,h=Math.sqrt(o);if(a.scale(t,t,1/h),this.preventNodeOverlap){if(h=h-e.size-i.size,h>0)n=this.nodeToNodeRepulsionFactor(r,h,this._k);else if(0>=h)n=this._k*this._k*10*r}else n=this.nodeToNodeRepulsionFactor(r,h,this._k);if(!s)a.scaleAndAdd(e.force,e.force,t,2*n);a.scaleAndAdd(i.force,i.force,t,2*-n)}}}}(),o.prototype.applyEdgeAttraction=function(){var t=a.create();return function(e){var i=e.node1,s=e.node2;a.sub(t,i.position,s.position);var o,n=a.len(t);if(0===this.edgeWeightInfluence)o=1;else if(1==this.edgeWeightInfluence)o=e.weight;else o=Math.pow(e.weight,this.edgeWeightInfluence);var r;if(this.preventOverlap)if(n=n-i.size-s.size,0>=n)return;var r=this.attractionFactor(o,n,this._k);a.scaleAndAdd(i.force,i.force,t,-r),a.scaleAndAdd(s.force,s.force,t,r)}}(),o.prototype.applyNodeGravity=function(){var t=a.create();return function(e){if(a.sub(t,this.center,e.position),this.width>this.height)t[1]*=this.width/this.height;else t[0]*=this.height/this.width;var i=a.len(t)/100;if(this.strongGravity)a.scaleAndAdd(e.force,e.force,t,i*this.gravity*e.mass);else a.scaleAndAdd(e.force,e.force,t,this.gravity*e.mass/(i+1))}}(),o.prototype.applyEdgeToNodeRepulsion=function(){var t=a.create(),e=a.create(),i=a.create();return function(s,o){var n=s.node1,r=s.node2;if(n!==o&&r!==o){a.sub(t,r.position,n.position),a.sub(e,o.position,n.position);var h=a.len(t);a.scale(t,t,1/h);var l=a.dot(t,e);if(!(0>l||l>h)){a.scaleAndAdd(i,n.position,t,l);var d=a.dist(i,o.position)-o.size,p=this.edgeToNodeRepulsionFactor(o.mass,Math.max(d,.1),100);a.sub(t,o.position,i),a.normalize(t,t),a.scaleAndAdd(o.force,o.force,t,p),a.scaleAndAdd(n.force,n.force,t,-p),a.scaleAndAdd(r.force,r.force,t,-p)}}}}(),o.prototype.updateBBox=function(){for(var t=1/0,e=1/0,i=-1/0,s=-1/0,o=0;o<this.nodes.length;o++){var a=this.nodes[o].position;t=Math.min(t,a[0]),e=Math.min(e,a[1]),i=Math.max(i,a[0]),s=Math.max(s,a[1])}this.bbox[0]=t,this.bbox[1]=e,this.bbox[2]=i,this.bbox[3]=s},o.getWorkerCode=function(){var e=t.toString();return e.slice(e.indexOf("{")+1,e.lastIndexOf("return"))},n){var h=null;self.onmessage=function(t){if(!(t.data instanceof ArrayBuffer))switch(t.data.cmd){case"init":if(!h)h=new o;h.initNodes(t.data.nodesPosition,t.data.nodesMass,t.data.nodesSize),h.initEdges(t.data.edges,t.data.edgesWeight);break;case"updateConfig":if(h)for(var e in t.data.config)h[e]=t.data.config[e];break;case"update":var i=t.data.steps;if(h){var s=h.nodes.length,a=new Float32Array(2*s);h.temperature=t.data.temperature;for(var n=0;i>n;n++)h.update(),h.temperature*=t.data.coolDown;for(var n=0;s>n;n++){var r=h.nodes[n];a[2*n]=r.position[0],a[2*n+1]=r.position[1]}self.postMessage(a.buffer,[a.buffer])}else{var l=new Float32Array;self.postMessage(l.buffer,[l.buffer])}}else{if(!h)return;for(var a=new Float32Array(t.data),s=a.length/2,n=0;s>n;n++){var r=h.nodes[n];r.position[0]=a[2*n],r.position[1]=a[2*n+1]}}}}return o});