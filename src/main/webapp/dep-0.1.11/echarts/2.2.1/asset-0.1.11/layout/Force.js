define("echarts/layout/Force",["require","./forceLayoutWorker","zrender/tool/vector"],function(require){function t(){if("undefined"!=typeof Worker&&"undefined"!=typeof Blob)try{var t=new Blob([i.getWorkerCode()]);e=window.URL.createObjectURL(t)}catch(s){e=""}return e}var e,i=require("./forceLayoutWorker"),s=require("zrender/tool/vector"),a=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout(t,16)},o="undefined"==typeof Float32Array?Array:Float32Array,n=function(i){if("undefined"==typeof e)t();i=i||{},this.width=i.width||500,this.height=i.height||500,this.center=i.center||[this.width/2,this.height/2],this.ratioScaling=i.ratioScaling||!1,this.scaling=i.scaling||1,this.gravity="undefined"!=typeof i.gravity?i.gravity:1,this.large=i.large||!1,this.preventNodeOverlap=i.preventNodeOverlap||!1,this.preventNodeEdgeOverlap=i.preventNodeEdgeOverlap||!1,this.maxSpeedIncrease=i.maxSpeedIncrease||1,this.onupdate=i.onupdate||function(){},this.temperature=i.temperature||1,this.coolDown=i.coolDown||.99,this._layout=null,this._layoutWorker=null;var s=this,a=this._$onupdate;this._$onupdate=function(t){a.call(s,t)}};return n.prototype.updateConfig=function(){var t=this.width,e=this.height,i=Math.min(t,e),s={center:this.center,width:this.ratioScaling?t:i,height:this.ratioScaling?e:i,scaling:this.scaling||1,gravity:this.gravity||1,barnesHutOptimize:this.large,preventNodeOverlap:this.preventNodeOverlap,preventNodeEdgeOverlap:this.preventNodeEdgeOverlap,maxSpeedIncrease:this.maxSpeedIncrease};if(this._layoutWorker)this._layoutWorker.postMessage({cmd:"updateConfig",config:s});else for(var a in s)this._layout[a]=s[a]},n.prototype.init=function(t,s){if(this._layoutWorker)this._layoutWorker.terminate(),this._layoutWorker=null;if(e&&s)try{if(!this._layoutWorker)this._layoutWorker=new Worker(e),this._layoutWorker.onmessage=this._$onupdate;this._layout=null}catch(a){if(this._layoutWorker=null,!this._layout)this._layout=new i}else if(!this._layout)this._layout=new i;this.temperature=1,this.graph=t;for(var n=t.nodes.length,r=new o(2*n),h=new o(n),l=new o(n),d=0;n>d;d++){var p=t.nodes[d];r[2*d]=p.layout.position[0],r[2*d+1]=p.layout.position[1],h[d]="undefined"==typeof p.layout.mass?1:p.layout.mass,l[d]="undefined"==typeof p.layout.size?1:p.layout.size,p.layout.__index=d}n=t.edges.length;for(var c=new o(2*n),g=new o(n),d=0;n>d;d++){var u=t.edges[d];c[2*d]=u.node1.layout.__index,c[2*d+1]=u.node2.layout.__index,g[d]=u.layout.weight||1}if(this._layoutWorker)this._layoutWorker.postMessage({cmd:"init",nodesPosition:r,nodesMass:h,nodesSize:l,edges:c,edgesWeight:g});else this._layout.initNodes(r,h,l),this._layout.initEdges(c,g);this.updateConfig()},n.prototype.step=function(t){var e=this.graph.nodes;if(this._layoutWorker){for(var i=new o(2*e.length),n=0;n<e.length;n++){var r=e[n];i[2*n]=r.layout.position[0],i[2*n+1]=r.layout.position[1]}this._layoutWorker.postMessage(i.buffer,[i.buffer]),this._layoutWorker.postMessage({cmd:"update",steps:t,temperature:this.temperature,coolDown:this.coolDown});for(var n=0;t>n;n++)this.temperature*=this.coolDown}else{a(this._$onupdate);for(var n=0;n<e.length;n++){var r=e[n];s.copy(this._layout.nodes[n].position,r.layout.position)}for(var n=0;t>n;n++)this._layout.temperature=this.temperature,this._layout.update(),this.temperature*=this.coolDown}},n.prototype._$onupdate=function(t){if(this._layoutWorker){for(var e=new Float32Array(t.data),i=0;i<this.graph.nodes.length;i++){var a=this.graph.nodes[i];a.layout.position[0]=e[2*i],a.layout.position[1]=e[2*i+1]}this.onupdate&&this.onupdate()}else if(this._layout){for(var i=0;i<this.graph.nodes.length;i++){var a=this.graph.nodes[i];s.copy(a.layout.position,this._layout.nodes[i].position)}this.onupdate&&this.onupdate()}},n.prototype.dispose=function(){if(this._layoutWorker)this._layoutWorker.terminate();this._layoutWorker=null,this._layout=null},n});