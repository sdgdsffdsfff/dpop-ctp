define("echarts/chart/k",["require","./base","../util/shape/Candle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","../chart"],function(require){function e(e,i,a,r,s){t.call(this,e,i,a,r,s),this.refresh(r)}var t=require("./base"),i=require("../util/shape/Candle");require("../component/axis"),require("../component/grid"),require("../component/dataZoom");var a=require("../config");a.k={zlevel:0,z:2,clickable:!0,hoverable:!0,legendHoverLink:!1,xAxisIndex:0,yAxisIndex:0,itemStyle:{normal:{color:"#fff",color0:"#00aa11",lineStyle:{width:1,color:"#ff3200",color0:"#00aa11"},label:{show:!1}},emphasis:{label:{show:!1}}}};var r=require("../util/ecData"),s=require("zrender/tool/util");return e.prototype={type:a.CHART_TYPE_K,_buildShape:function(){var e=this.series;this.selectedMap={};for(var t,i={top:[],bottom:[]},r=0,s=e.length;s>r;r++)if(e[r].type===a.CHART_TYPE_K)if(e[r]=this.reformOption(e[r]),this.legendHoverLink=e[r].legendHoverLink||this.legendHoverLink,t=this.component.xAxis.getAxis(e[r].xAxisIndex),t.type===a.COMPONENT_TYPE_AXIS_CATEGORY)i[t.getPosition()].push(r);for(var o in i)if(i[o].length>0)this._buildSinglePosition(o,i[o]);this.addShapeList()},_buildSinglePosition:function(e,t){var i=this._mapData(t),a=i.locationMap,r=i.maxDataLength;if(0!==r&&0!==a.length){this._buildHorizontal(t,r,a);for(var s=0,o=t.length;o>s;s++)this.buildMark(t[s])}},_mapData:function(e){for(var t,i,a=this.series,r=this.component.legend,s=[],o=0,l=0,n=e.length;n>l;l++){if(t=a[e[l]],i=t.name,this.selectedMap[i]=r?r.isSelected(i):!0,this.selectedMap[i])s.push(e[l]);o=Math.max(o,t.data.length)}return{locationMap:s,maxDataLength:o}},_buildHorizontal:function(e,t,i){for(var a,r,s,o,l,n,h,d,p,c,u=this.series,g={},f=0,y=i.length;y>f;f++){if(a=i[f],r=u[a],s=r.xAxisIndex||0,o=this.component.xAxis.getAxis(s),h=r.barWidth||Math.floor(o.getGap()/2),c=r.barMaxWidth,c&&h>c)h=c;l=r.yAxisIndex||0,n=this.component.yAxis.getAxis(l),g[a]=[];for(var m=0,v=t;v>m&&null!=o.getNameByIndex(m);m++)if(d=r.data[m],p=this.getDataFromOption(d,"-"),"-"!==p&&4==p.length)g[a].push([o.getCoordByIndex(m),h,n.getCoord(p[0]),n.getCoord(p[1]),n.getCoord(p[2]),n.getCoord(p[3]),m,o.getNameByIndex(m)]);else;}this._buildKLine(e,g)},_buildKLine:function(e,t){for(var i,r,s,o,l,n,h,d,p,c,u,g,f,y,m,v,b,x=this.series,_=0,S=e.length;S>_;_++){if(b=e[_],u=x[b],y=t[b],this._isLarge(y))y=this._getLargePointList(y);if(u.type===a.CHART_TYPE_K&&null!=y){g=u,i=this.query(g,"itemStyle.normal.lineStyle.width"),r=this.query(g,"itemStyle.normal.lineStyle.color"),s=this.query(g,"itemStyle.normal.lineStyle.color0"),o=this.query(g,"itemStyle.normal.color"),l=this.query(g,"itemStyle.normal.color0"),n=this.query(g,"itemStyle.emphasis.lineStyle.width"),h=this.query(g,"itemStyle.emphasis.lineStyle.color"),d=this.query(g,"itemStyle.emphasis.lineStyle.color0"),p=this.query(g,"itemStyle.emphasis.color"),c=this.query(g,"itemStyle.emphasis.color0");for(var C=0,z=y.length;z>C;C++)m=y[C],f=u.data[m[6]],g=f,v=m[3]<m[2],this.shapeList.push(this._getCandle(b,m[6],m[7],m[0],m[1],m[2],m[3],m[4],m[5],v?this.query(g,"itemStyle.normal.color")||o:this.query(g,"itemStyle.normal.color0")||l,this.query(g,"itemStyle.normal.lineStyle.width")||i,v?this.query(g,"itemStyle.normal.lineStyle.color")||r:this.query(g,"itemStyle.normal.lineStyle.color0")||s,v?this.query(g,"itemStyle.emphasis.color")||p||o:this.query(g,"itemStyle.emphasis.color0")||c||l,this.query(g,"itemStyle.emphasis.lineStyle.width")||n||i,v?this.query(g,"itemStyle.emphasis.lineStyle.color")||h||r:this.query(g,"itemStyle.emphasis.lineStyle.color0")||d||s))}}},_isLarge:function(e){return e[0][1]<.5},_getLargePointList:function(e){for(var t=this.component.grid.getWidth(),i=e.length,a=[],r=0;t>r;r++)a[r]=e[Math.floor(i/t*r)];return a},_getCandle:function(e,t,a,s,o,l,n,h,d,p,c,u,g,f,y){var m=this.series,v=m[e],b=v.data[t],x=[b,v],_={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(x,"clickable"),hoverable:this.deepQuery(x,"hoverable"),style:{x:s,y:[l,n,h,d],width:o,color:p,strokeColor:u,lineWidth:c,brushType:"both"},highlightStyle:{color:g,strokeColor:y,lineWidth:f},_seriesIndex:e};return _=this.addLabel(_,v,b,a),r.pack(_,v,e,b,t,a),_=new i(_)},getMarkCoord:function(e,t){var i=this.series[e],a=this.component.xAxis.getAxis(i.xAxisIndex),r=this.component.yAxis.getAxis(i.yAxisIndex);return["string"!=typeof t.xAxis&&a.getCoordByIndex?a.getCoordByIndex(t.xAxis||0):a.getCoord(t.xAxis||0),"string"!=typeof t.yAxis&&r.getCoordByIndex?r.getCoordByIndex(t.yAxis||0):r.getCoord(t.yAxis||0)]},refresh:function(e){if(e)this.option=e,this.series=e.series;this.backupShapeList(),this._buildShape()},addDataAnimation:function(e,t){function i(){if(g--,0===g)t&&t()}for(var a=this.series,s={},o=0,l=e.length;l>o;o++)s[e[o][0]]=e[o];for(var n,h,d,p,c,u,g=0,o=0,l=this.shapeList.length;l>o;o++)if(c=this.shapeList[o]._seriesIndex,s[c]&&!s[c][3])if("candle"===this.shapeList[o].type){if(u=r.get(this.shapeList[o],"dataIndex"),p=a[c],s[c][2]&&u===p.data.length-1){this.zr.delShape(this.shapeList[o].id);continue}else if(!s[c][2]&&0===u){this.zr.delShape(this.shapeList[o].id);continue}h=this.component.xAxis.getAxis(p.xAxisIndex||0).getGap(),n=s[c][2]?h:-h,d=0,g++,this.zr.animate(this.shapeList[o].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[n,d]}).done(i).start()}if(!g)i()}},s.inherits(e,t),require("../chart").define("k",e),e});