define("echarts/chart/base",["require","zrender/shape/Image","../util/shape/Icon","../util/shape/MarkLine","../util/shape/Symbol","zrender/shape/Polyline","zrender/shape/ShapeBundle","../config","../util/ecData","../util/ecAnimation","../util/ecEffect","../util/accMath","../component/base","../layout/EdgeBundling","zrender/tool/util","zrender/tool/area"],function(require){function e(e){return null!=e.x&&null!=e.y}function t(e,t,i,a,r){c.call(this,e,t,i,a,r);var o=this;this.selectedMap={},this.lastShapeList=[],this.shapeHandler={onclick:function(){o.isClick=!0},ondragover:function(e){var t=e.target;t.highlightStyle=t.highlightStyle||{};var i=t.highlightStyle,a=i.brushTyep,r=i.strokeColor,n=i.lineWidth;i.brushType="stroke",i.strokeColor=o.ecTheme.calculableColor||l.calculableColor,i.lineWidth="icon"===t.type?30:10,o.zr.addHoverShape(t),setTimeout(function(){if(i)i.brushType=a,i.strokeColor=r,i.lineWidth=n},20)},ondrop:function(e){if(null!=h.get(e.dragged,"data"))o.isDrop=!0},ondragend:function(){o.isDragend=!0}}}var i=require("zrender/shape/Image"),a=require("../util/shape/Icon"),r=require("../util/shape/MarkLine"),o=require("../util/shape/Symbol"),n=require("zrender/shape/Polyline"),s=require("zrender/shape/ShapeBundle"),l=require("../config"),h=require("../util/ecData"),d=require("../util/ecAnimation"),p=require("../util/ecEffect"),g=require("../util/accMath"),c=require("../component/base"),f=require("../layout/EdgeBundling"),m=require("zrender/tool/util"),u=require("zrender/tool/area");return t.prototype={setCalculable:function(e){return e.dragEnableTime=this.ecTheme.DRAG_ENABLE_TIME||l.DRAG_ENABLE_TIME,e.ondragover=this.shapeHandler.ondragover,e.ondragend=this.shapeHandler.ondragend,e.ondrop=this.shapeHandler.ondrop,e},ondrop:function(e,t){if(this.isDrop&&e.target&&!t.dragIn){var i,a=e.target,r=e.dragged,o=h.get(a,"seriesIndex"),n=h.get(a,"dataIndex"),s=this.series,d=this.component.legend;if(-1===n){if(h.get(r,"seriesIndex")==o)return t.dragOut=t.dragIn=t.needRefresh=!0,void(this.isDrop=!1);if(i={value:h.get(r,"value"),name:h.get(r,"name")},this.type===l.CHART_TYPE_PIE&&i.value<0)i.value=0;for(var p=!1,c=s[o].data,f=0,m=c.length;m>f;f++)if(c[f].name===i.name&&"-"===c[f].value)s[o].data[f].value=i.value,p=!0;!p&&s[o].data.push(i),d&&d.add(i.name,r.style.color||r.style.strokeColor)}else if(i=s[o].data[n]||"-",null!=i.value){if("-"!=i.value)s[o].data[n].value=g.accAdd(s[o].data[n].value,h.get(r,"value"));else s[o].data[n].value=h.get(r,"value");if(this.type===l.CHART_TYPE_FUNNEL||this.type===l.CHART_TYPE_PIE)d&&1===d.getRelatedAmount(i.name)&&this.component.legend.del(i.name),i.name+=this.option.nameConnector+h.get(r,"name"),d&&d.add(i.name,r.style.color||r.style.strokeColor)}else if("-"!=i)s[o].data[n]=g.accAdd(s[o].data[n],h.get(r,"value"));else s[o].data[n]=h.get(r,"value");t.dragIn=t.dragIn||!0,this.isDrop=!1;var u=this;setTimeout(function(){u.zr.trigger("mousemove",e.event)},300)}},ondragend:function(e,t){if(this.isDragend&&e.target&&!t.dragOut){var i=e.target,a=h.get(i,"seriesIndex"),r=h.get(i,"dataIndex"),o=this.series;if(null!=o[a].data[r].value){o[a].data[r].value="-";var n=o[a].data[r].name,s=this.component.legend;if(s&&0===s.getRelatedAmount(n))s.del(n)}else o[a].data[r]="-";t.dragOut=!0,t.needRefresh=!0,this.isDragend=!1}},onlegendSelected:function(e,t){var i=e.selected;for(var a in this.selectedMap){if(this.selectedMap[a]!=i[a])t.needRefresh=!0;this.selectedMap[a]=i[a]}},_buildPosition:function(){this._symbol=this.option.symbolList,this._sIndex2ShapeMap={},this._sIndex2ColorMap={},this.selectedMap={},this.xMarkMap={};for(var e,t,i,a,r=this.series,o={top:[],bottom:[],left:[],right:[],other:[]},n=0,s=r.length;s>n;n++)if(r[n].type===this.type)if(r[n]=this.reformOption(r[n]),this.legendHoverLink=r[n].legendHoverLink||this.legendHoverLink,e=r[n].xAxisIndex,t=r[n].yAxisIndex,i=this.component.xAxis.getAxis(e),a=this.component.yAxis.getAxis(t),i.type===l.COMPONENT_TYPE_AXIS_CATEGORY)o[i.getPosition()].push(n);else if(a.type===l.COMPONENT_TYPE_AXIS_CATEGORY)o[a.getPosition()].push(n);else o.other.push(n);for(var h in o)if(o[h].length>0)this._buildSinglePosition(h,o[h]);this.addShapeList()},_buildSinglePosition:function(e,t){var i=this._mapData(t),a=i.locationMap,r=i.maxDataLength;if(0!==r&&0!==a.length){switch(e){case"bottom":case"top":this._buildHorizontal(t,r,a,this.xMarkMap);break;case"left":case"right":this._buildVertical(t,r,a,this.xMarkMap);break;case"other":this._buildOther(t,r,a,this.xMarkMap)}for(var o=0,n=t.length;n>o;o++)this.buildMark(t[o])}},_mapData:function(e){for(var t,i,a,r,o=this.series,n=0,s={},h="__kener__stack__",d=this.component.legend,p=[],g=0,c=0,f=e.length;f>c;c++){if(t=o[e[c]],a=t.name,this._sIndex2ShapeMap[e[c]]=this._sIndex2ShapeMap[e[c]]||this.query(t,"symbol")||this._symbol[c%this._symbol.length],d){if(this.selectedMap[a]=d.isSelected(a),this._sIndex2ColorMap[e[c]]=d.getColor(a),r=d.getItemShape(a)){var m=r.style;if(this.type==l.CHART_TYPE_LINE)m.iconType="legendLineIcon",m.symbol=this._sIndex2ShapeMap[e[c]];else if(t.itemStyle.normal.barBorderWidth>0){var u=r.highlightStyle;m.brushType="both",m.x+=1,m.y+=1,m.width-=2,m.height-=2,m.strokeColor=u.strokeColor=t.itemStyle.normal.barBorderColor,u.lineWidth=3}d.setItemShape(a,r)}}else this.selectedMap[a]=!0,this._sIndex2ColorMap[e[c]]=this.zr.getColor(e[c]);if(this.selectedMap[a])if(i=t.stack||h+e[c],null==s[i])s[i]=n,p[n]=[e[c]],n++;else p[s[i]].push(e[c]);g=Math.max(g,t.data.length)}return{locationMap:p,maxDataLength:g}},_calculMarkMapXY:function(e,t,i){for(var a=this.series,r=0,o=t.length;o>r;r++)for(var n=0,s=t[r].length;s>n;n++){var l=t[r][n],h="xy"==i?0:"",d=this.component.grid,p=e[l];if("-1"!=i.indexOf("x")){if(p["counter"+h]>0)p["average"+h]=p["sum"+h]/p["counter"+h];var g=this.component.xAxis.getAxis(a[l].xAxisIndex||0).getCoord(p["average"+h]);p["averageLine"+h]=[[g,d.getYend()],[g,d.getY()]],p["minLine"+h]=[[p["minX"+h],d.getYend()],[p["minX"+h],d.getY()]],p["maxLine"+h]=[[p["maxX"+h],d.getYend()],[p["maxX"+h],d.getY()]],p.isHorizontal=!1}if(h="xy"==i?1:"","-1"!=i.indexOf("y")){if(p["counter"+h]>0)p["average"+h]=p["sum"+h]/p["counter"+h];var c=this.component.yAxis.getAxis(a[l].yAxisIndex||0).getCoord(p["average"+h]);p["averageLine"+h]=[[d.getX(),c],[d.getXend(),c]],p["minLine"+h]=[[d.getX(),p["minY"+h]],[d.getXend(),p["minY"+h]]],p["maxLine"+h]=[[d.getX(),p["maxY"+h]],[d.getXend(),p["maxY"+h]]],p.isHorizontal=!0}}},addLabel:function(e,t,i,a,r){var o=[i,t],n=this.deepMerge(o,"itemStyle.normal.label"),s=this.deepMerge(o,"itemStyle.emphasis.label"),l=n.textStyle||{},h=s.textStyle||{};if(n.show){var d=e.style;d.text=this._getLabelText(t,i,a,"normal"),d.textPosition=null==n.position?"horizontal"===r?"right":"top":n.position,d.textColor=l.color,d.textFont=this.getFont(l),d.textAlign=l.align,d.textBaseline=l.baseline}if(s.show){var p=e.highlightStyle;p.text=this._getLabelText(t,i,a,"emphasis"),p.textPosition=n.show?e.style.textPosition:null==s.position?"horizontal"===r?"right":"top":s.position,p.textColor=h.color,p.textFont=this.getFont(h),p.textAlign=h.align,p.textBaseline=h.baseline}return e},_getLabelText:function(e,t,i,a){var r=this.deepQuery([t,e],"itemStyle."+a+".label.formatter");if(!r&&"emphasis"===a)r=this.deepQuery([t,e],"itemStyle.normal.label.formatter");var o=this.getDataFromOption(t,"-");if(r){if("function"==typeof r)return r.call(this.myChart,{seriesName:e.name,series:e,name:i,value:o,data:t,status:a});else if("string"==typeof r)return r=r.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{a0}",e.name).replace("{b0}",i).replace("{c0}",this.numAddCommas(o))}else if(o instanceof Array)return null!=o[2]?this.numAddCommas(o[2]):o[0]+" , "+o[1];else return this.numAddCommas(o)},buildMark:function(e){var t=this.series[e];if(this.selectedMap[t.name])t.markLine&&this._buildMarkLine(e),t.markPoint&&this._buildMarkPoint(e)},_buildMarkPoint:function(e){for(var t,i,a=(this.markAttachStyle||{})[e],r=this.series[e],o=m.clone(r.markPoint),n=0,s=o.data.length;s>n;n++)if(t=o.data[n],i=this.getMarkCoord(e,t),t.x=null!=t.x?t.x:i[0],t.y=null!=t.y?t.y:i[1],t.type&&("max"===t.type||"min"===t.type))t.value=i[3],t.name=t.name||t.type,t.symbolSize=t.symbolSize||u.getTextWidth(i[3],this.getFont())/2+5;for(var h=this._markPoint(e,o),n=0,s=h.length;s>n;n++){var d=h[n];d.zlevel=this.getZlevelBase(),d.z=this.getZBase()+1;for(var p in a)d[p]=m.clone(a[p]);this.shapeList.push(d)}if(this.type===l.CHART_TYPE_FORCE||this.type===l.CHART_TYPE_CHORD)for(var n=0,s=h.length;s>n;n++)this.zr.addShape(h[n])},_buildMarkLine:function(e){for(var t,i=(this.markAttachStyle||{})[e],a=this.series[e],r=m.clone(a.markLine),o=0,n=r.data.length;n>o;o++){var h=r.data[o];if(h.type&&("max"===h.type||"min"===h.type||"average"===h.type))t=this.getMarkCoord(e,h),r.data[o]=[m.clone(h),{}],r.data[o][0].name=h.name||h.type,r.data[o][0].value="average"!==h.type?t[3]:+t[3].toFixed(null!=r.precision?r.precision:this.deepQuery([this.ecTheme,l],"markLine.precision")),t=t[2],h=[{},{}];else t=[this.getMarkCoord(e,h[0]),this.getMarkCoord(e,h[1])];if(null!=t&&null!=t[0]&&null!=t[1])r.data[o][0].x=null!=h[0].x?h[0].x:t[0][0],r.data[o][0].y=null!=h[0].y?h[0].y:t[0][1],r.data[o][1].x=null!=h[1].x?h[1].x:t[1][0],r.data[o][1].y=null!=h[1].y?h[1].y:t[1][1];else;}var d=this._markLine(e,r),p=r.large;if(p){var g=new s({style:{shapeList:d}}),c=d[0];if(c){m.merge(g.style,c.style),m.merge(g.highlightStyle={},c.highlightStyle),g.style.brushType="stroke",g.zlevel=this.getZlevelBase(),g.z=this.getZBase()+1,g.hoverable=!1;for(var f in i)g[f]=m.clone(i[f])}this.shapeList.push(g),this.zr.addShape(g),g._mark="largeLine";var u=r.effect;if(u.show)g.effect=u}else{for(var o=0,n=d.length;n>o;o++){var y=d[o];y.zlevel=this.getZlevelBase(),y.z=this.getZBase()+1;for(var f in i)y[f]=m.clone(i[f]);this.shapeList.push(y)}if(this.type===l.CHART_TYPE_FORCE||this.type===l.CHART_TYPE_CHORD)for(var o=0,n=d.length;n>o;o++)this.zr.addShape(d[o])}},_markPoint:function(e,t){var i=this.series[e],a=this.component;m.merge(m.merge(t,m.clone(this.ecTheme.markPoint||{})),m.clone(l.markPoint)),t.name=i.name;var r,o,n,s,d,p,g,c=[],f=t.data,u=a.dataRange,y=a.legend,x=this.zr.getWidth(),b=this.zr.getHeight();if(!t.large)for(var v=0,_=f.length;_>v;v++)if(null!=f[v].x&&null!=f[v].y){if(n=null!=f[v].value?f[v].value:"",y)o=y.getColor(i.name);if(u)if(o=isNaN(n)?o:u.getColor(n),s=[f[v],t],d=this.deepQuery(s,"itemStyle.normal.color")||o,p=this.deepQuery(s,"itemStyle.emphasis.color")||d,null==d&&null==p)continue;if(o=null==o?this.zr.getColor(e):o,f[v].tooltip=f[v].tooltip||t.tooltip||{trigger:"item"},f[v].name=null!=f[v].name?f[v].name:"",f[v].value=n,r=this.getSymbolShape(t,e,f[v],v,f[v].name,this.parsePercent(f[v].x,x),this.parsePercent(f[v].y,b),"pin",o,"rgba(0,0,0,0)","horizontal"),r._mark="point",g=this.deepMerge([f[v],t],"effect"),g.show)r.effect=g;if(i.type===l.CHART_TYPE_MAP)r._geo=this.getMarkGeo(f[v]);h.pack(r,i,e,f[v],v,f[v].name,n),c.push(r)}else;else r=this.getLargeMarkPointShape(e,t),r._mark="largePoint",r&&c.push(r);return c},_markLine:function(){function t(e,t){e[t]=e[t]instanceof Array?e[t].length>1?e[t]:[e[t][0],e[t][0]]:[e[t],e[t]]}return function(i,a){var r=this.series[i],o=this.component,n=o.dataRange,s=o.legend;m.merge(m.merge(a,m.clone(this.ecTheme.markLine||{})),m.clone(l.markLine));var d=s?s.getColor(r.name):this.zr.getColor(i);t(a,"symbol"),t(a,"symbolSize"),t(a,"symbolRotate");for(var p=a.data,g=[],c=this.zr.getWidth(),u=this.zr.getHeight(),y=0;y<p.length;y++){var x=p[y];if(e(x[0])&&e(x[1])){var b=this.deepMerge(x),v=[b,a],_=d,C=null!=b.value?b.value:"";if(n){_=isNaN(C)?_:n.getColor(C);var S=this.deepQuery(v,"itemStyle.normal.color")||_,M=this.deepQuery(v,"itemStyle.emphasis.color")||S;if(null==S&&null==M)continue}x[0].tooltip=b.tooltip||a.tooltip||{trigger:"item"},x[0].name=x[0].name||"",x[1].name=x[1].name||"",x[0].value=C,g.push({points:[[this.parsePercent(x[0].x,c),this.parsePercent(x[0].y,u)],[this.parsePercent(x[1].x,c),this.parsePercent(x[1].y,u)]],rawData:x,color:_})}}var k=this.query(a,"bundling.enable");if(k){var A=new f;A.maxTurningAngle=this.query(a,"bundling.maxTurningAngle")/180*Math.PI,g=A.run(g)}a.name=r.name;for(var I=[],y=0,z=g.length;z>y;y++){var L=g[y],T=L.rawEdge||L,x=T.rawData,C=null!=x.value?x.value:"",P=this.getMarkLineShape(a,i,x,y,L.points,k,T.color);P._mark="line";var B=this.deepMerge([x[0],x[1],a],"effect");if(B.show)P.effect=B,P.effect.large=a.large;if(r.type===l.CHART_TYPE_MAP)P._geo=[this.getMarkGeo(x[0]),this.getMarkGeo(x[1])];h.pack(P,r,i,x[0],y,x[0].name+(""!==x[1].name?" > "+x[1].name:""),C),I.push(P)}return I}}(),getMarkCoord:function(){return[0,0]},getSymbolShape:function(e,t,r,o,n,s,l,d,p,g,c){var f=[r,e],m=this.getDataFromOption(r,"-");d=this.deepQuery(f,"symbol")||d;var u=this.deepQuery(f,"symbolSize");u="function"==typeof u?u(m):u;var y=this.deepQuery(f,"symbolRotate"),x=this.deepMerge(f,"itemStyle.normal"),b=this.deepMerge(f,"itemStyle.emphasis"),v=null!=x.borderWidth?x.borderWidth:x.lineStyle&&x.lineStyle.width;if(null==v)v=d.match("empty")?2:0;var _=null!=b.borderWidth?b.borderWidth:b.lineStyle&&b.lineStyle.width;if(null==_)_=v+2;var C=this.getItemStyleColor(x.color,t,o,r),S=this.getItemStyleColor(b.color,t,o,r),M=new a({style:{iconType:d.replace("empty","").toLowerCase(),x:s-u,y:l-u,width:2*u,height:2*u,brushType:"both",color:d.match("empty")?g:C||p,strokeColor:x.borderColor||C||p,lineWidth:v},highlightStyle:{color:d.match("empty")?g:S||C||p,strokeColor:b.borderColor||x.borderColor||S||C||p,lineWidth:_},clickable:this.deepQuery(f,"clickable")});if(d.match("image"))M.style.image=d.replace(new RegExp("^image:\\/\\/"),""),M=new i({style:M.style,highlightStyle:M.highlightStyle,clickable:this.deepQuery(f,"clickable")});if(null!=y)M.rotation=[y*Math.PI/180,s,l];if(d.match("star"))M.style.iconType="star",M.style.n=d.replace("empty","").replace("star","")-0||5;if("none"===d)M.invisible=!0,M.hoverable=!1;if(M=this.addLabel(M,e,r,n,c),d.match("empty")){if(null==M.style.textColor)M.style.textColor=M.style.strokeColor;if(null==M.highlightStyle.textColor)M.highlightStyle.textColor=M.highlightStyle.strokeColor}return h.pack(M,e,t,r,o,n),M._x=s,M._y=l,M._dataIndex=o,M._seriesIndex=t,M},getMarkLineShape:function(e,t,i,a,o,s,l){var h=null!=i[0].value?i[0].value:"-",d=null!=i[1].value?i[1].value:"-",p=[i[0].symbol||e.symbol[0],i[1].symbol||e.symbol[1]],g=[i[0].symbolSize||e.symbolSize[0],i[1].symbolSize||e.symbolSize[1]];g[0]="function"==typeof g[0]?g[0](h):g[0],g[1]="function"==typeof g[1]?g[1](d):g[1];var c=[this.query(i[0],"symbolRotate")||e.symbolRotate[0],this.query(i[1],"symbolRotate")||e.symbolRotate[1]],f=[i[0],i[1],e],m=this.deepMerge(f,"itemStyle.normal");m.color=this.getItemStyleColor(m.color,t,a,i);var u=this.deepMerge(f,"itemStyle.emphasis");u.color=this.getItemStyleColor(u.color,t,a,i);var y=m.lineStyle,x=u.lineStyle,b=y.width;if(null==b)b=m.borderWidth;var v=x.width;if(null==v)v=null!=u.borderWidth?u.borderWidth:b+2;var _=this.deepQuery(f,"smoothness");if(!this.deepQuery(f,"smooth"))_=0;var C=s?n:r,S=new C({style:{symbol:p,symbolSize:g,symbolRotate:c,brushType:"both",lineType:y.type,shadowColor:y.shadowColor||y.color||m.borderColor||m.color||l,shadowBlur:y.shadowBlur,shadowOffsetX:y.shadowOffsetX,shadowOffsetY:y.shadowOffsetY,color:m.color||l,strokeColor:y.color||m.borderColor||m.color||l,lineWidth:b,symbolBorderColor:m.borderColor||m.color||l,symbolBorder:m.borderWidth},highlightStyle:{shadowColor:x.shadowColor,shadowBlur:x.shadowBlur,shadowOffsetX:x.shadowOffsetX,shadowOffsetY:x.shadowOffsetY,color:u.color||m.color||l,strokeColor:x.color||y.color||u.borderColor||m.borderColor||u.color||m.color||l,lineWidth:v,symbolBorderColor:u.borderColor||m.borderColor||u.color||m.color||l,symbolBorder:null==u.borderWidth?m.borderWidth+2:u.borderWidth},clickable:this.deepQuery(f,"clickable")}),M=S.style;if(s)M.pointList=o,M.smooth=_;else M.xStart=o[0][0],M.yStart=o[0][1],M.xEnd=o[1][0],M.yEnd=o[1][1],M.curveness=_,S.updatePoints(S.style);return S=this.addLabel(S,e,i[0],i[0].name+" : "+i[1].name)},getLargeMarkPointShape:function(e,t){var i,a,r,n,s,l,h=this.series[e],d=this.component,p=t.data,g=d.dataRange,c=d.legend,f=[p[0],t];if(c)a=c.getColor(h.name);if(g)if(r=null!=p[0].value?p[0].value:"",a=isNaN(r)?a:g.getColor(r),n=this.deepQuery(f,"itemStyle.normal.color")||a,s=this.deepQuery(f,"itemStyle.emphasis.color")||n,null==n&&null==s)return;a=this.deepMerge(f,"itemStyle.normal").color||a;var m=this.deepQuery(f,"symbol")||"circle";m=m.replace("empty","").replace(/\d/g,""),l=this.deepMerge([p[0],t],"effect");var u=window.devicePixelRatio||1;if(i=new o({style:{pointList:p,color:a,strokeColor:a,shadowColor:l.shadowColor||a,shadowBlur:(null!=l.shadowBlur?l.shadowBlur:8)*u,size:this.deepQuery(f,"symbolSize"),iconType:m,brushType:"fill",lineWidth:1},draggable:!1,hoverable:!1}),l.show)i.effect=l;return i},backupShapeList:function(){if(this.shapeList&&this.shapeList.length>0)this.lastShapeList=this.shapeList,this.shapeList=[];else this.lastShapeList=[]},addShapeList:function(){var e,t,i=this.option.animationThreshold/(this.canvasSupported?2:4),a=this.lastShapeList,r=this.shapeList,o=a.length>0,n=o?this.query(this.option,"animationDurationUpdate"):this.query(this.option,"animationDuration"),s=this.query(this.option,"animationEasing"),h={},d={};if(this.option.animation&&!this.option.renderAsImage&&r.length<i&&!this.motionlessOnce){for(var p=0,g=a.length;g>p;p++)if(t=this._getAnimationKey(a[p]),t.match("undefined"))this.zr.delShape(a[p].id);else if(t+=a[p].type,h[t])this.zr.delShape(a[p].id);else h[t]=a[p];for(var p=0,g=r.length;g>p;p++)if(t=this._getAnimationKey(r[p]),t.match("undefined"))this.zr.addShape(r[p]);else t+=r[p].type,d[t]=r[p];for(t in h)if(!d[t])this.zr.delShape(h[t].id);for(t in d)if(h[t])this.zr.delShape(h[t].id),this._animateMod(h[t],d[t],n,s,0,o);else e=(this.type==l.CHART_TYPE_LINE||this.type==l.CHART_TYPE_RADAR)&&0!==t.indexOf("icon")?n/2:0,this._animateMod(!1,d[t],n,s,e,o);this.zr.refresh(),this.animationEffect()}else{this.motionlessOnce=!1,this.zr.delShape(a);for(var p=0,g=r.length;g>p;p++)this.zr.addShape(r[p])}},_getAnimationKey:function(e){if(this.type!=l.CHART_TYPE_MAP)return h.get(e,"seriesIndex")+"_"+h.get(e,"dataIndex")+(e._mark?e._mark:"")+(this.type===l.CHART_TYPE_RADAR?h.get(e,"special"):"");else return h.get(e,"seriesIndex")+"_"+h.get(e,"dataIndex")+(e._mark?e._mark:"undefined")},_animateMod:function(e,t,i,a,r,o){switch(t.type){case"polyline":case"half-smooth-polygon":d.pointList(this.zr,e,t,i,a);break;case"rectangle":d.rectangle(this.zr,e,t,i,a);break;case"image":case"icon":d.icon(this.zr,e,t,i,a,r);break;case"candle":if(!o)d.candle(this.zr,e,t,i,a);else this.zr.addShape(t);break;case"ring":case"sector":case"circle":if(!o)d.ring(this.zr,e,t,i+(h.get(t,"dataIndex")||0)%20*100,a);else if("sector"===t.type)d.sector(this.zr,e,t,i,a);else this.zr.addShape(t);break;case"text":d.text(this.zr,e,t,i,a);break;case"polygon":if(!o)d.polygon(this.zr,e,t,i,a);else d.pointList(this.zr,e,t,i,a);break;case"ribbon":d.ribbon(this.zr,e,t,i,a);break;case"gauge-pointer":d.gaugePointer(this.zr,e,t,i,a);break;case"mark-line":d.markline(this.zr,e,t,i,a);break;case"bezier-curve":case"line":d.line(this.zr,e,t,i,a);break;default:this.zr.addShape(t)}},animationMark:function(e,t,i){for(var i=i||this.shapeList,a=0,r=i.length;r>a;a++)if(i[a]._mark)this._animateMod(!1,i[a],e,t,0,!0);else;this.animationEffect(i)},animationEffect:function(e){if(!e&&this.clearEffectShape(),e=e||this.shapeList,null!=e){var t=l.EFFECT_ZLEVEL;if(this.canvasSupported)this.zr.modLayer(t,{motionBlur:!0,lastFrameAlpha:.95});for(var i,a=0,r=e.length;r>a;a++)if(i=e[a],i._mark&&i.effect&&i.effect.show&&p[i._mark])p[i._mark](this.zr,this.effectList,i,t),this.effectList[this.effectList.length-1]._mark=i._mark;else;}},clearEffectShape:function(e){var t=this.effectList;if(this.zr&&t&&t.length>0){e&&this.zr.modLayer(l.EFFECT_ZLEVEL,{motionBlur:!1}),this.zr.delShape(t);for(var i=0;i<t.length;i++)if(t[i].effectAnimator)t[i].effectAnimator.stop()}this.effectList=[]},addMark:function(e,t,i){var a=this.series[e];if(this.selectedMap[a.name]){var r=this.query(this.option,"animationDurationUpdate"),o=this.query(this.option,"animationEasing"),n=a[i].data,s=this.shapeList.length;if(a[i].data=t.data,this["_build"+i.replace("m","M")](e),this.option.animation&&!this.option.renderAsImage)this.animationMark(r,o,this.shapeList.slice(s));else{for(var l=s,h=this.shapeList.length;h>l;l++)this.zr.addShape(this.shapeList[l]);this.zr.refreshNextFrame()}a[i].data=n}},delMark:function(e,t,i){i=i.replace("mark","").replace("large","").toLowerCase();var a=this.series[e];if(this.selectedMap[a.name]){for(var r=!1,o=[this.shapeList,this.effectList],n=2;n--;)for(var s=0,l=o[n].length;l>s;s++)if(o[n][s]._mark==i&&h.get(o[n][s],"seriesIndex")==e&&h.get(o[n][s],"name")==t){this.zr.delShape(o[n][s].id),o[n].splice(s,1),r=!0;break}r&&this.zr.refreshNextFrame()}}},m.inherits(t,c),t});