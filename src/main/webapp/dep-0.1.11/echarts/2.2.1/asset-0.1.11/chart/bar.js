define("echarts/chart/bar",["require","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(require){function e(e,i,r,a,o){t.call(this,e,i,r,a,o),this.refresh(a)}var t=require("./base"),i=require("zrender/shape/Rectangle");require("../component/axis"),require("../component/grid"),require("../component/dataZoom");var r=require("../config");r.bar={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,barMinHeight:0,barGap:"30%",barCategoryGap:"20%",itemStyle:{normal:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}},emphasis:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}}}};var a=require("../util/ecData"),o=require("zrender/tool/util"),n=require("zrender/tool/color");return e.prototype={type:r.CHART_TYPE_BAR,_buildShape:function(){this._buildPosition()},_buildNormal:function(e,t,a,o,n){for(var s,l,h,d,p,g,f,x,c,u,m,y,b=this.series,_=a[0][0],v=b[_],A="horizontal"==n,I=this.component.xAxis,C=this.component.yAxis,M=A?I.getAxis(v.xAxisIndex):C.getAxis(v.yAxisIndex),B=this._mapSize(M,a),N=B.gap,W=B.barGap,z=B.barWidthMap,S=B.barMaxWidthMap,k=B.barWidth,T=B.barMinHeightMap,O=B.interval,P=this.deepQuery([this.ecTheme,r],"island.r"),L=0,w=t;w>L&&null!=M.getNameByIndex(L);L++){A?d=M.getCoordByIndex(L)-N/2:p=M.getCoordByIndex(L)+N/2;for(var Y=0,E=a.length;E>Y;Y++){var G=b[a[Y][0]].yAxisIndex||0,F=b[a[Y][0]].xAxisIndex||0;s=A?C.getAxis(G):I.getAxis(F),f=g=c=x=s.getCoord(0);for(var X=0,H=a[Y].length;H>X;X++)if(_=a[Y][X],v=b[_],m=v.data[L],y=this.getDataFromOption(m,"-"),o[_]=o[_]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},h=Math.min(S[_]||Number.MAX_VALUE,z[_]||k),"-"!==y){if(y>0){if(l=X>0?s.getCoordSize(y):A?f-s.getCoord(y):s.getCoord(y)-f,1===H&&T[_]>l)l=T[_];if(A)g-=l,p=g;else d=g,g+=l}else if(0>y){if(l=X>0?s.getCoordSize(y):A?s.getCoord(y)-c:c-s.getCoord(y),1===H&&T[_]>l)l=T[_];if(A)p=x,x+=l;else x-=l,d=x}else if(l=0,A)g-=l,p=g;else d=g,g+=l;if(o[_][L]=A?d+h/2:p-h/2,o[_].min>y)if(o[_].min=y,A)o[_].minY=p,o[_].minX=o[_][L];else o[_].minX=d+l,o[_].minY=o[_][L];if(o[_].max<y)if(o[_].max=y,A)o[_].maxY=p,o[_].maxX=o[_][L];else o[_].maxX=d+l,o[_].maxY=o[_][L];if(o[_].sum+=y,o[_].counter++,L%O===0)u=this._getBarItem(_,L,M.getNameByIndex(L),d,p-(A?0:h),A?h:l,A?l:h,A?"vertical":"horizontal"),this.shapeList.push(new i(u))}else;for(var X=0,H=a[Y].length;H>X;X++)if(_=a[Y][X],v=b[_],m=v.data[L],y=this.getDataFromOption(m,"-"),h=Math.min(S[_]||Number.MAX_VALUE,z[_]||k),"-"==y){if(this.deepQuery([m,v,this.option],"calculable")){if(A)g-=P,p=g;else d=g,g+=P;u=this._getBarItem(_,L,M.getNameByIndex(L),d,p-(A?0:h),A?h:P,A?P:h,A?"vertical":"horizontal"),u.hoverable=!1,u.draggable=!1,u.style.lineWidth=1,u.style.brushType="stroke",u.style.strokeColor=v.calculableHolderColor||this.ecTheme.calculableHolderColor||r.calculableHolderColor,this.shapeList.push(new i(u))}}else;A?d+=h+W:p-=h+W}}this._calculMarkMapXY(o,a,A?"y":"x")},_buildHorizontal:function(e,t,i,r){return this._buildNormal(e,t,i,r,"horizontal")},_buildVertical:function(e,t,i,r){return this._buildNormal(e,t,i,r,"vertical")},_buildOther:function(e,t,r,a){for(var o=this.series,n=0,s=r.length;s>n;n++)for(var l=0,h=r[n].length;h>l;l++){var d=r[n][l],p=o[d],g=p.xAxisIndex||0,f=this.component.xAxis.getAxis(g),x=f.getCoord(0),c=p.yAxisIndex||0,u=this.component.yAxis.getAxis(c),m=u.getCoord(0);a[d]=a[d]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var y=0,b=p.data.length;b>y;y++){var _=p.data[y],v=this.getDataFromOption(_,"-");if(v instanceof Array){var A,I,C=f.getCoord(v[0]),M=u.getCoord(v[1]),B=[_,p],N=this.deepQuery(B,"barWidth")||10,W=this.deepQuery(B,"barHeight");if(null!=W){if(A="horizontal",v[0]>0)N=C-x,C-=N;else if(v[0]<0)N=x-C;else N=0;I=this._getBarItem(d,y,v[0],C,M-W/2,N,W,A)}else{if(A="vertical",v[1]>0)W=m-M;else if(v[1]<0)W=M-m,M-=W;else W=0;I=this._getBarItem(d,y,v[0],C-N/2,M,N,W,A)}if(this.shapeList.push(new i(I)),C=f.getCoord(v[0]),M=u.getCoord(v[1]),a[d].min0>v[0])a[d].min0=v[0],a[d].minY0=M,a[d].minX0=C;if(a[d].max0<v[0])a[d].max0=v[0],a[d].maxY0=M,a[d].maxX0=C;if(a[d].sum0+=v[0],a[d].counter0++,a[d].min1>v[1])a[d].min1=v[1],a[d].minY1=M,a[d].minX1=C;if(a[d].max1<v[1])a[d].max1=v[1],a[d].maxY1=M,a[d].maxX1=C;a[d].sum1+=v[1],a[d].counter1++}else;}}this._calculMarkMapXY(a,r,"xy")},_mapSize:function(e,t,i){var r,a,o=this._findSpecialBarSzie(t,i),n=o.barWidthMap,s=o.barMaxWidthMap,l=o.barMinHeightMap,h=o.sBarWidthCounter,d=o.sBarWidthTotal,p=o.barGap,g=o.barCategoryGap,f=1;if(t.length!=h){if(!i){if(r="string"==typeof g&&g.match(/%$/)?(e.getGap()*(100-parseFloat(g))/100).toFixed(2)-0:e.getGap()-g,"string"==typeof p&&p.match(/%$/))p=parseFloat(p)/100,a=+((r-d)/((t.length-1)*p+t.length-h)).toFixed(2),p=a*p;else p=parseFloat(p),a=+((r-d-p*(t.length-1))/(t.length-h)).toFixed(2);if(0>=a)return this._mapSize(e,t,!0)}else if(r=e.getGap(),p=0,a=+(r/t.length).toFixed(2),0>=a)f=Math.floor(t.length/r),a=1}else if(r=h>1?"string"==typeof g&&g.match(/%$/)?+(e.getGap()*(100-parseFloat(g))/100).toFixed(2):e.getGap()-g:d,a=0,p=h>1?+((r-d)/(h-1)).toFixed(2):0,0>p)return this._mapSize(e,t,!0);return this._recheckBarMaxWidth(t,n,s,l,r,a,p,f)},_findSpecialBarSzie:function(e,t){for(var i,r,a,o,n=this.series,s={},l={},h={},d=0,p=0,g=0,f=e.length;f>g;g++)for(var x={barWidth:!1,barMaxWidth:!1},c=0,u=e[g].length;u>c;c++){var m=e[g][c],y=n[m];if(!t){if(!x.barWidth){if(i=this.query(y,"barWidth"),null!=i){s[m]=i,p+=i,d++,x.barWidth=!0;for(var b=0,_=c;_>b;b++){var v=e[g][b];s[v]=i}}}else s[m]=i;if(!x.barMaxWidth){if(r=this.query(y,"barMaxWidth"),null!=r){l[m]=r,x.barMaxWidth=!0;for(var b=0,_=c;_>b;b++){var v=e[g][b];l[v]=r}}}else l[m]=r}h[m]=this.query(y,"barMinHeight"),a=null!=a?a:this.query(y,"barGap"),o=null!=o?o:this.query(y,"barCategoryGap")}return{barWidthMap:s,barMaxWidthMap:l,barMinHeightMap:h,sBarWidth:i,sBarMaxWidth:r,sBarWidthCounter:d,sBarWidthTotal:p,barGap:a,barCategoryGap:o}},_recheckBarMaxWidth:function(e,t,i,r,a,o,n,s){for(var l=0,h=e.length;h>l;l++){var d=e[l][0];if(i[d]&&i[d]<o)a-=o-i[d]}return{barWidthMap:t,barMaxWidthMap:i,barMinHeightMap:r,gap:a,barWidth:o,barGap:n,interval:s}},_getBarItem:function(e,t,i,r,o,s,l,h){var d,p=this.series,g=p[e],f=g.data[t],x=this._sIndex2ColorMap[e],c=[f,g],u=this.deepMerge(c,"itemStyle.normal"),m=this.deepMerge(c,"itemStyle.emphasis"),y=u.barBorderWidth;d={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(c,"clickable"),style:{x:r,y:o,width:s,height:l,brushType:"both",color:this.getItemStyleColor(this.deepQuery(c,"itemStyle.normal.color")||x,e,t,f),radius:u.barBorderRadius,lineWidth:y,strokeColor:u.barBorderColor},highlightStyle:{color:this.getItemStyleColor(this.deepQuery(c,"itemStyle.emphasis.color"),e,t,f),radius:m.barBorderRadius,lineWidth:m.barBorderWidth,strokeColor:m.barBorderColor},_orient:h};var b=d.style;if(d.highlightStyle.color=d.highlightStyle.color||("string"==typeof b.color?n.lift(b.color,-.3):b.color),b.x=Math.floor(b.x),b.y=Math.floor(b.y),b.height=Math.ceil(b.height),b.width=Math.ceil(b.width),y>0&&b.height>y&&b.width>y)b.y+=y/2,b.height-=y,b.x+=y/2,b.width-=y;else b.brushType="fill";d.highlightStyle.textColor=d.highlightStyle.color,d=this.addLabel(d,g,f,i,h);for(var _=[b,d.highlightStyle],v=0,A=_.length;A>v;v++){var I=_[v].textPosition;if("insideLeft"===I||"insideRight"===I||"insideTop"===I||"insideBottom"===I){var C=5;switch(I){case"insideLeft":_[v].textX=b.x+C,_[v].textY=b.y+b.height/2,_[v].textAlign="left",_[v].textBaseline="middle";break;case"insideRight":_[v].textX=b.x+b.width-C,_[v].textY=b.y+b.height/2,_[v].textAlign="right",_[v].textBaseline="middle";break;case"insideTop":_[v].textX=b.x+b.width/2,_[v].textY=b.y+C/2,_[v].textAlign="center",_[v].textBaseline="top";break;case"insideBottom":_[v].textX=b.x+b.width/2,_[v].textY=b.y+b.height-C/2,_[v].textAlign="center",_[v].textBaseline="bottom"}_[v].textPosition="specific",_[v].textColor=_[v].textColor||"#fff"}}if(this.deepQuery([f,g,this.option],"calculable"))this.setCalculable(d),d.draggable=!0;return a.pack(d,p[e],e,p[e].data[t],t,i),d},getMarkCoord:function(e,t){var i,r,a=this.series[e],o=this.xMarkMap[e],n=this.component.xAxis.getAxis(a.xAxisIndex),s=this.component.yAxis.getAxis(a.yAxisIndex);if(t.type&&("max"===t.type||"min"===t.type||"average"===t.type)){var l=null!=t.valueIndex?t.valueIndex:null!=o.maxX0?"1":"";r=[o[t.type+"X"+l],o[t.type+"Y"+l],o[t.type+"Line"+l],o[t.type+l]]}else if(o.isHorizontal){i="string"==typeof t.xAxis&&n.getIndexByName?n.getIndexByName(t.xAxis):t.xAxis||0;var h=o[i];h=null!=h?h:"string"!=typeof t.xAxis&&n.getCoordByIndex?n.getCoordByIndex(t.xAxis||0):n.getCoord(t.xAxis||0),r=[h,s.getCoord(t.yAxis||0)]}else{i="string"==typeof t.yAxis&&s.getIndexByName?s.getIndexByName(t.yAxis):t.yAxis||0;var d=o[i];d=null!=d?d:"string"!=typeof t.yAxis&&s.getCoordByIndex?s.getCoordByIndex(t.yAxis||0):s.getCoord(t.yAxis||0),r=[n.getCoord(t.xAxis||0),d]}return r},refresh:function(e){if(e)this.option=e,this.series=e.series;this.backupShapeList(),this._buildShape()},addDataAnimation:function(e,t){function i(){if(c--,0===c)t&&t()}for(var r=this.series,o={},n=0,s=e.length;s>n;n++)o[e[n][0]]=e[n];for(var l,h,d,p,g,f,x,c=0,n=this.shapeList.length-1;n>=0;n--)if(f=a.get(this.shapeList[n],"seriesIndex"),o[f]&&!o[f][3])if("rectangle"===this.shapeList[n].type){if(x=a.get(this.shapeList[n],"dataIndex"),g=r[f],o[f][2]&&x===g.data.length-1){this.zr.delShape(this.shapeList[n].id);continue}else if(!o[f][2]&&0===x){this.zr.delShape(this.shapeList[n].id);continue}if("horizontal"===this.shapeList[n]._orient)p=this.component.yAxis.getAxis(g.yAxisIndex||0).getGap(),d=o[f][2]?-p:p,l=0;else h=this.component.xAxis.getAxis(g.xAxisIndex||0).getGap(),l=o[f][2]?h:-h,d=0;this.shapeList[n].position=[0,0],c++,this.zr.animate(this.shapeList[n].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[l,d]}).done(i).start()}if(!c)i()}},o.inherits(e,t),require("../chart").define("bar",e),e});