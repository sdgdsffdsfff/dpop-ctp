define("echarts/chart/island",["require","./base","zrender/shape/Circle","../config","../util/ecData","zrender/tool/util","zrender/tool/event","zrender/tool/color","../util/accMath","../chart"],function(require){function e(e,i,a,s,l){t.call(this,e,i,a,s,l),this._nameConnector,this._valueConnector,this._zrHeight=this.zr.getHeight(),this._zrWidth=this.zr.getWidth();var n=this;n.shapeHandler.onmousewheel=function(e){var t=e.target,i=e.event,a=o.getDelta(i);a=a>0?-1:1,t.style.r-=a,t.style.r=t.style.r<5?5:t.style.r;var s=r.get(t,"value"),l=s*n.option.island.calculateStep;s=l>1?Math.round(s-l*a):+(s-l*a).toFixed(2);var h=r.get(t,"name");t.style.text=h+":"+s,r.set(t,"value",s),r.set(t,"name",h),n.zr.modShape(t.id),n.zr.refreshNextFrame(),o.stop(i)}}var t=require("./base"),i=require("zrender/shape/Circle"),a=require("../config");a.island={zlevel:0,z:5,r:15,calculateStep:.1};var r=require("../util/ecData"),s=require("zrender/tool/util"),o=require("zrender/tool/event");return e.prototype={type:a.CHART_TYPE_ISLAND,_combine:function(e,t){var i=require("zrender/tool/color"),a=require("../util/accMath"),s=a.accAdd(r.get(e,"value"),r.get(t,"value")),o=r.get(e,"name")+this._nameConnector+r.get(t,"name");e.style.text=o+this._valueConnector+s,r.set(e,"value",s),r.set(e,"name",o),e.style.r=this.option.island.r,e.style.color=i.mix(e.style.color,t.style.color)},refresh:function(e){if(e)e.island=this.reformOption(e.island),this.option=e,this._nameConnector=this.option.nameConnector,this._valueConnector=this.option.valueConnector},getOption:function(){return this.option},resize:function(){var e=this.zr.getWidth(),t=this.zr.getHeight(),i=e/(this._zrWidth||e),a=t/(this._zrHeight||t);if(1!==i||1!==a){this._zrWidth=e,this._zrHeight=t;for(var r=0,s=this.shapeList.length;s>r;r++)this.zr.modShape(this.shapeList[r].id,{style:{x:Math.round(this.shapeList[r].style.x*i),y:Math.round(this.shapeList[r].style.y*a)}})}},add:function(e){var t=r.get(e,"name"),a=r.get(e,"value"),s=null!=r.get(e,"series")?r.get(e,"series").name:"",o=this.getFont(this.option.island.textStyle),l={zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:e.style.x,y:e.style.y,r:this.option.island.r,color:e.style.color||e.style.strokeColor,text:t+this._valueConnector+a,textFont:o},draggable:!0,hoverable:!0,onmousewheel:this.shapeHandler.onmousewheel,_type:"island"};if("#fff"===l.style.color)l.style.color=e.style.strokeColor;this.setCalculable(l),l.dragEnableTime=0,r.pack(l,{name:s},-1,a,-1,t),l=new i(l),this.shapeList.push(l),this.zr.addShape(l)},del:function(e){this.zr.delShape(e.id);for(var t=[],i=0,a=this.shapeList.length;a>i;i++)if(this.shapeList[i].id!=e.id)t.push(this.shapeList[i]);this.shapeList=t},ondrop:function(e,t){if(this.isDrop&&e.target){var i=e.target,a=e.dragged;this._combine(i,a),this.zr.modShape(i.id),t.dragIn=!0,this.isDrop=!1}},ondragend:function(e,t){var i=e.target;if(!this.isDragend){if(!t.dragIn)i.style.x=o.getX(e.event),i.style.y=o.getY(e.event),this.add(i),t.needRefresh=!0}else if(t.dragIn)this.del(i),t.needRefresh=!0;this.isDragend=!1}},s.inherits(e,t),require("../chart").define("island",e),e});