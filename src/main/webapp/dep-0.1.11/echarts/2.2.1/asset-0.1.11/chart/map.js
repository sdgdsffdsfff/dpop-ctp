define("echarts/chart/map",["require","./base","zrender/shape/Text","zrender/shape/Path","zrender/shape/Circle","zrender/shape/Rectangle","zrender/shape/Line","zrender/shape/Polygon","zrender/shape/Ellipse","../component/dataRange","../component/roamController","../config","../util/ecData","zrender/tool/util","zrender/config","zrender/tool/event","../util/mapData/params","../util/mapData/textFixed","../util/mapData/geoCoord","../util/projection/svg","../util/projection/normal","../chart"],function(require){function e(e,i,a,s,r){t.call(this,e,i,a,s,r);var o=this;o._onmousewheel=function(e){return o.__onmousewheel(e)},o._onmousedown=function(e){return o.__onmousedown(e)},o._onmousemove=function(e){return o.__onmousemove(e)},o._onmouseup=function(e){return o.__onmouseup(e)},o._onroamcontroller=function(e){return o.__onroamcontroller(e)},o._ondrhoverlink=function(e){return o.__ondrhoverlink(e)},this._isAlive=!0,this._selectedMode={},this._activeMapType={},this._clickable={},this._hoverable={},this._showLegendSymbol={},this._selected={},this._mapTypeMap={},this._mapDataMap={},this._nameMap={},this._specialArea={},this._refreshDelayTicket,this._mapDataRequireCounter,this._markAnimation=!1,this._hoverLinkMap={},this._roamMap={},this._scaleLimitMap={},this._mx,this._my,this._mousedown,this._justMove,this._curMapType,this.refresh(s),this.zr.on(c.EVENT.MOUSEWHEEL,this._onmousewheel),this.zr.on(c.EVENT.MOUSEDOWN,this._onmousedown),i.bind(h.EVENT.ROAMCONTROLLER,this._onroamcontroller),i.bind(h.EVENT.DATA_RANGE_HOVERLINK,this._ondrhoverlink)}var t=require("./base"),i=require("zrender/shape/Text"),a=require("zrender/shape/Path"),s=require("zrender/shape/Circle"),r=require("zrender/shape/Rectangle"),o=require("zrender/shape/Line"),n=require("zrender/shape/Polygon"),l=require("zrender/shape/Ellipse");require("../component/dataRange"),require("../component/roamController");var h=require("../config");h.map={zlevel:0,z:2,mapType:"china",mapValuePrecision:0,showLegendSymbol:!0,dataRangeHoverLink:!0,hoverable:!0,clickable:!0,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,areaStyle:{color:"#ccc"},label:{show:!1,textStyle:{color:"rgb(139,69,19)"}}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,areaStyle:{color:"rgba(255,215,0,0.8)"},label:{show:!1,textStyle:{color:"rgb(100,0,0)"}}}}};var d=require("../util/ecData"),p=require("zrender/tool/util"),c=require("zrender/config"),u=require("zrender/tool/event"),g=require("../util/mapData/params").params,f=require("../util/mapData/textFixed"),m=require("../util/mapData/geoCoord");return e.prototype={type:h.CHART_TYPE_MAP,_buildShape:function(){var e=this.series;this.selectedMap={},this._activeMapType={};for(var t,i,a,s,r=this.component.legend,o={},n={},l={},d={},c=0,u=e.length;u>c;c++)if(e[c].type==h.CHART_TYPE_MAP){if(e[c]=this.reformOption(e[c]),i=e[c].mapType,n[i]=n[i]||{},n[i][c]=!0,l[i]=l[i]||e[c].mapValuePrecision,this._scaleLimitMap[i]=this._scaleLimitMap[i]||{},e[c].scaleLimit&&p.merge(this._scaleLimitMap[i],e[c].scaleLimit,!0),this._roamMap[i]=e[c].roam||this._roamMap[i],this._hoverLinkMap[i]=e[c].dataRangeHoverLink||this._hoverLinkMap[i],this._nameMap[i]=this._nameMap[i]||{},e[c].nameMap&&p.merge(this._nameMap[i],e[c].nameMap,!0),this._activeMapType[i]=!0,e[c].textFixed)p.merge(f,e[c].textFixed,!0);if(e[c].geoCoord)p.merge(m,e[c].geoCoord,!0);if(this._selectedMode[i]=this._selectedMode[i]||e[c].selectedMode,null==this._hoverable[i]||this._hoverable[i])this._hoverable[i]=e[c].hoverable;if(null==this._clickable[i]||this._clickable[i])this._clickable[i]=e[c].clickable;if(null==this._showLegendSymbol[i]||this._showLegendSymbol[i])this._showLegendSymbol[i]=e[c].showLegendSymbol;if(d[i]=d[i]||e[c].mapValueCalculation,t=e[c].name,this.selectedMap[t]=r?r.isSelected(t):!0,this.selectedMap[t]){o[i]=o[i]||{},a=e[c].data;for(var y=0,v=a.length;v>y;y++){s=this._nameChange(i,a[y].name),o[i][s]=o[i][s]||{seriesIndex:[]};for(var b in a[y])if("value"!=b)o[i][s][b]=a[y][b];else if(!isNaN(a[y].value))null==o[i][s].value&&(o[i][s].value=0),o[i][s].value+=+a[y].value;o[i][s].seriesIndex.push(c)}}}this._mapDataRequireCounter=0;for(var _ in o)this._mapDataRequireCounter++;if(this._clearSelected(),0===this._mapDataRequireCounter)this.clear(),this.zr&&this.zr.delShape(this.lastShapeList),this.lastShapeList=[];for(var _ in o){if(d[_]&&"average"==d[_])for(var v in o[_])o[_][v].value=(o[_][v].value/o[_][v].seriesIndex.length).toFixed(l[_])-0;if(this._mapDataMap[_]=this._mapDataMap[_]||{},this._mapDataMap[_].mapData)this._mapDataCallback(_,o[_],n[_])(this._mapDataMap[_].mapData);else if(g[_.replace(/\|.*/,"")].getGeoJson)this._specialArea[_]=g[_.replace(/\|.*/,"")].specialArea||this._specialArea[_],g[_.replace(/\|.*/,"")].getGeoJson(this._mapDataCallback(_,o[_],n[_]))}},_mapDataCallback:function(e,t,i){var a=this;return function(s){if(a._isAlive&&null!=a._activeMapType[e]){if(-1!=e.indexOf("|"))s=a._getSubMapData(e,s);if(a._mapDataMap[e].mapData=s,s.firstChild)a._mapDataMap[e].rate=1,a._mapDataMap[e].projection=require("../util/projection/svg");else a._mapDataMap[e].rate=.75,a._mapDataMap[e].projection=require("../util/projection/normal");if(a._buildMap(e,a._getProjectionData(e,s,i),t,i),a._buildMark(e,i),--a._mapDataRequireCounter<=0)a.addShapeList(),a.zr.refreshNextFrame()}}},_clearSelected:function(){for(var e in this._selected)if(!this._activeMapType[this._mapTypeMap[e]])delete this._selected[e],delete this._mapTypeMap[e]},_getSubMapData:function(e,t){for(var i=e.replace(/^.*\|/,""),a=t.features,s=0,r=a.length;r>s;s++)if(a[s].properties&&a[s].properties.name==i){if(a=a[s],"United States of America"==i&&a.geometry.coordinates.length>1)a={geometry:{coordinates:a.geometry.coordinates.slice(5,6),type:a.geometry.type},id:a.id,properties:a.properties,type:a.type};break}return{type:"FeatureCollection",features:[a]}},_getProjectionData:function(e,t,i){var a,s=this._mapDataMap[e].projection,r=[],o=this._mapDataMap[e].bbox||s.getBbox(t,this._specialArea[e]);if(!this._mapDataMap[e].hasRoam)a=this._getTransform(o,i,this._mapDataMap[e].rate);else a=this._mapDataMap[e].transform;var n,l=this._mapDataMap[e].lastTransform||{scale:{}};if(a.left!=l.left||a.top!=l.top||a.scale.x!=l.scale.x||a.scale.y!=l.scale.y)n=s.geoJson2Path(t,a,this._specialArea[e]),l=p.clone(a);else a=this._mapDataMap[e].transform,n=this._mapDataMap[e].pathArray;this._mapDataMap[e].bbox=o,this._mapDataMap[e].transform=a,this._mapDataMap[e].lastTransform=l,this._mapDataMap[e].pathArray=n;for(var h=[a.left,a.top],d=0,c=n.length;c>d;d++)r.push(this._getSingleProvince(e,n[d],h));if(this._specialArea[e])for(var u in this._specialArea[e])r.push(this._getSpecialProjectionData(e,t,u,this._specialArea[e][u],h));if("china"==e){var y=this.geo2pos(e,m["南海诸岛"]||g["南海诸岛"].textCoord),v=a.scale.x/10.5,b=[32*v+y[0],83*v+y[1]];if(f["南海诸岛"])b[0]+=f["南海诸岛"][0],b[1]+=f["南海诸岛"][1];r.push({name:this._nameChange(e,"南海诸岛"),path:g["南海诸岛"].getPath(y,v),position:h,textX:b[0],textY:b[1]})}return r},_getSpecialProjectionData:function(e,t,i,a,s){t=this._getSubMapData("x|"+i,t);var r=require("../util/projection/normal"),o=r.getBbox(t),n=this.geo2pos(e,[a.left,a.top]),l=this.geo2pos(e,[a.left+a.width,a.top+a.height]),h=Math.abs(l[0]-n[0]),d=Math.abs(l[1]-n[1]),p=o.width,c=o.height,u=h/.75/p,g=d/c;if(u>g)u=.75*g,h=p*u;else g=u,u=.75*g,d=c*g;var f={OffsetLeft:n[0],OffsetTop:n[1],scale:{x:u,y:g}},m=r.geoJson2Path(t,f);return this._getSingleProvince(e,m[0],s)},_getSingleProvince:function(e,t,i){var a,s=t.properties.name,r=f[s]||[0,0];if(m[s])a=this.geo2pos(e,m[s]);else if(t.cp)a=[t.cp[0]+r[0],t.cp[1]+r[1]];else{var o=this._mapDataMap[e].bbox;a=this.geo2pos(e,[o.left+o.width/2,o.top+o.height/2]),a[0]+=r[0],a[1]+=r[1]}return t.name=this._nameChange(e,s),t.position=i,t.textX=a[0],t.textY=a[1],t},_getTransform:function(e,t,i){var a,s,r,o,n,l,h,d=this.series,p=this.zr.getWidth(),c=this.zr.getHeight(),u=Math.round(.02*Math.min(p,c));for(var g in t)a=d[g].mapLocation||{},r=a.x||r,n=a.y||n,l=a.width||l,h=a.height||h;s=this.parsePercent(r,p),s=isNaN(s)?u:s,o=this.parsePercent(n,c),o=isNaN(o)?u:o,l=null==l?p-s-2*u:this.parsePercent(l,p),h=null==h?c-o-2*u:this.parsePercent(h,c);var f=e.width,m=e.height,y=l/i/f,v=h/m;if(y>v)y=v*i,l=f*y;else v=y,y=v*i,h=m*v;if(isNaN(r))switch(r=r||"center",r+""){case"center":s=Math.floor((p-l)/2);break;case"right":s=p-l}if(isNaN(n))switch(n=n||"center",n+""){case"center":o=Math.floor((c-h)/2);break;case"bottom":o=c-h}return{left:s,top:o,width:l,height:h,baseScale:1,scale:{x:y,y:v}}},_buildMap:function(e,t,c,u){for(var g,f,m,y,v,b,_,x,S,M,C,L=this.series,z=this.component.legend,k=this.component.dataRange,w=0,A=t.length;A>w;w++){if(x=p.clone(t[w]),S={name:x.name,path:x.path,position:p.clone(x.position)},f=x.name,m=c[f]){v=[m],g="";for(var T=0,I=m.seriesIndex.length;I>T;T++)if(v.push(L[m.seriesIndex[T]]),g+=L[m.seriesIndex[T]].name+" ",z&&this._showLegendSymbol[e]&&z.hasColor(L[m.seriesIndex[T]].name))this.shapeList.push(new s({zlevel:this.getZlevelBase(),z:this.getZBase()+1,position:p.clone(x.position),_mapType:e,style:{x:x.textX+3+7*T,y:x.textY-10,r:3,color:z.getColor(L[m.seriesIndex[T]].name)},hoverable:!1}));y=m.value}else{m="-",g="",v=[];for(var E in u)v.push(L[E]);y="-"}if(this.ecTheme.map&&v.push(this.ecTheme.map),v.push(h),b=k&&!isNaN(y)?k.getColor(y):null,x.color=x.color||b||this.getItemStyleColor(this.deepQuery(v,"itemStyle.normal.color"),m.seriesIndex,-1,m)||this.deepQuery(v,"itemStyle.normal.areaStyle.color"),x.strokeColor=x.strokeColor||this.deepQuery(v,"itemStyle.normal.borderColor"),x.lineWidth=x.lineWidth||this.deepQuery(v,"itemStyle.normal.borderWidth"),S.color=this.getItemStyleColor(this.deepQuery(v,"itemStyle.emphasis.color"),m.seriesIndex,-1,m)||this.deepQuery(v,"itemStyle.emphasis.areaStyle.color")||x.color,S.strokeColor=this.deepQuery(v,"itemStyle.emphasis.borderColor")||x.strokeColor,S.lineWidth=this.deepQuery(v,"itemStyle.emphasis.borderWidth")||x.lineWidth,x.brushType=S.brushType=x.brushType||"both",x.lineJoin=S.lineJoin="round",x._name=S._name=f,_=this.deepQuery(v,"itemStyle.normal.label.textStyle"),C={zlevel:this.getZlevelBase(),z:this.getZBase()+1,position:p.clone(x.position),_mapType:e,_geo:this.pos2geo(e,[x.textX,x.textY]),style:{brushType:"fill",x:x.textX,y:x.textY,text:this.getLabelText(f,y,v,"normal"),_name:f,textAlign:"center",color:this.deepQuery(v,"itemStyle.normal.label.show")?this.deepQuery(v,"itemStyle.normal.label.textStyle.color"):"rgba(0,0,0,0)",textFont:this.getFont(_)}},C._style=p.clone(C.style),C.highlightStyle=p.clone(C.style),this.deepQuery(v,"itemStyle.emphasis.label.show"))C.highlightStyle.text=this.getLabelText(f,y,v,"emphasis"),C.highlightStyle.color=this.deepQuery(v,"itemStyle.emphasis.label.textStyle.color")||C.style.color,_=this.deepQuery(v,"itemStyle.emphasis.label.textStyle")||_,C.highlightStyle.textFont=this.getFont(_);else C.highlightStyle.color="rgba(0,0,0,0)";if(M={zlevel:this.getZlevelBase(),z:this.getZBase(),position:p.clone(x.position),style:x,highlightStyle:S,_style:p.clone(x),_mapType:e},null!=x.scale)M.scale=p.clone(x.scale);switch(C=new i(C),M.style.shapeType){case"rectangle":M=new r(M);break;case"line":M=new o(M);break;case"circle":M=new s(M);break;case"polygon":M=new n(M);break;case"ellipse":M=new l(M);break;default:if(M=new a(M),M.buildPathArray)M.style.pathArray=M.buildPathArray(M.style.path)}if(this._selectedMode[e]&&this._selected[f]||m.selected&&this._selected[f]!==!1)C.style=C.highlightStyle,M.style=M.highlightStyle;if(C.clickable=M.clickable=this._clickable[e]&&(null==m.clickable||m.clickable),this._selectedMode[e])if(this._selected[f]=null!=this._selected[f]?this._selected[f]:m.selected,this._mapTypeMap[f]=e,null==m.selectable||m.selectable)M.clickable=C.clickable=!0,M.onclick=C.onclick=this.shapeHandler.onclick;if(this._hoverable[e]&&(null==m.hoverable||m.hoverable))C.hoverable=M.hoverable=!0,M.hoverConnect=C.id,C.hoverConnect=M.id;else C.hoverable=M.hoverable=!1;d.pack(C,{name:g,tooltip:this.deepQuery(v,"tooltip")},0,m,0,f),this.shapeList.push(C),d.pack(M,{name:g,tooltip:this.deepQuery(v,"tooltip")},0,m,0,f),this.shapeList.push(M)}},_buildMark:function(e,t){this._seriesIndexToMapType=this._seriesIndexToMapType||{},this.markAttachStyle=this.markAttachStyle||{};var i=[this._mapDataMap[e].transform.left,this._mapDataMap[e].transform.top];if("none"==e)i=[0,0];for(var a in t)this._seriesIndexToMapType[a]=e,this.markAttachStyle[a]={position:i,_mapType:e},this.buildMark(a)},getMarkCoord:function(e,t){return t.geoCoord||m[t.name]?this.geo2pos(this._seriesIndexToMapType[e],t.geoCoord||m[t.name]):[0,0]},getMarkGeo:function(e){return e.geoCoord||m[e.name]},_nameChange:function(e,t){return this._nameMap[e][t]||t},getLabelText:function(e,t,i,a){var s=this.deepQuery(i,"itemStyle."+a+".label.formatter");if(s){if("function"==typeof s)return s.call(this.myChart,e,t);else if("string"==typeof s)return s=s.replace("{a}","{a0}").replace("{b}","{b0}"),s=s.replace("{a0}",e).replace("{b0}",t)}else return e},_findMapTypeByPos:function(e,t){var i,a,s,r,o;for(var n in this._mapDataMap)if(i=this._mapDataMap[n].transform,i&&this._roamMap[n]&&this._activeMapType[n]){if(a=i.left,s=i.top,r=i.width,o=i.height,e>=a&&a+r>=e&&t>=s&&s+o>=t)return n}else;},__onmousewheel:function(e){function t(e,t){for(var i=0;i<e.pointList.length;i++){var a=e.pointList[i];a[0]*=t,a[1]*=t}var s=e.controlPointList;if(s)for(var i=0;i<s.length;i++){var a=s[i];a[0]*=t,a[1]*=t}}function i(e,t){if(e.xStart*=t,e.yStart*=t,e.xEnd*=t,e.yEnd*=t,null!=e.cpX1)e.cpX1*=t,e.cpY1*=t}if(!(this.shapeList.length<=0)){for(var a=0,s=this.shapeList.length;s>a;a++){var r=this.shapeList[a];if(r.__animating)return}var o,n,l=e.event,d=u.getX(l),p=u.getY(l),c=u.getDelta(l),g=e.mapTypeControl;if(!g)if(g={},n=this._findMapTypeByPos(d,p),n&&this._roamMap[n]&&"move"!=this._roamMap[n])g[n]=!0;var f=!1;for(n in g)if(g[n]){f=!0;var m=this._mapDataMap[n].transform,y=m.left,v=m.top,b=m.width,_=m.height,x=this.pos2geo(n,[d-y,p-v]);if(c>0){if(o=1.2,null!=this._scaleLimitMap[n].max&&m.baseScale>=this._scaleLimitMap[n].max)continue}else if(o=1/1.2,null!=this._scaleLimitMap[n].min&&m.baseScale<=this._scaleLimitMap[n].min)continue;m.baseScale*=o,m.scale.x*=o,m.scale.y*=o,m.width=b*o,m.height=_*o,this._mapDataMap[n].hasRoam=!0,this._mapDataMap[n].transform=m,x=this.geo2pos(n,x),m.left-=x[0]-(d-y),m.top-=x[1]-(p-v),this._mapDataMap[n].transform=m,this.clearEffectShape(!0);for(var a=0,s=this.shapeList.length;s>a;a++){var r=this.shapeList[a];if(r._mapType==n){var S=r.type,M=r.style;switch(r.position[0]=m.left,r.position[1]=m.top,S){case"path":case"symbol":case"circle":case"rectangle":case"polygon":case"line":case"ellipse":r.scale[0]*=o,r.scale[1]*=o;break;case"mark-line":i(M,o);break;case"polyline":t(M,o);break;case"shape-bundle":for(var C=0;C<M.shapeList.length;C++){var L=M.shapeList[C];if("mark-line"==L.type)i(L.style,o);else if("polyline"==L.type)t(L.style,o)}break;case"icon":case"image":x=this.geo2pos(n,r._geo),M.x=M._x=x[0]-M.width/2,M.y=M._y=x[1]-M.height/2;break;default:if(x=this.geo2pos(n,r._geo),M.x=x[0],M.y=x[1],"text"==S)r._style.x=r.highlightStyle.x=x[0],r._style.y=r.highlightStyle.y=x[1]}this.zr.modShape(r.id)}}}if(f){u.stop(l),this.zr.refreshNextFrame();var z=this;clearTimeout(this._refreshDelayTicket),this._refreshDelayTicket=setTimeout(function(){z&&z.shapeList&&z.animationEffect()},100),this.messageCenter.dispatch(h.EVENT.MAP_ROAM,e.event,{type:"scale"},this.myChart)}}},__onmousedown:function(e){if(!(this.shapeList.length<=0)){var t=e.target;if(!t||!t.draggable){var i=e.event,a=u.getX(i),s=u.getY(i),r=this._findMapTypeByPos(a,s);if(r&&this._roamMap[r]&&"scale"!=this._roamMap[r]){this._mousedown=!0,this._mx=a,this._my=s,this._curMapType=r,this.zr.on(c.EVENT.MOUSEUP,this._onmouseup);var o=this;setTimeout(function(){o.zr.on(c.EVENT.MOUSEMOVE,o._onmousemove)},100)}}}},__onmousemove:function(e){if(this._mousedown&&this._isAlive){var t=e.event,i=u.getX(t),a=u.getY(t),s=this._mapDataMap[this._curMapType].transform;s.hasRoam=!0,s.left-=this._mx-i,s.top-=this._my-a,this._mx=i,this._my=a,this._mapDataMap[this._curMapType].transform=s;for(var r=0,o=this.shapeList.length;o>r;r++)if(this.shapeList[r]._mapType==this._curMapType)this.shapeList[r].position[0]=s.left,this.shapeList[r].position[1]=s.top,this.zr.modShape(this.shapeList[r].id);this.messageCenter.dispatch(h.EVENT.MAP_ROAM,e.event,{type:"move"},this.myChart),this.clearEffectShape(!0),this.zr.refreshNextFrame(),this._justMove=!0,u.stop(t)}},__onmouseup:function(e){var t=e.event;this._mx=u.getX(t),this._my=u.getY(t),this._mousedown=!1;var i=this;setTimeout(function(){i._justMove&&i.animationEffect(),i._justMove=!1,i.zr.un(c.EVENT.MOUSEMOVE,i._onmousemove),i.zr.un(c.EVENT.MOUSEUP,i._onmouseup)},120)},__onroamcontroller:function(e){var t=e.event;t.zrenderX=this.zr.getWidth()/2,t.zrenderY=this.zr.getHeight()/2;var i=e.mapTypeControl,a=0,s=0,r=e.step;switch(e.roamType){case"scaleUp":return t.zrenderDelta=1,void this.__onmousewheel({event:t,mapTypeControl:i});case"scaleDown":return t.zrenderDelta=-1,void this.__onmousewheel({event:t,mapTypeControl:i});case"up":a=-r;break;case"down":a=r;break;case"left":s=-r;break;case"right":s=r}var o,n;for(n in i)if(this._mapDataMap[n]&&this._activeMapType[n])o=this._mapDataMap[n].transform,o.hasRoam=!0,o.left-=s,o.top-=a,this._mapDataMap[n].transform=o;else;for(var l=0,d=this.shapeList.length;d>l;l++)if(n=this.shapeList[l]._mapType,i[n]&&this._activeMapType[n])o=this._mapDataMap[n].transform,this.shapeList[l].position[0]=o.left,this.shapeList[l].position[1]=o.top,this.zr.modShape(this.shapeList[l].id);else;this.messageCenter.dispatch(h.EVENT.MAP_ROAM,e.event,{type:"move"},this.myChart),this.clearEffectShape(!0),this.zr.refreshNextFrame(),clearTimeout(this.dircetionTimer);var p=this;this.dircetionTimer=setTimeout(function(){p.animationEffect()},150)},__ondrhoverlink:function(e){for(var t,i,a=0,s=this.shapeList.length;s>a;a++)if(t=this.shapeList[a]._mapType,this._hoverLinkMap[t]&&this._activeMapType[t]){if(i=d.get(this.shapeList[a],"value"),null!=i&&i>=e.valueMin&&i<=e.valueMax)this.zr.addHoverShape(this.shapeList[a])}else;},onclick:function(e){if(this.isClick&&e.target&&!this._justMove&&"icon"!=e.target.type){this.isClick=!1;var t=e.target,i=t.style._name,a=this.shapeList.length,s=t._mapType||"";if("single"==this._selectedMode[s])for(var r in this._selected)if(this._selected[r]&&this._mapTypeMap[r]==s){for(var o=0;a>o;o++)if(this.shapeList[o].style._name==r&&this.shapeList[o]._mapType==s)this.shapeList[o].style=this.shapeList[o]._style,this.zr.modShape(this.shapeList[o].id);r!=i&&(this._selected[r]=!1)}this._selected[i]=!this._selected[i];for(var o=0;a>o;o++)if(this.shapeList[o].style._name==i&&this.shapeList[o]._mapType==s){if(this._selected[i])this.shapeList[o].style=this.shapeList[o].highlightStyle;else this.shapeList[o].style=this.shapeList[o]._style;this.zr.modShape(this.shapeList[o].id)}this.messageCenter.dispatch(h.EVENT.MAP_SELECTED,e.event,{selected:this._selected,target:i},this.myChart),this.zr.refreshNextFrame();var n=this;setTimeout(function(){n.zr.trigger(c.EVENT.MOUSEMOVE,e.event)},100)}},refresh:function(e){if(e)this.option=e,this.series=e.series;if(this._mapDataRequireCounter>0)this.clear();else this.backupShapeList();this._buildShape(),this.zr.refreshHover()},ondataRange:function(e,t){if(this.component.dataRange)this.refresh(),t.needRefresh=!0},pos2geo:function(e,t){if(!this._mapDataMap[e].transform)return null;else return this._mapDataMap[e].projection.pos2geo(this._mapDataMap[e].transform,t)},getGeoByPos:function(e,t){if(!this._mapDataMap[e].transform)return null;var i=[this._mapDataMap[e].transform.left,this._mapDataMap[e].transform.top];if(t instanceof Array)t[0]-=i[0],t[1]-=i[1];else t.x-=i[0],t.y-=i[1];return this.pos2geo(e,t)},geo2pos:function(e,t){if(!this._mapDataMap[e].transform)return null;else return this._mapDataMap[e].projection.geo2pos(this._mapDataMap[e].transform,t)},getPosByGeo:function(e,t){if(!this._mapDataMap[e].transform)return null;var i=this.geo2pos(e,t);return i[0]+=this._mapDataMap[e].transform.left,i[1]+=this._mapDataMap[e].transform.top,i},getMapPosition:function(e){if(!this._mapDataMap[e].transform)return null;else return[this._mapDataMap[e].transform.left,this._mapDataMap[e].transform.top]},onbeforDispose:function(){this._isAlive=!1,this.zr.un(c.EVENT.MOUSEWHEEL,this._onmousewheel),this.zr.un(c.EVENT.MOUSEDOWN,this._onmousedown),this.messageCenter.unbind(h.EVENT.ROAMCONTROLLER,this._onroamcontroller),this.messageCenter.unbind(h.EVENT.DATA_RANGE_HOVERLINK,this._ondrhoverlink)}},p.inherits(e,t),require("../chart").define("map",e),e});