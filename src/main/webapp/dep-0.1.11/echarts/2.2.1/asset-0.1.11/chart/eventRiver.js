define("echarts/chart/eventRiver",["require","./base","../layout/eventRiver","zrender/shape/Polygon","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","../util/date","zrender/tool/util","zrender/tool/color","../chart"],function(require){function e(e,i,a,r,o){t.call(this,e,i,a,r,o);var s=this;s._ondragend=function(){s.isDragend=!0},this.refresh(r)}var t=require("./base"),i=require("../layout/eventRiver"),a=require("zrender/shape/Polygon");require("../component/axis"),require("../component/grid"),require("../component/dataZoom");var r=require("../config");r.eventRiver={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"inside",formatter:"{b}"}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0}}}};var o=require("../util/ecData"),s=require("../util/date"),n=require("zrender/tool/util"),l=require("zrender/tool/color");return e.prototype={type:r.CHART_TYPE_EVENTRIVER,_buildShape:function(){var e=this.series;this.selectedMap={},this._dataPreprocessing();for(var t=this.component.legend,a=[],r=0;r<e.length;r++)if(e[r].type===this.type){e[r]=this.reformOption(e[r]),this.legendHoverLink=e[r].legendHoverLink||this.legendHoverLink;var o=e[r].name||"";if(this.selectedMap[o]=t?t.isSelected(o):!0,!this.selectedMap[o])continue;this.buildMark(r),a.push(this.series[r])}i(a,this._intervalX,this.component.grid.getArea()),this._drawEventRiver(),this.addShapeList()},_dataPreprocessing:function(){for(var e,t,i=this.series,a=0,r=i.length;r>a;a++)if(i[a].type===this.type){e=this.component.xAxis.getAxis(i[a].xAxisIndex||0);for(var o=0,n=i[a].data.length;n>o;o++){t=i[a].data[o].evolution;for(var l=0,h=t.length;h>l;l++)t[l].timeScale=e.getCoord(s.getNewDate(t[l].time)-0),t[l].valueScale=Math.pow(t[l].value,.8)}}this._intervalX=Math.round(this.component.grid.getWidth()/40)},_drawEventRiver:function(){for(var e=this.series,t=0;t<e.length;t++){var i=e[t].name||"";if(e[t].type===this.type&&this.selectedMap[i])for(var a=0;a<e[t].data.length;a++)this._drawEventBubble(e[t].data[a],t,a)}},_drawEventBubble:function(e,t,i){var r=this.series,s=r[t],n=s.name||"",h=s.data[i],d=[h,s],p=this.component.legend,c=p?p.getColor(n):this.zr.getColor(t),g=this.deepMerge(d,"itemStyle.normal")||{},u=this.deepMerge(d,"itemStyle.emphasis")||{},f=this.getItemStyleColor(g.color,t,i,h)||c,y=this.getItemStyleColor(u.color,t,i,h)||("string"==typeof f?l.lift(f,-.2):f),m=this._calculateControlPoints(e),v={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(d,"clickable"),style:{pointList:m,smooth:"spline",brushType:"both",lineJoin:"round",color:f,lineWidth:g.borderWidth,strokeColor:g.borderColor},highlightStyle:{color:y,lineWidth:u.borderWidth,strokeColor:u.borderColor},draggable:"vertical",ondragend:this._ondragend};v=new a(v),this.addLabel(v,s,h,e.name),o.pack(v,r[t],t,r[t].data[i],i,r[t].data[i].name),this.shapeList.push(v)},_calculateControlPoints:function(e){var t=this._intervalX,i=e.y,a=e.evolution,r=a.length;if(!(1>r)){for(var o=[],s=[],n=0;r>n;n++)o.push(a[n].timeScale),s.push(a[n].valueScale);var l=[];l.push([o[0],i]);var n=0;for(n=0;r-1>n;n++)l.push([(o[n]+o[n+1])/2,s[n]/-2+i]);for(l.push([(o[n]+(o[n]+t))/2,s[n]/-2+i]),l.push([o[n]+t,i]),l.push([(o[n]+(o[n]+t))/2,s[n]/2+i]),n=r-1;n>0;n--)l.push([(o[n]+o[n-1])/2,s[n-1]/2+i]);return l}},ondragend:function(e,t){if(this.isDragend&&e.target)t.dragOut=!0,t.dragIn=!0,t.needRefresh=!1,this.isDragend=!1},refresh:function(e){if(e)this.option=e,this.series=e.series;this.backupShapeList(),this._buildShape()}},n.inherits(e,t),require("../chart").define("eventRiver",e),e});