define("echarts/component/tooltip",["require","./base","../util/shape/Cross","zrender/shape/Line","zrender/shape/Rectangle","../config","../util/ecData","zrender/config","zrender/tool/event","zrender/tool/area","zrender/tool/color","zrender/tool/util","zrender/shape/Base","../component"],function(require){function t(t,a,o,r,n){e.call(this,t,a,o,r,n),this.dom=n.dom;var l=this;l._onmousemove=function(t){return l.__onmousemove(t)},l._onglobalout=function(t){return l.__onglobalout(t)},this.zr.on(h.EVENT.MOUSEMOVE,l._onmousemove),this.zr.on(h.EVENT.GLOBALOUT,l._onglobalout),l._hide=function(t){return l.__hide(t)},l._tryShow=function(t){return l.__tryShow(t)},l._refixed=function(t){return l.__refixed(t)},l._setContent=function(t,e){return l.__setContent(t,e)},this._tDom=this._tDom||document.createElement("div"),this._tDom.onselectstart=function(){return!1},this._tDom.onmouseover=function(){l._mousein=!0},this._tDom.onmouseout=function(){l._mousein=!1},this._tDom.className="echarts-tooltip",this._tDom.style.position="absolute",this.hasAppend=!1,this._axisLineShape&&this.zr.delShape(this._axisLineShape.id),this._axisLineShape=new s({zlevel:this.getZlevelBase(),z:this.getZBase(),invisible:!0,hoverable:!1}),this.shapeList.push(this._axisLineShape),this.zr.addShape(this._axisLineShape),this._axisShadowShape&&this.zr.delShape(this._axisShadowShape.id),this._axisShadowShape=new s({zlevel:this.getZlevelBase(),z:1,invisible:!0,hoverable:!1}),this.shapeList.push(this._axisShadowShape),this.zr.addShape(this._axisShadowShape),this._axisCrossShape&&this.zr.delShape(this._axisCrossShape.id),this._axisCrossShape=new i({zlevel:this.getZlevelBase(),z:this.getZBase(),invisible:!0,hoverable:!1}),this.shapeList.push(this._axisCrossShape),this.zr.addShape(this._axisCrossShape),this.showing=!1,this.refresh(r)}var e=require("./base"),i=require("../util/shape/Cross"),s=require("zrender/shape/Line"),a=require("zrender/shape/Rectangle"),o=new a({}),r=require("../config");r.tooltip={zlevel:1,z:8,show:!0,showContent:!0,trigger:"item",islandFormatter:"{a} <br/>{b} : {c}",showDelay:20,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"rgba(0,0,0,0.7)",borderColor:"#333",borderRadius:4,borderWidth:0,padding:5,axisPointer:{type:"line",lineStyle:{color:"#48b",width:2,type:"solid"},crossStyle:{color:"#1e90ff",width:1,type:"dashed"},shadowStyle:{color:"rgba(150,150,150,0.3)",width:"auto",type:"default"}},textStyle:{color:"#fff"}};var n=require("../util/ecData"),h=require("zrender/config"),l=require("zrender/tool/event"),d=require("zrender/tool/area"),p=require("zrender/tool/color"),c=require("zrender/tool/util"),g=require("zrender/shape/Base");return t.prototype={type:r.COMPONENT_TYPE_TOOLTIP,_gCssText:"position:absolute;display:block;border-style:solid;white-space:nowrap;",_style:function(t){if(!t)return"";var e=[];if(t.transitionDuration){var i="left "+t.transitionDuration+"s,top "+t.transitionDuration+"s";e.push("transition:"+i),e.push("-moz-transition:"+i),e.push("-webkit-transition:"+i),e.push("-o-transition:"+i)}if(t.backgroundColor)e.push("background-Color:"+p.toHex(t.backgroundColor)),e.push("filter:alpha(opacity=70)"),e.push("background-Color:"+t.backgroundColor);if(null!=t.borderWidth)e.push("border-width:"+t.borderWidth+"px");if(null!=t.borderColor)e.push("border-color:"+t.borderColor);if(null!=t.borderRadius)e.push("border-radius:"+t.borderRadius+"px"),e.push("-moz-border-radius:"+t.borderRadius+"px"),e.push("-webkit-border-radius:"+t.borderRadius+"px"),e.push("-o-border-radius:"+t.borderRadius+"px");var s=t.textStyle;if(s)s.color&&e.push("color:"+s.color),s.decoration&&e.push("text-decoration:"+s.decoration),s.align&&e.push("text-align:"+s.align),s.fontFamily&&e.push("font-family:"+s.fontFamily),s.fontSize&&e.push("font-size:"+s.fontSize+"px"),s.fontSize&&e.push("line-height:"+Math.round(3*s.fontSize/2)+"px"),s.fontStyle&&e.push("font-style:"+s.fontStyle),s.fontWeight&&e.push("font-weight:"+s.fontWeight);var a=t.padding;if(null!=a)a=this.reformCssArray(a),e.push("padding:"+a[0]+"px "+a[1]+"px "+a[2]+"px "+a[3]+"px");return e=e.join(";")+";"},__hide:function(){if(this._lastDataIndex=-1,this._lastSeriesIndex=-1,this._lastItemTriggerId=-1,this._tDom)this._tDom.style.display="none";var t=!1;if(!this._axisLineShape.invisible)this._axisLineShape.invisible=!0,this.zr.modShape(this._axisLineShape.id),t=!0;if(!this._axisShadowShape.invisible)this._axisShadowShape.invisible=!0,this.zr.modShape(this._axisShadowShape.id),t=!0;if(!this._axisCrossShape.invisible)this._axisCrossShape.invisible=!0,this.zr.modShape(this._axisCrossShape.id),t=!0;if(this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape),this._lastTipShape=!1,this.shapeList.length=2;t&&this.zr.refreshNextFrame(),this.showing=!1},_show:function(t,e,i,s){var a=this._tDom.offsetHeight,o=this._tDom.offsetWidth;if(t){if("function"==typeof t)t=t([e,i]);if(t instanceof Array)e=t[0],i=t[1]}if(e+o>this._zrWidth)e-=o+40;if(i+a>this._zrHeight)i-=a-20;if(20>i)i=0;if(this._tDom.style.cssText=this._gCssText+this._defaultCssText+(s?s:"")+"left:"+e+"px;top:"+i+"px;",10>a||10>o)setTimeout(this._refixed,20);this.showing=!0},__refixed:function(){if(this._tDom){var t="",e=this._tDom.offsetHeight,i=this._tDom.offsetWidth;if(this._tDom.offsetLeft+i>this._zrWidth)t+="left:"+(this._zrWidth-i-20)+"px;";if(this._tDom.offsetTop+e>this._zrHeight)t+="top:"+(this._zrHeight-e-10)+"px;";if(""!==t)this._tDom.style.cssText+=t}},__tryShow:function(){var t,e;if(!this._curTarget)this._findPolarTrigger()||this._findAxisTrigger();else{if("island"===this._curTarget._type&&this.option.tooltip.show)return void this._showItemTrigger();var i=n.get(this._curTarget,"series"),s=n.get(this._curTarget,"data");if(t=this.deepQuery([s,i,this.option],"tooltip.show"),null==i||null==s||!t)clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this._hidingTicket=setTimeout(this._hide,this._hideDelay);else e=this.deepQuery([s,i,this.option],"tooltip.trigger"),"axis"===e?this._showAxisTrigger(i.xAxisIndex,i.yAxisIndex,n.get(this._curTarget,"dataIndex")):this._showItemTrigger()}},_findAxisTrigger:function(){if(!this.component.xAxis||!this.component.yAxis)return void(this._hidingTicket=setTimeout(this._hide,this._hideDelay));for(var t,e,i=this.option.series,s=0,a=i.length;a>s;s++)if("axis"===this.deepQuery([i[s],this.option],"tooltip.trigger"))if(t=i[s].xAxisIndex||0,e=i[s].yAxisIndex||0,this.component.xAxis.getAxis(t)&&this.component.xAxis.getAxis(t).type===r.COMPONENT_TYPE_AXIS_CATEGORY)return void this._showAxisTrigger(t,e,this._getNearestDataIndex("x",this.component.xAxis.getAxis(t)));else if(this.component.yAxis.getAxis(e)&&this.component.yAxis.getAxis(e).type===r.COMPONENT_TYPE_AXIS_CATEGORY)return void this._showAxisTrigger(t,e,this._getNearestDataIndex("y",this.component.yAxis.getAxis(e)));else return void this._showAxisTrigger(t,e,-1);if("cross"===this.option.tooltip.axisPointer.type)this._showAxisTrigger(-1,-1,-1)},_findPolarTrigger:function(){if(!this.component.polar)return!1;var t,e=l.getX(this._event),i=l.getY(this._event),s=this.component.polar.getNearestIndex([e,i]);if(s)t=s.valueIndex,s=s.polarIndex;else s=-1;if(-1!=s)return this._showPolarTrigger(s,t);else return!1},_getNearestDataIndex:function(t,e){var i=-1,s=l.getX(this._event),a=l.getY(this._event);if("x"===t){for(var o,r,n=this.component.grid.getXend(),h=e.getCoordByIndex(i);n>h&&(r=h,s>=h);)o=h,h=e.getCoordByIndex(++i);if(0>=i)i=0;else if(r-s>=s-o)i-=1;else if(null==e.getNameByIndex(i))i-=1;return i}else{for(var d,p,c=this.component.grid.getY(),h=e.getCoordByIndex(i);h>c&&(d=h,h>=a);)p=h,h=e.getCoordByIndex(++i);if(0>=i)i=0;else if(a-d>=p-a)i-=1;else if(null==e.getNameByIndex(i))i-=1;return i}},_showAxisTrigger:function(t,e,i){if(!this._event.connectTrigger&&this.messageCenter.dispatch(r.EVENT.TOOLTIP_IN_GRID,this._event,null,this.myChart),null==this.component.xAxis||null==this.component.yAxis||null==t||null==e)return clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),void(this._hidingTicket=setTimeout(this._hide,this._hideDelay));var s,a,o,n,h=this.option.series,d=[],p=[],c="";if("axis"===this.option.tooltip.trigger){if(!this.option.tooltip.show)return;a=this.option.tooltip.formatter,o=this.option.tooltip.position}var g,u,f=-1!=t&&this.component.xAxis.getAxis(t).type===r.COMPONENT_TYPE_AXIS_CATEGORY?"xAxis":-1!=e&&this.component.yAxis.getAxis(e).type===r.COMPONENT_TYPE_AXIS_CATEGORY?"yAxis":!1;if(f){var m="xAxis"==f?t:e;s=this.component[f].getAxis(m);for(var _=0,y=h.length;y>_;_++)if(this._isSelected(h[_].name)){if(h[_][f+"Index"]===m&&"axis"===this.deepQuery([h[_],this.option],"tooltip.trigger"))if(n=this.query(h[_],"tooltip.showContent")||n,a=this.query(h[_],"tooltip.formatter")||a,o=this.query(h[_],"tooltip.position")||o,c+=this._style(this.query(h[_],"tooltip")),null!=h[_].stack&&"xAxis"==f)d.unshift(h[_]),p.unshift(_);else d.push(h[_]),p.push(_)}else;this.messageCenter.dispatch(r.EVENT.TOOLTIP_HOVER,this._event,{seriesIndex:p,dataIndex:i},this.myChart);var x;if("xAxis"==f)g=this.subPixelOptimize(s.getCoordByIndex(i),this._axisLineWidth),u=l.getY(this._event),x=[g,this.component.grid.getY(),g,this.component.grid.getYend()];else g=l.getX(this._event),u=this.subPixelOptimize(s.getCoordByIndex(i),this._axisLineWidth),x=[this.component.grid.getX(),u,this.component.grid.getXend(),u];this._styleAxisPointer(d,x[0],x[1],x[2],x[3],s.getGap(),g,u)}else if(g=l.getX(this._event),u=l.getY(this._event),this._styleAxisPointer(h,this.component.grid.getX(),u,this.component.grid.getXend(),u,0,g,u),i>=0)this._showItemTrigger(!0);else clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this._tDom.style.display="none";if(d.length>0){if(this._lastItemTriggerId=-1,this._lastDataIndex!=i||this._lastSeriesIndex!=p[0]){this._lastDataIndex=i,this._lastSeriesIndex=p[0];var v,b;if("function"==typeof a){for(var S=[],_=0,y=d.length;y>_;_++)v=d[_].data[i],b=this.getDataFromOption(v,"-"),S.push({seriesIndex:p[_],seriesName:d[_].name||"",series:d[_],dataIndex:i,data:v,name:s.getNameByIndex(i),value:b,0:d[_].name||"",1:s.getNameByIndex(i),2:b,3:v});this._curTicket="axis:"+i,this._tDom.innerHTML=a.call(this.myChart,S,this._curTicket,this._setContent)}else if("string"==typeof a){this._curTicket=0/0,a=a.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}");for(var _=0,y=d.length;y>_;_++)a=a.replace("{a"+_+"}",this._encodeHTML(d[_].name||"")),a=a.replace("{b"+_+"}",this._encodeHTML(s.getNameByIndex(i))),v=d[_].data[i],v=this.getDataFromOption(v,"-"),a=a.replace("{c"+_+"}",v instanceof Array?v:this.numAddCommas(v));this._tDom.innerHTML=a}else{this._curTicket=0/0,a=this._encodeHTML(s.getNameByIndex(i));for(var _=0,y=d.length;y>_;_++)a+="<br/>"+this._encodeHTML(d[_].name||"")+" : ",v=d[_].data[i],v=this.getDataFromOption(v,"-"),a+=v instanceof Array?v:this.numAddCommas(v);this._tDom.innerHTML=a}}if(n===!1||!this.option.tooltip.showContent)return;if(!this.hasAppend)this._tDom.style.left=this._zrWidth/2+"px",this._tDom.style.top=this._zrHeight/2+"px",this.dom.firstChild.appendChild(this._tDom),this.hasAppend=!0;this._show(o,g+10,u+10,c)}},_showPolarTrigger:function(t,e){if(null==this.component.polar||null==t||null==e||0>e)return!1;var i,s,a,o=this.option.series,r=[],n=[],h="";if("axis"===this.option.tooltip.trigger){if(!this.option.tooltip.show)return!1;i=this.option.tooltip.formatter,s=this.option.tooltip.position}for(var d=this.option.polar[t].indicator[e].text,p=0,c=o.length;c>p;p++)if(this._isSelected(o[p].name)){if(o[p].polarIndex===t&&"axis"===this.deepQuery([o[p],this.option],"tooltip.trigger"))a=this.query(o[p],"tooltip.showContent")||a,i=this.query(o[p],"tooltip.formatter")||i,s=this.query(o[p],"tooltip.position")||s,h+=this._style(this.query(o[p],"tooltip")),r.push(o[p]),n.push(p)}else;if(r.length>0){for(var g,u,f,m=[],p=0,c=r.length;c>p;p++){g=r[p].data;for(var _=0,y=g.length;y>_;_++)if(u=g[_],this._isSelected(u.name))u=null!=u?u:{name:"",value:{dataIndex:"-"}},f=this.getDataFromOption(u.value[e]),m.push({seriesIndex:n[p],seriesName:r[p].name||"",series:r[p],dataIndex:e,data:u,name:u.name,indicator:d,value:f,0:r[p].name||"",1:u.name,2:f,3:d});else;}if(m.length<=0)return;if(this._lastItemTriggerId=-1,this._lastDataIndex!=e||this._lastSeriesIndex!=n[0])if(this._lastDataIndex=e,this._lastSeriesIndex=n[0],"function"==typeof i)this._curTicket="axis:"+e,this._tDom.innerHTML=i.call(this.myChart,m,this._curTicket,this._setContent);else if("string"==typeof i){i=i.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{d}","{d0}");for(var p=0,c=m.length;c>p;p++)i=i.replace("{a"+p+"}",this._encodeHTML(m[p].seriesName)),i=i.replace("{b"+p+"}",this._encodeHTML(m[p].name)),i=i.replace("{c"+p+"}",this.numAddCommas(m[p].value)),i=i.replace("{d"+p+"}",this._encodeHTML(m[p].indicator));this._tDom.innerHTML=i}else{i=this._encodeHTML(m[0].name)+"<br/>"+this._encodeHTML(m[0].indicator)+" : "+this.numAddCommas(m[0].value);for(var p=1,c=m.length;c>p;p++)i+="<br/>"+this._encodeHTML(m[p].name)+"<br/>",i+=this._encodeHTML(m[p].indicator)+" : "+this.numAddCommas(m[p].value);this._tDom.innerHTML=i}if(a===!1||!this.option.tooltip.showContent)return;if(!this.hasAppend)this._tDom.style.left=this._zrWidth/2+"px",this._tDom.style.top=this._zrHeight/2+"px",this.dom.firstChild.appendChild(this._tDom),this.hasAppend=!0;return this._show(s,l.getX(this._event),l.getY(this._event),h),!0}},_showItemTrigger:function(t){if(this._curTarget){var e,i,s,a=n.get(this._curTarget,"series"),o=n.get(this._curTarget,"seriesIndex"),h=n.get(this._curTarget,"data"),d=n.get(this._curTarget,"dataIndex"),p=n.get(this._curTarget,"name"),c=n.get(this._curTarget,"value"),g=n.get(this._curTarget,"special"),u=n.get(this._curTarget,"special2"),f=[h,a,this.option],m="";if("island"!=this._curTarget._type){var _=t?"axis":"item";if(this.option.tooltip.trigger===_)e=this.option.tooltip.formatter,i=this.option.tooltip.position;if(this.query(a,"tooltip.trigger")===_)s=this.query(a,"tooltip.showContent")||s,e=this.query(a,"tooltip.formatter")||e,i=this.query(a,"tooltip.position")||i,m+=this._style(this.query(a,"tooltip"));s=this.query(h,"tooltip.showContent")||s,e=this.query(h,"tooltip.formatter")||e,i=this.query(h,"tooltip.position")||i,m+=this._style(this.query(h,"tooltip"))}else this._lastItemTriggerId=0/0,s=this.deepQuery(f,"tooltip.showContent"),e=this.deepQuery(f,"tooltip.islandFormatter"),i=this.deepQuery(f,"tooltip.islandPosition");if(this._lastDataIndex=-1,this._lastSeriesIndex=-1,this._lastItemTriggerId!==this._curTarget.id)if(this._lastItemTriggerId=this._curTarget.id,"function"==typeof e)this._curTicket=(a.name||"")+":"+d,this._tDom.innerHTML=e.call(this.myChart,{seriesIndex:o,seriesName:a.name||"",series:a,dataIndex:d,data:h,name:p,value:c,percent:g,indicator:g,value2:u,indicator2:u,0:a.name||"",1:p,2:c,3:g,4:u,5:h,6:o,7:d},this._curTicket,this._setContent);else if("string"==typeof e)this._curTicket=0/0,e=e.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}"),e=e.replace("{a0}",this._encodeHTML(a.name||"")).replace("{b0}",this._encodeHTML(p)).replace("{c0}",c instanceof Array?c:this.numAddCommas(c)),e=e.replace("{d}","{d0}").replace("{d0}",g||""),e=e.replace("{e}","{e0}").replace("{e0}",n.get(this._curTarget,"special2")||""),this._tDom.innerHTML=e;else if(this._curTicket=0/0,a.type===r.CHART_TYPE_RADAR&&g)this._tDom.innerHTML=this._itemFormatter.radar.call(this,a,p,c,g);else if(a.type===r.CHART_TYPE_EVENTRIVER)this._tDom.innerHTML=this._itemFormatter.eventRiver.call(this,a,p,c,h);else this._tDom.innerHTML=""+(null!=a.name?this._encodeHTML(a.name)+"<br/>":"")+(""===p?"":this._encodeHTML(p)+" : ")+(c instanceof Array?c:this.numAddCommas(c));var y=l.getX(this._event),x=l.getY(this._event);if(this.deepQuery(f,"tooltip.axisPointer.show")&&this.component.grid)this._styleAxisPointer([a],this.component.grid.getX(),x,this.component.grid.getXend(),x,0,y,x);else this._hide();if(s!==!1&&this.option.tooltip.showContent){if(!this.hasAppend)this._tDom.style.left=this._zrWidth/2+"px",this._tDom.style.top=this._zrHeight/2+"px",this.dom.firstChild.appendChild(this._tDom),this.hasAppend=!0;this._show(i,y+20,x-20,m)}}},_itemFormatter:{radar:function(t,e,i,s){var a="";a+=this._encodeHTML(""===e?t.name||"":e),a+=""===a?"":"<br />";for(var o=0;o<s.length;o++)a+=this._encodeHTML(s[o].text)+" : "+this.numAddCommas(i[o])+"<br />";return a},chord:function(t,e,i,s,a){if(null==a)return this._encodeHTML(e)+" ("+this.numAddCommas(i)+")";else{var o=this._encodeHTML(e),r=this._encodeHTML(s);return""+(null!=t.name?this._encodeHTML(t.name)+"<br/>":"")+o+" -> "+r+" ("+this.numAddCommas(i)+")<br />"+r+" -> "+o+" ("+this.numAddCommas(a)+")"}},eventRiver:function(t,e,i,s){var a="";a+=this._encodeHTML(""===t.name?"":t.name+" : "),a+=this._encodeHTML(e),a+=""===a?"":"<br />",s=s.evolution;for(var o=0,r=s.length;r>o;o++)if(a+='<div style="padding-top:5px;">',s[o].detail){if(s[o].detail.img)a+='<img src="'+s[o].detail.img+'" style="float:left;width:40px;height:40px;">';a+='<div style="margin-left:45px;">'+s[o].time+"<br/>",a+='<a href="'+s[o].detail.link+'" target="_blank">',a+=s[o].detail.text+"</a></div>",a+="</div>"}else;return a}},_styleAxisPointer:function(t,e,i,s,a,o,r,n){if(t.length>0){var h,l,d=this.option.tooltip.axisPointer,p=d.type,c={line:{},cross:{},shadow:{}};for(var g in c)c[g].color=d[g+"Style"].color,c[g].width=d[g+"Style"].width,c[g].type=d[g+"Style"].type;for(var u=0,f=t.length;f>u;u++)if(h=t[u],l=this.query(h,"tooltip.axisPointer.type"),p=l||p,l)c[l].color=this.query(h,"tooltip.axisPointer."+l+"Style.color")||c[l].color,c[l].width=this.query(h,"tooltip.axisPointer."+l+"Style.width")||c[l].width,c[l].type=this.query(h,"tooltip.axisPointer."+l+"Style.type")||c[l].type;if("line"===p){var m=c.line.width,_=e==s;this._axisLineShape.style={xStart:_?this.subPixelOptimize(e,m):e,yStart:_?i:this.subPixelOptimize(i,m),xEnd:_?this.subPixelOptimize(s,m):s,yEnd:_?a:this.subPixelOptimize(a,m),strokeColor:c.line.color,lineWidth:m,lineType:c.line.type},this._axisLineShape.invisible=!1,this.zr.modShape(this._axisLineShape.id)}else if("cross"===p){var y=c.cross.width;if(this._axisCrossShape.style={brushType:"stroke",rect:this.component.grid.getArea(),x:this.subPixelOptimize(r,y),y:this.subPixelOptimize(n,y),text:("( "+this.component.xAxis.getAxis(0).getValueFromCoord(r)+" , "+this.component.yAxis.getAxis(0).getValueFromCoord(n)+" )").replace("  , "," ").replace(" ,  "," "),textPosition:"specific",strokeColor:c.cross.color,lineWidth:y,lineType:c.cross.type},this.component.grid.getXend()-r>100)this._axisCrossShape.style.textAlign="left",this._axisCrossShape.style.textX=r+10;else this._axisCrossShape.style.textAlign="right",this._axisCrossShape.style.textX=r-10;if(n-this.component.grid.getY()>50)this._axisCrossShape.style.textBaseline="bottom",this._axisCrossShape.style.textY=n-10;else this._axisCrossShape.style.textBaseline="top",this._axisCrossShape.style.textY=n+10;this._axisCrossShape.invisible=!1,this.zr.modShape(this._axisCrossShape.id)}else if("shadow"===p){if(null==c.shadow.width||"auto"===c.shadow.width||isNaN(c.shadow.width))c.shadow.width=o;if(e===s){if(Math.abs(this.component.grid.getX()-e)<2)c.shadow.width/=2,e=s+=c.shadow.width/2;else if(Math.abs(this.component.grid.getXend()-e)<2)c.shadow.width/=2,e=s-=c.shadow.width/2}else if(i===a)if(Math.abs(this.component.grid.getY()-i)<2)c.shadow.width/=2,i=a+=c.shadow.width/2;else if(Math.abs(this.component.grid.getYend()-i)<2)c.shadow.width/=2,i=a-=c.shadow.width/2;this._axisShadowShape.style={xStart:e,yStart:i,xEnd:s,yEnd:a,strokeColor:c.shadow.color,lineWidth:c.shadow.width},this._axisShadowShape.invisible=!1,this.zr.modShape(this._axisShadowShape.id)}this.zr.refreshNextFrame()}},__onmousemove:function(t){if(clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),!this._mousein||!this._enterable){var e=t.target,i=l.getX(t.event),s=l.getY(t.event);if(!e)if(this._curTarget=!1,this._event=t.event,this._event.zrenderX=i,this._event.zrenderY=s,this._needAxisTrigger&&this.component.grid&&d.isInside(o,this.component.grid.getArea(),i,s))this._showingTicket=setTimeout(this._tryShow,this._showDelay);else if(this._needAxisTrigger&&this.component.polar&&-1!=this.component.polar.isInside([i,s]))this._showingTicket=setTimeout(this._tryShow,this._showDelay);else!this._event.connectTrigger&&this.messageCenter.dispatch(r.EVENT.TOOLTIP_OUT_GRID,this._event,null,this.myChart),this._hidingTicket=setTimeout(this._hide,this._hideDelay);else{this._curTarget=e,this._event=t.event,this._event.zrenderX=i,this._event.zrenderY=s;var a;if(this._needAxisTrigger&&this.component.polar&&-1!=(a=this.component.polar.isInside([i,s])))for(var n=this.option.series,h=0,p=n.length;p>h;h++)if(n[h].polarIndex===a&&"axis"===this.deepQuery([n[h],this.option],"tooltip.trigger")){this._curTarget=null;break}this._showingTicket=setTimeout(this._tryShow,this._showDelay)}}},__onglobalout:function(){clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this._hidingTicket=setTimeout(this._hide,this._hideDelay)},__setContent:function(t,e){if(this._tDom){if(t===this._curTicket)this._tDom.innerHTML=e;setTimeout(this._refixed,20)}},ontooltipHover:function(t,e){if(!this._lastTipShape||this._lastTipShape&&this._lastTipShape.dataIndex!=t.dataIndex){if(this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape),this.shapeList.length=2;for(var i=0,s=e.length;s>i;i++)e[i].zlevel=this.getZlevelBase(),e[i].z=this.getZBase(),e[i].style=g.prototype.getHighlightStyle(e[i].style,e[i].highlightStyle),e[i].draggable=!1,e[i].hoverable=!1,e[i].clickable=!1,e[i].ondragend=null,e[i].ondragover=null,e[i].ondrop=null,this.shapeList.push(e[i]),this.zr.addShape(e[i]);this._lastTipShape={dataIndex:t.dataIndex,tipShape:e}}},ondragend:function(){this._hide()},onlegendSelected:function(t){this._selectedMap=t.selected},_setSelectedMap:function(){if(this.component.legend)this._selectedMap=c.clone(this.component.legend.getSelectedMap());else this._selectedMap={}},_isSelected:function(t){if(null!=this._selectedMap[t])return this._selectedMap[t];else return!0},showTip:function(t){if(t){var e,i=this.option.series;if(null!=t.seriesIndex)e=t.seriesIndex;else for(var s=t.seriesName,a=0,o=i.length;o>a;a++)if(i[a].name===s){e=a;break}var l=i[e];if(null!=l){var d=this.myChart.chart[l.type],p="axis"===this.deepQuery([l,this.option],"tooltip.trigger");if(d)if(p){var c=t.dataIndex;switch(d.type){case r.CHART_TYPE_LINE:case r.CHART_TYPE_BAR:case r.CHART_TYPE_K:if(null==this.component.xAxis||null==this.component.yAxis||l.data.length<=c)return;var g=l.xAxisIndex||0,u=l.yAxisIndex||0;if(this.component.xAxis.getAxis(g).type===r.COMPONENT_TYPE_AXIS_CATEGORY)this._event={zrenderX:this.component.xAxis.getAxis(g).getCoordByIndex(c),zrenderY:this.component.grid.getY()+(this.component.grid.getYend()-this.component.grid.getY())/4};else this._event={zrenderX:this.component.grid.getX()+(this.component.grid.getXend()-this.component.grid.getX())/4,zrenderY:this.component.yAxis.getAxis(u).getCoordByIndex(c)};this._showAxisTrigger(g,u,c);break;case r.CHART_TYPE_RADAR:if(null==this.component.polar||l.data[0].value.length<=c)return;var f=l.polarIndex||0,m=this.component.polar.getVector(f,c,"max");this._event={zrenderX:m[0],zrenderY:m[1]},this._showPolarTrigger(f,c)}}else{var _,y,x=d.shapeList;switch(d.type){case r.CHART_TYPE_LINE:case r.CHART_TYPE_BAR:case r.CHART_TYPE_K:case r.CHART_TYPE_SCATTER:for(var c=t.dataIndex,a=0,o=x.length;o>a;a++)if(null==x[a]._mark&&n.get(x[a],"seriesIndex")==e&&n.get(x[a],"dataIndex")==c){this._curTarget=x[a],_=x[a].style.x,y=d.type!=r.CHART_TYPE_K?x[a].style.y:x[a].style.y[0];break}break;case r.CHART_TYPE_RADAR:for(var c=t.dataIndex,a=0,o=x.length;o>a;a++)if("polygon"===x[a].type&&n.get(x[a],"seriesIndex")==e&&n.get(x[a],"dataIndex")==c){this._curTarget=x[a];var m=this.component.polar.getCenter(l.polarIndex||0);_=m[0],y=m[1];break}break;case r.CHART_TYPE_PIE:for(var v=t.name,a=0,o=x.length;o>a;a++)if("sector"===x[a].type&&n.get(x[a],"seriesIndex")==e&&n.get(x[a],"name")==v){this._curTarget=x[a];var b=this._curTarget.style,S=(b.startAngle+b.endAngle)/2*Math.PI/180;_=this._curTarget.style.x+Math.cos(S)*b.r/1.5,y=this._curTarget.style.y-Math.sin(S)*b.r/1.5;break}break;case r.CHART_TYPE_MAP:for(var v=t.name,z=l.mapType,a=0,o=x.length;o>a;a++)if("text"===x[a].type&&x[a]._mapType===z&&x[a].style._name===v){this._curTarget=x[a],_=this._curTarget.style.x+this._curTarget.position[0],y=this._curTarget.style.y+this._curTarget.position[1];break}break;case r.CHART_TYPE_CHORD:for(var v=t.name,a=0,o=x.length;o>a;a++)if("sector"===x[a].type&&n.get(x[a],"name")==v){this._curTarget=x[a];var b=this._curTarget.style,S=(b.startAngle+b.endAngle)/2*Math.PI/180;return _=this._curTarget.style.x+Math.cos(S)*(b.r-2),y=this._curTarget.style.y-Math.sin(S)*(b.r-2),void this.zr.trigger(h.EVENT.MOUSEMOVE,{zrenderX:_,zrenderY:y})}break;case r.CHART_TYPE_FORCE:for(var v=t.name,a=0,o=x.length;o>a;a++)if("circle"===x[a].type&&n.get(x[a],"name")==v){this._curTarget=x[a],_=this._curTarget.position[0],y=this._curTarget.position[1];break}}if(null!=_&&null!=y)this._event={zrenderX:_,zrenderY:y},this.zr.addHoverShape(this._curTarget),this.zr.refreshHover(),this._showItemTrigger()}}}},hideTip:function(){this._hide()},refresh:function(t){if(this._zrHeight=this.zr.getHeight(),this._zrWidth=this.zr.getWidth(),this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape);if(this._lastTipShape=!1,this.shapeList.length=2,this._lastDataIndex=-1,this._lastSeriesIndex=-1,this._lastItemTriggerId=-1,t){if(this.option=t,this.option.tooltip=this.reformOption(this.option.tooltip),this.option.tooltip.textStyle=c.merge(this.option.tooltip.textStyle,this.ecTheme.textStyle),this._needAxisTrigger=!1,"axis"===this.option.tooltip.trigger)this._needAxisTrigger=!0;for(var e=this.option.series,i=0,s=e.length;s>i;i++)if("axis"===this.query(e[i],"tooltip.trigger")){this._needAxisTrigger=!0;break}this._showDelay=this.option.tooltip.showDelay,this._hideDelay=this.option.tooltip.hideDelay,this._defaultCssText=this._style(this.option.tooltip),this._setSelectedMap(),this._axisLineWidth=this.option.tooltip.axisPointer.lineStyle.width,this._enterable=this.option.tooltip.enterable}if(this.showing){var a=this;setTimeout(function(){a.zr.trigger(h.EVENT.MOUSEMOVE,a.zr.handler._event)},50)}},onbeforDispose:function(){if(this._lastTipShape&&this._lastTipShape.tipShape.length>0)this.zr.delShape(this._lastTipShape.tipShape);if(clearTimeout(this._hidingTicket),clearTimeout(this._showingTicket),this.zr.un(h.EVENT.MOUSEMOVE,this._onmousemove),this.zr.un(h.EVENT.GLOBALOUT,this._onglobalout),this.hasAppend&&this.dom.firstChild)this.dom.firstChild.removeChild(this._tDom);this._tDom=null},_encodeHTML:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},c.inherits(t,e),require("../component").define("tooltip",t),t});