define("echarts/component/toolbox",["require","./base","zrender/shape/Line","zrender/shape/Image","zrender/shape/Rectangle","../util/shape/Icon","../config","zrender/tool/util","zrender/config","zrender/tool/event","./dataView","../component"],function(require){function t(t,i,s,a,o){e.call(this,t,i,s,a,o),this.dom=o.dom,this._magicType={},this._magicMap={},this._isSilence=!1,this._iconList,this._iconShapeMap={},this._featureTitle={},this._featureIcon={},this._featureColor={},this._featureOption={},this._enableColor="red",this._disableColor="#ccc",this._markShapeList=[];var r=this;r._onMark=function(t){r.__onMark(t)},r._onMarkUndo=function(t){r.__onMarkUndo(t)},r._onMarkClear=function(t){r.__onMarkClear(t)},r._onDataZoom=function(t){r.__onDataZoom(t)},r._onDataZoomReset=function(t){r.__onDataZoomReset(t)},r._onDataView=function(t){r.__onDataView(t)},r._onRestore=function(t){r.__onRestore(t)},r._onSaveAsImage=function(t){r.__onSaveAsImage(t)},r._onMagicType=function(t){r.__onMagicType(t)},r._onCustomHandler=function(t){r.__onCustomHandler(t)},r._onmousemove=function(t){return r.__onmousemove(t)},r._onmousedown=function(t){return r.__onmousedown(t)},r._onmouseup=function(t){return r.__onmouseup(t)},r._onclick=function(t){return r.__onclick(t)}}var e=require("./base"),i=require("zrender/shape/Line"),s=require("zrender/shape/Image"),a=require("zrender/shape/Rectangle"),o=require("../util/shape/Icon"),r=require("../config");r.toolbox={zlevel:0,z:6,show:!1,orient:"horizontal",x:"right",y:"top",color:["#1e90ff","#22bb22","#4b0082","#d2691e"],disableColor:"#ddd",effectiveColor:"red",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,itemSize:16,showTitle:!0,feature:{mark:{show:!1,title:{mark:"辅助线开关",markUndo:"删除辅助线",markClear:"清空辅助线"},lineStyle:{width:1,color:"#1e90ff",type:"dashed"}},dataZoom:{show:!1,title:{dataZoom:"区域缩放",dataZoomReset:"区域缩放后退"}},dataView:{show:!1,title:"数据视图",readOnly:!1,lang:["数据视图","关闭","刷新"]},magicType:{show:!1,title:{line:"折线图切换",bar:"柱形图切换",stack:"堆积",tiled:"平铺",force:"力导向布局图切换",chord:"和弦图切换",pie:"饼图切换",funnel:"漏斗图切换"},type:[]},restore:{show:!1,title:"还原"},saveAsImage:{show:!1,title:"保存为图片",type:"png",lang:["点击保存"]}}};var n=require("zrender/tool/util"),h=require("zrender/config"),l=require("zrender/tool/event"),d="stack",p="tiled";return t.prototype={type:r.COMPONENT_TYPE_TOOLBOX,_buildShape:function(){this._iconList=[];var t=this.option.toolbox;this._enableColor=t.effectiveColor,this._disableColor=t.disableColor;var e=t.feature,i=[];for(var s in e)if(e[s].show)switch(s){case"mark":i.push({key:s,name:"mark"}),i.push({key:s,name:"markUndo"}),i.push({key:s,name:"markClear"});break;case"magicType":for(var a=0,o=e[s].type.length;o>a;a++){if(e[s].title[e[s].type[a]+"Chart"]=e[s].title[e[s].type[a]],e[s].option)e[s].option[e[s].type[a]+"Chart"]=e[s].option[e[s].type[a]];i.push({key:s,name:e[s].type[a]+"Chart"})}break;case"dataZoom":i.push({key:s,name:"dataZoom"}),i.push({key:s,name:"dataZoomReset"});break;case"saveAsImage":if(this.canvasSupported)i.push({key:s,name:"saveAsImage"});break;default:i.push({key:s,name:s})}if(i.length>0){for(var r,s,a=0,o=i.length;o>a;a++){if(r=i[a].name,s=i[a].key,this._iconList.push(r),this._featureTitle[r]=e[s].title[r]||e[s].title,e[s].icon)this._featureIcon[r]=e[s].icon[r]||e[s].icon;if(e[s].color)this._featureColor[r]=e[s].color[r]||e[s].color;if(e[s].option)this._featureOption[r]=e[s].option[r]||e[s].option}this._itemGroupLocation=this._getItemGroupLocation(),this._buildBackground(),this._buildItem();for(var a=0,o=this.shapeList.length;o>a;a++)this.zr.addShape(this.shapeList[a]);if(this._iconShapeMap.mark)this._iconDisable(this._iconShapeMap.markUndo),this._iconDisable(this._iconShapeMap.markClear);if(this._iconShapeMap.dataZoomReset&&0===this._zoomQueue.length)this._iconDisable(this._iconShapeMap.dataZoomReset)}},_buildItem:function(){var t,e,i,a,r=this.option.toolbox,n=this._iconList.length,h=this._itemGroupLocation.x,l=this._itemGroupLocation.y,d=r.itemSize,p=r.itemGap,c=r.color instanceof Array?r.color:[r.color],g=this.getFont(r.textStyle);if("horizontal"===r.orient)e=this._itemGroupLocation.y/this.zr.getHeight()<.5?"bottom":"top",i=this._itemGroupLocation.x/this.zr.getWidth()<.5?"left":"right",a=this._itemGroupLocation.y/this.zr.getHeight()<.5?"top":"bottom";else e=this._itemGroupLocation.x/this.zr.getWidth()<.5?"right":"left";this._iconShapeMap={};for(var u=this,f=0;n>f;f++){if(t={type:"icon",zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:h,y:l,width:d,height:d,iconType:this._iconList[f],lineWidth:1,strokeColor:this._featureColor[this._iconList[f]]||c[f%c.length],brushType:"stroke"},highlightStyle:{lineWidth:1,text:r.showTitle?this._featureTitle[this._iconList[f]]:void 0,textFont:g,textPosition:e,strokeColor:this._featureColor[this._iconList[f]]||c[f%c.length]},hoverable:!0,clickable:!0},this._featureIcon[this._iconList[f]])t.style.image=this._featureIcon[this._iconList[f]].replace(new RegExp("^image:\\/\\/"),""),t.style.opacity=.8,t.highlightStyle.opacity=1,t.type="image";if("horizontal"===r.orient){if(0===f&&"left"===i)t.highlightStyle.textPosition="specific",t.highlightStyle.textAlign=i,t.highlightStyle.textBaseline=a,t.highlightStyle.textX=h,t.highlightStyle.textY="top"===a?l+d+10:l-10;if(f===n-1&&"right"===i)t.highlightStyle.textPosition="specific",t.highlightStyle.textAlign=i,t.highlightStyle.textBaseline=a,t.highlightStyle.textX=h+d,t.highlightStyle.textY="top"===a?l+d+10:l-10}switch(this._iconList[f]){case"mark":t.onclick=u._onMark;break;case"markUndo":t.onclick=u._onMarkUndo;break;case"markClear":t.onclick=u._onMarkClear;break;case"dataZoom":t.onclick=u._onDataZoom;break;case"dataZoomReset":t.onclick=u._onDataZoomReset;break;case"dataView":if(!this._dataView){var y=require("./dataView");this._dataView=new y(this.ecTheme,this.messageCenter,this.zr,this.option,this.myChart)}t.onclick=u._onDataView;break;case"restore":t.onclick=u._onRestore;break;case"saveAsImage":t.onclick=u._onSaveAsImage;break;default:if(this._iconList[f].match("Chart"))t._name=this._iconList[f].replace("Chart",""),t.onclick=u._onMagicType;else t.onclick=u._onCustomHandler}if("icon"===t.type)t=new o(t);else if("image"===t.type)t=new s(t);if(this.shapeList.push(t),this._iconShapeMap[this._iconList[f]]=t,"horizontal"===r.orient)h+=d+p;else l+=d+p}},_buildBackground:function(){var t=this.option.toolbox,e=this.reformCssArray(this.option.toolbox.padding);this.shapeList.push(new a({zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:this._itemGroupLocation.x-e[3],y:this._itemGroupLocation.y-e[0],width:this._itemGroupLocation.width+e[3]+e[1],height:this._itemGroupLocation.height+e[0]+e[2],brushType:0===t.borderWidth?"fill":"both",color:t.backgroundColor,strokeColor:t.borderColor,lineWidth:t.borderWidth}}))},_getItemGroupLocation:function(){var t=this.option.toolbox,e=this.reformCssArray(this.option.toolbox.padding),i=this._iconList.length,s=t.itemGap,a=t.itemSize,o=0,r=0;if("horizontal"===t.orient)o=(a+s)*i-s,r=a;else r=(a+s)*i-s,o=a;var n,h=this.zr.getWidth();switch(t.x){case"center":n=Math.floor((h-o)/2);break;case"left":n=e[3]+t.borderWidth;break;case"right":n=h-o-e[1]-t.borderWidth;break;default:n=t.x-0,n=isNaN(n)?0:n}var l,d=this.zr.getHeight();switch(t.y){case"top":l=e[0]+t.borderWidth;break;case"bottom":l=d-r-e[2]-t.borderWidth;break;case"center":l=Math.floor((d-r)/2);break;default:l=t.y-0,l=isNaN(l)?0:l}return{x:n,y:l,width:o,height:r}},__onmousemove:function(t){if(this._marking)this._markShape.style.xEnd=l.getX(t.event),this._markShape.style.yEnd=l.getY(t.event),this.zr.addHoverShape(this._markShape);if(this._zooming)this._zoomShape.style.width=l.getX(t.event)-this._zoomShape.style.x,this._zoomShape.style.height=l.getY(t.event)-this._zoomShape.style.y,this.zr.addHoverShape(this._zoomShape),this.dom.style.cursor="crosshair",l.stop(t.event);if(this._zoomStart&&"pointer"!=this.dom.style.cursor&&"move"!=this.dom.style.cursor)this.dom.style.cursor="crosshair"},__onmousedown:function(t){if(!t.target){this._zooming=!0;var e=l.getX(t.event),i=l.getY(t.event),s=this.option.dataZoom||{};return this._zoomShape=new a({zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:e,y:i,width:1,height:1,brushType:"both"},highlightStyle:{lineWidth:2,color:s.fillerColor||r.dataZoom.fillerColor,strokeColor:s.handleColor||r.dataZoom.handleColor,brushType:"both"}}),this.zr.addHoverShape(this._zoomShape),!0}},__onmouseup:function(){if(!this._zoomShape||Math.abs(this._zoomShape.style.width)<10||Math.abs(this._zoomShape.style.height)<10)return this._zooming=!1,!0;if(this._zooming&&this.component.dataZoom){this._zooming=!1;var t=this.component.dataZoom.rectZoom(this._zoomShape.style);if(t)this._zoomQueue.push({start:t.start,end:t.end,start2:t.start2,end2:t.end2}),this._iconEnable(this._iconShapeMap.dataZoomReset),this.zr.refreshNextFrame()}return!0},__onclick:function(t){if(!t.target)if(this._marking)this._marking=!1,this._markShapeList.push(this._markShape),this._iconEnable(this._iconShapeMap.markUndo),this._iconEnable(this._iconShapeMap.markClear),this.zr.addShape(this._markShape),this.zr.refreshNextFrame();else if(this._markStart){this._marking=!0;var e=l.getX(t.event),s=l.getY(t.event);this._markShape=new i({zlevel:this.getZlevelBase(),z:this.getZBase(),style:{xStart:e,yStart:s,xEnd:e,yEnd:s,lineWidth:this.query(this.option,"toolbox.feature.mark.lineStyle.width"),strokeColor:this.query(this.option,"toolbox.feature.mark.lineStyle.color"),lineType:this.query(this.option,"toolbox.feature.mark.lineStyle.type")}}),this.zr.addHoverShape(this._markShape)}},__onMark:function(t){var e=t.target;if(this._marking||this._markStart)this._resetMark(),this.zr.refreshNextFrame();else{this._resetZoom(),this.zr.modShape(e.id,{style:{strokeColor:this._enableColor}}),this.zr.refreshNextFrame(),this._markStart=!0;var i=this;setTimeout(function(){i.zr&&i.zr.on(h.EVENT.CLICK,i._onclick)&&i.zr.on(h.EVENT.MOUSEMOVE,i._onmousemove)},10)}return!0},__onMarkUndo:function(){if(this._marking)this._marking=!1;else{var t=this._markShapeList.length;if(t>=1){var e=this._markShapeList[t-1];if(this.zr.delShape(e.id),this.zr.refreshNextFrame(),this._markShapeList.pop(),1===t)this._iconDisable(this._iconShapeMap.markUndo),this._iconDisable(this._iconShapeMap.markClear)}}return!0},__onMarkClear:function(){if(this._marking)this._marking=!1;var t=this._markShapeList.length;if(t>0){for(;t--;)this.zr.delShape(this._markShapeList.pop().id);this._iconDisable(this._iconShapeMap.markUndo),this._iconDisable(this._iconShapeMap.markClear),this.zr.refreshNextFrame()}return!0},__onDataZoom:function(t){var e=t.target;if(this._zooming||this._zoomStart)this._resetZoom(),this.zr.refreshNextFrame(),this.dom.style.cursor="default";else{this._resetMark(),this.zr.modShape(e.id,{style:{strokeColor:this._enableColor}}),this.zr.refreshNextFrame(),this._zoomStart=!0;var i=this;setTimeout(function(){i.zr&&i.zr.on(h.EVENT.MOUSEDOWN,i._onmousedown)&&i.zr.on(h.EVENT.MOUSEUP,i._onmouseup)&&i.zr.on(h.EVENT.MOUSEMOVE,i._onmousemove)},10),this.dom.style.cursor="crosshair"}return!0},__onDataZoomReset:function(){if(this._zooming)this._zooming=!1;if(this._zoomQueue.pop(),this._zoomQueue.length>0)this.component.dataZoom.absoluteZoom(this._zoomQueue[this._zoomQueue.length-1]);else this.component.dataZoom.rectZoom(),this._iconDisable(this._iconShapeMap.dataZoomReset),this.zr.refreshNextFrame();return!0},_resetMark:function(){if(this._marking=!1,this._markStart){if(this._markStart=!1,this._iconShapeMap.mark)this.zr.modShape(this._iconShapeMap.mark.id,{style:{strokeColor:this._iconShapeMap.mark.highlightStyle.strokeColor}});this.zr.un(h.EVENT.CLICK,this._onclick),this.zr.un(h.EVENT.MOUSEMOVE,this._onmousemove)}},_resetZoom:function(){if(this._zooming=!1,this._zoomStart){if(this._zoomStart=!1,this._iconShapeMap.dataZoom)this.zr.modShape(this._iconShapeMap.dataZoom.id,{style:{strokeColor:this._iconShapeMap.dataZoom.highlightStyle.strokeColor}});this.zr.un(h.EVENT.MOUSEDOWN,this._onmousedown),this.zr.un(h.EVENT.MOUSEUP,this._onmouseup),this.zr.un(h.EVENT.MOUSEMOVE,this._onmousemove)}},_iconDisable:function(t){if("image"!=t.type)this.zr.modShape(t.id,{hoverable:!1,clickable:!1,style:{strokeColor:this._disableColor}});else this.zr.modShape(t.id,{hoverable:!1,clickable:!1,style:{opacity:.3}})},_iconEnable:function(t){if("image"!=t.type)this.zr.modShape(t.id,{hoverable:!0,clickable:!0,style:{strokeColor:t.highlightStyle.strokeColor}});else this.zr.modShape(t.id,{hoverable:!0,clickable:!0,style:{opacity:.8}})},__onDataView:function(){return this._dataView.show(this.option),!0},__onRestore:function(){return this._resetMark(),this._resetZoom(),this.messageCenter.dispatch(r.EVENT.RESTORE,null,null,this.myChart),!0},__onSaveAsImage:function(){var t=this.option.toolbox.feature.saveAsImage,e=t.type||"png";if("png"!=e&&"jpeg"!=e)e="png";var i;if(!this.myChart.isConnected())i=this.zr.toDataURL("image/"+e,this.option.backgroundColor&&"rgba(0,0,0,0)"===this.option.backgroundColor.replace(" ","")?"#fff":this.option.backgroundColor);else i=this.myChart.getConnectedDataURL(e);var s=document.createElement("div");s.id="__echarts_download_wrap__",s.style.cssText="position:fixed;z-index:99999;display:block;top:0;left:0;background-color:rgba(33,33,33,0.5);text-align:center;width:100%;height:100%;line-height:"+document.documentElement.clientHeight+"px;";var a=document.createElement("a");a.href=i,a.setAttribute("download",(t.name?t.name:this.option.title&&(this.option.title.text||this.option.title.subtext)?this.option.title.text||this.option.title.subtext:"ECharts")+"."+e),a.innerHTML='<img style="vertical-align:middle" src="'+i+'" title="'+(window.ActiveXObject||"ActiveXObject"in window?"右键->图片另存为":t.lang?t.lang[0]:"点击保存")+'"/>',s.appendChild(a),document.body.appendChild(s),a=null,s=null,setTimeout(function(){var t=document.getElementById("__echarts_download_wrap__");if(t)t.onclick=function(){var t=document.getElementById("__echarts_download_wrap__");t.onclick=null,t.innerHTML="",document.body.removeChild(t),t=null},t=null},500)},__onMagicType:function(t){this._resetMark();var e=t.target._name;if(!this._magicType[e]){if(this._magicType[e]=!0,e===r.CHART_TYPE_LINE)this._magicType[r.CHART_TYPE_BAR]=!1;else if(e===r.CHART_TYPE_BAR)this._magicType[r.CHART_TYPE_LINE]=!1;if(e===r.CHART_TYPE_PIE)this._magicType[r.CHART_TYPE_FUNNEL]=!1;else if(e===r.CHART_TYPE_FUNNEL)this._magicType[r.CHART_TYPE_PIE]=!1;if(e===r.CHART_TYPE_FORCE)this._magicType[r.CHART_TYPE_CHORD]=!1;else if(e===r.CHART_TYPE_CHORD)this._magicType[r.CHART_TYPE_FORCE]=!1;if(e===d)this._magicType[p]=!1;else if(e===p)this._magicType[d]=!1;this.messageCenter.dispatch(r.EVENT.MAGIC_TYPE_CHANGED,t.event,{magicType:this._magicType},this.myChart)}return!0},setMagicType:function(t){this._resetMark(),this._magicType=t,!this._isSilence&&this.messageCenter.dispatch(r.EVENT.MAGIC_TYPE_CHANGED,null,{magicType:this._magicType},this.myChart)},__onCustomHandler:function(t){var e=t.target.style.iconType,i=this.option.toolbox.feature[e].onclick;if("function"==typeof i)i.call(this,this.option)},reset:function(t,e){if(e&&this.clear(),this.query(t,"toolbox.show")&&this.query(t,"toolbox.feature.magicType.show")){var i=t.toolbox.feature.magicType.type,s=i.length;for(this._magicMap={};s--;)this._magicMap[i[s]]=!0;s=t.series.length;for(var a,o;s--;){if(a=t.series[s].type,this._magicMap[a]){if(o=t.xAxis instanceof Array?t.xAxis[t.series[s].xAxisIndex||0]:t.xAxis,o&&"category"===(o.type||"category"))o.__boundaryGap=null!=o.boundaryGap?o.boundaryGap:!0;if(o=t.yAxis instanceof Array?t.yAxis[t.series[s].yAxisIndex||0]:t.yAxis,o&&"category"===o.type)o.__boundaryGap=null!=o.boundaryGap?o.boundaryGap:!0;t.series[s].__type=a,t.series[s].__itemStyle=n.clone(t.series[s].itemStyle||{})}if(this._magicMap[d]||this._magicMap[p])t.series[s].__stack=t.series[s].stack}}this._magicType=e?{}:this._magicType||{};for(var r in this._magicType)if(this._magicType[r]){this.option=t,this.getMagicOption();break}var h=t.dataZoom;if(h&&h.show){var l=null!=h.start&&h.start>=0&&h.start<=100?h.start:0,c=null!=h.end&&h.end>=0&&h.end<=100?h.end:100;if(l>c)l+=c,c=l-c,l-=c;this._zoomQueue=[{start:l,end:c,start2:0,end2:100}]}else this._zoomQueue=[]},getMagicOption:function(){var t,e;if(this._magicType[r.CHART_TYPE_LINE]||this._magicType[r.CHART_TYPE_BAR]){for(var i=this._magicType[r.CHART_TYPE_LINE]?!1:!0,s=0,a=this.option.series.length;a>s;s++)if(e=this.option.series[s].type,e==r.CHART_TYPE_LINE||e==r.CHART_TYPE_BAR){if(t=this.option.xAxis instanceof Array?this.option.xAxis[this.option.series[s].xAxisIndex||0]:this.option.xAxis,t&&"category"===(t.type||"category"))t.boundaryGap=i?!0:t.__boundaryGap;if(t=this.option.yAxis instanceof Array?this.option.yAxis[this.option.series[s].yAxisIndex||0]:this.option.yAxis,t&&"category"===t.type)t.boundaryGap=i?!0:t.__boundaryGap}this._defaultMagic(r.CHART_TYPE_LINE,r.CHART_TYPE_BAR)}if(this._defaultMagic(r.CHART_TYPE_CHORD,r.CHART_TYPE_FORCE),this._defaultMagic(r.CHART_TYPE_PIE,r.CHART_TYPE_FUNNEL),this._magicType[d]||this._magicType[p])for(var s=0,a=this.option.series.length;a>s;s++){if(this._magicType[d])this.option.series[s].stack="_ECHARTS_STACK_KENER_2014_",e=d;else if(this._magicType[p])this.option.series[s].stack=null,e=p;if(this._featureOption[e+"Chart"])n.merge(this.option.series[s],this._featureOption[e+"Chart"]||{},!0)}return this.option},_defaultMagic:function(t,e){if(this._magicType[t]||this._magicType[e])for(var i=0,s=this.option.series.length;s>i;i++){var a=this.option.series[i].type;if(a==t||a==e)if(this.option.series[i].type=this._magicType[t]?t:e,this.option.series[i].itemStyle=n.clone(this.option.series[i].__itemStyle),a=this.option.series[i].type,this._featureOption[a+"Chart"])n.merge(this.option.series[i],this._featureOption[a+"Chart"]||{},!0)}},silence:function(t){this._isSilence=t},resize:function(){if(this._resetMark(),this.clear(),this.option&&this.option.toolbox&&this.option.toolbox.show)this._buildShape();if(this._dataView)this._dataView.resize()},hideDataView:function(){if(this._dataView)this._dataView.hide()},clear:function(t){if(this.zr)if(this.zr.delShape(this.shapeList),this.shapeList=[],!t)this.zr.delShape(this._markShapeList),this._markShapeList=[]},onbeforDispose:function(){if(this._dataView)this._dataView.dispose(),this._dataView=null;this._markShapeList=null},refresh:function(t){if(t){if(this._resetMark(),this._resetZoom(),t.toolbox=this.reformOption(t.toolbox),this.option=t,this.clear(!0),t.toolbox.show)this._buildShape();this.hideDataView()}}},n.inherits(t,e),require("../component").define("toolbox",t),t});