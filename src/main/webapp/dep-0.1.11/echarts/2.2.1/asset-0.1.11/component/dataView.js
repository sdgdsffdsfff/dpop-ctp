define("echarts/component/dataView",["require","./base","../config","zrender/tool/util","../component"],function(require){function e(e,i,a,s,o){if(t.call(this,e,i,a,s,o),this.dom=o.dom,this._tDom=document.createElement("div"),this._textArea=document.createElement("textArea"),this._buttonRefresh=document.createElement("button"),this._buttonClose=document.createElement("button"),this._hasShow=!1,this._zrHeight=a.getHeight(),this._zrWidth=a.getWidth(),this._tDom.className="echarts-dataview",this.hide(),this.dom.firstChild.appendChild(this._tDom),window.addEventListener)this._tDom.addEventListener("click",this._stop),this._tDom.addEventListener("mousewheel",this._stop),this._tDom.addEventListener("mousemove",this._stop),this._tDom.addEventListener("mousedown",this._stop),this._tDom.addEventListener("mouseup",this._stop),this._tDom.addEventListener("touchstart",this._stop),this._tDom.addEventListener("touchmove",this._stop),this._tDom.addEventListener("touchend",this._stop);else this._tDom.attachEvent("onclick",this._stop),this._tDom.attachEvent("onmousewheel",this._stop),this._tDom.attachEvent("onmousemove",this._stop),this._tDom.attachEvent("onmousedown",this._stop),this._tDom.attachEvent("onmouseup",this._stop)}var t=require("./base"),i=require("../config"),a=require("zrender/tool/util");return e.prototype={type:i.COMPONENT_TYPE_DATAVIEW,_lang:["Data View","close","refresh"],_gCssText:"position:absolute;display:block;overflow:hidden;transition:height 0.8s,background-color 1s;-moz-transition:height 0.8s,background-color 1s;-webkit-transition:height 0.8s,background-color 1s;-o-transition:height 0.8s,background-color 1s;z-index:1;left:0;top:0;",hide:function(){this._sizeCssText="width:"+this._zrWidth+"px;height:0px;background-color:#f0ffff;",this._tDom.style.cssText=this._gCssText+this._sizeCssText},show:function(e){this._hasShow=!0;var t=this.query(this.option,"toolbox.feature.dataView.lang")||this._lang;this.option=e,this._tDom.innerHTML='<p style="padding:8px 0;margin:0 0 10px 0;border-bottom:1px solid #eee">'+(t[0]||this._lang[0])+"</p>";var i=this.query(this.option,"toolbox.feature.dataView.optionToContent");if("function"!=typeof i)this._textArea.value=this._optionToContent();else this._textArea=document.createElement("div"),this._textArea.innerHTML=i(this.option);this._textArea.style.cssText="display:block;margin:0 0 8px 0;padding:4px 6px;overflow:auto;width:100%;height:"+(this._zrHeight-100)+"px;",this._tDom.appendChild(this._textArea),this._buttonClose.style.cssText="float:right;padding:1px 6px;",this._buttonClose.innerHTML=t[1]||this._lang[1];var a=this;if(this._buttonClose.onclick=function(){a.hide()},this._tDom.appendChild(this._buttonClose),this.query(this.option,"toolbox.feature.dataView.readOnly")===!1)this._buttonRefresh.style.cssText="float:right;margin-right:10px;padding:1px 6px;",this._buttonRefresh.innerHTML=t[2]||this._lang[2],this._buttonRefresh.onclick=function(){a._save()},this._textArea.readOnly=!1,this._textArea.style.cursor="default";else this._buttonRefresh.style.cssText="display:none",this._textArea.readOnly=!0,this._textArea.style.cursor="text";this._tDom.appendChild(this._buttonRefresh),this._sizeCssText="width:"+this._zrWidth+"px;height:"+this._zrHeight+"px;background-color:#fff;",this._tDom.style.cssText=this._gCssText+this._sizeCssText},_optionToContent:function(){var e,t,a,s,o,r,n=[],h="";if(this.option.xAxis){if(this.option.xAxis instanceof Array)n=this.option.xAxis;else n=[this.option.xAxis];for(e=0,s=n.length;s>e;e++)if("category"==(n[e].type||"category")){for(r=[],t=0,a=n[e].data.length;a>t;t++)r.push(this.getDataFromOption(n[e].data[t]));h+=r.join(", ")+"\n\n"}}if(this.option.yAxis){if(this.option.yAxis instanceof Array)n=this.option.yAxis;else n=[this.option.yAxis];for(e=0,s=n.length;s>e;e++)if("category"==n[e].type){for(r=[],t=0,a=n[e].data.length;a>t;t++)r.push(this.getDataFromOption(n[e].data[t]));h+=r.join(", ")+"\n\n"}}var l,d=this.option.series;for(e=0,s=d.length;s>e;e++){for(r=[],t=0,a=d[e].data.length;a>t;t++){if(o=d[e].data[t],d[e].type==i.CHART_TYPE_PIE||d[e].type==i.CHART_TYPE_MAP)l=(o.name||"-")+":";else l="";if(d[e].type==i.CHART_TYPE_SCATTER)o=this.getDataFromOption(o).join(", ");r.push(l+this.getDataFromOption(o))}h+=(d[e].name||"-")+" : \n",h+=r.join(d[e].type==i.CHART_TYPE_SCATTER?"\n":", "),h+="\n\n"}return h},_save:function(){var e=this.query(this.option,"toolbox.feature.dataView.contentToOption");if("function"!=typeof e){for(var t=this._textArea.value.split("\n"),a=[],s=0,o=t.length;o>s;s++)if(t[s]=this._trim(t[s]),""!==t[s])a.push(t[s]);this._contentToOption(a)}else e(this._textArea,this.option);this.hide();var r=this;setTimeout(function(){r.messageCenter&&r.messageCenter.dispatch(i.EVENT.DATA_VIEW_CHANGED,null,{option:r.option},r.myChart)},r.canvasSupported?800:100)},_contentToOption:function(e){var t,a,s,o,r,n,h,l=[],d=0;if(this.option.xAxis){if(this.option.xAxis instanceof Array)l=this.option.xAxis;else l=[this.option.xAxis];for(t=0,o=l.length;o>t;t++)if("category"==(l[t].type||"category")){for(n=e[d].split(","),a=0,s=l[t].data.length;s>a;a++)if(h=this._trim(n[a]||""),r=l[t].data[a],"undefined"!=typeof l[t].data[a].value)l[t].data[a].value=h;else l[t].data[a]=h;d++}}if(this.option.yAxis){if(this.option.yAxis instanceof Array)l=this.option.yAxis;else l=[this.option.yAxis];for(t=0,o=l.length;o>t;t++)if("category"==l[t].type){for(n=e[d].split(","),a=0,s=l[t].data.length;s>a;a++)if(h=this._trim(n[a]||""),r=l[t].data[a],"undefined"!=typeof l[t].data[a].value)l[t].data[a].value=h;else l[t].data[a]=h;d++}}var p=this.option.series;for(t=0,o=p.length;o>t;t++)if(d++,p[t].type==i.CHART_TYPE_SCATTER)for(var a=0,s=p[t].data.length;s>a;a++){if(n=e[d],h=n.replace(" ","").split(","),"undefined"!=typeof p[t].data[a].value)p[t].data[a].value=h;else p[t].data[a]=h;d++}else{n=e[d].split(",");for(var a=0,s=p[t].data.length;s>a;a++)if(h=(n[a]||"").replace(/.*:/,""),h=this._trim(h),h="-"!=h&&""!==h?h-0:"-","undefined"!=typeof p[t].data[a].value)p[t].data[a].value=h;else p[t].data[a]=h;d++}},_trim:function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return e.replace(t,"")},_stop:function(e){if(e=e||window.event,e.stopPropagation)e.stopPropagation();else e.cancelBubble=!0},resize:function(){if(this._zrHeight=this.zr.getHeight(),this._zrWidth=this.zr.getWidth(),this._tDom.offsetHeight>10)this._sizeCssText="width:"+this._zrWidth+"px;height:"+this._zrHeight+"px;background-color:#fff;",this._tDom.style.cssText=this._gCssText+this._sizeCssText,this._textArea.style.cssText="display:block;margin:0 0 8px 0;padding:4px 6px;overflow:auto;width:100%;height:"+(this._zrHeight-100)+"px;"},dispose:function(){if(window.removeEventListener)this._tDom.removeEventListener("click",this._stop),this._tDom.removeEventListener("mousewheel",this._stop),this._tDom.removeEventListener("mousemove",this._stop),this._tDom.removeEventListener("mousedown",this._stop),this._tDom.removeEventListener("mouseup",this._stop),this._tDom.removeEventListener("touchstart",this._stop),this._tDom.removeEventListener("touchmove",this._stop),this._tDom.removeEventListener("touchend",this._stop);else this._tDom.detachEvent("onclick",this._stop),this._tDom.detachEvent("onmousewheel",this._stop),this._tDom.detachEvent("onmousemove",this._stop),this._tDom.detachEvent("onmousedown",this._stop),this._tDom.detachEvent("onmouseup",this._stop);if(this._buttonRefresh.onclick=null,this._buttonClose.onclick=null,this._hasShow)this._tDom.removeChild(this._textArea),this._tDom.removeChild(this._buttonRefresh),this._tDom.removeChild(this._buttonClose);this._textArea=null,this._buttonRefresh=null,this._buttonClose=null,this.dom.firstChild.removeChild(this._tDom),this._tDom=null}},a.inherits(e,t),require("../component").define("dataView",e),e});