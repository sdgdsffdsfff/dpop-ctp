define("echarts/component/legend",["require","./base","zrender/shape/Text","zrender/shape/Rectangle","zrender/shape/Sector","../util/shape/Icon","../util/shape/Candle","../config","zrender/tool/util","zrender/tool/area","../component"],function(require){function e(e,i,s,a,o){if(!this.query(a,"legend.data"))return void console.error("option.legend.data has not been defined.");t.call(this,e,i,s,a,o);var r=this;r._legendSelected=function(e){r.__legendSelected(e)},r._dispatchHoverLink=function(e){return r.__dispatchHoverLink(e)},this._colorIndex=0,this._colorMap={},this._selectedMap={},this._hasDataMap={},this.refresh(a)}var t=require("./base"),i=require("zrender/shape/Text"),s=require("zrender/shape/Rectangle"),a=require("zrender/shape/Sector"),o=require("../util/shape/Icon"),r=require("../util/shape/Candle"),n=require("../config");n.legend={zlevel:0,z:4,show:!0,orient:"horizontal",x:"center",y:"top",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,itemWidth:20,itemHeight:14,textStyle:{color:"#333"},selectedMode:!0};var h=require("zrender/tool/util"),l=require("zrender/tool/area");e.prototype={type:n.COMPONENT_TYPE_LEGEND,_buildShape:function(){if(this.legendOption.show){this._itemGroupLocation=this._getItemGroupLocation(),this._buildBackground(),this._buildItem();for(var e=0,t=this.shapeList.length;t>e;e++)this.zr.addShape(this.shapeList[e])}},_buildItem:function(){var e,t,s,a,r,n,d,p,c=this.legendOption.data,g=c.length,u=this.legendOption.textStyle,f=this.zr.getWidth(),y=this.zr.getHeight(),m=this._itemGroupLocation.x,_=this._itemGroupLocation.y,x=this.legendOption.itemWidth,v=this.legendOption.itemHeight,b=this.legendOption.itemGap;if("vertical"===this.legendOption.orient&&"right"===this.legendOption.x)m=this._itemGroupLocation.x+this._itemGroupLocation.width-x;for(var S=0;g>S;S++)if(r=h.merge(c[S].textStyle||{},u),n=this.getFont(r),e=this._getName(c[S]),d=this._getFormatterName(e),""!==e){if(t=c[S].icon||this._getSomethingByName(e).type,p=this.getColor(e),"horizontal"===this.legendOption.orient){if(200>f-m&&x+5+l.getTextWidth(d,n)+(S===g-1||""===c[S+1]?0:b)>=f-m)m=this._itemGroupLocation.x,_+=v+b}else if(200>y-_&&v+(S===g-1||""===c[S+1]?0:b)>=y-_)"right"===this.legendOption.x?m-=this._itemGroupLocation.maxWidth+b:m+=this._itemGroupLocation.maxWidth+b,_=this._itemGroupLocation.y;if(s=this._getItemShapeByType(m,_,x,v,this._selectedMap[e]&&this._hasDataMap[e]?p:"#ccc",t,p),s._name=e,s=new o(s),a={zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:m+x+5,y:_+v/2,color:this._selectedMap[e]?"auto"===r.color?p:r.color:"#ccc",text:d,textFont:n,textBaseline:"middle"},highlightStyle:{color:p,brushType:"fill"},hoverable:!!this.legendOption.selectedMode,clickable:!!this.legendOption.selectedMode},"vertical"===this.legendOption.orient&&"right"===this.legendOption.x)a.style.x-=x+10,a.style.textAlign="right";if(a._name=e,a=new i(a),this.legendOption.selectedMode)s.onclick=a.onclick=this._legendSelected,s.onmouseover=a.onmouseover=this._dispatchHoverLink,s.hoverConnect=a.id,a.hoverConnect=s.id;if(this.shapeList.push(s),this.shapeList.push(a),"horizontal"===this.legendOption.orient)m+=x+5+l.getTextWidth(d,n)+b;else _+=v+b}else if("horizontal"===this.legendOption.orient)m=this._itemGroupLocation.x,_+=v+b;else"right"===this.legendOption.x?m-=this._itemGroupLocation.maxWidth+b:m+=this._itemGroupLocation.maxWidth+b,_=this._itemGroupLocation.y;if("horizontal"===this.legendOption.orient&&"center"===this.legendOption.x&&_!=this._itemGroupLocation.y)this._mLineOptimize()},_getName:function(e){return"undefined"!=typeof e.name?e.name:e},_getFormatterName:function(e){var t,i=this.legendOption.formatter;if("function"==typeof i)t=i.call(this.myChart,e);else if("string"==typeof i)t=i.replace("{name}",e);else t=e;return t},_getFormatterNameFromData:function(e){var t=this._getName(e);return this._getFormatterName(t)},_mLineOptimize:function(){for(var e=[],t=this._itemGroupLocation.x,i=2,s=this.shapeList.length;s>i;i++)if(this.shapeList[i].style.x===t)e.push((this._itemGroupLocation.width-(this.shapeList[i-1].style.x+l.getTextWidth(this.shapeList[i-1].style.text,this.shapeList[i-1].style.textFont)-t))/2);else if(i===s-1)e.push((this._itemGroupLocation.width-(this.shapeList[i].style.x+l.getTextWidth(this.shapeList[i].style.text,this.shapeList[i].style.textFont)-t))/2);for(var a=-1,i=1,s=this.shapeList.length;s>i;i++){if(this.shapeList[i].style.x===t)a++;if(0!==e[a])this.shapeList[i].style.x+=e[a];else;}},_buildBackground:function(){var e=this.reformCssArray(this.legendOption.padding);this.shapeList.push(new s({zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:this._itemGroupLocation.x-e[3],y:this._itemGroupLocation.y-e[0],width:this._itemGroupLocation.width+e[3]+e[1],height:this._itemGroupLocation.height+e[0]+e[2],brushType:0===this.legendOption.borderWidth?"fill":"both",color:this.legendOption.backgroundColor,strokeColor:this.legendOption.borderColor,lineWidth:this.legendOption.borderWidth}}))},_getItemGroupLocation:function(){var e=this.legendOption.data,t=e.length,i=this.legendOption.itemGap,s=this.legendOption.itemWidth+5,a=this.legendOption.itemHeight,o=this.legendOption.textStyle,r=this.getFont(o),n=0,d=0,p=this.reformCssArray(this.legendOption.padding),c=this.zr.getWidth()-p[1]-p[3],g=this.zr.getHeight()-p[0]-p[2],u=0,f=0;if("horizontal"===this.legendOption.orient){d=a;for(var y=0;t>y;y++)if(""!==this._getName(e[y])){var m=l.getTextWidth(this._getFormatterNameFromData(e[y]),e[y].textStyle?this.getFont(h.merge(e[y].textStyle||{},o)):r);if(u+s+m+i>c)u-=i,n=Math.max(n,u),d+=a+i,u=0;else u+=s+m+i,n=Math.max(n,u-i)}else u-=i,n=Math.max(n,u),d+=a+i,u=0}else{for(var y=0;t>y;y++)f=Math.max(f,l.getTextWidth(this._getFormatterNameFromData(e[y]),e[y].textStyle?this.getFont(h.merge(e[y].textStyle||{},o)):r));f+=s,n=f;for(var y=0;t>y;y++)if(""!==this._getName(e[y]))if(u+a+i>g)n+=f+i,u-=i,d=Math.max(d,u),u=0;else u+=a+i,d=Math.max(d,u-i);else n+=f+i,u-=i,d=Math.max(d,u),u=0}c=this.zr.getWidth(),g=this.zr.getHeight();var _;switch(this.legendOption.x){case"center":_=Math.floor((c-n)/2);break;case"left":_=p[3]+this.legendOption.borderWidth;break;case"right":_=c-n-p[1]-p[3]-2*this.legendOption.borderWidth;break;default:_=this.parsePercent(this.legendOption.x,c)}var x;switch(this.legendOption.y){case"top":x=p[0]+this.legendOption.borderWidth;break;case"bottom":x=g-d-p[0]-p[2]-2*this.legendOption.borderWidth;break;case"center":x=Math.floor((g-d)/2);break;default:x=this.parsePercent(this.legendOption.y,g)}return{x:_,y:x,width:n,height:d,maxWidth:f}},_getSomethingByName:function(e){for(var t,i=this.option.series,s=0,a=i.length;a>s;s++){if(i[s].name===e)return{type:i[s].type,series:i[s],seriesIndex:s,data:null,dataIndex:-1};if(i[s].type===n.CHART_TYPE_PIE||i[s].type===n.CHART_TYPE_RADAR||i[s].type===n.CHART_TYPE_CHORD||i[s].type===n.CHART_TYPE_FORCE||i[s].type===n.CHART_TYPE_FUNNEL){t=i[s].categories||i[s].data||i[s].nodes;for(var o=0,r=t.length;r>o;o++)if(t[o].name===e)return{type:i[s].type,series:i[s],seriesIndex:s,data:t[o],dataIndex:o}}}return{type:"bar",series:null,seriesIndex:-1,data:null,dataIndex:-1}},_getItemShapeByType:function(e,t,i,s,a,o,r){var h,l="#ccc"===a?r:a,d={zlevel:this.getZlevelBase(),z:this.getZBase(),style:{iconType:"legendicon"+o,x:e,y:t,width:i,height:s,color:a,strokeColor:a,lineWidth:2},highlightStyle:{color:l,strokeColor:l,lineWidth:1},hoverable:this.legendOption.selectedMode,clickable:this.legendOption.selectedMode};if(o.match("image")){var h=o.replace(new RegExp("^image:\\/\\/"),"");o="image"}switch(o){case"line":d.style.brushType="stroke",d.highlightStyle.lineWidth=3;break;case"radar":case"scatter":d.highlightStyle.lineWidth=3;break;case"k":d.style.brushType="both",d.highlightStyle.lineWidth=3,d.highlightStyle.color=d.style.color=this.deepQuery([this.ecTheme,n],"k.itemStyle.normal.color")||"#fff",d.style.strokeColor="#ccc"!=a?this.deepQuery([this.ecTheme,n],"k.itemStyle.normal.lineStyle.color")||"#ff3200":a;break;case"image":if(d.style.iconType="image",d.style.image=h,"#ccc"===a)d.style.opacity=.5}return d},__legendSelected:function(e){var t=e.target._name;if("single"===this.legendOption.selectedMode)for(var i in this._selectedMap)this._selectedMap[i]=!1;this._selectedMap[t]=!this._selectedMap[t],this.messageCenter.dispatch(n.EVENT.LEGEND_SELECTED,e.event,{selected:this._selectedMap,target:t},this.myChart)},__dispatchHoverLink:function(e){this.messageCenter.dispatch(n.EVENT.LEGEND_HOVERLINK,e.event,{target:e.target._name},this.myChart)},refresh:function(e){if(e){this.option=e||this.option,this.option.legend=this.reformOption(this.option.legend),this.legendOption=this.option.legend;var t,i,s,a,o=this.legendOption.data||[];if(this.legendOption.selected)for(var r in this.legendOption.selected)this._selectedMap[r]="undefined"!=typeof this._selectedMap[r]?this._selectedMap[r]:this.legendOption.selected[r];for(var h=0,l=o.length;l>h;h++)if(t=this._getName(o[h]),""!==t)if(i=this._getSomethingByName(t),!i.series)this._hasDataMap[t]=!1;else{if(this._hasDataMap[t]=!0,i.data&&(i.type===n.CHART_TYPE_PIE||i.type===n.CHART_TYPE_FORCE||i.type===n.CHART_TYPE_FUNNEL))a=[i.data,i.series];else a=[i.series];if(s=this.getItemStyleColor(this.deepQuery(a,"itemStyle.normal.color"),i.seriesIndex,i.dataIndex,i.data),s&&i.type!=n.CHART_TYPE_K)this.setColor(t,s);this._selectedMap[t]=null!=this._selectedMap[t]?this._selectedMap[t]:!0}else;}this.clear(),this._buildShape()},getRelatedAmount:function(e){for(var t,i=0,s=this.option.series,a=0,o=s.length;o>a;a++){if(s[a].name===e)i++;if(s[a].type===n.CHART_TYPE_PIE||s[a].type===n.CHART_TYPE_RADAR||s[a].type===n.CHART_TYPE_CHORD||s[a].type===n.CHART_TYPE_FORCE||s[a].type===n.CHART_TYPE_FUNNEL){t=s[a].type!=n.CHART_TYPE_FORCE?s[a].data:s[a].categories;for(var r=0,h=t.length;h>r;r++)if(t[r].name===e&&"-"!=t[r].value)i++}}return i},setColor:function(e,t){this._colorMap[e]=t},getColor:function(e){if(!this._colorMap[e])this._colorMap[e]=this.zr.getColor(this._colorIndex++);return this._colorMap[e]},hasColor:function(e){return this._colorMap[e]?this._colorMap[e]:!1},add:function(e,t){for(var i=this.legendOption.data,s=0,a=i.length;a>s;s++)if(this._getName(i[s])===e)return;this.legendOption.data.push(e),this.setColor(e,t),this._selectedMap[e]=!0,this._hasDataMap[e]=!0},del:function(e){for(var t=this.legendOption.data,i=0,s=t.length;s>i;i++)if(this._getName(t[i])===e)return this.legendOption.data.splice(i,1)},getItemShape:function(e){if(null!=e)for(var t,i=0,s=this.shapeList.length;s>i;i++)if(t=this.shapeList[i],t._name===e&&"text"!=t.type)return t},setItemShape:function(e,t){for(var i,s=0,a=this.shapeList.length;a>s;s++)if(i=this.shapeList[s],i._name===e&&"text"!=i.type){if(!this._selectedMap[e])t.style.color="#ccc",t.style.strokeColor="#ccc";this.zr.modShape(i.id,t)}},isSelected:function(e){if("undefined"!=typeof this._selectedMap[e])return this._selectedMap[e];else return!0},getSelectedMap:function(){return this._selectedMap},setSelected:function(e,t){if("single"===this.legendOption.selectedMode)for(var i in this._selectedMap)this._selectedMap[i]=!1;this._selectedMap[e]=t,this.messageCenter.dispatch(n.EVENT.LEGEND_SELECTED,null,{selected:this._selectedMap,target:e},this.myChart)},onlegendSelected:function(e,t){var i=e.selected;for(var s in i){if(this._selectedMap[s]!=i[s])t.needRefresh=!0;this._selectedMap[s]=i[s]}}};var d={line:function(e,t){var i=t.height/2;e.moveTo(t.x,t.y+i),e.lineTo(t.x+t.width,t.y+i)},pie:function(e,t){var i=t.x,s=t.y,o=t.width,r=t.height;a.prototype.buildPath(e,{x:i+o/2,y:s+r+2,r:r,r0:6,startAngle:45,endAngle:135})},eventRiver:function(e,t){var i=t.x,s=t.y,a=t.width,o=t.height;e.moveTo(i,s+o),e.bezierCurveTo(i+a,s+o,i,s+4,i+a,s+4),e.lineTo(i+a,s),e.bezierCurveTo(i,s,i+a,s+o-4,i,s+o-4),e.lineTo(i,s+o)},k:function(e,t){var i=t.x,s=t.y,a=t.width,o=t.height;r.prototype.buildPath(e,{x:i+a/2,y:[s+1,s+1,s+o-6,s+o],width:a-6})},bar:function(e,t){var i=t.x,s=t.y+1,a=t.width,o=t.height-2,r=3;e.moveTo(i+r,s),e.lineTo(i+a-r,s),e.quadraticCurveTo(i+a,s,i+a,s+r),e.lineTo(i+a,s+o-r),e.quadraticCurveTo(i+a,s+o,i+a-r,s+o),e.lineTo(i+r,s+o),e.quadraticCurveTo(i,s+o,i,s+o-r),e.lineTo(i,s+r),e.quadraticCurveTo(i,s,i+r,s)},force:function(e,t){o.prototype.iconLibrary.circle(e,t)},radar:function(e,t){var i=6,s=t.x+t.width/2,a=t.y+t.height/2,o=t.height/2,r=2*Math.PI/i,n=-Math.PI/2,h=s+o*Math.cos(n),l=a+o*Math.sin(n);e.moveTo(h,l),n+=r;for(var d=0,p=i-1;p>d;d++)e.lineTo(s+o*Math.cos(n),a+o*Math.sin(n)),n+=r;e.lineTo(h,l)}};d.chord=d.pie,d.map=d.bar;for(var p in d)o.prototype.iconLibrary["legendicon"+p]=d[p];return h.inherits(e,t),require("../component").define("legend",e),e});