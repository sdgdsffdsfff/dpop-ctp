define("echarts/component/polar",["require","./base","zrender/shape/Text","zrender/shape/Line","zrender/shape/Polygon","zrender/shape/Circle","zrender/shape/Ring","../config","zrender/tool/util","../util/coordinates","../util/accMath","../util/smartSteps","../component"],function(require){function e(e,i,s,a,o){t.call(this,e,i,s,a,o),this.refresh(a)}var t=require("./base"),i=require("zrender/shape/Text"),s=require("zrender/shape/Line"),a=require("zrender/shape/Polygon"),o=require("zrender/shape/Circle"),r=require("zrender/shape/Ring"),n=require("../config");n.polar={zlevel:0,z:0,center:["50%","50%"],radius:"75%",startAngle:90,boundaryGap:[0,0],splitNumber:5,name:{show:!0,textStyle:{color:"#333"}},axisLine:{show:!0,lineStyle:{color:"#ccc",width:1,type:"solid"}},axisLabel:{show:!1,textStyle:{color:"#333"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}},splitLine:{show:!0,lineStyle:{width:1,color:"#ccc"}},type:"polygon"};var h=require("zrender/tool/util"),l=require("../util/coordinates");return e.prototype={type:n.COMPONENT_TYPE_POLAR,_buildShape:function(){for(var e=0;e<this.polar.length;e++)this._index=e,this.reformOption(this.polar[e]),this._queryTarget=[this.polar[e],this.option],this._createVector(e),this._buildSpiderWeb(e),this._buildText(e),this._adjustIndicatorValue(e),this._addAxisLabel(e);for(var e=0;e<this.shapeList.length;e++)this.zr.addShape(this.shapeList[e])},_createVector:function(e){for(var t,i=this.polar[e],s=this.deepQuery(this._queryTarget,"indicator"),a=s.length,o=i.startAngle,r=2*Math.PI/a,n=this._getRadius(),h=i.__ecIndicator=[],d=0;a>d;d++)t=l.polar2cartesian(n,o*Math.PI/180+r*d),h.push({vector:[t[1],-t[0]]})},_getRadius:function(){var e=this.polar[this._index];return this.parsePercent(e.radius,Math.min(this.zr.getWidth(),this.zr.getHeight())/2)},_buildSpiderWeb:function(e){var t=this.polar[e],i=t.__ecIndicator,s=t.splitArea,a=t.splitLine,o=this.getCenter(e),r=t.splitNumber,n=a.lineStyle.color,h=a.lineStyle.width,l=a.show,d=this.deepQuery(this._queryTarget,"axisLine");this._addArea(i,r,o,s,n,h,l),d.show&&this._addLine(i,o,d)},_addAxisLabel:function(e){for(var t,s,a,o,s,r,n,l,d,p,c=require("../util/accMath"),g=this.polar[e],u=this.deepQuery(this._queryTarget,"indicator"),f=g.__ecIndicator,y=this.deepQuery(this._queryTarget,"splitNumber"),m=this.getCenter(e),_=0;_<u.length;_++)if(t=this.deepQuery([u[_],g,this.option],"axisLabel"),t.show){var x=this.deepQuery([t,g,this.option],"textStyle"),v=this.deepQuery([t,g],"formatter");if(a={},a.textFont=this.getFont(x),a.color=x.color,a=h.merge(a,t),a.lineWidth=a.width,s=f[_].vector,r=f[_].value,l=_/u.length*2*Math.PI,d=t.offset||10,p=t.interval||0,!r)return;for(var b=1;y>=b;b+=p+1){if(o=h.merge({},a),n=c.accAdd(r.min,c.accMul(r.step,b)),"function"==typeof v)n=v(n);else if("string"==typeof v)n=v.replace("{a}","{a0}").replace("{a0}",n);else n=this.numAddCommas(n);o.text=n,o.x=b*s[0]/y+Math.cos(l)*d+m[0],o.y=b*s[1]/y+Math.sin(l)*d+m[1],this.shapeList.push(new i({zlevel:this.getZlevelBase(),z:this.getZBase(),style:o,draggable:!1,hoverable:!1}))}}},_buildText:function(e){for(var t,s,a,o,r,n,h,l=this.polar[e],d=l.__ecIndicator,p=this.deepQuery(this._queryTarget,"indicator"),c=this.getCenter(e),g=0,u=0,f=0;f<p.length;f++)if(o=this.deepQuery([p[f],l,this.option],"name"),o.show){if(h=this.deepQuery([o,l,this.option],"textStyle"),s={},s.textFont=this.getFont(h),s.color=h.color,"function"==typeof o.formatter)s.text=o.formatter.call(this.myChart,p[f].text,f);else if("string"==typeof o.formatter)s.text=o.formatter.replace("{value}",p[f].text);else s.text=p[f].text;if(d[f].text=s.text,t=d[f].vector,Math.round(t[0])>0)a="left";else if(Math.round(t[0])<0)a="right";else a="center";if(null==o.margin)t=this._mapVector(t,c,1.1);else n=o.margin,g=t[0]>0?n:-n,u=t[1]>0?n:-n,g=0===t[0]?0:g,u=0===t[1]?0:u,t=this._mapVector(t,c,1);if(s.textAlign=a,s.x=t[0]+g,s.y=t[1]+u,o.rotate)r=[o.rotate/180*Math.PI,t[0],t[1]];else r=[0,0,0];this.shapeList.push(new i({zlevel:this.getZlevelBase(),z:this.getZBase(),style:s,draggable:!1,hoverable:!1,rotation:r}))}else;},getIndicatorText:function(e,t){return this.polar[e]&&this.polar[e].__ecIndicator[t]&&this.polar[e].__ecIndicator[t].text},getDropBox:function(e){var t,i,e=e||0,s=this.polar[e],a=this.getCenter(e),o=s.__ecIndicator,r=o.length,n=[],h=s.type;if("polygon"==h){for(var l=0;r>l;l++)t=o[l].vector,n.push(this._mapVector(t,a,1.2));i=this._getShape(n,"fill","rgba(0,0,0,0)","",1)}else if("circle"==h)i=this._getCircle("",1,1.2,a,"fill","rgba(0,0,0,0)");return i},_addArea:function(e,t,i,s,a,o,r){for(var n,h,l,d,p=this.deepQuery(this._queryTarget,"type"),c=0;t>c;c++){if(h=(t-c)/t,r){if("polygon"==p)d=this._getPointList(e,h,i),n=this._getShape(d,"stroke","",a,o);else if("circle"==p)n=this._getCircle(a,o,h,i,"stroke");this.shapeList.push(n)}if(s.show)l=(t-c-1)/t,this._addSplitArea(e,s,h,l,i,c)}},_getCircle:function(e,t,i,s,a,r){var n=this._getRadius();return new o({zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:s[0],y:s[1],r:n*i,brushType:a,strokeColor:e,lineWidth:t,color:r},hoverable:!1,draggable:!1})},_getRing:function(e,t,i,s){var a=this._getRadius();return new r({zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:s[0],y:s[1],r:t*a,r0:i*a,color:e,brushType:"fill"},hoverable:!1,draggable:!1})},_getPointList:function(e,t,i){for(var s,a=[],o=e.length,r=0;o>r;r++)s=e[r].vector,a.push(this._mapVector(s,i,t));return a},_getShape:function(e,t,i,s,o){return new a({zlevel:this.getZlevelBase(),z:this.getZBase(),style:{pointList:e,brushType:t,color:i,strokeColor:s,lineWidth:o},hoverable:!1,draggable:!1})},_addSplitArea:function(e,t,i,s,a,o){var r,n,h,l,d,p=e.length,c=t.areaStyle.color,g=[],p=e.length,u=this.deepQuery(this._queryTarget,"type");if("string"==typeof c)c=[c];if(n=c.length,r=c[o%n],"polygon"==u)for(var f=0;p>f;f++)g=[],h=e[f].vector,l=e[(f+1)%p].vector,g.push(this._mapVector(h,a,i)),g.push(this._mapVector(h,a,s)),g.push(this._mapVector(l,a,s)),g.push(this._mapVector(l,a,i)),d=this._getShape(g,"fill",r,"",1),this.shapeList.push(d);else if("circle"==u)d=this._getRing(r,i,s,a),this.shapeList.push(d)},_mapVector:function(e,t,i){return[e[0]*i+t[0],e[1]*i+t[1]]},getCenter:function(e){var e=e||0;return this.parseCenter(this.zr,this.polar[e].center)},_addLine:function(e,t,i){for(var s,a,o=e.length,r=i.lineStyle,n=r.color,h=r.width,l=r.type,d=0;o>d;d++)a=e[d].vector,s=this._getLine(t[0],t[1],a[0]+t[0],a[1]+t[1],n,h,l),this.shapeList.push(s)},_getLine:function(e,t,i,a,o,r,n){return new s({zlevel:this.getZlevelBase(),z:this.getZBase(),style:{xStart:e,yStart:t,xEnd:i,yEnd:a,strokeColor:o,lineWidth:r,lineType:n},hoverable:!1})},_adjustIndicatorValue:function(e){for(var t,i,s,a=this.polar[e],o=this.deepQuery(this._queryTarget,"indicator"),r=o.length,n=a.__ecIndicator,h=this._getSeriesData(e),l=a.boundaryGap,d=a.splitNumber,p=a.scale,c=require("../util/smartSteps"),g=0;r>g;g++){if("number"==typeof o[g].max)t=o[g].max,i=o[g].min||0,s={max:t,min:i};else{var u=this._findValue(h,g,d,l);i=u.min,t=u.max}if(!p&&i>=0&&t>=0)i=0;if(!p&&0>=i&&0>=t)t=0;var f=c(i,t,d,s);n[g].value={min:f.min,max:f.max,step:f.step}}},_getSeriesData:function(e){for(var t,i,s,a=[],o=this.component.legend,r=0;r<this.series.length;r++)if(t=this.series[r],t.type==n.CHART_TYPE_RADAR){i=t.data||[];for(var h=0;h<i.length;h++)if(s=this.deepQuery([i[h],t,this.option],"polarIndex")||0,s==e&&(!o||o.isSelected(i[h].name)))a.push(i[h])}else;return a},_findValue:function(e,t,i,s){function a(e){(e>o||void 0===o)&&(o=e),(r>e||void 0===r)&&(r=e)}var o,r,n;if(e&&0!==e.length){if(1==e.length)r=0;if(1!=e.length)for(var h=0;h<e.length;h++)a(this.getDataFromOption(e[h].value[t]));else{n=e[0];for(var h=0;h<n.value.length;h++)a(this.getDataFromOption(n.value[h]))}var l=Math.abs(o-r);if(r-=Math.abs(l*s[0]),o+=Math.abs(l*s[1]),r===o)if(0===o)o=1;else if(o>0)r=o/i;else o/=i;return{max:o,min:r}}},getVector:function(e,t,i){e=e||0,t=t||0;var s=this.polar[e].__ecIndicator;if(!(t>=s.length)){var a,o=this.polar[e].__ecIndicator[t],r=this.getCenter(e),n=o.vector,h=o.value.max,l=o.value.min;if("undefined"==typeof i)return r;switch(i){case"min":i=l;break;case"max":i=h;break;case"center":i=(h+l)/2}if(h!=l)a=(i-l)/(h-l);else a=.5;return this._mapVector(n,r,a)}},isInside:function(e){var t=this.getNearestIndex(e);if(t)return t.polarIndex;else return-1},getNearestIndex:function(e){for(var t,i,s,a,o,r,n,h,d,p=0;p<this.polar.length;p++){if(t=this.polar[p],i=this.getCenter(p),e[0]==i[0]&&e[1]==i[1])return{polarIndex:p,valueIndex:0};if(s=this._getRadius(),o=t.startAngle,r=t.indicator,n=r.length,h=2*Math.PI/n,a=l.cartesian2polar(e[0]-i[0],i[1]-e[1]),e[0]-i[0]<0)a[1]+=Math.PI;if(a[1]<0)a[1]+=2*Math.PI;if(d=a[1]-o/180*Math.PI+2*Math.PI,Math.abs(Math.cos(d%(h/2)))*s>a[0])return{polarIndex:p,valueIndex:Math.floor((d+h/2)/h)%n}}},getIndicator:function(e){var e=e||0;return this.polar[e].indicator},refresh:function(e){if(e)this.option=e,this.polar=this.option.polar,this.series=this.option.series;this.clear(),this._buildShape()}},h.inherits(e,t),require("../component").define("polar",e),e});