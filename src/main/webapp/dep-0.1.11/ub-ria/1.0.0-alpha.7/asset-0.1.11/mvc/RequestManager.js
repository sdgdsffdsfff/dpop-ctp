define("ub-ria/mvc/RequestManager",["require","underscore","er/util","er/ajax"],function(require){function e(e,t){this.entityName=e,this.backendEntityName=t,this.runningRequests={}}function t(e,t){if(!t)return null;var i=a.findWhere(o,{type:e.constructor});return i&&i.config[t]||s[t]||null}function i(e,t,i){var n=e.runningRequests[t.name];if(n){var r=t.policy;if("auto"===r){var o=i.method.toUpperCase();r=a.isEqual(i,n.options)?"reuse":"GET"===o||"PUT"===o?"parallel":"abort"}switch(r){case"reuse":return n.xhr;case"abort":return void n.xhr.abort();default:return}}}function n(e,t,i){if(e.runningRequests&&e.runningRequests[t]&&e.runningRequests[t].xhr===i)e.runningRequests[t]=null;if(l&&l[t]&&l[t].xhr===i)l[t]=null}var a=require("underscore"),r=require("er/util"),o=[],s={},l={};e.register=function(e,t,i){var n={name:t,scope:"instance",policy:"auto"};if(i=r.mix(n,i),"instance"===i.scope){var l=a.findWhere(o,{type:e});if(!l)l={type:e,config:{}},o.push(l);var h=l.config;if(h.hasOwnProperty(t))throw new Error('An instance request config "'+t+'" has already been registered');h[t]=i}else{if(s.hasOwnProperty(t))throw new Error('A global request config "'+t+'" has already been registered');s[t]=i}},e.prototype.getEntityName=function(){return this.entityName||""},e.prototype.getBackendEntityName=function(){return this.backendEntityName||this.getEntityName()},e.prototype.setRequestStrategy=function(e){this.requestStrategy=e},e.prototype.getRequestStrategy=function(){return this.requestStrategy},e.prototype.getRequest=function(e,i,n){var a=this.getRequestStrategy();if("string"!=typeof e)n=e,e=null;e=a.formatName(e,n);var o=t(this,e);if(n=r.mix({},o&&o.options,n),"function"==typeof i)i=i(this,n);if("function"==typeof n.data)n.data=n.data(this,n);if(i)n.data=r.mix({},n.data,i);n=a.formatOptions(n);var s={name:e,options:n,config:o};if(s.options.url)s.options.url=a.formatURL(s.options.url,s.options);return s};var h=require("er/ajax");return e.prototype.request=function(e,t,r){var o=this.getRequest(e,t,r);if(!o.config)return h.request(o.options);var s=i(this,o.config,o.options);if(!s)if(s=h.request(o.options),e){var d="instance"===o.config.scope?this.runningRequests:l;d[e]={options:o.options,xhr:s};var m=a.partial(n,this,o.name,s);s.ensure(m)}return s},e.prototype.dispose=function(){a.each(this.runningRequests,function(e){e&&e.xhr.abort()}),this.runningRequests=null},e.prototype.search=function(){throw new Error("search method is not implemented")},e.prototype.list=function(){throw new Error("list method is not implemented")},e.prototype.save=function(){throw new Error("save method is not implemented")},e.prototype.update=function(){throw new Error("update method is not implemented")},e.prototype.updateStatus=function(){throw new Error("updateStatus method is not implemented")},e.prototype.remove=a.partial(e.prototype.updateStatus,0),e.prototype.restore=a.partial(e.prototype.updateStatus,1),e.prototype.getAdvice=function(){throw new Error("getAdvice method is not implemented")},e.prototype.getRemoveAdvice=a.partial(e.prototype.getAdvice,0),e.prototype.getRestoreAdvice=a.partial(e.prototype.getAdvice,1),e.prototype.findById=function(){throw new Error("findById method is not implemented")},e});