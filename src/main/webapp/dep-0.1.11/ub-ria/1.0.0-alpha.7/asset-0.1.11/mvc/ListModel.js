define("ub-ria/mvc/ListModel",["require","./BaseModel","er/util","underscore","../util","er/URL","er/Deferred"],function(require){function e(){i.apply(this,arguments),r.each(this.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},this),this.putDatasource(o,0),this.putDatasource(s,0),this.putDatasource(l,1)}function t(){var e=this.get("canBatchModify");this.set("selectMode",e?"multi":"")}function n(e,t){var n=r.findWhere(this.getStatusTransitions(),{status:e});if(n.accept){var i=r.difference(n.accept,n.deny||[]);return r.contains(i,t.status)}else if(n.deny)return!r.contains(n.deny,t.status);else return!0}var i=require("./BaseModel"),a=require("er/util"),r=require("underscore"),o={list:{retrieve:function(e){var t=e.getQuery();return t=require("../util").purify(t,null,!0),e.search(t)},dump:!0}},s={listWithoutKeywordURL:function(e){var t=e.get("url"),n=t.getPath(),i=t.getQuery();i=r.omit(i,"keyword");var a="#"+require("er/URL").withQuery(n,i);return a}},l={hasResult:function(e){return e.get("results").length||!r.isEmpty(e.get("url").getQuery())}};return a.inherits(e,i),e.prototype.statusTransitions=[{status:0,deny:[0],statusName:"remove",command:"删除"},{status:1,deny:[1],statusName:"restore",command:"启用"}],e.prototype.getStatusTransitions=function(){return this.statusTransitions},e.prototype.defaultStatusValue=1,e.prototype.getDefaultStatusValue=function(){return this.defaultStatusValue||""},e.prototype.defaultArgs={},e.prototype.getDefaultArgs=function(){var e=this.defaultArgs||{},t=this.getDefaultStatusValue();if(!e.hasOwnProperty("status")&&t)e.status=t;return e},e.prototype.load=function(){return i.prototype.load.apply(this,arguments).then(r.bind(t,this))},e.prototype.prepare=function(){this.set("filtersInfo",this.getFiltersInfo())},e.prototype.getQuery=function(){var e={keyword:this.get("keyword"),status:this.get("status"),order:this.get("order"),orderBy:this.get("orderBy"),pageNo:this.get("page")||1};if(!e.status)e.status=this.getDefaultStatusValue();else if("all"===e.status)e.status="";return e},e.prototype.canUpdateToStatus=function(e,t){return r.any(e,r.bind(n,this,t))},e.prototype.updatePageSize=function(e){var t=this.data("global");if(!t)throw new Error("No global data object attached to this Model");if("function"!=typeof t.updatePageSize)throw new Error("No updatePageSize method implemented on global data object");return t.updatePageSize(e)},e.prototype.getAllItems=function(){return this.get("results")},e.prototype.getItemById=function(e){var t=this.getAllItems();return t?r.findWhere(t,{id:e}):null},e.prototype.indexOf=function(e){var t=this.getAllItems();if(!t)return-1;if("object"==typeof e)return r.indexOf(t,e);else{for(var n=0;n<t.length;n++)if(t[n].id===e)return n;return-1}},e.prototype.search=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.search)throw new Error("No search method implemented on default data object");return t.search(e||{})},e.prototype.updateStatus=function(e,t){var n=this.data();if(!n)throw new Error("No default data object attached to this Model");if("function"!=typeof n.updateStatus)throw new Error("No updateStatus method implemented on default data object");return n.updateStatus(e,t)},e.prototype.remove=r.partial(e.prototype.updateStatus,0),e.prototype.restore=r.partial(e.prototype.updateStatus,1),e.prototype.getAdvice=function(e,t){var n=this.data();if(!n)throw new Error("No default data object attached to this Model");if("function"!=typeof n.getAdvice)throw new Error("No getAdvice method implemented on default data object");return n.getAdvice(e,t)},e.prototype.getRemoveAdvice=function(e){var t=require("er/Deferred"),n=e.length,i=this.get("entityDescription"),a="您确定要删除已选择的"+n+"个"+i+"吗？";if(1>=n)a="您确定要删除该"+i+"吗？";var r={message:a};return t.resolved(r)},e.prototype.getRestoreAdvice=r.partial(e.prototype.getAdvice,1),e.prototype.getFilters=function(){return{}},e.prototype.getFiltersInfo=function(){var e=!0,t=this.getDefaultArgs(),n={};return r.each(this.getFilters(),function(i,a){var o={text:"function"==typeof i.text?i.text(i):i.text,defaultValue:t[a],name:a};if(r.defaults(o,i),o.isDefaultValue=o.hasOwnProperty("isDefaultValue")?o.isDefaultValue:o.defaultValue==o.value,!o.isDefaultValue)e=!1;n[a]=o},this),{filters:n,isAllFiltersDefault:e}},e});