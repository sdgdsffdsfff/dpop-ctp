define("esui/Tab",["require","underscore","./lib","./Control","./painters","./main"],function(require){function e(){l.apply(this,arguments)}function t(e){for(var t=[],i=s.getChildren(e),n=0;n<i.length;n++){var a=i[n],o={title:s.getText(a),panel:a.getAttribute("data-for")};if(a.className)o.classes=a.className.split(/\s+/);t.push(o)}return t}function i(e){for(var t=e.target,i=t;i&&"li"!==i.nodeName.toLowerCase();)i=i.parentNode;if(i&&"li"===i.nodeName.toLowerCase())for(var n=i.parentNode,a=s.getChildren(n),o=0;o<a.length;o++)if(a[o]===i){if(this.helper.isPart(t,"close"))this.removeAt(o);else this.set("activeIndex",o);return}}function n(e,t,i,n){var a=document.createElement("li");if(e.helper.addPartClasses("item",a),t.classes)s.addClasses(a,t.classes);if(i)e.helper.addPartClasses("item-active",a);return a.innerHTML=e.getContentHTML(t,n),a}function a(e){var t=e.helper.getPart("navigator"),i=t.parentNode,a=t.nextSibling;t.innerHTML="",t.parentNode.removeChild(t);for(var o=0;o<e.tabs.length;o++){var r=e.tabs[o],s=e.activeIndex===o,l=n(e,r,s,e.allowClose);t.appendChild(l)}i.insertBefore(t,a)}function o(e,t){for(var i=0;i<e.tabs.length;i++){var n=e.tabs[i];if(n.panel){var a=s.g(n.panel);if(a)a.style.display=i===t?"":"none"}var o=e.helper.getPart("navigator"),r=s.getChildren(o),l=r[i],h=i===t?"addPartClasses":"removePartClasses";e.helper[h]("item-active",l)}var m={activeIndex:t,tab:e.tabs[t]};e.fire("activate",m)}var r=require("underscore"),s=require("./lib"),l=require("./Control");return e.prototype.type="Tab",e.prototype.initOptions=function(e){var i={tabs:[],activeIndex:0,allowClose:!1,orientation:"horizontal"};r.extend(i,e);var n=s.getChildren(this.main);if(n.length){for(var a=[],o=0;o<n.length;o++){var l=n[o];if("navigator"===l.getAttribute("data-role")){this.navigatorElement=l,i.tabs=t(l);break}else{var h={title:l.getAttribute("title"),panel:l.id};a.push(h)}}if(!i.tabs.length)i.tabs=a}if("string"==typeof i.activeIndex)i.activeIndex=+i.activeIndex;this.setProperties(i)},e.prototype.initStructure=function(){var e=this.navigatorElement;if(this.navigatorElement=null,!e)e=document.createElement("ul"),this.main.insertBefore(e,this.main.firstChild||null);e.id=this.helper.getId("navigator"),this.helper.addPartClasses("navigator",e)},e.prototype.initEvents=function(){this.helper.addDOMEvent("navigator","click",i)},e.prototype.contentTemplate="<span>${title}</span>",e.prototype.getContentHTML=function(e,t){var i=s.format(this.contentTemplate,{title:r.escape(e.title)});if(t)i+='<span class="'+this.helper.getPartClassName("close")+'">关闭</span>';return i},e.prototype.setProperties=function(e){if(e.tabs){if(null==e.activeIndex){for(var t=this.tabs[this.activeIndex],i=-1,n=0;n<e.tabs.length;n++)if(e.tabs[n]===t){i=n;break}if(-1===i)this.activeIndex=-1,e.activeIndex=0;else this.activeIndex=i}if(null!=e.allowClose)this.allowClose=e.allowClose,delete e.allowClose}l.prototype.setProperties.apply(this,arguments)},e.prototype.repaint=require("./painters").createRepaint(l.prototype.repaint,{name:["tabs","allowClose"],paint:a},{name:"activeIndex",paint:o},{name:"orientation",paint:function(e,t){e.removeState("vertical"),e.removeState("horizontal"),e.addState(t)}}),e.prototype.activate=function(e){for(var t=0;t<this.tabs.length;t++)if(this.tabs[t]===e)this.set("activeIndex",t)},e.prototype.add=function(e){this.insert(e,this.tabs.length)},e.prototype.insert=function(e,t){t=Math.min(t,this.tabs.length),t=Math.max(t,0),this.tabs.splice(t,0,e);var i=n(this,e,!1,this.allowClose),a=this.helper.getPart("navigator"),r=s.getChildren(a);if(a.insertBefore(i,r[t]||null),1===this.tabs.length)this.activeIndex=0,o(this,0);else{if(t<=this.activeIndex)this.activeIndex++;if(e.panel){var l=s.g(e.panel);if(l)l.style.display="none"}}this.fire("add",{tab:e,index:t})},e.prototype.remove=function(e){for(var t=0;(t=r.indexOf(this.tabs,e,t))>=0;)this.removeAt(t)},e.prototype.removeAt=function(e){var t=this.tabs.splice(e,1)[0],i=this.helper.getPart("navigator");if(t){var n=s.getChildren(i),a=n[e];if(a.parentNode.removeChild(a),e<this.activeIndex)this.activeIndex--;else if(e===this.activeIndex)this.activeIndex=Math.min(this.activeIndex,this.tabs.length-1),o(this,this.activeIndex);if(t.panel){var r=s.g(t.panel);if(r)r.style.display="none"}this.fire("remove",{tab:t,index:e})}},e.prototype.getActiveTab=function(){return this.get("tabs")[this.get("activeIndex")]},s.inherits(e,l),require("./main").register(e),e});