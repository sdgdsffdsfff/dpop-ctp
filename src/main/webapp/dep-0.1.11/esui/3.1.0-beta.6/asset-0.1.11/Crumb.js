define("esui/Crumb",["require","underscore","./lib","./Control","./painters","./main"],function(require){function e(){o.apply(this,arguments)}function t(e){for(var t=e.target,n=a.getChildren(this.main);t!==this.main;){if(this.helper.isPart(t,"node")){var o=a.hasAttribute(t,"data-index")?t.getAttribute("data-index"):i(n,t),r=this.fire("click",{item:this.path[o]});return r.isDefaultPrevented()&&e.preventDefault(),void(r.isPropagationStopped()&&e.stopPropagation())}t=t.parentNode}}function i(e,t){for(var i=e.length-1;i>-1;i-=2)if(e[i]===t)return i/2}var n=require("underscore"),a=require("./lib"),o=require("./Control");e.defaultProperties={separator:">"},e.prototype.type="Crumb",e.prototype.initOptions=function(t){var i={path:[]};n.extend(i,e.defaultProperties,t);var o=a.getChildren(this.main);if(!t.path&&o.length)i.path=n.map(o,function(e){var t={text:a.getText(e)};if("a"===e.nodeName.toLowerCase())t.href=a.getAttribute(e,"href");return t});this.setProperties(i)},e.prototype.initEvents=function(){this.helper.addDOMEvent(this.main,"click",t)},e.prototype.textNodeTemplate='<span class="${classes}" data-index="${index}">${text}</span>',e.prototype.linkNodeTemplate='<a class="${classes}" href="${href}" data-index="${index}">${text}</a>',e.prototype.separatorTemplate='<span class="${classes}">${text}</span>',e.prototype.getNodeHTML=function(e,t){var i=this.helper.getPartClasses("node");if(0===t)i.push.apply(i,this.helper.getPartClasses("node-first"));if(t===this.path.length-1)i.push.apply(i,this.helper.getPartClasses("node-last"));var o=e.href?this.linkNodeTemplate:this.textNodeTemplate,r={href:n.escape(e.href),text:n.escape(e.text),index:t,classes:i.join(" ")};return a.format(o,r)},e.prototype.getSeparatorHTML=function(){return a.format(this.separatorTemplate,{classes:this.helper.getPartClassName("separator"),text:n.escape(this.separator)})};var r=require("./painters");return e.prototype.repaint=r.createRepaint(o.prototype.repaint,{name:["path","separator"],paint:function(e,t){var i=n.map(t,e.getNodeHTML,e),a=e.getSeparatorHTML();e.main.innerHTML=i.join(a)}}),require("./main").register(e),a.inherits(e,o),e});