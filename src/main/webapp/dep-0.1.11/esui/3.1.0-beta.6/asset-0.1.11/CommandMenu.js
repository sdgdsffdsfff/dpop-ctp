define("esui/CommandMenu",["require","underscore","./lib","./Control","./Layer","./painters","./main"],function(require){function e(e){for(var t=e.target;t!==e.currentTarget&&!a.hasAttribute(t,"data-index");)t=t.parentNode;var n=+t.getAttribute("data-index"),i=this.datasource[n];if(!i.disabled)if(this.layer.hide(),t!==e.currentTarget){if(i)if("function"==typeof i.handler)i.handler.call(this,i,n);this.fire("select",{item:i,index:n})}}function t(){r.apply(this,arguments)}function n(){o.apply(this,arguments),this.layer=new t(this)}var i=require("underscore"),a=require("./lib"),o=require("./Control"),r=require("./Layer");a.inherits(t,r),t.prototype.nodeName="ul",t.prototype.dock={strictWidth:!0},t.prototype.render=function(e){for(var t="",n=0;n<this.control.datasource.length;n++){var i=this.control.helper.getPartClasses("node");if(n===this.control.activeIndex)i.push.apply(i,this.control.helper.getPartClasses("node-active"));if(this.control.datasource[n].disabled)i.push.apply(i,this.control.helper.getPartClasses("node-disabled"));t+='<li data-index="'+n+'" class="'+i.join(" ")+'">',t+=this.control.getItemHTML(this.control.datasource[n])}e.innerHTML=t},t.prototype.initBehavior=function(t){this.control.helper.addDOMEvent(t,"click",e)},n.prototype.type="CommandMenu",n.prototype.itemTemplate="<span>${text}</span>",n.prototype.getItemHTML=function(e){var t={text:i.escape(e.text)};return a.format(this.itemTemplate,t)},n.prototype.initEvents=function(){this.helper.addDOMEvent(this.main,"click",i.bind(this.layer.toggle,this.layer))};var s=require("./painters");return n.prototype.repaint=s.createRepaint(o.prototype.repaint,s.style("width"),s.style("height"),{name:"datasource",paint:function(e){e.layer.repaint()}},s.text("displayText"),{name:["disabled","hidden","readOnly"],paint:function(e,t,n,i){if(t||n||i)e.layer.hide()}}),n.prototype.dispose=function(){if(!this.helper.isInStage("DISPOSED")){if(this.layer)this.layer.dispose(),this.layer=null;o.prototype.dispose.apply(this,arguments)}},a.inherits(n,o),require("./main").register(n),n});