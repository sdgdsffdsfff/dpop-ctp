define("esui/Table",["require","./lib","underscore","./controlHelper","./Control","./main"],function(require){function e(e){var t={followHeightArr:[0,0],followWidthArr:[],handlers:[]};Tt.call(this,St.extend({},e,t))}function t(e){return!("undefined"==typeof e||null===e)}function i(e){return!t(e)||!e.toString().length}function n(e,t,i){Jt.setAttribute(e,"data-"+t,i)}function a(e,t){return Jt.getAttribute(e,"data-"+t)}function o(e,t){var i=Jt.getStyle(e,t);return""===i?0:parseInt(i,10)||0}function r(e,t){return Et.getId(e,t)}function s(e,t){return Et.getPartClasses(e,t).join(" ")}function l(e){return Jt.g(r(e,"head"))}function h(e){return Jt.g(r(e,"body"))}function d(e){return Jt.g(r(e,"foot"))}function m(e,t){return Jt.g(r(e,"row")+t)}function c(e){return Jt.g(r(e,"select-all"))}function p(e,t){e.selectedIndex=t;for(var i={},n=t.length-1;n>=0;n--)i[t[n]]=1;e.selectedIndexMap=i}function V(e,t){if(e.selectedIndexMap)return!!e.selectedIndexMap[t];else return!1}function U(e){for(var t=0,i=e.realFields,n=e.minColsWidth,a=0,o=i.length;o>a;a++){var r=i[a];t+=r.width||n[a]}return t}function u(e){if(e.width)return e.width;var t=document.createElement("div"),i=e.main.parentNode;i.appendChild(t);var n=t.offsetWidth;return t.parentNode.removeChild(t),n}function f(e){if(e.fields){for(var t=e.fields,i=t.slice(0),n=i.length;n--;)if(!i[n])i.splice(n,1);if(e.realFields=i,e.select)switch(e.select.toLowerCase()){case"multi":i.unshift(mt(e));break;case"single":i.unshift(ct(e))}}}function g(e){if(e.followHead)if(b(e),!e.noFollowHeadCache)L(e)}function y(e){if(e.followHead)b(e),L(e)}function b(e){if(e.followHead){for(var t=e.followDoms=[],i=e.main.parentNode.firstChild,n=e.id;i;){if(1===i.nodeType&&a(i,"follow-thead")===n)t.push(i);i=i.nextSibling}x(e),k(e)}}function k(e){var t=e.followDoms,i=e.followHeightArr;i[0]=0;for(var n=0,a=t.length;a>n;n++){var o=t[n];i[n+1]=i[n]+o.offsetHeight}i[n+1]=i[n],i.lenght=n+2}function x(e){for(var t=e.followDoms,i=e.followWidthArr,n=0,a=t.length;a>n;n++){var r=t[n],s=o(r,"padding-left")+o(r,"padding-right")+o(r,"border-left-width")+o(r,"border-right-width");i[n]=s,t[n].style.width=e.realWidth-s+"px"}}function L(e){var t=e.followDoms,i=Jt.getOffset(t[0]||e.main);e.followTop=i.top,e.followLeft=i.left}function v(e){var t=e.realFields,i=[],n=e.fontSize,a=2*e.colPadding+5;if(!e.noHead)for(var o=0,r=t.length;r>o;o++){var s=t[o],l=s.minWidth;if(!l&&!s.breakLine)l=s.title.length*n+a+(e.sortable&&s.sortable?e.sortWidth:0)+(s.tip?e.tipWidth:0);i[o]=l}else for(var h=n+a,o=0,r=t.length;r>o;o++)i[o]=h;e.minColsWidth=i}function _(e){var t=e.realFields,i=[];e.colsWidth=[];var n="auto"===e.overflowX?U(e):e.realWidth;n=Math.max(n,e.realWidth),e.bodyWidth=n;for(var a=n-1,o=0,r=t.length;r>o;o++){var s=t[o],l=s.width;if(l=l?parseInt(l,10):0,e.colsWidth.push(l),a-=l,!s.stable)i.push(o)}for(var r=i.length,h=Math.round(a/r),o=0;r>o;o++){var d=i[o],m=Math.abs(a)<Math.abs(h)?a:h;a-=m,e.colsWidth[d]+=m;var c=e.minColsWidth[d];if(c>e.colsWidth[d])a+=e.colsWidth[d]-c,e.colsWidth[d]=c}if(0>a)for(var o=0;r>o&&0!==a;){var d=i[o],c=e.minColsWidth[d];if(c<e.colsWidth[d]){var m=e.colsWidth[i[o]]-c;m=m>Math.abs(a)?a:-m,a+=Math.abs(m),e.colsWidth[d]+=m}o++}else if(a>0)e.colsWidth[i[0]]+=a}function W(e){var t=d(e);if(!(e.foot instanceof Array))t&&(t.style.display="none");else{if(!t)t=document.createElement("div"),t.id=r(e,"foot"),t.className=s(e,"foot"),n(t,"control-table",e.id),e.main.appendChild(t);if(t.style.display="",e.realWidth)t.style.width=e.realWidth+"px";t.innerHTML=w(e)}}function w(e){var t=[],n=e.foot,a=0,o=e.colsWidth,r=s(e,"fcell"),l=s(e,"fcell-text"),h=e.rowWidthOffset;t.push(Jt.format(Pt,{width:"100%",controlTableId:e.id}),"<tr>");for(var d=0,m=n.length;m>d;d++){var c=n[d],p=o[a],V=c.colspan||1,U=[r],u=c.content;if("function"==typeof u)u=u.call(e);if(i(u))u="&nbsp;";for(var f=1;V>f;f++)p+=o[a+f];if(a+=V,c.align)U.push(s(e,"cell-align-"+c.align));p+=h,0>p&&(p=0),t.push('<th id="'+J(e,d)+'" class="'+U.join(" ")+'"',' style="width:'+p+"px;",(p?"":"display:none;")+'">','<div class="'+l+'">',u,"</div></th>")}return t.push("</tr></table>"),t.join("")}function X(e){var t=l(e),i=r(e,"head-panel");if(!t)t=document.createElement("div"),t.id=r(e,"head"),t.className=s(e,"head"),n(t,"control-table",e.id),e.main.appendChild(t),t.innerHTML=Jt.format('<div id="${id}" data-ui="type:Panel;id:${id};"></div>',{id:i}),e.initChildren(t),e.headPanel=e.viewContext.get(i),Et.addDOMEvent(e,t,"mousemove",St.bind(F,t,e)),Et.addDOMEvent(e,t,"mousedown",St.bind(O,t,e));if(e.noHead)return void(t.style.display="none");if(t.style.display="",e.bodyWidth)t.style.width=e.bodyWidth+"px";Jt.g(i).innerHTML=K(e),I(e,e.viewContext.get(i))}function I(e,t){if(t.children)t.disposeChildren();if(e.hasTip)t.initChildren()}function K(e){var t=e.realFields,n=s(e,"hcell"),a=s(e,"hcell-text"),o=s(e,"cell-break"),l=s(e,"hsort"),h=s(e,"hcell-sel"),d=-1,m=-1,c=e.rowWidthOffset;if(!e.disabled){for(var p=0,V=t.length;V>p;p++)if(!t[p].stable){d=p;break}for(var p=V-1;p>=0;p--)if(!t[p].stable){m=p;break}}var U=[];U.push(Jt.format(Pt,{width:"100%",controlTableId:e.id}),"<tr>");for(var p=0,V=t.length;V>p;p++){var u=[n],f=t[p],g=f.title,y=e.sortable&&f.sortable,b=y&&f.field&&f.field===e.orderBy,k=a;if(0===p)k+=" "+s(e,"hcell-text-first");if(p===V-1)k+=" "+s(e,"hcell-text-last");var x="";if(y){if(u.push(s(e,"hcell-sort")),b)u.push(s(e,"hcell-"+e.order));x=Jt.format(At,{className:l})}if(f.align)u.push(s(e,"cell-align-"+f.align));if(e.breakLine||f.breakLine)u.push(o);var L="",v="",_=f.tip;if("function"==typeof _)v=_.call(e);else v=_;if(v)L=Jt.format(Ft,{id:r(e,"htip"+p),className:s(e,"htip"),content:v}),e.hasTip=!0;var W;if("function"==typeof g)W=g.call(e);else W=g;if(i(W))W="&nbsp;";U.push('<th id="'+C(e,p)+'"',' data-index="'+p+'"',' class="'+u.join(" ")+'"',y?' data-sortable="1"':"",p>=d&&m>p?' data-dragright="1"':"",m>=p&&p>d?' data-dragleft="1"':"",' style="',"width:"+(e.colsWidth[p]+c)+"px;",(e.colsWidth[p]?"":"display:none")+'">','<div class="'+k+(f.select?" "+h:"")+'">',L,W,x,"</div></th>")}return U.push("</tr></table>"),U.join("")}function C(e,t){return r(e,"title-cell")+t}function J(e,t){return r(e,"foot-cell")+t}function S(e){E(this,e)}function E(e,t){if(!e.isDraging&&!e.dragReady)if(Et.addPartClasses(e,"hcell-hover",t),e.sortable){e.sortReady=1;var i=a(t,"index"),n=e.realFields[i];if(n&&n.sortable)Et.addPartClasses(e,"hcell-sort-hover",t)}}function T(e){P(this,e)}function P(e,t){if(Et.removePartClasses(e,"hcell-hover",t),e.sortable)e.sortReady=0,Et.removePartClasses(e,"hcell-sort-hover",t)}function A(e){var t=this;if(t.sortable&&t.sortReady){var i=a(e,"index"),n=t.realFields[i];if(n.sortable){var o=t.orderBy,r=t.order;if(o===n.field)r=!r||"asc"===r?"desc":"asc";else r="desc";t.setProperties({order:r,orderBy:n.field}),t.fire("sort",{field:n,order:r})}}}function F(e,t){if(e.columnResizable){var i="startdrag",n=8;if(!e.isDraging){var o=t.target;if(o=M(e,o)){var r=this,s=t.pageX||t.clientX+Jt.page.getScrollLeft(),l=Jt.getOffset(o),h=a(o,"sortable");if(a(o,"dragleft")&&s-l.left<n)h&&P(e,o),Et.addPartClasses(e,i,r),e.dragPoint="left",e.dragReady=1;else if(a(o,"dragright")&&l.left+o.offsetWidth-s<n)h&&P(e,o),Et.addPartClasses(e,i,r),e.dragPoint="right",e.dragReady=1;else Et.removePartClasses(e,i,r),h&&E(e,o),e.dragPoint="",e.dragReady=0}}}}function M(e,t){for(;1===t.nodeType;){if("TH"===t.nodeName)return t;t=t.parentNode}return null}function O(e,t){if(e.columnResizable){e.fire("startdrag"),e.fire("dragstart");var i=s(e,"startdrag"),n=t.target;if(n=M(e,n))if(!(Jt.g(r(e,"head")).className.indexOf(i)<0)){e.htmlHeight=document.documentElement.clientHeight,e.isDraging=!0,e.dragIndex=a(n,"index"),e.dragStart=t.pageX||t.clientX+Jt.page.getScrollLeft(),D(e);var o=St.partial(z,e),l=function(t){var i=!0;try{i=St.partial(G,e)(t)}catch(n){}return Jt.un(document,"mousemove",o),Jt.un(document,"mouseup",l),i};return Jt.on(document,"mousemove",o),Jt.on(document,"mouseup",l),N(e,e.dragStart),Jt.event.preventDefault(t),!1}}}function D(e){var t=Jt.getOffset(e.main);e.top=t.top,e.left=t.left}function z(e,t){var i=t||window.event;return N(e,i.pageX||i.clientX+Jt.page.getScrollLeft()),Jt.event.preventDefault(i),!1}function N(e,t){var i=R(e),n=e.left+e.realWidth,a=e.left+1,o=n-1;if(t=a>t?a:t,t=t>o?o:t,!i)i=H(e);i.style.top=e.top+"px",i.style.left=t+"px",i.style.zIndex=e.zIndex||"";var r=e.htmlHeight-e.top+Jt.page.getScrollTop(),s=e.main.offsetHeight;r=s>r?r:s,i.style.height=r+"px"}function B(e){var t=R(e);t.style.left="-10000px",t.style.top="-10000px"}function H(e){var t=document.createElement("div");return t.id=r(e,"drag-mark"),t.className=s(e,"mark "),t.style.top="-10000px",t.style.left="-10000px",document.body.appendChild(t),t}function R(e){return Jt.g(r(e,"drag-mark"))}function G(e,t){var i=t||window.event,n=parseInt(e.dragIndex,10),a=i.pageX||i.clientX+Jt.page.getScrollLeft(),o=e.realFields,r=o.length,s=0,l=e.colsWidth,h=0;if("left"===e.dragPoint)n--;var d=e.minColsWidth[n],m=a-e.dragStart,c=l[n]+m;if(d>c)m+=d-c,c=d;for(var p=[],V=[],U=n+1;r>U;U++)if(!o[U].stable&&l[U]>0)p.push(U),y=l[U],V.push(y),s+=y;for(var u=m,f=p.length,U=0;f>U;U++){var g=p[U],y=V[U],b=m*y/s,k=u>0?Math.ceil(b):Math.floor(b);if(k=Math.abs(k)<Math.abs(u)?k:u,y-=k,u-=k,d=e.minColsWidth[g],d>y)h+=d-y,y=d;l[g]=y}return c-=h,l[n]=c,dt(e),e.isDraging=!1,B(e),e.fire("enddrag"),e.fire("dragend"),Jt.event.preventDefault(i),!1}function Y(e){var t=h(e),i=r(e,"body-panel");if(!t){var n="body",a=r(e,n);t=document.createElement("div"),t.id=a,t.className=s(e,n),e.main.appendChild(t),t.innerHTML=Jt.format('<div id="${id}" data-ui="type:Panel;id:${id}"></div>',{id:i}),e.initChildren(t),e.bodyPanel=e.viewContext.get(i)}var o=t.style;if(o.overflowX="auto",o.overflowY="auto",e.bodyWidth)o.width=e.bodyWidth+"px";e.bodyPanel.disposeChildren(),Jt.g(i).innerHTML=Q(e),e.fire("bodyChange")}function Z(e){var t=h(e),i=t.style,n=e.datasource.length,a=e.bodyMaxHeight;if(a>0&&n>0){var o=a,s=Jt.g(r(e,"body-panel"));if(s)o=s.offsetHeight;if(o>=a)return void(i.height=a+"px")}i.height="auto"}function Q(e){var t=e.datasource||[],i=t.length,n=[];if(!i)return Jt.format(Mt,{className:s(e,"body-nodata"),html:e.noDataHtml});for(var a=e.rowBuilderList,o=0;i>o;o++){var r=t[o];n.push(et(e,r,o,a))}return n.join("")}function q(e,t,i){return r(e,"cell")+t+"-"+i}function j(e,i){for(var n=e.rowBuilderList||[],a=0,o=i.length;o>a;a++){var r=i[a];if(r.getColHtml){if(r.getSubrowHtml)e.hasSubrow=!0;if(!t(r.index))r.index=1e3;n.push(r)}else;}n.sort(function(e,t){return e.index-t.index}),e.rowBuilderList=n}function $(e){j(e,[{index:1,getRowArgs:tt,getColHtml:it}])}function et(e,i,n,a){function o(e,t){return e.index-t.index}for(var s=[],l=e.realFields,h=e.rowWidthOffset,d=[],m=[],c=[],p=0,V=a.length;V>p;p++){var U=a[p],u=U.getRowArgs?U.getRowArgs(e,n)||{}:{};d.push(u),u.rowClass&&m.push(u.rowClass),u.rowAttr&&c.push(u.rowAttr)}for(var p=0,V=l.length;V>p;p++){for(var f=l[p],g=e.colsWidth[p],y=[],b=[],k=[],x=[],L=[],v=[],_=-1,W=0,w=a.length;w>W;W++){var X=a[W].getColHtml(e,i,f,n,p,d[W]);if(X){var I=X.html;if(X.colClass)y.push(X.colClass);if(X.textClass)b.push(X.textClass);if(X.colAttr)k.push(X.colAttr);if(X.textAttr)x.push(X.textAttr);if(t(I))if(X.notInText)X.index=W,v.push(X);else L.push(I),0>_&&(_=W)}else;}var K="";if(L=['<div class="'+b.join(" ")+'" ',x.join(" ")+">",L.join(""),"</div>"].join(""),v.push({html:L,index:_}),v.sort(o),v.length>1){for(var K=['<table width="100%" cellpadding="0" cellspacing="0">',"<tr>"],W=0,w=v.length;w>W;W++){var C=v[W];K.push("<td ",t(C.width)?' width="'+C.width+'" ':"",C.align?' align="'+C.align+'">':">",C.html,"</td>")}K.push("</tr></table>"),K=K.join("")}else K=L;s.push('<td id="'+q(e,n,p)+'" ','class="'+y.join(" ")+'" ',k.join(" ")+" ",'style="width:'+(g+h)+"px;",(g?"":"display:none")+'" ','data-control-table="'+e.id+'" ','data-row="'+n+'" data-col="'+p+'">',K,"</td>")}if(s.unshift(Jt.format(Ot,{id:r(e,"row")+n,className:m.join(" "),attr:c.join(" "),index:n}),Jt.format(Pt,{width:"100%",controlTableId:e.id})),s.push("</tr></table></div>"),e.hasSubrow)for(var p=0,V=a.length;V>p;p++){var J=a[p].getSubrowHtml;if(J)s.push(J(e,n,d[p]))}return s.join("")}function tt(e,t){var i=e.datasource||[],n=i.length;return{tdCellClass:s(e,"cell"),tdBreakClass:s(e,"cell-break"),tdTextClass:s(e,"cell-text"),fieldLen:e.realFields.length,rowClass:[s(e,"row"),s(e,"row-"+(t%2?"odd":"even")),V(e,t)?s(e,"row-selected"):"",n-1===t?s(e,"row-last"):""].join(" ")}}function it(e,t,n,a,o,l){var h=l.tdCellClass,d=l.tdBreakClass,m=l.tdTextClass,c=[h],p=[m],V=n.content;if(0===o)p.push(s(e,"cell-text-first"));if(o===l.fieldLen-1)p.push(s(e,"cell-text-last"));if(e.breakLine||n.breakLine)c.push(d);if(n.select)p.push(s(e,"cell-sel"));if(n.align)c.push(s(e,"cell-align-"+n.align));if(n.field&&n.field===e.orderBy)c.push(s(e,"cell-sorted"));var U="function"==typeof V?V.call(e,t,a,o):e.encode?Jt.encodeHTML(t[V]):t[V];if(i(U))U="&nbsp;";return{colClass:c.join(" "),textClass:p.join(" "),html:Jt.format(Dt,{colTextId:r(e,"cell-textfield-"+a+"-"+o),content:U})}}function nt(e){if(!this.isDraging)Et.addPartClasses(this,"row-hover",e)}function at(e){Et.removePartClasses(this,"row-hover",e)}function ot(e,t){var i=this,n=Et.getPartClasses(i,"cell-text")[0];if("line"===i.selectMode&&Jt.hasClass(t.target,n)){if(i.dontSelectLine)return void(i.dontSelectLine=!1);var o=a(e,"index");switch(i.select){case"multi":var s=Jt.g(r(i,"multi-select")+o);Vt(i,o,!s.checked),Ut(i);break;case"single":bt(i,o,!0)}}}function rt(e){e.viewWidth=Jt.page.getViewWidth(),e.viewHeight=Jt.page.getViewHeight();var t=function(){var t=Jt.page.getViewWidth(),i=Jt.page.getViewHeight();if(t!==e.viewWidth||i!==e.viewHeight)e.viewWidth=t,e.viewHeight=i,st(e)};Et.addDOMEvent(e,window,"resize",t)}function st(e){var t=l(e),i=d(e);e.realWidth=u(e);var n=e.realWidth+"px";if(e.realWidth)e.main.style.width=n;_(e),dt(e);var a=e.bodyWidth+"px";if(e.realWidth)h(e).style.width=a,t&&(t.style.width=a),i&&(i.style.width=n);if(e.followHead)x(e),k(e);D(e),e.fire("resize"),e.topReseter&&e.topReseter()}function lt(e,t,i,n){if(e)e.style.top=i+"px",e.style.left=n+"px",e.style.position=t}function ht(e){if(e.followHead&&!e.topReseter){var t=l(e),i=r(e,"top-placeholder"),n=document.createElement("div");n.id=i,n.style.width="100%",n.style.display="none",Jt.insertBefore(n,e.main),n=null,e.topReseter=function(){if(e.followHead){var n=Jt.page.getScrollTop(),a=Jt.ie&&Jt.ie<7?"absolute":"fixed",o=e.main.offsetHeight,r="absolute"===a,s=Jt.g(i),l=e.followDoms;if(e.noFollowHeadCache){var h=t.style.position;if("fixed"!==h&&"absolute"!==h)L(e)}if(n>e.followTop&&(r||n-e.followTop<o)){var d=Jt.page.getScrollLeft(),m=e.followHeightArr,c=m.length;D(e);var p=r?e.left:e.left-d;if(s.style.height=m[c-1]+t.offsetHeight+"px",s.style.display="",Jt.ie&&Jt.ie<8)t.style.zIndex=e.zIndex+1;if(r){for(var V=0,U=l.length;U>V;V++)lt(l[V],a,m[V]+n,p);lt(t,a,m[c-1]+n,p)}else{for(var V=0,U=l.length;U>V;V++)lt(l[V],a,m[V],p);lt(t,a,m[c-1],p)}}else if(s){s.style.height=0,s.style.display="none",a="";for(var V=0,U=l.length;U>V;V++)lt(l[V],a,0,0);lt(t,a,0,0),t.style.zIndex=""}}},Et.addDOMEvent(e,window,"scroll",e.topReseter)}}function dt(e){var t=e.colsWidth,i=e.foot,n=e.id,o=i instanceof Array&&i.length,r=h(e)&&h(e).getElementsByTagName("td")||[],s=r.length,l=e.rowWidthOffset;if(o)for(var d=0,m=0;o>m;m++){for(var c=i[m],p=t[d],V=c.colspan||1,U=1;V>U;U++)p+=t[d+U];d+=V;var u=Jt.g(J(e,m));p=Math.max(p+l,0),u.style.width=p+"px",u.style.display=p?"":"none"}if(o=t.length,!e.noHead)for(var m=0;o>m;m++){var p=Math.max(t[m]+l,0),u=Jt.g(C(e,m));if(u)u.style.width=p+"px",u.style.display=p?"":"none"}for(var U=0,m=0;s>m;m++){var u=r[m];if(a(u,"control-table")===n){var p=Math.max(t[U%o]+l,0);u.style.width=p+"px",u.style.display=p?"":"none",U++}}}function mt(e){return{width:30,stable:!0,select:!0,title:function(t,i){var n={id:r(e,"select-all"),className:s(e,"select-all"),disabled:e.disabled?'disabled="disabled"':"",index:i};return Jt.format(zt,n)},content:function(t,i){var n={id:r(e,"multi-select")+i,className:s(e,"multi-select"),disabled:e.disabled?'disabled="disabled"':"",index:i,checked:V(e,i)?'checked="checked"':""};return Jt.format(Nt,n)}}}function ct(e){return{width:30,stable:!0,title:"&nbsp;",select:!0,content:function(t,i){var n=r(e,"single-select"),a={id:n+i,name:n,className:s(e,"single-select"),index:i,disabled:e.disabled?'disabled="disabled"':"",checked:V(e,i)?'checked="checked"':""};return Jt.format(Bt,a)}}}function pt(e){var t=a(e,"index");Vt(this,t),Ut(this)}function Vt(e,i,n){var o="row-selected";if(i>=0){var s=Jt.g(r(e,"multi-select")+i);if(s){t(n)&&(s.checked=n);var l=m(e,i);if(s.checked)Et.addPartClasses(e,o,l);else Et.removePartClasses(e,o,l)}}else if(t(n))for(var h=ft(e,"checkbox"),d=0,c=h.length;c>d;d++){var s=h[d];s.checked=n;var p=a(s,"index"),l=m(e,p);if(n)Et.addPartClasses(e,o,l);else Et.removePartClasses(e,o,l)}}function Ut(e){for(var t=c(e),i=ft(e,"checkbox"),n=!0,o=[],s=r(e,"multi-select"),l=0,h=i.length;h>l;l++){var d=i[l];if(d.id.indexOf(s)>=0){var m=a(d,"index");if(!d.checked)n=!1;else o.push(m)}}p(e,o),e.fire("select",{selectedIndex:o}),t.checked=n}function ut(){gt(this,c(this).checked)}function ft(e,t){for(var i=h(e).getElementsByTagName("input"),n=[],a=0,o=i.length;o>a;a++){var r=i[a],s=r.id;if(r.getAttribute("type")===t&&s)n.push(r)}return n}function gt(e,t){Vt(e,-1,t),Ut(e)}function yt(e){bt(this,a(e,"index"))}function bt(e,i,n){var a=e.selectedIndex,o=Jt.g(r(e,"single-select")+i);if(o){if(t(n)&&(o.checked=n),e.fire("select",{selectedIndex:i}),a&&a.length)Et.removePartClasses(e,"row-selected",m(e,a[0]));p(e,[i]),Et.addPartClasses(e,"row-selected",m(e,i))}}function kt(e){e.main.style.zIndex=e.zIndex||""}function xt(e){for(var t=ft(e,"multi"===e.select?"checkbox":"radio"),i=t.length-1;i>=0;i--)if(e.disabled)t[i].setAttribute("disabled","disabled");else t[i].removeAttribute("disabled");if("multi"===e.select){var n=c(e);if(n)if(e.disabled)n.setAttribute("disabled","disabled");else n.removeAttribute("disabled")}if(e.children&&e.children.length)for(var a=e.children,i=a.length-1;i>=0;i--)a[i].setDisabled(e.disabled)}function Lt(e){var t=" "+e+" ";return function(e){var i=" "+e.className+" ";return i.replace(Ht," ").indexOf(t)>=0}}function vt(e,t){var i=null;if(t)i="function"==typeof t?t:Lt(t);return{handler:e,matchFn:i}}function _t(e,t,i){var n=t.id,a=e.handlers[n];if(!a)a=e.handlers[n]={};if(i)if(a=e.handlers[i],!a)a=e.handlers[i]=[];return a}function Wt(e,t,i,n){var a=_t(e,t,i),o=[];if(!a.length)It(e,t,i);for(var r=0,s=n.length;s>r;r++){var l=n[r],h=vt(l.handler,l.matchFn);a.push(h),o.push(h)}return o}function wt(e,t,i,n){for(var a=_t(e,t,i),o=0,r=n.length;r>o;o++)for(var s=n[o],l=0,h=a.length;h>l;l++)if(a[l]===s)a.splice(l,1),l--;if(!a.length)Kt(e,t,i)}function Xt(e,t,i){return function(n){for(var n=n||window.event,a=n.target;a;){if(1===a.nodeType)for(var o=t.length-1;o>=0;o--){var r=t[o];if(!r.matchFn||r.matchFn(a))r.handler.call(i,a,n)}if(a===e)break;a=a.parentNode}}}function It(e,t,i){var n=_t(e,t,i);Et.addDOMEvent(e,t,i,Xt(t,n,e))}function Kt(e,t,i){Et.removeDOMEvent(e,t,i)}function Ct(e){var t=Et.getPartClasses,i=t(e,"row")[0],n=t(e,"hcell")[0],a=t(e,"select-all")[0],o=t(e,"multi-select")[0],r=t(e,"single-select")[0];Wt(e,e.main,"mouseover",[{handler:nt,matchFn:i},{handler:S,matchFn:n}]),Wt(e,e.main,"mouseout",[{handler:at,matchFn:i},{handler:T,matchFn:n}]),Wt(e,e.main,"click",[{handler:ot,matchFn:i},{handler:A,matchFn:n},{handler:ut,matchFn:a},{handler:pt,matchFn:o},{handler:yt,matchFn:r}])}var Jt=require("./lib"),St=require("underscore"),Et=require("./controlHelper"),Tt=require("./Control");e.defaultProperties={noDataHtml:"没有数据",noFollowHeadCache:!1,followHead:!1,sortable:!1,encode:!1,columnResizable:!1,rowWidthOffset:-1,select:"",selectMode:"box",subrowMutex:1,subEntryOpenTip:"点击展开",subEntryCloseTip:"点击收起",subEntryWidth:18,breakLine:!1,hasTip:!1,hasSubrow:!1,tipWidth:18,sortWidth:9,fontSize:13,colPadding:8,zIndex:0,overflowX:"hidden"};var Pt='<table cellpadding="0" cellspacing="0" width="${width}" data-control-table="${controlTableId}">',At='<div class="${className}"></div>',Ft='<div id="${id}" class="${className}" data-ui="type:Tip;id:${id};content:${content}"></div>',Mt='<div class="${className}">${html}</div>',Ot='<div id="${id}" class="${className}" data-index="${index}" ${attr}>',Dt='<span id="${colTextId}">${content}</span>',zt='<input type="checkbox" id="${id}" class="${className}" data-index="${index}" ${disabled}/>',Nt='<input type="checkbox" id="${id}" class="${className}" data-index="${index}" ${disabled} ${checked} />',Bt='<input type="radio" id="${id}" name="${name}" class="${className}" data-index="${index}" ${disabled} ${checked} />',Ht=/[\t\r\n]/g;return e.prototype={type:"Table",initOptions:function(t){var i={};St.extend(i,e.defaultProperties,t),this.setProperties(i)},initStructure:function(){if(this.realWidth=u(this),this.realWidth)this.main.style.width=this.realWidth+"px";kt(this),$(this),rt(this),Ct(this)},repaint:function(t,i){Tt.prototype.repaint.apply(this,arguments);var n=this;if(!n.realWidth)if(n.realWidth=u(n),n.realWidth)n.main.style.width=n.realWidth+"px";var a=e.defaultProperties,o={};if(!t){for(var r in a)if(a.hasOwnProperty(r))o[r]=!0}else for(var s=0;s<t.length;s++){var l=t[s];o[l.name]=!0}var h=!1,d=!1,m=!1;if(o.fields||o.select||o.selectMode||o.sortable)f(n),h=!0;if(h||o.breakLine||o.colPadding||o.fontSize)v(n),_(n),d=!0;if(h||d||o.noHead||o.order||o.orderBy||o.selectedIndex)X(n);if(o.followHead||o.noFollowHeadCache)g(n),ht(n);if(h||d||o.encode||o.noDataHtml||o.datasource||o.selectedIndex)Y(n),m=!0;if(m||o.bodyMaxHeight)Z(n);if(h||d||o.foot)W(n);if(n.extraRepaint=Et.createRepaint([{name:"disabled",paint:xt},{name:"width",paint:st},{name:"zIndex",paint:kt}]),n.extraRepaint(t,i),m&&Et.isInStage(n,"RENDERED"))switch(n.select){case"multi":p(n,[]),n.fire("select",{selectedIndex:n.selectedIndex})}if(n.realWidth!==u(n))st(n)},getId:function(e){return r(this,e)},getBodyCellId:function(e,t){return q(this,e,t)},setCellText:function(e,t,n,a){if(a)e=Jt.encodeHTML(e);e=i(e)?"&nbsp":e,Jt.g(r(this,"cell-textfield-"+t+"-"+n)).innerHTML=e},getClass:function(e){return s(this,e)},getRow:function(e){return m(this,e)},addRowBuilders:function(e){j(this,e)},addHandlers:function(e,t){if(!t.length)t=[t];return Wt(this,this.main,e,t)},removeHandlers:function(e,t){if(!t.length)t=[t];wt(this,this.main,e,t)},adjustWidth:function(){st(this)},setDatasource:function(e){this.datasource=e,p(this,[]);var t={name:"datasource"},i={name:"selectedIndex"};this.repaint([t,i],{datasource:t,selectedIndex:i})},updateRowAt:function(e,t){t&&(this.datasource[e]=t);var i=this.datasource[e],n=m(this,e);if(i&&n){this.fire("beforerowupdate",{index:e,data:i});var a=document.createElement("div");a.innerHTML=et(this,t,e,this.rowBuilderList);var o=a.children[0];n.parentNode.replaceChild(o,n),this.fire("afterrowupdate",{index:e,data:i})}},getSelectedItems:function(){var e=this.selectedIndex,t=[];if(e){var i=this.datasource;if(i)for(var n=0;n<e.length;n++)t.push(i[e[n]])}return t},setRowSelected:function(e,t){var i=this,n="multi"===i.select,a=n?Vt:bt;if(St.isArray(e))if(n)St.each(e,function(e){a(i,e,t)});else a(i,e[0],t);else a(i,e,t);if(n)Ut(i)},setAllRowSelected:function(e){this.setRowSelected(-1,e)},resetFollowHead:function(){y(this)},dispose:function(){if(!Et.isInStage(this,"DISPOSED")){Et.beforeDispose(this);var e=this.main;if(e){this.followDoms=null;var t=Jt.g(r(this,"drag-mark"));if(t)document.body.removeChild(t)}this.rowBuilderList=null,this.headPanel.disposeChildren(),this.bodyPanel.disposeChildren(),this.headPanel=null,this.bodyPanel=null,Et.dispose(this),Et.afterDispose(this)}}},Jt.inherits(e,Tt),require("./main").register(e),e});