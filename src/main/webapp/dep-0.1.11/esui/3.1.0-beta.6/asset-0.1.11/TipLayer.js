define("esui/TipLayer",["require","./Button","./Label","./Panel","underscore","./lib","./controlHelper","./Control","./main","./painters"],function(require){function e(){m.apply(this,arguments)}function t(e){var t=e.main;if(t){for(var i,n=h.getChildren(t),a=n.length,o={};a--;)if(i=n[a].getAttribute("data-role"))o[i]=n[a];e.roles=o}}function i(e,t){if(t)e.title=t.innerHTML;else if(t=document.createElement("h3"),e.main.firstChild)h.insertBefore(t,e.main.firstChild);else e.main.appendChild(t);var i=[].concat(d.getPartClasses(e,"title"));h.addClasses(t,i);var n={main:t,childName:"title"},a=c.create("Label",n);return a.render(),e.addChild(a),a}function n(e,t,i){if(i)e.content=i.innerHTML;else if(i=document.createElement("div"),"body"===t){var n=e.getChild("title");if(n)h.insertAfter(i,n.main);else if(e.main.firstChild)h.insertBefore(i,n,e.main.firstChild);else e.main.appendChild(i)}else e.main.appendChild(i);h.addClasses(i,d.getPartClasses(e,t+"-panel"));var a={main:i,renderOptions:e.renderOptions},o=c.create("Panel",a);return o.render(),e.addChild(o,t),o}function a(e,t,i){if(e.isShow)e.autoPosition(t,i)}function o(e,t,i,n){if(t=t||V)clearTimeout(e.showTimeout),clearTimeout(e.hideTimeout),e.showTimeout=setTimeout(h.bind(e.show,e,i,n),t);else e.show(i,n)}function r(e,t){t=t||u,clearTimeout(e.showTimeout),clearTimeout(e.hideTimeout),e.hideTimeout=setTimeout(h.bind(e.hide,e),t)}function s(e,t){if("string"==typeof t)t=e.viewContext.get(t);return t.main}require("./Button"),require("./Label"),require("./Panel");var l=require("underscore"),h=require("./lib"),d=require("./controlHelper"),m=require("./Control"),c=require("./main"),p=require("./painters"),V=0,u=150;return e.prototype={type:"TipLayer",initOptions:function(e){t(e);var i={roles:{}};h.extend(i,e),this.setProperties(i)},initStructure:function(){var e=this.main;if(e.parentNode&&"body"!==e.parentNode.nodeName.toLowerCase())document.body.appendChild(e);if(this.main.style.left="-10000px",this.title||this.roles.title)i(this,this.roles.title);if(n(this,"body",this.roles.content),this.foot||this.roles.foot)n(this,"foot",this.roles.foot);if(this.arrow){var t=document.createElement("div");t.id=d.getId(this,"arrow"),t.className=d.getPartClasses(this,"arrow").join(" "),this.main.appendChild(t)}},repaint:d.createRepaint(m.prototype.repaint,p.style("width"),{name:"title",paint:function(e,t){var n=e.getHead();if(null==t){if(n)e.removeChild(n)}else{if(!n)n=i(e);n.setText(t)}}},{name:"content",paint:function(e,t){var i='<div class="${class}" id="${id}">${content}</div>',n=e.getBody(),a=d.getId(e,"body"),o=d.getPartClasses(e,"body"),r={"class":o.join(" "),id:a,content:t};n.setContent(h.format(i,r))}},{name:"foot",paint:function(e,t){var i='<div class="${class}" id="${id}">${content}</div>',a=d.getId(e,"foot"),o=d.getPartClasses(e,"foot"),r=e.getFoot();if(null==t){if(r)e.removeChild(r)}else{var s={"class":o.join(" "),id:a,content:t};if(!r)r=n(e,"foot");r.setContent(h.format(i,s))}}},{name:["targetDOM","targetControl","showMode","positionOpt","delayTime","showDuration"],paint:function(e,t,i,n,a,o,r){var s={targetDOM:t,targetControl:i,showMode:n,delayTime:o||V,showDuration:r||u};if(a)a=a.split("|"),s.positionOpt={top:a[0]||"top",right:a[1]||"left"};e.attachTo(s)}}),autoPosition:function(e,t){var i=this,n=this.main;t=t||{left:"right",top:"top"};var a=e.getBoundingClientRect(),o=h.getOffset(e),r={top:a.top,right:a.right,bottom:a.bottom,left:a.left,width:a.right-a.left,height:a.bottom-a.top},s=n.style.display;n.style.display="block";var m=n.offsetHeight,c=n.offsetWidth;n.style.display="none";var p=l.omit(t,"targetControl"),V=h.page.getViewWidth(),u=h.page.getViewHeight(),U=r.left-c,f=V-r.right-c,g=u-r.top-m,y=r.bottom-m;if(U>=0)if(f>=0){if(!p.right&&!p.left)if(U>f)p.left="right",p.right=null;else p.right="left",p.left=null}else p.left="right",p.right=null;else p.right="left",p.left=null;if(g>=0)if(y>=0){if(!p.bottom&&!p.top)if(g>y)p.top="top",p.bottom=null;else p.bottom="bottom",p.top=null}else p.top="top",p.bottom=null;else p.bottom="bottom",p.top=null;var b,k={};if(p.right)if(k.left=o.right,p.top)b="lt";else b="lb";else if(p.left)if(k.left=o.left-c,p.top)b="rt";else b="rb";if(p.top)k.top=o.top;else if(p.bottom)k.top=o.bottom-m;n.style.display=s,n.className=""+d.getPartClasses(i).join(" ")+" "+d.getPartClasses(i,b).join(" ");var x=h.g(d.getId(i,"arrow"));if(x)x.className=""+d.getPartClasses(i,"arrow").join(" ")+" "+d.getPartClasses(i,"arrow-"+b).join(" ");i.renderLayer(n,k)},renderLayer:function(e,t){var i=h.clone(t||{});if(i.hasOwnProperty("top")&&i.hasOwnProperty("bottom"))i.height=i.bottom-i.top,delete i.bottom;if(i.hasOwnProperty("left")&&i.hasOwnProperty("right"))i.width=i.right-i.left,delete i.right;if(i.hasOwnProperty("top")||i.hasOwnProperty("bottom"))e.style.top="",e.style.bottom="";if(i.hasOwnProperty("left")||i.hasOwnProperty("right"))e.style.left="",e.style.right="";for(var n in i)if(i.hasOwnProperty(n))e.style[n]=i[n]+"px"},attachTo:function(e){var t,i=e.showMode||"over";if(e.targetDOM)t=h.g(e.targetDOM);else if(e.targetControl)t=s(this,e.targetControl);if(t)switch(i){case"auto":this.initAutoMode(e);break;case"over":this.initOverMode(e);break;case"click":this.initClickMode(e)}},getInitHandlers:function(e){var t,i=this;if(e.targetDOM)t=h.g(e.targetDOM);else if(e.targetControl)t=s(this,e.targetControl);if(t){var n={targetElement:t,layer:{show:h.curry(o,i,e.delayTime,t,e.positionOpt),hide:h.curry(r,i),bind:function(e,a){e=e||"mouseup",d.addDOMEvent(i,t,e,function(e){if(n.layer.show(),n.clickOutsideHide.bind(),"function"==typeof a)a();e.stopPropagation()})}},clickOutsideHide:{preventPopMethod:function(e){e.stopPropagation()},method:function(){n.layer.hide(),n.clickOutsideHide.unbind()},bind:function(){d.addDOMEvent(i,document.documentElement,"mouseup",n.clickOutsideHide.method),d.addDOMEvent(i,i.main,"mouseup",n.clickOutsideHide.preventPopMethod)},unbind:function(){d.removeDOMEvent(i,document.documentElement,"mouseup",n.clickOutsideHide.method),d.removeDOMEvent(i,i.main,"mouseup",n.clickOutsideHide.preventPopMethod)}}};return n}},initAutoMode:function(e){var t=this.getInitHandlers(e);if(t.layer.show(),!e.showDuration)t.clickOutsideHide.bind(),t.layer.bind("mouseup");else setTimeout(function(){t.layer.hide(e.showDuration),t.layer.bind("mouseup")},e.delayTime)},initClickMode:function(e){var t=this.getInitHandlers(e);t.layer.bind("mouseup")},initOverMode:function(e){var t=this.getInitHandlers(e);t.layer.bind("mouseover"),d.addDOMEvent(this,t.targetElement,"mouseup",function(e){e.stopPropagation()}),d.addDOMEvent(this,this.main,"mouseover",h.bind(this.show,this,t.targetElement,e.positionOpt))},getHead:function(){return this.getChild("title")},getBody:function(){return this.getChild("body")},getFoot:function(){return this.getChild("foot")},show:function(e,t){if(d.isInStage(this,"INITED"))this.render();else if(d.isInStage(this,"DISPOSED"))return;if(clearTimeout(this.hideTimeout),d.addDOMEvent(this,window,"resize",h.curry(a,this,e,t)),this.main.style.zIndex=d.layer.getZIndex(e),this.removeState("hidden"),this.autoPosition(e,t),!this.isShow)this.isShow=!0,this.fire("show")},hide:function(){if(this.isShow)this.isShow=!1,this.addState("hidden"),this.fire("hide")},setTitle:function(e){this.setProperties({title:e})},setContent:function(e){this.setProperties({content:e})},setFoot:function(e){this.setProperties({foot:e})},dispose:function(){if(!d.isInStage(this,"DISPOSED")){this.hide();var e=this.main.id;h.removeNode(e),m.prototype.dispose.apply(this,arguments)}}},e.onceNotice=function(e){function t(e){var t=e.onok,i="function"==typeof t;if(i)t(e);e.fire("ok"),e.dispose()}var i="tipLayer-once-notice",n="tipLayer-notice-ok",a=h.encodeHTML(e.content)||"",o={type:"onceNotice",skin:"onceNotice",arrow:!0};h.extend(o,e);var r=document.createElement("div");document.body.appendChild(r);var s=d.getGUID(i);o.id=s,o.main=r,o.type=null;var l=c.create("TipLayer",o);l.setContent(a);var m=e.okText||"知道了";l.setFoot('<div data-ui="type:Button;childName:okBtn;id:'+s+"-"+n+';width:50;"class="'+d.getPartClasses(l,"once-notice")+'">'+m+"</div>"),l.render();var p=l.getFoot().getChild("okBtn");return p.on("click",h.curry(t,l,"ok")),l.attachTo({targetDOM:e.targetDOM,targetControl:e.targetControl,showMode:"auto",positionOpt:{top:"top",right:"left"}}),l},h.inherits(e,m),c.register(e),e});