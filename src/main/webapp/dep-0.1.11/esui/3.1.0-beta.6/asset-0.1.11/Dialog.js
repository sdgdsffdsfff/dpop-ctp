define("esui/Dialog",["require","./Button","./Panel","./lib","./controlHelper","./Control","./main"],function(require){function e(){f.apply(this,arguments)}function t(e){var t=e.main;if(t){for(var i,n=c.getChildren(t),a=n.length,o={};a--;)if(i=n[a].getAttribute("data-role"))o[i]=n[a];e.roles=o}}function i(e,t){var i="title",n="close-icon",a='<div class="${clsClass}" id="${clsId}">&nbsp;</div>',o="";if(e.closeButton)o=c.format(a,{clsId:u.getId(e,n),clsClass:u.getPartClasses(e,n).join(" ")});var r='<div id="${titleId}" class="${titleClass}"></div>${closeIcon}',s=[].concat(u.getPartClasses(e,"head")),l={titleId:u.getId(e,i),titleClass:u.getPartClasses(e,i).join(" "),closeIcon:o},h=c.format(r,l);if(t)e.title=t.innerHTML;else if(t=document.createElement("div"),e.main.firstChild)c.insertBefore(t,e.main.firstChild);else e.main.appendChild(t);t.innerHTML=h,c.addClasses(t,s);var m={main:t,renderOptions:e.renderOptions},V=y.create("Panel",m);return V.render(),e.addChild(V,"head"),V}function n(){var e=this.fire("beforeclose");if(e.isDefaultPrevented())return!1;if(this.hide(),this.fire("close"),this.closeOnHide)this.dispose()}function a(){var e=c.page,t=this.main,i=this.left,n=this.top,a=this.right,o=this.bottom;if(void 0===i||null===i)i=(e.getViewWidth()-t.offsetWidth)/2;if(0>i)i=0;if(void 0===n||null===n)n=(e.getViewHeight()-t.offsetHeight)/2;if(n=Math.max(n,0),t.style.left=i+"px",t.style.top=e.getScrollTop()+n+"px",void 0!==a&&null!==a)t.style.right=a+"px";if(void 0!==o&&null!==o)t.style.bottom=o+"px";if("auto"===this.height){var r=e.getViewHeight()-n;t.style.height=r+"px";var s=this.getBody().main,l=this.getHead().main,h=parseInt(c.getStyle(l,"height"),10);s.style.height=r-h+"px"}}function o(e,t){var i=e,n=e.getChild("head").main;if(t===!0)u.removeDOMEvent(i,n,"mousedown",s);else u.addDOMEvent(i,n,"mousedown",s)}function r(e,t,i){if(i)u.addDOMEvent(e,t,"selectstart",function(e){e.preventDefault()});else u.removeDOMEvent(e,t,"selectstart")}function s(e){var t=e.button,i=!1;if(!e.which&&1===t||1===e.which)i=!0;if(i){var n=document;this.addState("dragging"),r(this,this.main,!0),u.addDOMEvent(this,n,"mousemove",l),u.addDOMEvent(this,n,"mouseup",h),c.event.getMousePosition(e),this.dragStartPos={x:e.pageX,y:e.pageY}}}function l(e){var t=this;c.event.getMousePosition(e);var i={x:e.pageX-t.dragStartPos.x,y:e.pageY-t.dragStartPos.y};t.dragStartPos={x:e.pageX,y:e.pageY};var n=t.main,a=c.getOffset(n),o=a.left+i.x,r=a.top+i.y,s=c.page.getWidth(),l=c.page.getHeight(),h=c.getOffset(n);if(0>r)r=0;else if(r>l-h.height)r=l-h.height;if(0>o)o=0;else if(o>s-h.width)o=s-h.width;n.style.left=o+"px",n.style.top=r+"px"}function h(){u.removeDOMEvent(this,document,"mousemove",l),u.removeDOMEvent(this,document,"mouseup",h),this.removeState("dragging"),r(this,this.main,!1)}function m(e,t){var i=d(e),n=[],a=u.getPartClasses(e,"mask").join(" ");n.push(a),i.className=n.join(" "),i.style.display="block",i.style.zIndex=t}function V(e){var t=d(e);if("undefined"!=typeof t)c.removeNode(t)}function U(e){var t=document.createElement("div");t.id=e,document.body.appendChild(t)}function d(e){var t=u.getId(e),i=g+"-"+t,n=c.g(i);if(!n)U(i);return c.g(i)}require("./Button"),require("./Panel");var p,c=require("./lib"),u=require("./controlHelper"),f=require("./Control"),y=require("./main"),g="ctrl-mask";return e.OK_TEXT="确定",e.CANCEL_TEXT="取消",e.prototype={type:"Dialog",initOptions:function(e){t(e);var i={closeButton:!0,closeOnHide:!0,draggable:!1,mask:!0,title:"我是标题",content:"<p>我是内容</p>",defaultFoot:'<div class="'+this.helper.getPartClassName("ok-btn")+'" data-ui="type:Button;id:btnFootOk;childName:btnOk;skin:spring;">确定</div><div class="'+this.helper.getPartClassName("cancel-btn")+'" data-ui="type:Button;id:btnFootCancel;childName:btnCancel;">取消</div>',needFoot:!0,roles:{}};if("false"===e.closeOnHide)e.closeOnHide=!1;if("false"===e.closeButton)e.closeButton=!1;if("false"===e.mask)e.mask=!1;if("false"===e.needFoot)e.needFoot=!1;if(c.extend(i,e),i.needFoot)if(!i.foot)i.foot=i.defaultFoot;this.setProperties(i)},initStructure:function(){var e=this.main;if(e.parentNode&&"body"!==e.parentNode.nodeName.toLowerCase())document.body.appendChild(e);if(this.addState("hidden"),i(this,this.roles.title),this.createBF("body",this.roles.content),this.needFoot)this.createBF("foot",this.roles.foot)},initEvents:function(){if(this.closeButton){var e=c.g(u.getId(this,"close-icon"));if(e)u.addDOMEvent(this,e,"click",c.curry(n,this))}},createBF:function(e,t){if(t)this.content=t.innerHTML;else if(t=document.createElement("div"),"body"===e){var i=this.getChild("head");if(i)c.insertAfter(t,i.main);else if(this.main.firstChild)c.insertBefore(t,i,this.main.firstChild);else this.main.appendChild(t)}else this.main.appendChild(t);c.addClasses(t,u.getPartClasses(this,e+"-panel"));var n={main:t,renderOptions:this.renderOptions},a=y.create("Panel",n);return a.render(),this.addChild(a,e),a},repaint:u.createRepaint(f.prototype.repaint,{name:"height",paint:function(e,t){if("auto"===t)e.main.style.height="auto";else if(t)e.main.style.height=t+"px";if(e.isShow)a.apply(e)}},{name:"width",paint:function(e,t){if("auto"===t)e.main.style.width="auto";else if(t)e.main.style.width=t+"px";if(e.isShow)a.apply(e)}},{name:"title",paint:function(e,t){var i=u.getId(e,"title");c.g(i).innerHTML=t}},{name:"content",paint:function(e,t){if(t){var i='<div class="${class}" id="${id}">${content}</div>',n=e.getBody(),a=u.getId(e,"body"),o=u.getPartClasses(e,"body"),r={"class":o.join(" "),id:a,content:t};n.setContent(c.format(i,r))}}},{name:"foot",paint:function(e,t){var i='<div class="${class}" id="${id}">${content}</div>',n=u.getId(e,"foot"),a=u.getPartClasses(e,"foot"),o=e.getFoot();if(null==t){if(e.needFoot=!1,o)e.removeChild(o)}else{e.needFoot=!0;var r={"class":a.join(" "),id:n,content:t};if(!o)o=e.createBF("foot");o.setContent(c.format(i,r))}}},{name:"draggable",paint:function(e,t){var i=!1;if(t)e.addState("draggable");else e.removeState("draggable"),i=!0;o(e,i)}}),getBody:function(){return this.getChild("body")},getHead:function(){return this.getChild("head")},getFoot:function(){return this.getChild("foot")},show:function(){var e=this.mask;if(u.isInStage(this,"INITED"))this.render();else if(u.isInStage(this,"DISPOSED"))return;p=c.curry(a,this),u.addDOMEvent(this,window,"resize",a),this.setWidth(this.width),this.removeState("hidden"),a.apply(this);for(var t=1203,i=document.body.children,n=0,o=0,r=i.length;r>o;o++)if(1===i[o].nodeType)if(c.hasClass(i[o],this.helper.getPrimaryClassName())&&!c.hasClass(i[o],this.helper.getPrimaryClassName("hidden")))n++;if(t+=10*n,this.main.style.zIndex=t,e)m(this,t-1);if(!this.isShow)this.isShow=!0,this.fire("show")},hide:function(){if(this.isShow){if(this.isShow=!1,u.removeDOMEvent(this,window,"resize",a),this.addState("hidden"),this.mask)V(this);this.fire("hide")}},setTitle:function(e){this.setProperties({title:e})},setContent:function(e){this.setProperties({content:e})},setFoot:function(e){this.setProperties({foot:e})},setHeight:function(e){this.setProperties({height:e})},setWidth:function(e){this.setProperties({width:e})},resize:function(){a.apply(this)},dispose:function(){if(!this.helper.isInStage("DISPOSED")){this.hide();var e=this.main.id;c.removeNode(e),f.prototype.dispose.apply(this,arguments)}}},e.confirm=function(t){function i(e,t){e.fire(t),e.dispose()}var n="dialog-confirm",a=c.encodeHTML(t.title)||"",o=c.encodeHTML(t.content)||"",r=c.encodeHTML(t.okText)||e.OK_TEXT,s=c.encodeHTML(t.cancelText)||e.CANCEL_TEXT,l={type:"confirm",skin:"confirm",title:""};c.extend(l,t);var h=['<div class="${prefix}-icon ${prefix}-icon-${type}"></div>','<div class="${prefix}-text">${content}</div>'].join("");l.id=u.getGUID(n),l.closeButton=!1,l.mask=!0,l.alwaysTop=!0;var m=l.type;l.type=null;var V=y.create("Dialog",l);V.appendTo(document.body),V.show();var U=V.getFoot().getChild("btnOk"),d=V.getFoot().getChild("btnCancel");if(U.setContent(r),d.setContent(s),V.setTitle(a),V.setContent(c.format(h,{type:m,content:o,prefix:V.helper.getPrimaryClassName()})),l.btnHeight)U.set("height",l.btnHeight),d.set("height",l.btnHeight);if(l.btnWidth)U.set("width",l.btnWidth),d.set("width",l.btnWidth);return U.on("click",c.curry(i,V,"ok")),d.on("click",c.curry(i,V,"cancel")),V},e.alert=function(t){function i(e,t){e.fire("ok"),t.dispose(),e.dispose()}var n="dialog-alert",a="dialog-alert-ok",o=c.encodeHTML(t.title)||"",r=c.encodeHTML(t.content)||"",s=c.encodeHTML(t.okText)||e.OK_TEXT,l={type:"warning",skin:"alert",title:""};c.extend(l,t);var h=['<div class="${prefix}-icon ${prefix}-icon-${type}"></div>','<div class="${prefix}-text">${content}</div>'].join(""),m=u.getGUID(n);l.id=m,l.closeButton=!1,l.mask=!0,l.alwaysTop=!0;var V=l.type;l.type=null;var U=y.create("Dialog",l);U.appendTo(document.body),U.setTitle(o),U.setContent(c.format(h,{type:V,content:r,prefix:U.helper.getPrimaryClassName()})),U.setFoot('<div class="'+U.helper.getPartClassName("ok-btn")+'" data-ui="type:Button;childName:okBtn;id:'+m+"-"+a+'; skin:spring;width:50;">'+s+"</div>"),U.show();var d=U.getFoot().getChild("okBtn");if(d.on("click",c.curry(i,U,d)),l.btnHeight)d.set("height",l.btnHeight);if(l.btnwidth)d.set("width",l.btnwidth);return U},c.inherits(e,f),y.register(e),e});