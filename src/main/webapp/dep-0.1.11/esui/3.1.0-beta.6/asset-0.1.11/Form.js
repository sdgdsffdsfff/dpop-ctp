define("esui/Form",["require","underscore","./lib","./main","./Panel"],function(require){function e(e){this.length=e.length;for(var t=0;t<e.length;t++)this[t]=e[t]}function t(e,t){for(var i={},n=0;n<e.length;n++){var a=e[n];if("check"!==a.getCategory()||a.isChecked())if(!a.isDisabled()){var o=a.get("name"),r=t(a);if(i.hasOwnProperty(o))i[o]=[].concat(i[o],r);else i[o]=r}else;else;}return i}function i(){s.apply(this,arguments)}function n(e){var t=e.getCategory();return"input"===t||"check"===t}var a=require("underscore"),o=require("./lib"),r=require("./main"),s=require("./Panel");return e.prototype.splice=Array.prototype.splice,e.prototype.getData=function(){return t(this,function(e){return e.getRawValue()})},e.prototype.getDataAsString=function(){var e=t(this,function(e){var t=e.getValue();return encodeURIComponent(t)}),i="";return a.each(e,function(e,t){i+=encodeURIComponent(t)+"="+e}),i},e.prototype.getValueAsString=function(e){var t=this.getData(),i=t[e],n=i?"string"==typeof i?i:i.join(","):"";return n},e.prototype.checkAll=function(){for(var e=0;e<this.length;e++){var t=this[e];if("check"===t.getCategory())t.setChecked(!0)}},e.prototype.uncheckAll=function(){for(var e=0;e<this.length;e++){var t=this[e];if("check"===t.getCategory())t.setChecked(!1)}},e.prototype.checkInverse=function(){for(var e=0;e<this.length;e++){var t=this[e];if("check"===t.getCategory())t.setChecked(!t.isChecked())}},e.prototype.checkByValue=function(e){for(var t=o.toDictionary(e),i=0;i<this.length;i++){var n=this[i];if("check"===n.getCategory()){var a=t.hasOwnProperty(n.getValue());n.setChecked(a)}}},i.defaultProperties={autoValidate:!1},i.prototype.type="Form",i.prototype.validateAndSubmit=function(){var e=this.fire("beforevalidate");if(!e.isDefaultPrevented())try{var t=this.get("autoValidate")?this.validate():!0,e=this.fire("aftervalidate",{isValid:t});if(e.isDefaultPrevented())return;var i={triggerSource:this};if(t)this.fire("submit",i);else this.fire("invalid",i)}catch(n){this.fire("submitfail",{error:n})}},i.prototype.initEvents=function(){if("form"===this.main.nodeName.toLowerCase())this.helper.addDOMEvent(this.main,"submit",function(e){return this.validateAndSubmit(),e.preventDefault(),!1})},i.prototype.createMain=function(e){var t=document.createElement("form");return t.method="POST",t.action=e.action||"",t},i.prototype.initOptions=function(e){var t=a.extend({},i.defaultProperties,e);if("form"===this.main.nodeName.toLowerCase())t.action=this.main.getAttribute("action"),t.method=this.main.getAttribute("method");else t.method=this.method||"POST";if("false"===e.autoValidate)t.autoValidate=!1;else t.autoValidate=!!t.autoValidate;s.prototype.initOptions.call(this,t)},i.prototype.getInputControls=function(t,i){function a(e,s){for(var l=s.children,h=l.length,m=0;h>m;m++){var V=l[m];if(1===V.nodeType){var U=r.getControlByDOM(V);if(U&&n(U)&&U.viewContext===e.viewContext&&U.get("name")&&(!t||U.get("name")===t)&&(!i||U.get("type")===i))o.push(U);else a(e,V)}else;}}var o=[];return a(this,this.main),new e(o)},i.prototype.getData=function(){var e=this.getInputControls();return e.getData()},i.prototype.getDataAsString=function(){var e=this.getInputControls();return e.getDataAsString()},i.prototype.validate=function(){for(var e=this.getInputControls(),t=!0,i=0;i<e.length;i++){var n=e[i];if(!n.isDisabled())t&=n.validate();else;}return!!t},i.prototype.repaint=function(e,t){s.prototype.repaint.apply(this,arguments);var i=!1;if(!t&&this.submitButton)i=!0;if(t&&t.hasOwnProperty("submitButton")){var n=t.submitButton;if(n.oldValue){for(var a=0;a<n.oldValue.length;a++){var o=this.viewContext.get(n.oldValue[a]);if(o)o.un("click",this.validateAndSubmit,this)}i=!!this.submitButton}}if(i)for(var a=0;a<this.submitButton.length;a++){var r=this.viewContext.get(this.submitButton[a]);if(r)r.on("click",this.validateAndSubmit,this)}},i.prototype.setProperties=function(e){e=a.clone(e),e.submitButton=o.splitTokenList(e.submitButton),s.prototype.setProperties.call(this,e)},o.inherits(i,s),r.register(i),i});