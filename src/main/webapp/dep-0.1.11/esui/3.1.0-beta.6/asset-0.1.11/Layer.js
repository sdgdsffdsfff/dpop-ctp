define("esui/Layer",["require","underscore","./lib","./main","mini-event/EventTarget"],function(require){function e(e){this.control=e}function t(e){var t=e.target,i=this.getElement(this),n=this.control.main;if(i){for(;t&&t!==i&&t!==n;)t=t.parentNode;if(t!==i&&t!==n)this.hide()}}function i(e){var t=e.control.helper.getPartClasses("layer-hidden");return t.unshift(r.getConfig("uiClassPrefix")+"-layer-hidden"),t}function n(e,t){var i=o.clone(t||{});if(i.hasOwnProperty("top")&&i.hasOwnProperty("bottom"))i.height=i.bottom-i.top,delete i.bottom;if(i.hasOwnProperty("left")&&i.hasOwnProperty("right"))i.width=i.right-i.left,delete i.right;if(i.hasOwnProperty("top")||i.hasOwnProperty("bottom"))e.style.top="",e.style.bottom="";if(i.hasOwnProperty("left")||i.hasOwnProperty("right"))e.style.left="",e.style.right="";for(var n in i)if(i.hasOwnProperty(n))e.style[n]=i[n]+"px"}var a=require("underscore"),o=require("./lib"),r=require("./main");e.prototype.nodeName="div",e.prototype.autoHide=!0,e.prototype.enableAutoHide=function(e){var t="onwheel"in document.body?"wheel":"mousewheel";this.control.helper.addDOMEvent(document.documentElement,t,a.bind(this.hide,this)),this.control.helper.addDOMEvent(e,t,function(e){e.stopPropagation()})},e.prototype.create=function(){var e=this.control.helper.createPart("layer",this.nodeName);if(o.addClass(e,r.getConfig("uiClassPrefix")+"-layer"),this.autoHide)this.enableAutoHide(e);return e},e.prototype.addCustomClasses=function(e){var t=this.getElement();o.addClasses(t,e)},e.prototype.render=function(){},e.prototype.syncState=function(){},e.prototype.repaint=function(){var e=this.getElement(!1);if(e)this.render(e)},e.prototype.initBehavior=function(){},e.prototype.getElement=function(e){var n=this.control.helper.getPart("layer");if(!n&&e!==!1){if(n=this.create(),this.render(n),o.addClasses(n,i(this)),this.initBehavior(n),this.control.helper.addDOMEvent(document,"mousedown",a.bind(t,this)),this.control.helper.addDOMEvent(n,"mousedown",function(e){e.stopPropagation()}),this.syncState(n),!n.parentElement)document.body.appendChild(n);this.fire("rendered")}return n},e.prototype.hide=function(){var e=i(this),t=this.getElement();o.addClasses(t,e),this.control.removeState("active"),this.fire("hide")},e.prototype.show=function(){var e=this.getElement();e.style.zIndex=this.getZIndex(),this.position();var t=i(this);o.removeClasses(e,t),this.control.addState("active"),this.fire("show")},e.prototype.toggle=function(){var e=this.getElement();if(!e||this.control.helper.isPart(e,"layer-hidden"))this.show();else this.hide()},e.prototype.position=function(){var t=this.getElement();e.attachTo(t,this.control.main,this.dock)},e.prototype.getZIndex=function(){return e.getZIndex(this.control.main)},e.prototype.dispose=function(){var e=this.getElement(!1);if(e)e.innerHTML="",o.removeNode(e);this.control=null};var s=1e3;e.create=function(e){var t=document.createElement(e||"div");return t.style.position="absolute",t},e.getZIndex=function(e){for(var t=0;!t&&e&&e!==document;)t=parseInt(o.getComputedStyle(e,"zIndex"),10),e=e.parentNode;return t=t||0,t+1},e.moveToTop=function(e){e.style.zIndex=++s},e.moveTo=function(e,t,i){n(e,{top:t,left:i})},e.resize=function(e,t,i){n(e,{width:t,height:i})},e.attachTo=function(e,t,i){i=i||{strictWidth:!1};var a=o.page.getViewWidth(),r=o.page.getViewHeight(),s=o.page.getScrollTop(),l=o.page.getScrollLeft(),h=o.getOffset(t),m=e.style.display;if(e.style.display="block",e.style.top="-5000px",e.style.left="-5000px",i.strictWidth)e.style.minWidth=h.width+"px";var V=o.getOffset(e);e.style.top="",e.style.left="",e.style.display=m;var U={},d=r-(h.bottom-s),p=h.top-s;if(d<=V.height&&p>V.height)U.top=h.top-V.height;else U.top=h.bottom;var c=a-(h.left-l),u=h.right-l;if(c<=V.width&&u>V.width)U.left=h.right-V.width;else U.left=h.left;n(e,U)},e.centerToView=function(e,t){var i=t?o.clone(t):{};if("number"!=typeof i.width)i.width=this.width;if("number"!=typeof i.height)i.height=this.height;i.left=(o.page.getViewWidth()-i.width)/2;var n=o.page.getViewHeight();if(i.height>=n&&t.hasOwnProperty("minTop"))i.top=t.minTop;else i.top=Math.floor((n-i.height)/2);var a=o.page.getViewWidth();if(i.height>=a&&t.hasOwnProperty("minLeft"))i.left=t.minLeft;else i.left=Math.floor((a-i.width)/2);i.top+=o.page.getScrollTop(),this.setProperties(i)};var l=require("mini-event/EventTarget");return o.inherits(e,l),e});