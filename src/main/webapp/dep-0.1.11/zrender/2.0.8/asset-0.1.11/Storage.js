define("zrender/Storage",["require","./tool/util","./Group"],function(require){"use strict";function e(e,t){if(e.zlevel==t.zlevel)if(e.z==t.z)return e.__renderidx-t.__renderidx;else return e.z-t.z;return e.zlevel-t.zlevel}var t=require("./tool/util"),i=require("./Group"),n={hover:!1,normal:"down",update:!1},a=function(){this._elements={},this._hoverElements=[],this._roots=[],this._shapeList=[],this._shapeListOffset=0};return a.prototype.iterShape=function(e,t){if(!t)t=n;if(t.hover)for(var i=0,a=this._hoverElements.length;a>i;i++){var r=this._hoverElements[i];if(r.updateTransform(),e(r))return this}if(t.update)this.updateShapeList();switch(t.normal){case"down":for(var a=this._shapeList.length;a--;)if(e(this._shapeList[a]))return this;break;default:for(var i=0,a=this._shapeList.length;a>i;i++)if(e(this._shapeList[i]))return this}return this},a.prototype.getHoverShapes=function(t){for(var i=[],n=0,a=this._hoverElements.length;a>n;n++){i.push(this._hoverElements[n]);var r=this._hoverElements[n].hoverConnect;if(r){var o;r=r instanceof Array?r:[r];for(var s=0,l=r.length;l>s;s++)if(o=r[s].id?r[s]:this.get(r[s]))i.push(o)}}if(i.sort(e),t)for(var n=0,a=i.length;a>n;n++)i[n].updateTransform();return i},a.prototype.getShapeList=function(e){if(e)this.updateShapeList();return this._shapeList},a.prototype.updateShapeList=function(){this._shapeListOffset=0;for(var t=0,i=this._roots.length;i>t;t++){var n=this._roots[t];this._updateAndAddShape(n)}this._shapeList.length=this._shapeListOffset;for(var t=0,i=this._shapeList.length;i>t;t++)this._shapeList[t].__renderidx=t;this._shapeList.sort(e)},a.prototype._updateAndAddShape=function(e,t){if(!e.ignore)if(e.updateTransform(),"group"==e.type){if(e.clipShape)if(e.clipShape.parent=e,e.clipShape.updateTransform(),t)t=t.slice(),t.push(e.clipShape);else t=[e.clipShape];for(var i=0;i<e._children.length;i++){var n=e._children[i];n.__dirty=e.__dirty||n.__dirty,this._updateAndAddShape(n,t)}e.__dirty=!1}else e.__clipShapes=t,this._shapeList[this._shapeListOffset++]=e},a.prototype.mod=function(e,i){if("string"==typeof e)e=this._elements[e];if(e)if(e.modSelf(),i)if(i.parent||i._storage||i.__clipShapes){var n={};for(var a in i)if("parent"!==a&&"_storage"!==a&&"__clipShapes"!==a){if(i.hasOwnProperty(a))n[a]=i[a]}else;t.merge(e,n,!0)}else t.merge(e,i,!0);return this},a.prototype.drift=function(e,t,i){var n=this._elements[e];if(n){if(n.needTransform=!0,"horizontal"===n.draggable)i=0;else if("vertical"===n.draggable)t=0;if(!n.ondrift||n.ondrift&&!n.ondrift(t,i))n.drift(t,i)}return this},a.prototype.addHover=function(e){return e.updateNeedTransform(),this._hoverElements.push(e),this},a.prototype.delHover=function(){return this._hoverElements=[],this},a.prototype.hasHoverShape=function(){return this._hoverElements.length>0},a.prototype.addRoot=function(e){if(!this._elements[e.id]){if(e instanceof i)e.addChildrenToStorage(this);this.addToMap(e),this._roots.push(e)}},a.prototype.delRoot=function(e){if("undefined"==typeof e){for(var n=0;n<this._roots.length;n++){var a=this._roots[n];if(a instanceof i)a.delChildrenFromStorage(this)}return this._elements={},this._hoverElements=[],this._roots=[],this._shapeList=[],void(this._shapeListOffset=0)}if(!(e instanceof Array)){var r;if("string"==typeof e)r=this._elements[e];else r=e;var o=t.indexOf(this._roots,r);if(o>=0)if(this.delFromMap(r.id),this._roots.splice(o,1),r instanceof i)r.delChildrenFromStorage(this)}else for(var n=0,s=e.length;s>n;n++)this.delRoot(e[n])},a.prototype.addToMap=function(e){if(e instanceof i)e._storage=this;return e.modSelf(),this._elements[e.id]=e,this},a.prototype.get=function(e){return this._elements[e]},a.prototype.delFromMap=function(e){var t=this._elements[e];if(t)if(delete this._elements[e],t instanceof i)t._storage=null;return this},a.prototype.dispose=function(){this._elements=this._renderList=this._roots=this._hoverElements=null},a});