define("zrender/mixin/Transformable",["require","../tool/matrix","../tool/vector"],function(require){"use strict";function e(e){return e>-o&&o>e}function t(e){return e>o||-o>e}var i=require("../tool/matrix"),n=require("../tool/vector"),a=[0,0],r=i.translate,o=5e-5,s=function(){if(!this.position)this.position=[0,0];if("undefined"==typeof this.rotation)this.rotation=[0,0,0];if(!this.scale)this.scale=[1,1,0,0];this.needLocalTransform=!1,this.needTransform=!1};return s.prototype={constructor:s,updateNeedTransform:function(){this.needLocalTransform=t(this.rotation[0])||t(this.position[0])||t(this.position[1])||t(this.scale[0]-1)||t(this.scale[1]-1)},updateTransform:function(){this.updateNeedTransform();var e=this.parent&&this.parent.needTransform;if(this.needTransform=this.needLocalTransform||e,this.needTransform){var n=this.transform||i.create();if(i.identity(n),this.needLocalTransform){var o=this.scale;if(t(o[0])||t(o[1])){a[0]=-o[2]||0,a[1]=-o[3]||0;var s=t(a[0])||t(a[1]);if(s)r(n,n,a);if(i.scale(n,n,o),s)a[0]=-a[0],a[1]=-a[1],r(n,n,a)}if(this.rotation instanceof Array){if(0!==this.rotation[0]){a[0]=-this.rotation[1]||0,a[1]=-this.rotation[2]||0;var s=t(a[0])||t(a[1]);if(s)r(n,n,a);if(i.rotate(n,n,this.rotation[0]),s)a[0]=-a[0],a[1]=-a[1],r(n,n,a)}}else if(0!==this.rotation)i.rotate(n,n,this.rotation);if(t(this.position[0])||t(this.position[1]))r(n,n,this.position)}if(e)if(this.needLocalTransform)i.mul(n,this.parent.transform,n);else i.copy(n,this.parent.transform);this.transform=n,this.invTransform=this.invTransform||i.create(),i.invert(this.invTransform,n)}},setTransform:function(e){if(this.needTransform){var t=this.transform;e.transform(t[0],t[1],t[2],t[3],t[4],t[5])}},lookAt:function(){var t=n.create();return function(a){if(!this.transform)this.transform=i.create();var r=this.transform;if(n.sub(t,a,this.position),!e(t[0])||!e(t[1])){n.normalize(t,t);var o=this.scale;r[2]=t[0]*o[1],r[3]=t[1]*o[1],r[0]=t[1]*o[0],r[1]=-t[0]*o[0],r[4]=this.position[0],r[5]=this.position[1],this.decomposeTransform()}}}(),decomposeTransform:function(){if(this.transform){var e=this.transform,i=e[0]*e[0]+e[1]*e[1],n=this.position,a=this.scale,r=this.rotation;if(t(i-1))i=Math.sqrt(i);var o=e[2]*e[2]+e[3]*e[3];if(t(o-1))o=Math.sqrt(o);n[0]=e[4],n[1]=e[5],a[0]=i,a[1]=o,a[2]=a[3]=0,r[0]=Math.atan2(-e[1]/o,e[0]/i),r[1]=r[2]=0}},transformCoordToLocal:function(e,t){var n=[e,t];if(this.needTransform&&this.invTransform)i.mulVector(n,this.invTransform,n);return n}},s});