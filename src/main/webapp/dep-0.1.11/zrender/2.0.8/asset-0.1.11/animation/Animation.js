define("zrender/animation/Animation",["require","./Clip","../tool/color","../tool/util","../tool/event"],function(require){"use strict";function e(e,t){return e[t]}function t(e,t,n){e[t]=n}function n(e,t,n){return(t-e)*n+e}function i(e,t,i,a,r){var o=e.length;if(1==r)for(var s=0;o>s;s++)a[s]=n(e[s],t[s],i);else for(var l=e[0].length,s=0;o>s;s++)for(var h=0;l>h;h++)a[s][h]=n(e[s][h],t[s][h],i)}function a(e){switch(typeof e){case"undefined":case"string":return!1}return"undefined"!=typeof e.length}function r(e,t,n,i,a,r,s,l,h){var d=e.length;if(1==h)for(var u=0;d>u;u++)l[u]=o(e[u],t[u],n[u],i[u],a,r,s);else for(var c=e[0].length,u=0;d>u;u++)for(var p=0;c>p;p++)l[u][p]=o(e[u][p],t[u][p],n[u][p],i[u][p],a,r,s)}function o(e,t,n,i,a,r,o){var s=.5*(n-e),l=.5*(i-t);return(2*(t-n)+s+l)*o+(-3*(t-n)-2*s-l)*r+s*a+t}function s(e){if(a(e)){var t=e.length;if(a(e[0])){for(var n=[],i=0;t>i;i++)n.push(m.call(e[i]));return n}else return m.call(e)}else return e}function l(e){return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.floor(e[2]),"rgba("+e.join(",")+")"}var h=require("./Clip"),d=require("../tool/color"),u=require("../tool/util"),c=require("../tool/event").Dispatcher,p=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,16)},m=Array.prototype.slice,f=function(e){e=e||{},this.stage=e.stage||{},this.onframe=e.onframe||function(){},this._clips=[],this._running=!1,this._time=0,c.call(this)};f.prototype={add:function(e){this._clips.push(e)},remove:function(e){var t=u.indexOf(this._clips,e);if(t>=0)this._clips.splice(t,1)},_update:function(){for(var e=(new Date).getTime(),t=e-this._time,n=this._clips,i=n.length,a=[],r=[],o=0;i>o;o++){var s=n[o],l=s.step(e);if(l)a.push(l),r.push(s)}for(var o=0;i>o;)if(n[o]._needsRemove)n[o]=n[i-1],n.pop(),i--;else o++;i=a.length;for(var o=0;i>o;o++)r[o].fire(a[o]);if(this._time=e,this.onframe(t),this.dispatch("frame",t),this.stage.update)this.stage.update()},start:function(){function e(){if(t._running)p(e),t._update()}var t=this;this._running=!0,this._time=(new Date).getTime(),p(e)},stop:function(){this._running=!1},clear:function(){this._clips=[]},animate:function(e,t){t=t||{};var n=new V(e,t.loop,t.getter,t.setter);return n.animation=this,n},constructor:f},u.merge(f.prototype,c.prototype,!0);var V=function(n,i,a,r){this._tracks={},this._target=n,this._loop=i||!1,this._getter=a||e,this._setter=r||t,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};return V.prototype={when:function(e,t){for(var n in t){if(!this._tracks[n])if(this._tracks[n]=[],0!==e)this._tracks[n].push({time:0,value:s(this._getter(this._target,n))});this._tracks[n].push({time:parseInt(e,10),value:t[n]})}return this},during:function(e){return this._onframeList.push(e),this},start:function(e){var t=this,s=this._setter,u=this._getter,c="spline"===e,p=function(){if(t._clipCount--,0===t._clipCount){t._tracks={};for(var e=t._doneList.length,n=0;e>n;n++)t._doneList[n].call(t)}},m=function(m,f){var V=m.length;if(V){var g=m[0].value,y=a(g),U=!1,b=y&&a(g[0])?2:1;m.sort(function(e,t){return e.time-t.time});var _;if(V){_=m[V-1].time;for(var v=[],k=[],x=0;V>x;x++){v.push(m[x].time/_);var L=m[x].value;if("string"==typeof L){if(L=d.toArray(L),0===L.length)L[0]=L[1]=L[2]=0,L[3]=1;U=!0}k.push(L)}var w,x,W,I,X,C,M,K=0,S=0;if(U)var T=[0,0,0,0];var D=function(e,a){if(S>a){for(w=Math.min(K+1,V-1),x=w;x>=0&&!(v[x]<=a);x--);x=Math.min(x,V-2)}else{for(x=K;V>x&&!(v[x]>a);x++);x=Math.min(x-1,V-2)}K=x,S=a;var h=v[x+1]-v[x];if(0!==h){if(W=(a-v[x])/h,c)if(X=k[x],I=k[0===x?x:x-1],C=k[x>V-2?V-1:x+1],M=k[x>V-3?V-1:x+2],y)r(I,X,C,M,W,W*W,W*W*W,u(e,f),b);else{var d;if(U)d=r(I,X,C,M,W,W*W,W*W*W,T,1),d=l(T);else d=o(I,X,C,M,W,W*W,W*W*W);s(e,f,d)}else if(y)i(k[x],k[x+1],W,u(e,f),b);else{var d;if(U)i(k[x],k[x+1],W,T,1),d=l(T);else d=n(k[x],k[x+1],W);s(e,f,d)}for(x=0;x<t._onframeList.length;x++)t._onframeList[x](e,a)}},E=new h({target:t._target,life:_,loop:t._loop,delay:t._delay,onframe:D,ondestroy:p});if(e&&"spline"!==e)E.easing=e;t._clipList.push(E),t._clipCount++,t.animation.add(E)}else;}};for(var f in this._tracks)m(this._tracks[f],f);return this},stop:function(){for(var e=0;e<this._clipList.length;e++){var t=this._clipList[e];this.animation.remove(t)}this._clipList=[]},delay:function(e){return this._delay=e,this},done:function(e){if(e)this._doneList.push(e);return this}},f});