/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/TradeChoosePanel",["require","esui/lib","esui/main","ub-ria/ui/TreeRichSelector","common/util","esui/InputControl","esui/painters","esui"],function(require){function e(){h.apply(this,arguments)}function t(e){return e.children[0].id}function i(e,t){var i=l.map(e.children,function(e){return e.id});return i.indexOf(t)}function n(e){var t=[];return l.each(l.keys(e),function(i){var n={id:i,text:e[i].name};t.push(n)}),t}function r(e,t){e.helper.clearDOMEvents(),e.helper.disposeChildren();var i=[{text:"一级行业",alias:"firstTrade"},{text:"二级行业",alias:"secondTrade"},{text:"三级行业",alias:"thirdTrade"}];l.each(i,function(i){var r={onlyLeafSelect:!0,multi:!1,width:90,height:200,hasFoot:!1,hasHead:!1,hasSearchBox:!1,datasource:{id:0,text:i.text}};if("firstTrade"===i.alias)r.datasource.children=n(t);else r.datasource.children=[];var a=document.createElement("div");a.classList.add("rich-selector-group");var o=s.create("TreeRichSelector",r);e.addChild(o,i.alias),o.appendTo(a),e.main.appendChild(a)}),e.addEvent()}function a(e,t){var i=e.childrenIndex.body.main.children[0];i.scrollTop=35*t}var o=require("esui/lib"),s=require("esui/main");require("ub-ria/ui/TreeRichSelector");var l=require("common/util"),h=require("esui/InputControl");return o.inherits(e,h),e.prototype.type="TradeChoosePanel",e.prototype.initOptions=function(e){var t={datasource:[]};if(l.extend(t,e),!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)},e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=h.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("esui/painters").createRepaint(h.prototype.repaint,{name:["datasource"],paint:r},{name:"rawValue",paint:function(e,t){t=t||[]}}),e.prototype.getDefaultValue=function(){var e=this.datasource,t=l.keys(e)[0],i=e[t].data,n=i[l.keys(i)[0]].data;return l.keys(n)[0]},e.prototype.addEvent=function(){var e=this.childrenIndex.firstTrade,t=this.childrenIndex.secondTrade;e.on("add",function(e){var t=e.item.id;this.handleFirstSelect(t)},this),t.on("add",function(e){var t=e.item.id;this.handleSecondSelect(t)},this)},e.prototype.handleFirstSelect=function(e){var i=this.childrenIndex.secondTrade,r=this.childrenIndex.thirdTrade;i.datasource={id:0,text:"二级行业",children:n(this.datasource[e].data)};var o=l.keys(this.datasource[e].data)[0];r.datasource={id:0,text:"三级行业",children:n(this.datasource[e].data[o].data)},delete i.currentSeletedId,delete r.currentSeletedId,i.refresh(),r.refresh(),i.selectItems([o],!0),r.selectItems([t(r.datasource)],!0),a(i,0),a(r,0)},e.prototype.handleSecondSelect=function(e){var i=this.childrenIndex.firstTrade,r=this.childrenIndex.thirdTrade;r.datasource={id:0,text:"三级行业",children:n(this.datasource[i.getValue()].data[e].data)},delete r.currentSeletedId,r.refresh(),r.selectItems([t(r.datasource)],!0),a(r,0)},e.prototype.getRawValue=function(){return this.childrenIndex.thirdTrade.getValue()},e.prototype.getContent=function(){var e="";return l.each(this.children,function(t){e+=t.getRawValue()[0].text+"-"}),e.slice(0,e.length-1)},e.prototype.setRawValue=function(e){var t=e.slice(0,2);this.childrenIndex.firstTrade.selectItems([t],!0),this.handleFirstSelect(t);var n=parseInt(e.slice(2,4),10)+"";this.childrenIndex.secondTrade.selectItems([n],!0),this.handleSecondSelect(n),this.childrenIndex.thirdTrade.selectItems([e],!0),l.each(this.children,function(e){a(e,i(e.datasource,e.getValue()))},this)},require("esui").register(e),e});