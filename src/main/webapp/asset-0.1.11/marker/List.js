/*! 2015 Baidu Inc. All Rights Reserved */
define("marker/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"toBegin",text:"未开始",value:0},{alias:"doing",text:"进行中",value:1},{alias:"done",text:"已完成",value:2},{alias:"closed",text:"已关闭",value:3}),exports.ModUserLevel=new e({alias:"inner",text:"内部任务",value:0},{alias:"outter",text:"外部任务",value:1}),exports}),define("marker/List",["require","esui/Toast","common/util","./enum","ub-ria/util","common/ListAction","eoo"],function(require){function e(e){this.performSearchAllKey(e)}function t(e){this.redirect("/marker/task/list~taskId="+e.data)}function i(e){this.model[e.statusName](e.ids).then(function(t){if(t.hasSuccess)e.responseList=t.data,n.call(this,e);else{var i=a.error(t.resultInfo);i.show()}}.bind(this),o.bind(this.notifyModifyFail,this,e))}function n(e){this.notifyModifySuccess(e);var t=this.fire("statusupdate",e);if(!t.isDefaultPrevented())this.reload()}function r(e){if("remove"===e.statusName)return void e.preventDefault();if("download"===e.statusName)return void e.preventDefault();else return void o.each(e.responseList,function(t){var i=this.model.getItemById(t.id);i.status=t.status>=10?s.closed:t.status,i.orignStatus=t.status,this.view.updateItem(i),e.preventDefault()},this)}var a=require("esui/Toast"),o=require("common/util"),exports={},s=require("./enum").Status;exports.group="resource",exports.entityDescription="标注任务列表",exports.initBehavior=function(){this.$super(arguments),this.view.on("searchAllKey",e,this),this.view.on("beginMarker",t,this),this.on("statusupdate",r,this)},exports.performSearchAllKey=function(e){var t=this.fire("search");if(!t.isDefaultPrevented()){var i=this.getSearchQuery();i.page=1;var n=new Date(e.end);if(e.begin===e.end&&Date.parse(n.toDateString())===o.getToday())delete e.begin,delete e.end;i.beginTime=e.begin,i.endTime=e.end,this.reloadWithQueryUpdate(i)}},exports.modifyStatus=function(e,t){var n=o.pluck(e,"id"),r=o.findWhere(this.model.getStatusTransitions(),{status:t}),a={ids:n,items:e,status:t,statusName:r.statusName,command:r.command};if(this.requireAdviceFor(a)){var s=require("ub-ria/util").pascalize(a.statusName),l="get"+s+"Advice";this.model[l](a.ids,a.items).then(o.bind(waitConfirmForAdvice,this,a)).then(o.bind(i,this,a))}else i.call(this,a)};var l=require("common/ListAction"),h=require("eoo").create(l,exports);return h});