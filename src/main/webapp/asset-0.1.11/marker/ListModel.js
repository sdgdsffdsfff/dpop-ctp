/*! 2015 Baidu Inc. All Rights Reserved */
define("marker/ListModel",["require","common/util","ub-ria/mvc/filterHelper","er/datasource","er/permission","./enum","common/ListModel","eoo"],function(require){var e=require("common/util"),t=require("ub-ria/mvc/filterHelper"),i=require("er/datasource"),n=require("er/permission"),exports={},r=require("./enum").Status,a=r.toArray();a.unshift({text:"全部状态",value:"all"});var o={statuses:i.constant(a)},s={canBatchModify:i.constant(!0)};if(n.isAllow("outerMarkerRole")||n.isAllow("outerAuditRole"))s={canBatchModify:i.constant(!1)};exports.constructor=function(){this.$super(arguments),this.putDatasource(s),this.putDatasource(o)},exports.statusTransitions=[{status:3,deny:[3],statusName:"pause",command:"关闭"},{status:0,accept:[3],statusName:"restore",command:"启用"}],exports.prepare=function(){this.$super(arguments);var t=this.get("data");t.canCreateMarker=!0,t.canBatchDownload=!0,t.canBatchClose=!1;var i=this.get("data").list;if(n.isAllow("outerMarkerRole")||n.isAllow("outerAuditRole"))t.canCreateMarker=!1,t.canBatchDownload=!1;if(n.isAllow("managerRole")||n.isAllow("innerAuditRole"))t.canBatchClose=!0;e.each(i,function(e){if(e.orignStatus=e.status,e.status>=10)e.status=r.closed})},exports.getQuery=function(){var e=this.get("beginTime"),t=this.get("endTime"),i={id:this.get("id"),beginTime:e,endTime:t,taskName:this.get("taskName"),addUser:this.get("addUser"),size:this.get("size"),keyword:this.get("keyword"),status:parseInt(this.get("status"))===r.closed?10:this.get("status"),order:this.get("order"),orderBy:this.get("orderBy"),page:this.get("page")||1};if(!i.status)i.status=this.getDefaultStatusValue();else if("all"===i.status)i.status="";return i},exports.pause=function(e){return this.updateStatus(!1,e)},exports.restore=function(e){return this.updateStatus(!0,e)},exports.getFilters=function(){var i,n;if(this.get("beginTime"))i=e.formatTime(new Date(parseInt(this.get("beginTime"))));if(this.get("endTime"))n=e.formatTime(new Date(parseInt(this.get("endTime"))));return{status:{value:this.get("status"),text:t.select.getText,datasource:this.get("statuses")},beginTime:{value:i,text:i},endTime:{value:n,text:n},id:{value:this.get("id"),text:this.get("id")},taskName:{value:this.get("taskName"),text:this.get("taskName")},addUser:{value:this.get("addUser"),text:this.get("addUser")}}};var l=require("common/ListModel"),h=require("eoo").create(l,exports);return h});