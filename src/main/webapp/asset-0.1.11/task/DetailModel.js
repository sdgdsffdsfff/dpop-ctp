/*! 2015 Baidu Inc. All Rights Reserved */
define("task/DetailModel",["require","common/util","./enum","common/GlobalData","ub-ria/mvc/BaseModel","eoo"],function(require){var e=require("common/util"),t=require("./enum").WuliaoType,i=require("./enum").DataType,n=require("common/GlobalData").getInstance(),exports={},r={detailInfo:function(e){var t=e.getQuery(),i=e.data().getDetail(t).then(function(e){return e.data});return i}},a={tradeList:function(){var e=n.getTrade().then(function(e){return e.levelThree});return e}},o={tagMap:function(){var t=n.getTrade().then(function(t){return e.formatTagmap(t.tagTypeInfo)});return t}};exports.constructor=function(){this.$super(arguments),this.putDatasource(r),this.putDatasource(a),this.putDatasource(o)},exports.prepare=function(){this.$super(arguments);var e=this.get("detailInfo");if(e){if(e.tagInfo=n.getDetailData(),this.set("attachDatasource",e.tagInfo.datasource),this.set("attachValue",e.tagInfo.value),this.set("attachOriginValue",e.tagInfo.originValue),t.fromValue(e.wuliaoType))e.wuliaoTypeText=t.fromValue(e.wuliaoType).text,e.wuliaoTypeAlias=t.fromValue(e.wuliaoType).alias;if(e.dataTypeAlias=i.fromValue(e.dataType).alias,"video"===e.wuliaoTypeAlias&&e.imgUrl&&e.imgUrl.indexOf(".flv")>=0)e.wuliaoTypeAlias="flv"}},exports.getQuery=function(){var t={id:this.get("id"),dataType:this.get("dataType"),region:this.get("region")||null};if(null===t.region)return e.omit(t,"region");else return t},exports.formatTagBoxData=function(t){var i=this.get("tagMap"),n=[],r={};e.each(t,function(t){n.push({text:t.text,name:t.name,datasource:e.assembleAttachGroupData(t.tags,i)}),r[t.name]=e.assembleAttachGroupValue(this.get("id"),t.tags,i)},this),this.set("attachDatasource",n),this.set("attachValue",r)};var s=require("ub-ria/mvc/BaseModel"),l=require("eoo").create(s,exports);return l});