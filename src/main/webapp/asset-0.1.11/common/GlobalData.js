/*! 2015 Baidu Inc. All Rights Reserved */
define("common/GlobalData",["require","underscore","er/util","ub-ria/mvc/RequestManager","er/permission","er/Deferred","./RequestStrategy"],function(require){function e(){a.apply(this,arguments)}function t(e,t){var i={};return n.each(e,function(e){if(t)i[e.text]=e.value;else i[e.value]=e.text}),i}function i(e){var t=require("er/permission"),i={outerMarkerRole:!1,outerAuditRole:!1,innerMarkerRole:!1,innerAuditRole:!1,managerRole:!1};switch(e){case"10":i.outerMarkerRole=!0;break;case"11":i.outerAuditRole=!0;break;case"1":i.innerMarkerRole=!0;break;case"2":i.innerAuditRole=!0;break;case"0":i.managerRole=!0}t.add(i)}var n=require("underscore"),r=require("er/util"),a=require("ub-ria/mvc/RequestManager");r.inherits(e,a);var o={},s={},l=null,h=null;e.prototype.getUser=function(){if(n.isEmpty(o))return this.loadUser();else return require("er/Deferred").resolved(o)},e.prototype.loadUser=function(){var e=this.request("global/user",null,{method:"GET",url:"/getCurrentUserInfo.action",urlPrefix:"ctp/user"});return e.then(function(e){return n.each(e.data,function(e,t){if("userRoleType"===t)i(e);else o[t]=e}),o})},e.prototype.getTrade=function(){if(null==l)return this.loadTrade();else return require("er/Deferred").resolved(l)},e.prototype.getDetailData=function(){return h},e.prototype.setDetailData=function(e){h=e},e.prototype.loadTrade=function(){var e=this.request("global/trade",null,{method:"GET",url:"/getAllIndustryType.do",urlPrefix:"ctp/task/group"});return e.then(function(e){return l=e.data})},e.prototype.updateUser=function(e){return this.request("global/updateUser",e,{method:"POST",url:"/modifyUserPwd.action",urlPrefix:"ctp/user"})},e.prototype.getSystem=function(){if(n.isEmpty(s))return this.loadSystem();else return require("er/Deferred").resolved(s)},e.prototype.loadSystem=function(){var e=this.request("global/system",null,{method:"GET",url:"/system"});return e.then(function(e){return n.each(e,function(e,i){s[i]=e,s[i+"Map"]=t(e,"sysVariables"===i)}),s})},e.prototype.getUserProperty=function(e){return o[e]},e.prototype.setUserProperty=function(e,t){o[e]=t},e.prototype.isSubUser=function(){return 0!==o.subUserInfoId},e.prototype.getDefaultChannel=function(){var e=o.defaultInfo.defaultChannel;return n.extend({id:parseInt(e.value,10)},e)},e.prototype.getDefaultCompany=function(){var e=o.defaultInfo.defaultCompany;return n.extend({id:parseInt(e.value,10)},e)},e.prototype.getDefaultOrder=function(){var e=o.defaultInfo.defaultOrder;return e},e.prototype.getSystemProperty=function(e){return s[e]},e.prototype.getPageSize=function(){return o.pageSize},e.prototype.updatePageSize=function(e){var t=this.request("global/pageSize",{pageSize:e},{method:"PUT",url:"/users/current/pageSize"});return t.then(function(){return o.pageSize=e,e})},e.prototype.dispose=function(){};var u={updatePageSize:{name:"global/pageSize",scope:"global",policy:"abort"},loadUser:{name:"global/user",scope:"global",policy:"abort"},loadSystem:{name:"global/system",scope:"global",policy:"abort"}};n.each(u,function(t){var i=require("ub-ria/mvc/RequestManager");i.register(e,t.name,t)});var d=new e,c=require("./RequestStrategy");return d.setRequestStrategy(new c),e.getInstance=function(){return d},e});