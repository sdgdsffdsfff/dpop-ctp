/*! 2015 Baidu Inc. All Rights Reserved */
define("common/Navigator",["require","ub-ria-sidebar","esui/lib","common/util","esui","er/permission","er/events","er/controller","mini-event/EventTarget","eoo"],function(require){function e(){a.toggleClass(a.g("main"),"navigator-collapsed-main"),a.toggleClass(a.g("header"),"navigator-collapsed-header"),a.toggleClass(a.g("foot"),"navigator-collapsed-foot"),this.fire("layoutchanged");var e=u.currentAction;if(e&&e.view.viewContext){var t=e.view.get("table")||e.view.table;if(t)t.adjustWidth()}}function t(e){var t=e.target.getAttribute("href")||e.target.parentElement.getAttribute("href");if(t){var i=h.fire("navigatorChange",{url:t});if(i.isDefaultPrevented())e.preventDefault()}}function i(e,t,i){i=i||"";var r=[t,i].join("/"),a=o.partial(n,t,r),s=o.deepClone(d[e]),l=o.find(s,function(e){if(e.items){var t=o.find(e.items,a);if(t)e.activeItem=t.id;return t}return a(e)});return l?{activeItems:[l.id,l.activeItem],expandItem:l.id,collapsed:!0}:{activeItems:["dashboard"],collapsed:!0}}function n(e,t,i){if(i.id===e&&o.indexOf(i.omit,t)>=0)return!1;else if(i.id!==e&&o.indexOf(i.plus,t)>=0)return!0;return i.id===e}function r(e){function t(e){if(e.items)if(e.items=o.filter(e.items,function(e){return t(e)}),0===e.items.length)return!1;else e.url=e.items[0].url;return!0}var i=o.deepClone(d[e]);return i=o.filter(i,function(e){return t(e)})}require("ub-ria-sidebar");var a=require("esui/lib"),o=require("common/util"),s=require("esui"),l=require("er/permission"),h=require("er/events"),u=require("er/controller"),d={marker:[{id:"marker",text:"标注任务",url:"#/marker/list",isLeaf:!0,expanded:!1}]};if(!l.isAllow("outerMarkerRole"))d.marker.push({id:"audit",text:"审核任务",url:"#/audit/list",isLeaf:!0,expanded:!1});if(l.isAllow("managerRole"))d.marker.push({id:"permission",text:"权限管理",isLeaf:!0,expanded:!1,url:"#/permission/list"},{id:"log",text:"操作日志",isLeaf:!0,expanded:!1,url:"#/log/user/list"});var exports={};exports.constructor=function(){this.renderSidebar(),this.bindEvents()},exports.renderSidebar=function(){var t=s.create("Sidebar",{main:a.g("sidebar"),toggleBtn:"toggle-navigator"});t.render(),t.on("modechanged",o.bind(e,this)),this.sidebar=t},exports.bindEvents=function(){var e=this.sidebar;e.helper.addDOMEvent(e.main,"click",t),h.on("enteraction",function(t){if(!t.isChildAction&&"error"!==t.action.group){var n="marker",a=r(n);e.set("datasource",a);var o=t.args.url.getPath(),s=o.split("/")[1],l=o.split("/")[2],h=i(n,s,l);e.setProperties(h)}})},exports.getSidebar=function(){return this.sidebar},exports.addControl=function(e,t){var i=this.getSidebar();i.setContents([{id:e,control:t}])};var c=require("mini-event/EventTarget"),p=require("eoo").create(c,exports),f=null;return p.getInstance=function(){if(null===f)f=new p;return f},p});