/*! 2015 Baidu Inc. All Rights Reserved */
define("ub-ria/mvc/RequestManager",["require","underscore","er/util","er/ajax"],function(require){function e(e,t){this.entityName=e,this.backendEntityName=t,this.runningRequests={}}function t(e,t){if(!t)return null;var i=r.findWhere(o,{type:e.constructor});return i&&i.config[t]||s[t]||null}function i(e,t,i){var n=e.runningRequests[t.name];if(n){var a=t.policy;if("auto"===a){var o=i.method.toUpperCase();a=r.isEqual(i,n.options)?"reuse":"GET"===o||"PUT"===o?"parallel":"abort"}switch(a){case"reuse":return n.xhr;case"abort":return void n.xhr.abort();default:return}}}function n(e,t,i){if(e.runningRequests&&e.runningRequests[t]&&e.runningRequests[t].xhr===i)e.runningRequests[t]=null;if(l&&l[t]&&l[t].xhr===i)l[t]=null}var r=require("underscore"),a=require("er/util"),o=[],s={},l={};e.register=function(e,t,i){var n={name:t,scope:"instance",policy:"auto"};if(i=a.mix(n,i),"instance"===i.scope){var l=r.findWhere(o,{type:e});if(!l)l={type:e,config:{}},o.push(l);var u=l.config;if(u.hasOwnProperty(t))throw new Error('An instance request config "'+t+'" has already been registered');u[t]=i}else{if(s.hasOwnProperty(t))throw new Error('A global request config "'+t+'" has already been registered');s[t]=i}},e.prototype.getEntityName=function(){return this.entityName||""},e.prototype.getBackendEntityName=function(){return this.backendEntityName||this.getEntityName()},e.prototype.setRequestStrategy=function(e){this.requestStrategy=e},e.prototype.getRequestStrategy=function(){return this.requestStrategy},e.prototype.getRequest=function(e,i,n){var r=this.getRequestStrategy();if("string"!=typeof e)n=e,e=null;e=r.formatName(e,n);var o=t(this,e);if(n=a.mix({},o&&o.options,n),"function"==typeof i)i=i(this,n);if("function"==typeof n.data)n.data=n.data(this,n);if(i)n.data=a.mix({},n.data,i);n=r.formatOptions(n);var s={name:e,options:n,config:o};if(s.options.url)s.options.url=r.formatURL(s.options.url,s.options);return s};var u=require("er/ajax");return e.prototype.request=function(e,t,a){var o=this.getRequest(e,t,a);if(!o.config)return u.request(o.options);var s=i(this,o.config,o.options);if(!s)if(s=u.request(o.options),e){var h="instance"===o.config.scope?this.runningRequests:l;h[e]={options:o.options,xhr:s};var d=r.partial(n,this,o.name,s);s.ensure(d)}return s},e.prototype.dispose=function(){r.each(this.runningRequests,function(e){e&&e.xhr.abort()}),this.runningRequests=null},e.prototype.search=function(){throw new Error("search method is not implemented")},e.prototype.list=function(){throw new Error("list method is not implemented")},e.prototype.save=function(){throw new Error("save method is not implemented")},e.prototype.update=function(){throw new Error("update method is not implemented")},e.prototype.updateStatus=function(){throw new Error("updateStatus method is not implemented")},e.prototype.remove=r.partial(e.prototype.updateStatus,0),e.prototype.restore=r.partial(e.prototype.updateStatus,1),e.prototype.getAdvice=function(){throw new Error("getAdvice method is not implemented")},e.prototype.getRemoveAdvice=r.partial(e.prototype.getAdvice,0),e.prototype.getRestoreAdvice=r.partial(e.prototype.getAdvice,1),e.prototype.findById=function(){throw new Error("findById method is not implemented")},e}),define("ub-ria/util",["require","underscore"],function(require){var e=require("underscore"),t={},i={};return i.purify=function n(i,r,a){r=r||t;var o={};return e.each(i,function(e,t){var i=null==e||""===e,s=r.hasOwnProperty(t)&&r[t]===e;if(!i&&!s)if(a&&"object"==typeof e)o[t]=n(e,r[t],a);else o[t]=e}),o},i.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},i.pascalize=function(e){if(e+="",/^[A-Z\-_]$/.test(e))e=e.toLowerCase();return e=e.replace(/[\s-\/_]+(.)/g,function(e,t){return t.toUpperCase()}),e=e.charAt(0).toUpperCase()+e.slice(1)},i.pascalize=e.memoize(i.pascalize),i.camelize=function(e){return e=i.pascalize(e),e.charAt(0).toLowerCase()+e.slice(1)},i.camelize=e.memoize(i.camelize),i.dasherize=function(e){if(e=i.pascalize(e),e=e.replace(/[A-Z]{2,}$/g,function(e){return e.charAt(0)+e.slice(1).toLowerCase()}),e=e.replace(/[A-Z]{2,}/g,function(e){return e.charAt(0)+e.slice(1,-1).toLowerCase()+e.charAt(e.length-1)}),e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),"-"===e.charAt(0))e=e.substring(1);return e},i.dasherize=e.memoize(i.dasherize),i.constlize=function(e){return e=i.pascalize(e),e.toUpperCase()},i.constlize=e.memoize(i.constlize),i.pluralize=function(e){return e.replace(/y$/,"ie")+"s"},i.pluralize=e.memoize(i.pluralize),i.formatNumber=function(e,t,i,n){if("number"!=typeof arguments[1])n=arguments[2],i=arguments[1],t=0;if(n=n||"",i=i||"",null==e||isNaN(e))return n+i;e=parseFloat(e).toFixed(t);var r=e.split("."),a=r[0],o=r[1];a=a.replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");var s=n+a;if(o)s+="."+o;return s},i.pad=function(e,t,i){e+="";var n=i-e.length;if(n>0){var r=new Array(n+1).join(t);return r+e}else return e},i.padRight=function(e,t,i){e+="";var n=i-e.length;if(n>0){var r=new Array(n+1).join(t);return e+r}else return e},i.deepClone=function(t){if(!e.isObject(t)||e.isFunction(t)||e.isRegExp(t))return t;if(e.isArray(t))return e.map(t,i.deepClone);var n={};return e.each(t,function(e,t){n[t]=i.deepClone(e)}),n},i}),define("common/util",["require","underscore","ub-ria/util"],function(require){function e(e){return 10>e?"0"+e:e}var t=require("underscore"),i=function(){};i.prototype=t;var n=new i;return n.formatTime=function(t){var i=t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate());return i},n.formatTimeToSecond=function(t){var i=this.formatTime(t);return i+=" "+e(t.getHours())+":"+e(t.getMinutes()+1)+":"+e(t.getSeconds())},n.formatTimeString=function(t){var i=t.getFullYear()+""+e(t.getMonth()+1)+e(t.getDate());return i},n.getToday=function(){var e=new Date;return Date.parse(e.toDateString())},n.getIndexOfList=function(e,t,i){var n=-1;return e.forEach(function(e,r){if(e[t]===i)n=r}),n},n.hasClass=function(e,t){return this.find(e.classList,function(e){return e===t})},n.formatTagmap=function(e){var t={};return this.each(this.keys(e),function(i){t[i]={},this.each(this.keys(e[i]),function(n){var r="";if("name_ch"===n)r="text";else if("name"===n)r="alias";else if("tags"===n)r="source";else r=n;t[i][r]=this.clone(e[i][n])},this)},this),t},n.assembleAttachGroupData=function(e,t){var i=this.map(this.keys(e),function(e){return t[e]});return this.sortBy(i,"priority")},n.assembleAttachGroupValue=function(e,t,i){var n={};return this.each(this.keys(t),function(r){var a=t[r];if("batch"===e)n[r]=i[r].defaultValue;else n[r]="0"===a?i[r].defaultValue:a}),n},n.extend(n,require("ub-ria/util")),n}),define("ub-ria/mvc/RequestStrategy",["require"],function(){function e(){}return e.prototype.formatName=function(e){return e},e.prototype.formatURL=function(e){return e},e.prototype.formatOptions=function(e){if(!e.dataType)e.dataType="json";return e},e}),define("common/RequestStrategy",["require","common/util","eoo","ub-ria/mvc/RequestStrategy"],function(require){var e="/",t=require("common/util"),i={};i.constructor=function(e,t){this.setEntityName(e),this.setBackendEntityName(t)},i.getEntityName=function(){return this.entityName||""},i.setEntityName=function(e){this.entityName=e},i.getBackendEntityName=function(){return this.backendEntityName||this.getEntityName()},i.setBackendEntityName=function(e){this.backendEntityName=e},i.formatName=function(e){return e.replace(/\$entity/g,this.getEntityName())},i.formatURL=function(i,n){i=i.replace(/\$entity/g,t.pluralize(this.getBackendEntityName()));var r=n.urlPrefix||e;if(0!==i.indexOf(r))i=r+i;return i},i.formatOptions=function(e){if(!e.dataType)e.dataType="json";if("GET"!==e.method.toUpperCase()&&!e.contentType)e.contentType="json";return e};var n=require("eoo").create(require("ub-ria/mvc/RequestStrategy"),i);return n}),define("common/GlobalData",["require","underscore","er/util","ub-ria/mvc/RequestManager","er/permission","er/Deferred","./RequestStrategy"],function(require){function e(){a.apply(this,arguments)}function t(e,t){var i={};return n.each(e,function(e){if(t)i[e.text]=e.value;else i[e.value]=e.text}),i}function i(e){var t=require("er/permission"),i={outerMarkerRole:!1,outerAuditRole:!1,innerMarkerRole:!1,innerAuditRole:!1,managerRole:!1};switch(e){case"10":i.outerMarkerRole=!0;break;case"11":i.outerAuditRole=!0;break;case"1":i.innerMarkerRole=!0;break;case"2":i.innerAuditRole=!0;break;case"0":i.managerRole=!0}t.add(i)}var n=require("underscore"),r=require("er/util"),a=require("ub-ria/mvc/RequestManager");r.inherits(e,a);var o={},s={},l=null,u=null;e.prototype.getUser=function(){if(n.isEmpty(o))return this.loadUser();else return require("er/Deferred").resolved(o)},e.prototype.loadUser=function(){var e=this.request("global/user",null,{method:"GET",url:"/getCurrentUserInfo.action",urlPrefix:"ctp/user"});return e.then(function(e){return n.each(e.data,function(e,t){if("userRoleType"===t)i(e);else o[t]=e}),o})},e.prototype.getTrade=function(){if(null==l)return this.loadTrade();else return require("er/Deferred").resolved(l)},e.prototype.getDetailData=function(){return u},e.prototype.setDetailData=function(e){u=e},e.prototype.loadTrade=function(){var e=this.request("global/trade",null,{method:"GET",url:"/getAllIndustryType.do",urlPrefix:"ctp/task/group"});return e.then(function(e){return l=e.data})},e.prototype.updateUser=function(e){return this.request("global/updateUser",e,{method:"POST",url:"/modifyUserPwd.action",urlPrefix:"ctp/user"})},e.prototype.getSystem=function(){if(n.isEmpty(s))return this.loadSystem();else return require("er/Deferred").resolved(s)},e.prototype.loadSystem=function(){var e=this.request("global/system",null,{method:"GET",url:"/system"});return e.then(function(e){return n.each(e,function(e,i){s[i]=e,s[i+"Map"]=t(e,"sysVariables"===i)}),s})},e.prototype.getUserProperty=function(e){return o[e]},e.prototype.setUserProperty=function(e,t){o[e]=t},e.prototype.isSubUser=function(){return 0!==o.subUserInfoId},e.prototype.getDefaultChannel=function(){var e=o.defaultInfo.defaultChannel;return n.extend({id:parseInt(e.value,10)},e)},e.prototype.getDefaultCompany=function(){var e=o.defaultInfo.defaultCompany;return n.extend({id:parseInt(e.value,10)},e)},e.prototype.getDefaultOrder=function(){var e=o.defaultInfo.defaultOrder;return e},e.prototype.getSystemProperty=function(e){return s[e]},e.prototype.getPageSize=function(){return o.pageSize},e.prototype.updatePageSize=function(e){var t=this.request("global/pageSize",{pageSize:e},{method:"PUT",url:"/users/current/pageSize"});return t.then(function(){return o.pageSize=e,e})},e.prototype.dispose=function(){};var h={updatePageSize:{name:"global/pageSize",scope:"global",policy:"abort"},loadUser:{name:"global/user",scope:"global",policy:"abort"},loadSystem:{name:"global/system",scope:"global",policy:"abort"}};n.each(h,function(t){var i=require("ub-ria/mvc/RequestManager");i.register(e,t.name,t)});var d=new e,c=require("./RequestStrategy");return d.setRequestStrategy(new c),e.getInstance=function(){return d},e}),define("common/account",["require","er/permission","./GlobalData"],function(require){function e(){var e=require("./GlobalData").getInstance(),n=e.getUser();if(n.then(t),!i.isAllow("outerAuditRole")&&!i.isAllow("outerMarkerRole"))document.getElementById("password").parentNode.style.display="none"}function t(e){var t=e.userName,i=document.getElementById("username");i.innerHTML=t}var i=require("er/permission");return{init:e}}),define("common/ActionFactory",["require","common/util","er/Deferred","eoo"],function(require){var e=require("common/util"),t=require("er/Deferred"),i={};i.constructor=function(e,t){t=t||{},this.actionModule=e,this.entityName=t.entityName||e.split("/")[0],this.backendEntityName=t.backendEntityName||this.entityName,this.noSchema=t.noSchema||!1},i.getBaseModuleName=function(){return this.actionModule.replace(/\/[^\/]*$/,"")},i.getModules=function(){var e=this.getBaseModuleName();return[this.actionModule,this.actionModule+"Model",this.actionModule+"View",e+"/Data","common/RequestStrategy","common/GlobalData","common/session"]},i.getViewName=function(t){var i=e.compact(t.url.toString().split("/")),n=i[i.length-1];if("create"===n||"update"===n)i[i.length-1]="form";return e.map(i,e.dasherize).join("-")},i.createRuntimeAction=function(i){var n=this.getModules();return t.require(n).then(e.bind(this.buildAction,this,i))},i.buildAction=function(){var e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4],a=arguments[5],o=arguments[6],s=arguments[7],l=new t;l.model=new i;var u=new r,h=new a(this.entityName,this.backendEntityName);if(u.setRequestStrategy(h),l.model.setData(u),l.model.setGlobalData)l.model.setGlobalData(o.getInstance());if(l.view=new n,l.view.name=this.getViewName(e),l.setSession)l.setSession(s);return l};var n=require("eoo").create(i);return n}),define("ef/ActionPanel",["require","er/events","esui/Panel","mini-event","er/Deferred","esui/painters","er/controller","eoo","esui"],function(require){function e(e){var t=require("mini-event").fromEvent(e,{preserveData:!0,syncState:!0});t.type="action@"+e.type,this.fire(t)}function t(t){if(t.isChildAction&&t.container===this.main.id){if(this.action=t.action,"function"==typeof this.action.on)this.action.on("*",e,this);this.fire("actionattach")}}function i(e){if(e.isChildAction&&e.container===this.main.id)this.fire("actionloaded")}function n(e){if(e.isChildAction&&e.container===this.main.id)this.action=null,this.fire("actionloadfail",{failType:e.failType,reason:e.reason})}function r(e){if(e.isChildAction&&e.container===this.main.id)this.fire("actionloadabort")}var a=require("er/events"),o=require("esui/Panel"),exports={};exports.type="ActionPanel",exports.setContent=function(){},exports.actionType=null,exports.action=null,exports.initStructure=function(){a.on("enteraction",t,this),a.on("enteractioncomplete",i,this),a.on("actionnotfound",n,this),a.on("permissiondenied",n,this),a.on("actionfail",n,this),a.on("enteractionfail",n,this),a.on("actionabort",r,this)},exports.disposeAction=function(){var t=require("er/Deferred"),i=this.action;if(i){if(t.isPromise(i)&&"function"==typeof i.abort)i.abort();else{if("function"==typeof i.un)i.un("*",e,this);if("function"==typeof i.leave)i.leave()}this.action=null}},exports.repaint=require("esui/painters").createRepaint(o.prototype.repaint,{name:["url","actionOptions"],paint:function(e,t,i){if(e.disposeAction(),t)if(!e.lazy||!e.helper.isInStage("INITED")){var n=require("er/controller");if(e.action=n.renderChildAction(t,e.main.id,i),"function"!=typeof e.action.abort)e.action=null}}}),exports.dispose=function(){this.disposeAction(),a.un("enteraction",t,this),a.un("enteractioncomplete",i,this),a.un("actionnotfound",n,this),a.un("permissiondenied",n,this),a.un("actionfail",n,this),a.un("enteractionfail",n,this),a.un("actionabort",r,this),this.$super(arguments)},exports.reload=function(e){var t=this.url;this.url=null,this.setProperties({url:t,actionOptions:e})};var s=require("eoo").create(o,exports);return require("esui").register(s),s}),define("ef/ActionDialog",["require","esui/main","esui/Dialog","./ActionPanel","mini-event","esui/painters","eoo","esui"],function(require){var e=require("esui/main"),t=require("esui/Dialog");require("./ActionPanel");var exports={};exports.type="ActionDialog",exports.styleType="Dialog",exports.setContent=function(){},exports.createBF=function(t,i){if(i)this.content=i.innerHTML;else i=document.createElement("div"),this.main.appendChild(i);this.helper.addPartClasses(t+"-panel",i);var n={main:i},r="Panel";if("body"===t)n.url=this.url,n.actionOptions=this.actionOptions,r="ActionPanel";var a=e.create(r,n);if("body"===t){a.on("actionattach",function(){if(this.resize(),this.autoClose){var e=this.get("action");if("function"==typeof e.on)e.on("handlefinish",!1),e.on("handlefinish",this.dispose,this)}this.fire("actionattach")},this),a.on("*",function(e){if(0===e.type.indexOf("action@"))this.fire(e)},this);var o=require("mini-event");o.delegate(a,this,"actionloaded"),o.delegate(a,this,"actionloadfail"),o.delegate(a,this,"actionloadabort")}return a.render(),this.addChild(a,t),a},exports.repaint=require("esui/painters").createRepaint(t.prototype.repaint,{name:["url","actionOptions"],paint:function(e,t,i){var n=e.getBody(),r={url:t,actionOptions:i};n.setProperties(r)}}),exports.getAction=function(){var e=this.getBody();if(e)return e.get("action");else return null},exports.reload=function(){var e=this.getBody();if(e)e.reload()};var i=require("eoo").create(t,exports);return require("esui").register(i),i}),define("ef/UIView",["require","underscore","er/View","ef/ActionDialog","esui","esui/Dialog","esui/main","esui/ViewContext","eoo"],function(require){function e(e,t){for(var i=e,n=0;n<t.length;n++)i=i[t[n]];return i}function t(e,t,i,n){if("string"==typeof n)n=e[n];if("function"!=typeof n)return n;var r=e.get(t);if(r)r.on(i,n,e);return n}function i(){return"ef-"+a++}var n=require("underscore"),r=require("er/View");require("ef/ActionDialog");var exports={};exports.replaceValue=function(t){if("string"!=typeof t)return t;if("@@"===t||"**"===t)return this.model;var i=t.charAt(0),n=t.substring(1);if("@"===i||"*"===i){var r=n.split("."),t=this.model.get(r[0]);return r.length>1?e(t,r.slice(1)):t}else return t},exports.get=function(e){return this.viewContext.get(e)},exports.getSafely=function(e){return this.viewContext.getSafely(e)},exports.getGroup=function(e){return this.viewContext.getGroup(e)},exports.create=function(e,t){if(t=t||{},!t.viewContext)t.viewContext=this.viewContext;return require("esui").create(e,t)},exports.alert=function(e,t){var i="string"==typeof e?{title:t||document.title,content:e}:n.clone(e);if(!i.viewContext)i.viewContext=this.viewContext;var r=require("esui/Dialog");return r.alert(i)},exports.confirm=function(e,t){var i="string"==typeof e?{title:t||document.title,content:e}:n.clone(e);if(!i.viewContext)i.viewContext=this.viewContext;var r=require("esui/Dialog");return r.confirm(i)},exports.popActionDialog=function(e){var t=document.createElement("div");document.body.appendChild(t);var i={width:600,needFoot:!1,draggable:!0,closeOnHide:!0,autoClose:!0,main:t,viewContext:this.viewContext};e=n.defaults({},e,i);var r=require("esui/main"),a=r.create("ActionDialog",e);return a.render(),a.show(),a},exports.uiEvents=null,exports.getUIEvents=function(){return this.uiEvents||{}},exports.uiProperties=null,exports.getUIProperties=function(){return this.uiProperties},exports.bindEvents=function(){var e=this.getUIEvents();if(e)for(var i in e)if(e.hasOwnProperty(i)){var n=i.split(":");if(n.length>1){var r=n[0],a=n[1],o=e[i];t(this,r,a,o)}else{var s=e[i];if("object"!=typeof s)return;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];t(this,i,a,o)}}}else;};var a=8785925;exports.getViewName=function(){if(this.name)return this.name;var e=this.constructor&&this.constructor.name;if(!e&&this.constructor){var t=this.constructor.toString(),n=/function\s+([^\(]*)/.exec(t);e=n&&n[1].replace(/\s+$/g,"")}if(!e)e=i();if(e=e.replace(/View$/,""),e=e.replace(/[A-Z]{2,}/g,function(e){return e.charAt(0)+e.slice(1,-1).toLowerCase()+e.charAt(e.length-1)}),e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),"-"===e.charAt(0))e=e.substring(1);return e},exports.createViewContext=function(){var e=require("esui/ViewContext"),t=this.getViewName();return new e(t||null)},exports.enterDocument=function(){this.viewContext=this.createViewContext();var e=this.getContainerElement(),t={viewContext:this.viewContext,properties:this.getUIProperties(),valueReplacer:n.bind(this.replaceValue,this)};try{require("esui").init(e,t)}catch(i){var r=new Error("ESUI initialization error on view because: "+i.message);throw r.actualError=i,r}this.bindEvents()},exports.dispose=function(){if(this.viewContext)this.viewContext.dispose(),this.viewContext=null;this.$super(arguments)};var o=require("eoo").create(r,exports);return o}),define("common/BaseChildView",["require","common/util","esui/validator/Validity","esui/validator/ValidityState","eoo","ef/UIView"],function(require){function e(e){var t=e.getCategory();return"input"===t||"check"===t}var t=require("common/util"),exports={};exports.getViewData=function(){for(var e={},t=this.getAllInputControls(),i=0;i<t.length;i++){var n=t[i];if("check"!==n.getCategory()||n.isChecked())if(!n.isDisabled()){var r=n.get("name"),a=n.getRawValue();if(e.hasOwnProperty(r))e[r]=[].concat(e[r],a);else e[r]=a}else;else;}return e},exports.setViewData=function(e){t.each(e,function(e,i){var n=t.dasherize(i);this.get(n).set("rawValue",e)},this)},exports.disableInputControls=function(){var e=this.getAllInputControls();t.each(e,function(e){if(t.isFunction(e.disable))e.disable()})},exports.enableInputControls=function(){var e=this.getAllInputControls();t.each(e,function(e){if(t.isFunction(e.enable))e.enable()})},exports.setReadOnly=function(e){var i=this.getAllInputControls();t.each(i,function(i){if(t.isFunction(i.setReadOnly))i.setReadOnly(e)})},exports.notifyErrors=function(e){for(var i=require("esui/validator/Validity"),n=require("esui/validator/ValidityState"),r=0;r<e.length;r++){var a=e[r],o=new n(!1,a.message),s=new i;s.addState("server",o);var l=t.dasherize(a.field),u=this.get(l);if(u)u.showValidity(s)}},exports.validate=function(){for(var e=this.getAllInputControls(),t=!0,i=0;i<e.length;i++){var n=e[i];if(!n.isDisabled())t&=n.validate();else;}return!!t},exports.getAllInputControls=function(){var i=this.viewContext.getControls(),n=[];return t.each(i,function(t){if(e(t))n.push(t)}),n};var i=require("eoo").create(require("ef/UIView"),exports);return i}),define("common/BaseData",["require","er/util","underscore","ub-ria/mvc/RequestManager"],function(require){function e(){n.apply(this,arguments)}var t=require("er/util"),i=require("underscore"),n=require("ub-ria/mvc/RequestManager");return t.inherits(e,n),e.prototype.search=function(e){return this.request("$entity/search",e,{method:"GET",url:"/$entity"})},e.prototype.list=function(e){return this.request("$entity/list",e,{method:"GET",url:"/$entity/list"})},e.prototype.nakedList=function(e){return this.list(e).then(function(e){return e.data.results||[]})},e.prototype.tree=function(e){return this.request("$entity/tree",e,{method:"GET",url:"/$entity/tree"})},e.prototype.save=function(e){return this.request("$entity/save",e,{method:"POST",url:"/$entity"})},e.prototype.update=function(e){var t=i.omit(e,"id");return this.request("$entity/update",t,{method:"PUT",url:"/$entity/"+e.id})},e.prototype.updateStatus=function(e,t,i){return this.request("$entity/"+e,{ids:i,status:t},{method:"POST",url:"/$entity/status"})},e.prototype.getAdvice=function(e,t,i){return this.request("$entity/"+e+"/advice",{ids:i,status:t},{method:"GET",url:"/$entity/status/advice"})},e.prototype.findById=function(e){return this.request("$entity/findById",null,{method:"GET",url:"/$entity/"+e})},e.prototype.remove=function(e){return this.updateStatus("delete",0,e)},e}),define("ub-ria/tpl",["require","er/ajax","etpl","./util"],function(require){function e(e){for(var t=[],i={},n=/<\s*esui-([\w-]+)[^>]*>|data-ui-type="(\w+)"/g,r=n.exec(e);r;){var s=r[1]&&a.pascalize(r[1])||r[2];if(!i[s]){i[s]=!0;var l=(o[s]||"ui")+"/";t.push(l+s)}r=n.exec(e)}return t}function t(e){for(var t=[],i={},n=/data-ui-extension-[^-]+-type="(\w+)"/g,r=n.exec(e);r;){var a=r[1];if(!i[a]){i[a]=!0;var o=(s[a]||"ui/extension")+"/";t.push(o+a)}r=n.exec(e)}return t}var i=require("er/ajax"),n=require("etpl"),r=n,a=require("./util");r.addFilter("trim",a.trim),r.addFilter("pascalize",a.pascalize),r.addFilter("camelize",a.camelize),r.addFilter("dasherize",a.dasherize),r.addFilter("constlize",a.constlize),r.addFilter("pluralize",a.pluralize);var o={BoxGroup:"esui",Button:"esui",Calendar:"esui",CheckBox:"esui",CommandMenu:"esui",Crumb:"esui",Dialog:"esui",Form:"esui",Frame:"esui",Label:"esui",Link:"esui",MonthView:"esui",Pager:"esui",Panel:"esui",RangeCalendar:"esui",Region:"esui",RichCalendar:"esui",Schedule:"esui",SearchBox:"esui",Select:"esui",Tab:"esui",Table:"esui",TextBox:"esui",TextLine:"esui",Tip:"esui",TipLayer:"esui",Tree:"esui",Validity:"esui",Wizard:"esui",ActionPanel:"ef",ActionDialog:"ef",ViewPanel:"ef",TogglePanel:"ub-ria/ui",ToggleButton:"ub-ria/ui",Uploader:"ub-ria/ui",RichSelector:"ub-ria/ui",TableRichSelector:"ub-ria/ui",SelectorTreeStrategy:"ub-ria/ui",TreeRichSelector:"ub-ria/ui",AbstractBoxGroup:"ub-ria/ui",Sidebar:"ub-ria/ui",PartialForm:"ub-ria/ui"},s={AutoSort:"esui/extension",Command:"esui/extension",CustomData:"esui/extension",TableEdit:"esui/extension",AutoSubmit:"ub-ria/ui/extension",TableTip:"ub-ria/ui/extension",ExternSearch:"ub-ria/ui/extension",ExternSelect:"ub-ria/ui/extension",TableSubrow:"esui/extension",WordCount:"ub-ria/ui/extension"},l={setupTemplateEngine:function(e){r=e||n},load:function(n,a,o){function s(i){r.parse(i);var n=e(i),a=t(i),s=n.concat(a);window.require(s,function(){o(i)})}var l={method:"GET",url:a.toUrl(n),cache:!0,dataType:"text"};i.request(l).then(s)},registerControl:function(e){var t=e.lastIndexOf("/"),i=e.substring(0,t),n=e.substring(t+1);o[n]=i},registerExtension:function(e){var t=e.lastIndexOf("/"),i=e.substring(0,t),n=e.substring(t+1);s[n]=i}};return l}),define("tpl",["require","ub-ria/tpl"],function(require){var e=require("ub-ria/tpl");return e}),define("common/tpl",["tpl"],function(e){return e}),define("ef/UIModel",["require","er/Model","eoo"],function(require){function e(e){return e+="",1===e.length?"0"+e:e}var t=require("er/Model"),exports={},i={date:function(t){return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())},dateRange:function(e){return i.date(e.begin)+","+i.date(e.end)},time:function(t){return i.date(t)+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())},timeRange:function(e){return i.time(e.begin)+","+i.time(e.end)}};exports.formatters={},exports.set=function(e,t,i){if(this.formatters.hasOwnProperty(e))t=this.formatters[e](t);this.$super([e,t,i])},exports.fill=function(e){for(var t in e)if(e.hasOwnProperty(t)&&this.formatters.hasOwnProperty(t)){var i=this.formatters[t],n=e[t];e[t]=i(n)}this.$super(arguments)},exports.getPart=function(e){if("[object Array]"!==Object.prototype.toString.call(e))e=[].slice.call(arguments);for(var t={},i=0;i<e.length;i++){var n=e[i];t[n]=this.get(n)}return t};var n=require("eoo").create(t,n);return n.formatters=i,n}),define("ub-ria/mvc/BaseModel",["require","underscore","er/util","ef/UIModel"],function(require){function e(){n.apply(this,arguments)}var t=require("underscore"),i=require("er/util"),n=require("ef/UIModel");return i.inherits(e,n),e.prototype.addData=function(e,t){if(!this.dataPool)this.dataPool={};if(arguments.length<2)t=e,e="default";if(!e)e="default";if(!this.dataPool[e])this.dataPool[e]=t},e.prototype.setData=function(e){this.addData(e)},e.prototype.data=function(e){if(!e)e="default";return this.dataPool[e]||null},e.prototype.putDatasource=function(e,i){if(e=t.clone(e),!this.datasource)this.datasource=[];else if(!t.isArray(this.datasource))this.datasource=[this.datasource];if(void 0===i)this.datasource.push(e);else{var n=this.datasource[i]||{};if(t.isArray(n))n.push(e);else t.extend(n,e);this.datasource[i]=n}},e.prototype.dispose=function(){n.prototype.dispose.apply(this,arguments),t.each(this.dataPool,function(e){e.dispose()}),this.dataPool=null},e}),define("ub-ria/mvc/BaseAction",["require","er/util","underscore","er/Action","../util","er/Model","./BaseModel"],function(require){function e(e){n.apply(this,arguments),this.entityName=e}var t=require("er/util"),i=require("underscore"),n=require("er/Action");return t.inherits(e,n),e.prototype.getEntityName=function(){if(!this.entityName){var e=this.context.url.getPath();this.entityName=e.split("/")[1]}return this.entityName},e.prototype.entityDescription="",e.prototype.getEntityDescription=function(){return this.entityDescription||""},e.prototype.group="",e.prototype.getGroup=function(){return this.group},e.prototype.category="",e.prototype.getCategory=function(){return this.category||""},e.prototype.getPageCategories=function(){var e=[],t=require("../util").dasherize(this.getCategory()),i=require("../util").dasherize(this.getEntityName());if(t)e.push(t+"-page");if(i)e.push(i+"-page");if(t&&i)e.push(i+"-"+this.category+"-page");return e},e.prototype.createModel=function(e){e.entityDescription=this.getEntityDescription();var t=n.prototype.createModel.apply(this,arguments),r=require("er/Model");if(!(t instanceof r)&&i.isEmpty(t)){var a=require("./BaseModel"),o=this.getEntityName();t=new a(o,e)}return t},e.prototype.setModel=function(e){e.set("entityDescription",this.getEntityDescription()),this.model=e},e}),define("error/Action",["require","ub-ria/mvc/BaseAction","er/Model","er/util","er/config"],function(require){function e(){t.apply(this,arguments)}var t=require("ub-ria/mvc/BaseAction"),i=require("er/Model");return require("er/util").inherits(e,t),e.prototype.createModel=function(){var e=new i;return e.set("indexURL",require("er/config").indexURL),e},e.prototype.initBehavior=function(){this.view.on("reload",this.reload,this)},e}),define("error/View",["require","ef/UIView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("ef/UIView"),i=require("er/util");return e.prototype.uiEvents={"reload:click":function(){this.fire("reload")}},i.inherits(e,t),e}),define("error/GenericError",["require","./Action","./View","tpl!b1c6f6b6.tpl.html","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("./Action"),i=require("./View");return require("tpl!b1c6f6b6.tpl.html"),e.prototype.createView=function(){var e=new i;return e.name="generic-error",e.template="genericError",e},require("er/util").inherits(e,t),e}),define("error/config",["require","./GenericError","er/controller"],function(require){require("./GenericError");var e=[{path:"/404",type:"error/NotFound",title:"无法找到页面"},{path:"/400",type:"error/GenericError",title:"出现未知问题"}];require("er/controller").registerAction(e)}),define("common/FormActionFactory",["require","eoo","./ActionFactory"],function(require){var exports={};exports.getModules=function(){var e=this.$super(arguments);return e.push("ub-ria/mvc/EntityValidator"),e.push(this.getBaseModuleName()+"/schema"),e.push("ub-ria/mvc/handler/ToastSubmitHandler"),e.push("ub-ria/mvc/handler/RedirectSubmitHandler"),e},exports.buildAction=function(){var e=this.$super(arguments),t=arguments[8],i=arguments[9],n=arguments[10],r=arguments[11],a=new t;a.setRule(e.model.get("rule")),a.setSchema(i),e.model.setValidator(a);var o=new n,s=new r;return o.setNextSubmitHandler(s),s.setRedirectOptions({global:!0,force:!0}),e.setSubmitHandler(o),e};var e=require("eoo").create(require("./ActionFactory"),exports);return e}),define("account/config",["require","common/FormActionFactory","er/controller"],function(require){var e=require("common/FormActionFactory"),t=[{path:"/account/update",type:new e("account/Form"),title:"修改密码",args:{formType:"update"},authority:["outerAuditRole","outerMarkerRole"]}];require("er/controller").registerAction(t)}),define("marker/config",["require","common/ActionFactory","er/controller"],function(require){var e=require("common/ActionFactory"),t=[{path:"/marker",type:new e("marker/List"),title:"标注任务列表"},{path:"/marker/list",type:new e("marker/List"),title:"标注任务列表"},{path:"/marker/statistics",type:new e("marker/statistics/Statistics"),title:"任务统计"},{path:"/marker/statistics/rank",type:new e("marker/statistics/rank/List"),title:"人员统计"},{path:"/marker/statistics/dimension",type:new e("marker/statistics/dimension/Dimension"),title:"维度统计"},{path:"/marker/task/list",type:new e("task/List"),args:{inType:"marker"},title:"开始标注"}];require("er/controller").registerAction(t)}),define("task/config",["require","common/ActionFactory","er/controller"],function(require){var e=require("common/ActionFactory"),t=[{path:"/task/detail",type:new e("task/Detail"),title:"物料详情"}];require("er/controller").registerAction(t)}),define("audit/config",["require","common/ActionFactory","common/FormActionFactory","er/controller"],function(require){var e=require("common/ActionFactory"),t=require("common/FormActionFactory"),i=["outerAuditRole","innerMarkerRole","innerAuditRole","managerRole"],n=[{path:"/audit",type:new e("audit/List"),title:"审核任务列表",authority:i},{path:"/audit/list",type:new e("audit/List"),title:"审核任务列表",authority:i},{path:"/audit/create",type:new t("audit/Form"),title:"新增审核任务",args:{formType:"create"},authority:i},{path:"/audit/create/success",type:new e("audit/Success"),args:{type:"create",entityName:"audit"},title:"新建-成功"},{path:"/audit/statistics",type:new e("audit/statistics/Statistics"),title:"审核任务统计",authority:i},{path:"/audit/statistics/tobegin",type:new e("audit/statistics/auditResult/ToBeginList"),title:"未审核列表",authority:i},{path:"/audit/statistics/right",type:new e("audit/statistics/auditResult/RightList"),title:"审核正确列表",authority:i},{path:"/audit/statistics/wrong",type:new e("audit/statistics/auditResult/WrongList"),title:"审核错误列表",authority:i},{path:"/audit/statistics/dimension",type:new e("audit/statistics/dimension/Dimension"),title:"维度统计",authority:i},{path:"/audit/task/list",type:new e("task/List"),args:{inType:"audit"},title:"审核任务",authority:i}];
require("er/controller").registerAction(n)}),define("permission/config",["require","common/ActionFactory","common/FormActionFactory","er/controller"],function(require){var e=require("common/ActionFactory"),t=require("common/FormActionFactory"),i=[{path:"/permission/list",type:new e("permission/List"),title:"权限管理",authority:["managerRole"]},{path:"/permission/create",type:new t("permission/Form"),title:"开通账户",args:{formType:"create"},authority:["managerRole"]},{path:"/permission/innerUpdate",type:new t("permission/Form"),title:"更改账户",args:{formType:"update",userRoleType:"inner"},authority:["managerRole"]},{path:"/permission/outerUpdate",type:new t("permission/Form"),title:"更改账户",args:{formType:"update",userRoleType:"outer"},authority:["managerRole"]}];require("er/controller").registerAction(i)}),define("log/config",["require","common/ActionFactory","er/controller"],function(require){var e=require("common/ActionFactory"),t=[{path:"/log/user/list",type:new e("log/List"),title:"权限操作日志",authority:["managerRole"],args:{logType:"user"}},{path:"/log/audit/list",type:new e("log/List"),title:"审核操作日志",authority:["managerRole"],args:{logType:"review"}}];require("er/controller").registerAction(t)}),define("common/config",["require","tpl!b1c6f6b6.tpl.html","error/config","account/config","marker/config","task/config","audit/config","permission/config","log/config","er-track","er/events","er/controller"],function(require){require("tpl!b1c6f6b6.tpl.html"),require("tpl!b1c6f6b6.tpl.html"),require("tpl!b1c6f6b6.tpl.html"),require("tpl!b1c6f6b6.tpl.html"),require("error/config"),require("account/config"),require("marker/config"),require("task/config"),require("audit/config"),require("permission/config"),require("log/config");var e=require("er-track").create();if(e.includeAll(),window.DEBUG)e.use("console");e.start();var t=require("er/events");t.on("actionfail",function(e){if(!e.isChildAction){var t=require("er/controller");t.renderAction("/400")}}),t.on("enteractionfail",function(e){if(!e.isChildAction){var t=require("er/controller"),i=t.currentURL.toString(),n=e.url.toString();i===n&&t.renderAction("/400")}})}),define("common/dom",["require","common/util"],function(require){function e(e){return e.className?e.className.split(/\s+/):[]}var t=require("common/util"),i={};return i.addEvent=function(e,t,n){if(e=i.g(e),e.addEventListener)e.addEventListener(t,n,!1);else e.attachEvent("on"+t,function(t){n.call(e,t)})},i.g=function(e){if(!e)return null;else return"string"==typeof e?document.getElementById(e):e},i.hasClass=function(n,r){if(n=i.g(n),""===r)throw new Error("className must not be empty");if(!n||!r)return!1;if(n.classList)return n.classList.contains(r);var a=e(n);return t.contains(a,r)},i.addClass=function(n,r){if(n=i.g(n),""===r)throw new Error("className must not be empty");if(!n||!r)return n;if(n.classList)return n.classList.add(r),n;var a=e(n);if(t.contains(a,r))return n;else return a.push(r),n.className=a.join(" "),n},i.addClasses=function(n,r){if(n=i.g(n),!n||!r)return n;if(n.classList)return t.each(r,function(e){n.classList.add(e)}),n;var a=e(n),o=t.union(a,r);if(o.length>a.length)n.className=o.join(" ");return n},i.removeClass=function(t,n){if(t=i.g(t),""===n)throw new Error("className must not be empty");if(!t||!n)return t;if(t.classList)return t.classList.remove(n),t;for(var r=e(t),a=!1,o=0;o<r.length;o++)if(r[o]===n)r.splice(o,1),o--,a=!0;if(a)t.className=r.join(" ");return t},i.removeClasses=function(n,r){if(n=i.g(n),!n||!r)return n;if(n.classList)return t.each(r,function(e){n.classList.remove(e)}),n;var a=e(n),o=t.difference(a,r);if(o.length<a.length)n.className=o.join(" ");return n},i.toggleClass=function(t,n){if(t=i.g(t),""===n)throw new Error("className must not be empty");if(!t||!n)return t;if(t.classList)return t.classList.toggle(n),t;for(var r=e(t),a=!1,o=0;o<r.length;o++)if(r[o]===n)r.splice(o,1),a=!0,o--;if(!a)r.push(n);return t.className=r.join(" "),t},i}),define("common/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"REMOVED",text:"删除"},{alias:"NORMAL",text:"启用"}),exports}),define("common/extension/ajax",["require","underscore","er/ajax"],function(require){function e(){a.config.cache=!0,a.config.timeout=15e3,a.config.charset="utf-8"}function t(){var e={json:"application/json"};a.hooks.beforeExecute=function(t){if(t.contentType&&e.hasOwnProperty(t.contentType))t.contentType=e[t.contentType]}}function i(){function e(){i=!1}var t={403:{name:"not-authorized",title:"登录超时",message:"系统登录超时，请重新登录再试。",handler:function(){var e=window.DEBUG?"index-debug.html":"login.html";location.href=e+location.hash}},500:{name:"server-error",title:"系统错误",message:"系统发生错误，请稍后再试。"}},i=!1;a.on("fail",function(n){if(!n.options.background)if(!i){var r=t[n.xhr.status];if(r)i=!0,window.require(["esui/Dialog"],function(t){var i={title:r.title,content:r.message},n=t.alert(i);if(r.handler)n.on("ok",r.handler),n.on("ok",e),n.on("close",e)})}})}function n(){e(),t(),i()}var r=require("underscore"),a=require("er/ajax");return{enable:r.once(n)}}),define("ub-ria/mvc/handler/SubmitHandler",["require","eoo"],function(require){var exports={};exports.nextSubmitHandler=null,exports.setNextSubmitHandler=function(e){this.nextSubmitHandler=e},exports.getNextSubmitHandler=function(){return this.nextSubmitHandler},exports.handle=function(e,t){this.next(e,t)},exports.next=function(e,t){var i=this.getNextSubmitHandler();if(i)i.handle(e,t)};var e=require("eoo").create(exports);return e}),define("ub-ria/mvc/handler/ToastSubmitHandler",["require","underscore","esui/Toast","./SubmitHandler","eoo"],function(require){var e=require("underscore"),t=require("esui/Toast"),i=require("./SubmitHandler"),exports={};exports.template="",exports.setTemplate=function(e){this.template=e},exports.getTemplate=function(){return this.template},exports.handle=function(e,i){var n=this.getToastMessage(e,i);if(n){var r=t.success(n);r.show()}this.next(e,i)},exports.getToastMessage=function(t,i){var n=this.getTemplate();if(null==n)return"";if(n)return e.template(n,t||{});else{var r="update"===i.context.formType?"修改":"创建";return"您"+r+"的"+i.getEntityDescription()+"[<strong>"+e.escape(t.name)+"</strong>]已经成功保存"}};var n=require("eoo").create(i,exports);return n}),define("common/extension/CustomToastHandler",["require","er/util","common/util","ub-ria/mvc/handler/ToastSubmitHandler"],function(require){function e(){n.apply(this,arguments)}var t=require("er/util"),i=require("common/util"),n=require("ub-ria/mvc/handler/ToastSubmitHandler");return t.inherits(e,n),e.prototype.getToastMessage=function(e,t){var n=this.getTemplate();if(null==n)return"";if(n)return i.template(n,e||{});else if(e.hasSuccess){if(t.content)return t.content;var r="update"===t.context.formType?"修改":"创建";return r+"成功!"}else return e.resultInfo},e}),define("common/extension/FormWithSuccessHandler",["require","underscore","ub-ria/mvc/handler/SubmitHandler","eoo"],function(require){var e=(require("underscore"),require("ub-ria/mvc/handler/SubmitHandler")),exports={};exports.handle=function(e,t){t.redirectAfterSubmit(e),this.next(e,t)};var t=require("eoo").create(e,exports);return t}),define("common/session",["require"],function(){var e={};return{get:function(t){var i=e[t];if(!i)return void 0;if(i.once)this.remove(t);return i.value},set:function(t,i){e[t]={value:i}},once:function(t,i){e[t]={value:i,once:!0}},remove:function(t){var i=e[t];return e[t]=null,!!i}}}),define("ub-ria/mvc/ListModel",["require","./BaseModel","er/util","underscore","../util","er/URL","er/Deferred"],function(require){function e(){n.apply(this,arguments),a.each(this.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},this),this.putDatasource(o,0),this.putDatasource(s,0),this.putDatasource(l,1)}function t(){var e=this.get("canBatchModify");this.set("selectMode",e?"multi":"")}function i(e,t){var i=a.findWhere(this.getStatusTransitions(),{status:e});if(i.accept){var n=a.difference(i.accept,i.deny||[]);return a.contains(n,t.status)}else if(i.deny)return!a.contains(i.deny,t.status);else return!0}var n=require("./BaseModel"),r=require("er/util"),a=require("underscore"),o={list:{retrieve:function(e){var t=e.getQuery();return t=require("../util").purify(t,null,!0),e.search(t)},dump:!0}},s={listWithoutKeywordURL:function(e){var t=e.get("url"),i=t.getPath(),n=t.getQuery();n=a.omit(n,"keyword");var r="#"+require("er/URL").withQuery(i,n);return r}},l={hasResult:function(e){return e.get("results").length||!a.isEmpty(e.get("url").getQuery())}};return r.inherits(e,n),e.prototype.statusTransitions=[{status:0,deny:[0],statusName:"remove",command:"删除"},{status:1,deny:[1],statusName:"restore",command:"启用"}],e.prototype.getStatusTransitions=function(){return this.statusTransitions},e.prototype.defaultStatusValue=1,e.prototype.getDefaultStatusValue=function(){return this.defaultStatusValue||""},e.prototype.defaultArgs={},e.prototype.getDefaultArgs=function(){var e=this.defaultArgs||{},t=this.getDefaultStatusValue();if(!e.hasOwnProperty("status")&&t)e.status=t;return e},e.prototype.load=function(){return n.prototype.load.apply(this,arguments).then(a.bind(t,this))},e.prototype.prepare=function(){this.set("filtersInfo",this.getFiltersInfo())},e.prototype.getQuery=function(){var e={keyword:this.get("keyword"),status:this.get("status"),order:this.get("order"),orderBy:this.get("orderBy"),pageNo:this.get("page")||1};if(!e.status)e.status=this.getDefaultStatusValue();else if("all"===e.status)e.status="";return e},e.prototype.canUpdateToStatus=function(e,t){return a.any(e,a.bind(i,this,t))},e.prototype.updatePageSize=function(e){var t=this.data("global");if(!t)throw new Error("No global data object attached to this Model");if("function"!=typeof t.updatePageSize)throw new Error("No updatePageSize method implemented on global data object");return t.updatePageSize(e)},e.prototype.getAllItems=function(){return this.get("results")},e.prototype.getItemById=function(e){var t=this.getAllItems();return t?a.findWhere(t,{id:e}):null},e.prototype.indexOf=function(e){var t=this.getAllItems();if(!t)return-1;if("object"==typeof e)return a.indexOf(t,e);else{for(var i=0;i<t.length;i++)if(t[i].id===e)return i;return-1}},e.prototype.search=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.search)throw new Error("No search method implemented on default data object");return t.search(e||{})},e.prototype.updateStatus=function(e,t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.updateStatus)throw new Error("No updateStatus method implemented on default data object");return i.updateStatus(e,t)},e.prototype.remove=a.partial(e.prototype.updateStatus,0),e.prototype.restore=a.partial(e.prototype.updateStatus,1),e.prototype.getAdvice=function(e,t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.getAdvice)throw new Error("No getAdvice method implemented on default data object");return i.getAdvice(e,t)},e.prototype.getRemoveAdvice=function(e){var t=require("er/Deferred"),i=e.length,n=this.get("entityDescription"),r="您确定要删除已选择的"+i+"个"+n+"吗？";if(1>=i)r="您确定要删除该"+n+"吗？";var a={message:r};return t.resolved(a)},e.prototype.getRestoreAdvice=a.partial(e.prototype.getAdvice,1),e.prototype.getFilters=function(){return{}},e.prototype.getFiltersInfo=function(){var e=!0,t=this.getDefaultArgs(),i={};return a.each(this.getFilters(),function(n,r){var o={text:"function"==typeof n.text?n.text(n):n.text,defaultValue:t[r],name:r};if(a.defaults(o,n),o.isDefaultValue=o.hasOwnProperty("isDefaultValue")?o.isDefaultValue:o.defaultValue==o.value,!o.isDefaultValue)e=!1;i[r]=o},this),{filters:i,isAllFiltersDefault:e}},e}),define("ub-ria/mvc/BaseView",["require","underscore","er/util","ef/UIView","er/Deferred"],function(require){function e(){n.apply(this,arguments)}var t=require("underscore"),i=require("er/util"),n=require("ef/UIView");return i.inherits(e,n),e.prototype.addUIEvents=function(e){var i=[e];t.each(e,function(n,r){if(t.isArray(n)){for(;n.length>1;){var a={};a[r]=n.splice(-1)[0],i.push(a)}if(n.length)e[r]=n.splice(-1)[0]}});var n=this.uiEvents;this.uiEvents=n&&[].concat(n)||[],this.uiEvents=this.uiEvents.concat(i)},e.prototype.getUIEventsCollection=function(){var e=this.uiEvents;return e&&[].concat(e)||[]},e.prototype.bindEvents=function(){t.each(this.getUIEventsCollection(),function(e){this.uiEvents=e,n.prototype.bindEvents.apply(this,arguments)},this)},e.prototype.addUIProperties=function(e){this.uiProperties=this.uiProperties||{};var i=this.uiProperties;t.each(e,function(e,n){if(i.hasOwnProperty(n))t.extend(i[n],e);else i[n]=e})},e.prototype.getUIProperties=function(){return this.uiProperties||{}},e.prototype.getTemplateName=function(){var e=n.prototype.getTemplateName.apply(this,arguments);if(this.model&&this.model.get("isChildAction"))e+="Main";return e},e.prototype.waitConfirm=function(){var e=this.confirm.apply(this,arguments),t=require("er/Deferred"),i=new t;return e.on("ok",i.resolver.resolve),e.on("cancel",i.resolver.reject),i.promise},e.prototype.waitActionDialog=function(){var e=this.popActionDialog.apply(this,arguments),t=require("er/Deferred"),i=new t;return e.on("actionloaded",i.resolver.resolve),e.on("actionloadfail",i.resolver.reject),e.on("actionloadabort",i.resolver.reject),i.promise},e}),define("common/mask",["require"],function(){var e=null;return{show:function(){if(e)clearTimeout(e);e=setTimeout(function(){document.getElementById("global-mask").className=""},200)},hide:function(){if(e)clearTimeout(e);document.getElementById("global-mask").className="hide"}}}),define("common/extension/mvc",["require","underscore","er/events","er/datasource","common/session","moment","ub-ria/mvc/ListModel","ub-ria/mvc/BaseView","esui","../mask"],function(require){function e(){var e=require("er/datasource");e.session=function(e){return function(){var t=require("common/session");return t.get(e)}},e.defaultValue=function(e,t){return function(i){return null==i.get(e)?t:i.get(e)}},e.enumText=function(e,t){return function(i,n){var r=i.get(t||n.name);if(null==r)return void 0;else return e.getTextFromValue(+r)}},e.formatDate=function(e,t){return e=e||"YYYY-MM-DD",function(i,n){var r=i.get(t||n.name);if(!r)return"";var a=require("moment");return a(r,"YYYYMMDD").format(e)}},e.user=function(e){return function(t){var i=t.data("global").getUser();return i[e]}},e.system=function(e){return function(t){var i=t.data("global").getSystem();return i[e]}}}function t(){var e=require("ub-ria/mvc/ListModel");e.prototype.getPageSize=function(){var e=this.data("global");if(!e)throw new Error("No global data object attached to this Model");return e.getUserProperty("pageSize")},e.prototype.updatePageSize=function(e){var t=this.data("global");if(!t)throw new Error("No global data object attached to this Model");return t.updatePageSize(e)};var t=require("ub-ria/mvc/BaseView");t.prototype.showToast=function(e,t){var i={content:e,disposeOnHide:!0,autoShow:!0,duration:3e3};r.extend(i,t);var n=require("esui").create("Toast",i);n.show()}}function i(){var e=require("../mask");a.on("forwardaction",function(t){if(!t.isChildAction)e.show()}),a.on("enteractioncomplete",function(t){if(!t.isChildAction)e.hide()}),a.on("enteractionfail",function(t){if(!t.isChildAction)e.hide()})}function n(){e(),t(),i()}var r=require("underscore"),a=require("er/events");return{enable:r.once(n)}}),define("common/extension/PasswordHandler",["require","er/util","common/util","ub-ria/mvc/handler/ToastSubmitHandler"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=(require("common/util"),require("ub-ria/mvc/handler/ToastSubmitHandler"));return t.inherits(e,i),e.prototype.getToastMessage=function(e){if(e.hasSuccess)return"密码已修改成功！";else return e.resultInfo},e}),define("ub-ria/ui/Uploader",["require","esui/lib","esui/controlHelper","esui/validator/Validity","esui/validator/ValidityState","esui/InputControl","underscore","esui"],function(require){function e(){s.apply(this,arguments)}function t(){this.removeState("busy"),this.addState("complete"),this.addState("uploaded");var e=this.helper.getPart("button");e.innerHTML=l.escape(this.overrideText);var t=new a;this.showValidity(t),this.fire("change")}function i(){this.removeState("busy"),this.removeState("complete"),this.removeState("uploaded"),this.helper.getPart("button").innerHTML=l.escape(this.text),this.fileInfo="";var e=document.createElement("input");e.type="file",e.id=this.helper.getId("input"),this.name&&(e.name=this.name);var t=this.helper.getPart("input");this.helper.removeDOMEvent(t,"change"),this.main.firstChild.replaceChild(e,t),this.helper.addDOMEvent(e,"change",n.bind(this.receiveFile,this))}var n=require("esui/lib"),r=require("esui/controlHelper"),a=require("esui/validator/Validity"),o=require("esui/validator/ValidityState"),s=require("esui/InputControl"),l=require("underscore");e.prototype.type="Uploader";var u={image:{".jpg":!0,".jpeg":!0,".gif":!0,".bmp":!0,".tif":!0,".tiff":!0,".png":!0},flash:{".flv":!0,".swf":!0}};return e.defaultProperties={width:80,height:25,fileType:"*",method:"POST",text:"点击上传",overrideText:"重新上传",busyText:"正在上传...",completeText:"上传完成",autoUpload:!0,extraArgs:{},action:"",mimeTypes:u},e.prototype.initOptions=function(t){var i={};if(n.extend(i,e.defaultProperties,t),n.isInput(this.main))i.accept=i.accept||n.getAttribute(this.main,"accept"),i.name=i.name||this.main.name;else if("FORM"===this.main.nodeName)if(i.action=i.action||this.main.action,!t.method&&n.hasAttribute(this.main,"method"))i.method=this.main.method;if("string"==typeof i.accept)i.accept=n.splitTokenList(i.accept);if("false"===i.autoUpload)i.autoUpload=!1;if(!i.hasOwnProperty("title")&&this.main.title)i.title=this.main.title;this.setProperties(i)},e.prototype.initStructure=function(){if("FORM"!==this.main.nodeName)this.helper.replaceMain();this.callbackName=n.getGUID("esuiShowUploadResult"),window[this.callbackName]=n.bind(this.showUploadResult,this);var e=this.helper.getPartClassName("indicator"),t=this.helper.getPartClassName("button"),i=this.helper.getId("iframe"),r=['<div id="'+this.helper.getId("input-container")+'">','<span id="'+this.helper.getId("button")+'" ','class="'+t+'">',"</span>",'<input type="hidden" name="callback" ','value="'+this.callbackName+'" ',"/>",'<input type="hidden" name="sessionToken" ','value="'+this.getSessionToken()+'" ',"/>",'<input type="file" ','id="'+this.helper.getId("input")+'" ',this.name?'name="'+this.name+'" ':" ","/>"];l.each(this.extraArgs,function(e,t){r.push('<input type="hidden" name="'+t+'" ','value="'+e+'"/>')}),r.push("</div>",'<div id="'+this.helper.getId("indicator-wrapper")+'"','class="'+e+'">','<span id="'+this.helper.getId("indicator")+'"></span>',"</div>",'<iframe id="'+i+'" name="'+i+'"',' src="about:blank"></iframe>'),this.main.innerHTML=r.join("");var a=this.helper.createPart("form","form");a.setAttribute("enctype","multipart/form-data"),a.target=i,document.body.appendChild(a);var o=this.helper.getPart("input");this.helper.addDOMEvent(o,"change",n.bind(this.receiveFile,this))},e.prototype.repaint=r.createRepaint(s.prototype.repaint,{name:["method","action"],paint:function(e,t,i){var n=e.helper.getPart("form");n.method=t,n.action=i}},{name:["text","overrideText"],paint:function(e,t,i){var n=e.helper.getPart("button"),r=e.hasState("uploaded")?l.escape(i):l.escape(t);n.innerHTML=r}},{name:["busyText","completeText"],paint:function(e,t,i){var n=e.helper.getPart("indicator"),r=e.hasState("busy")?l.escape(t):l.escape(i);n.innerHTML=r}},{name:"accept",paint:function(e,t){var i=e.helper.getPart("input");if(t)n.setAttribute(i,"accept",t.join(","));else n.removeAttribute(i,"accept")}},{name:["disabled","readOnly"],paint:function(e,t,i){var n=e.helper.getPart("input");n.disabled=t,n.readOnly=i}},{name:["width","height"],paint:function(e,t,i){var n=t+"px",r=i+"px";e.main.style.width=n,e.main.style.height=r;var a=e.helper.getPart("button");a.style.lineHeight=r;var o=e.helper.getPart("indicator");o.style.lineHeight=r}},{name:"rawValue",paint:function(e,n){if(n)if(l.isEqual(n,{}))i.call(e);else{if(!n.hasOwnProperty("type"))n.type=e.fileType;e.fileInfo=n,t.call(e,n),e.removeState("complete")}}}),e.prototype.checkFileFormat=function(e){if(this.accept){var t=e.split(".");t="."+t[t.length-1].toLowerCase();for(var i=!1,n=0;n<this.accept.length;n++){var r=this.accept[n].toLowerCase();if(r===t){i=!0;break}if("*"===r.slice(-1)[0]){var a=r.split("/")[0],o=this.mimeTypes[a];if(o&&o.hasOwnProperty(t)){i=!0;break}}}if(!i){var s=this.acceptErrorMessage||"仅接受以下文件格式："+this.accept.join(",");this.notifyFail(s)}return i}else return!0},e.prototype.submit=function(){this.showUploading();var e=this.helper.getPart("input-container"),t=this.helper.getPart("form");t.appendChild(e),t.submit(),this.main.insertBefore(e,this.main.firstChild)},e.prototype.receiveFile=function(){var e=this.helper.getPart("input"),t=e.value;if(t&&this.checkFileFormat(t))if(this.fire("receive"),this.autoUpload)this.submit()},e.prototype.showUploading=function(){this.removeState("complete"),this.addState("busy");var e=this.helper.getPart("indicator");e.innerHTML=l.escape(this.busyText)},e.prototype.showUploadResult=function(e){if(e.fields)this.fire("fail",{fields:e.fields}),this.notifyFail(e.fields[0].message);else if(e.info){if(!e.info.hasOwnProperty("type"))e.info.type=this.fileType;this.fileInfo=e.info,this.fire("complete"),this.notifyComplete(e.info)}},e.prototype.notifyFail=function(e){e=e||"上传失败";var t=new a,i=new o(!1,e);t.addState("upload",i),this.showValidity(t),this.removeState("busy")},e.prototype.notifyComplete=function(e){t.call(this,e);var i=this.helper.getPart("indicator");i.innerHTML=l.escape(this.completeText),this.timer=setTimeout(n.bind(this.removeState,this,"complete"),1e3)},e.prototype.getRawValue=function(){return this.fileInfo||null},e.prototype.getRawValueProperty=e.prototype.getRawValue,e.prototype.getFileName=function(){return this.helper.getPart("input").value||""},e.prototype.getSessionToken=function(){return""},e.prototype.dispose=function(){try{delete window[this.callbackName]}catch(e){window[this.callbackName]=void 0}var t=this.helper.getPart("form");n.removeNode(t),s.prototype.dispose.apply(this,arguments)},n.inherits(e,s),require("esui").register(e),e}),define("common/extension/ui",["require","underscore","esui/Table","esui/Form","esui/Pager","ub-ria/ui/Uploader","../GlobalData","esui/Select"],function(require){function e(){var e=require("esui/Table");e.defaultProperties.sortable=!0,e.defaultProperties.columnResizable=!0,e.defaultProperties.select="multi",e.defaultProperties.followHead=!0,e.defaultProperties.breakLine=!0,e.defaultProperties.encode=!0;var t=require("esui/Form");t.defaultProperties.autoValidate=!0;var i=require("esui/Pager");i.prototype.defaultProperties.pageSizes=[20,50,100],i.prototype.defaultProperties.pageSize=50;var n=require("ub-ria/ui/Uploader");n.prototype.getSessionToken=function(){var e=require("../GlobalData").getInstance();return e.getUserProperty("sessionToken")};var r=require("esui/Select");r.prototype.getSelectedItem=function(){return this.datasource[this.selectedIndex]||null}}var t=require("underscore");return{enable:t.once(e)}}),function(e){if("function"==typeof define&&define.amd)define("moment/lang/zh-cn",["moment"],e);else if("object"==typeof exports)module.exports=e(require("../moment"));else e(window.moment)}(function(e){return e.lang("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiem:function(e,t){var i=100*e+t;if(600>i)return"凌晨";else if(900>i)return"早上";else if(1130>i)return"上午";else if(1230>i)return"中午";else if(1800>i)return"下午";else return"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var t,i;return t=e().startOf("week"),i=this.unix()-t.unix()>=604800?"[下]":"[本]",0===this.minutes()?i+"dddAh点整":i+"dddAh点mm"},lastWeek:function(){var t,i;return t=e().startOf("week"),i=this.unix()<t.unix()?"[上]":"[本]",0===this.minutes()?i+"dddAh点整":i+"dddAh点mm"},sameElse:"LL"},ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"},week:{dow:1,doy:4}})}),define("common/extension/util",["require","underscore","moment","moment/lang/zh-cn","ub-ria/util"],function(require){function e(){i.lang("zh-cn"),t.extend(t,require("ub-ria/util")),t.escapeForRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},t.colorRGB=function(e,t){t=t||1,e=e.toLowerCase();var i=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(e&&i.test(e)){if(4===e.length){for(var n="#",r=1;4>r;r++){var a=n.slice(r,r+1);n+=a+a}e=n}for(var o=[],s=1;7>s;s+=2)o.push(parseInt("0x"+e.slice(s,s+2),16));return"rgba("+o.join(",")+","+t+")"}return e},t.parseDateRanges=function(e){if(!e)throw new Error("No date ranges given");if(e.length%2!==0)throw new Error("Invalid date range length");for(var t=e.length/2,i=[],n=0;t>n;n++)i.push([e[2*n],e[2*n+1]]);return i},t.ellipsis=function(e,t){if(2*e.length<=t)return e;for(var i=0,n="",r=0;r<e.length;r++){if(e.charCodeAt(r)>128){if(i+=2,i>t)return n.substring(0,n.length-1)+"..."}else if(i+=1,i>t)return n.substring(0,n.length-2)+"...";n+=e.charAt(r)}return n}}var t=require("underscore"),i=require("moment");return require("moment/lang/zh-cn"),{enable:t.once(e)}}),define("common/extension",["require","./extension/util","./extension/ajax","./extension/ui","er/events"],function(require){return{enable:function(){require("./extension/util").enable(),require("./extension/ajax").enable(),require("./extension/ui").enable();var e=require("er/events");if(window.DEBUG&&window.console)e.on("error",function(e){var t=e.error,i="";if(!t)i="Invoke action.enter() causes error";else if(t.message)if(i=t.message,t.stack)i+="\n"+t.stack;else i+="\nStackTrace is not supported";else if(window.JSON&&"function"==typeof JSON.stringify)try{i=JSON.stringify(t,null,"    ")}catch(n){i=t}else i=t;console.error(i)})}}}),define("ub-ria/mvc/SingleEntityModel",["require","underscore","er/util","./BaseModel"],function(require){function e(e){return this.fill(e),e}function t(){r.apply(this,arguments),this.putDatasource(a)}var i=require("underscore"),n=require("er/util"),r=require("./BaseModel"),a={entity:function(t){var n=t.get("id");if(n){var r=t.get("entity");if(r)return e.call(t,r);else return t.findById(n).then(i.bind(e,t))}else return{}}};return n.inherits(t,r),t.prototype.findById=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.findById)throw new Error("No findById method implemented on default data object");return t.findById(e)},t}),define("ub-ria/mvc/FormModel",["require","er/util","./SingleEntityModel","er/Deferred"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("./SingleEntityModel"),n=require("er/Deferred");return t.inherits(e,i),e.prototype.fillEntity=function(e){return e},e.prototype.setValidator=function(e){if(e)e.setRule(this.get("rule"));this.validator=e},e.prototype.getValidator=function(){return this.validator},e.prototype.validateEntity=function(e){var t=this.getValidator();if(!t)throw new Error("No validator object attached to this Model");return t.validate(e)},e.prototype.save=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.save)throw new Error("No save method implemented on default data object");e=this.fillEntity(e);var i=this.validateEntity(e);if(i.length>0)return n.rejected({fields:i});else return t.save(e)},e.prototype.update=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.update)throw new Error("No update method implemented on default data object");e=this.fillEntity(e),e.id=this.get("id");var i=this.validateEntity(e);if(i.length>0)return n.rejected({fields:i});else return t.update(e)},e}),define("ub-ria/mvc/FormAction",["require","er/util","underscore","er/Deferred","./BaseAction","./FormModel","er/events"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=this.handleSubmitError(e);if(!t)require("er/events").notifyError(e.responseText)}function i(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel()}function n(){var e=this.view.getEntity();this.view.disableSubmit(),require("er/Deferred").when(this.submitEntity(e)).ensure(a.bind(this.view.enableSubmit,this.view))}var r=require("er/util"),a=require("underscore"),o=require("er/Deferred"),s=require("./BaseAction");return r.inherits(e,s),e.prototype.modelType=require("./FormModel"),e.prototype.category="form",e.prototype.handleSubmitError=function(e){if(409===e.status)e=r.parseJSON(e.responseText);if(e.fields)return this.view.notifyErrors(e),!0;else return!1},e.prototype.handleSubmitResult=function(e){var t=this.fire("entitysave",{entity:e});if(!t.isDefaultPrevented()){var i=this.getSubmitHandler();if(i)i.handle(e,this)}this.fire("handlefinish")},e.prototype.getSubmitHandler=function(){return this.submitHandler},e.prototype.setSubmitHandler=function(e){this.submitHandler=e},e.prototype.getMethod=function(e){var t={create:"save",update:"update",copy:"save"};return t[e]||null},e.prototype.submitEntity=function(e){var i=this.getMethod(this.context.formType);try{if(i)return this.model[i](e).then(a.bind(this.handleSubmitResult,this),a.bind(t,this));else throw new Error("Cannot find formType in methodMap")}catch(n){return o.rejected(n)}},e.prototype.cancelConfirmTitle="确认取消编辑",e.prototype.getCancelConfirmTitle=function(){return this.cancelConfirmTitle},e.prototype.cancelConfirmMessage="取消编辑将不保留已经填写的数据，确定继续吗？",e.prototype.getCancelConfirmMessage=function(){return this.cancelConfirmMessage},e.prototype.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var t={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage()};this.view.waitCancelConfirm(t).then(a.bind(i,this))}else i.call(this)},e.prototype.redirectAfterCancel=function(){this.back("/"+this.getEntityName()+"/list")},e.prototype.isFormDataChanged=function(){return!1},e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments);var e=this.view.getFormData();this.model.set("initialFormData",e,{silent:!0}),this.view.on("submit",n,this),this.view.on("cancel",this.cancelEdit,this)},e}),define("common/FormAction",["require","ub-ria/mvc/FormAction"],function(require){return require("ub-ria/mvc/FormAction")}),define("ub-ria/mvc/rule",["require"],function(){return{maxLength:100,mail:{maxLength:64,pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/},description:{maxLength:4e3},phone:{pattern:/^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$/},mobile:{pattern:/^(1(3|4|5|8)\d{9})?$/},url:{maxLength:1e3,pattern:/^(?:https?|ftp|wap):\/\/.+$|^(?!(?:https?|ftp|wap):\/\/).+$/},positiveInteger:{pattern:/^\d+$/},money:{pattern:/^\d+(\.\d{1,2})?$/}}}),define("common/rule",["require","ub-ria/mvc/rule","common/util"],function(require){var e=require("ub-ria/mvc/rule"),t=require("common/util");return t.deepClone(e)}),define("common/FormModel",["require","common/rule","eoo","ub-ria/mvc/FormModel"],function(require){var e=require("common/rule"),exports={};
exports.constructor=function(){this.$super(arguments),this.set("rule",e)},exports.setGlobalData=function(e){this.addData("global",e)};var t=require("eoo").create(require("ub-ria/mvc/FormModel"),exports);return t}),define("ub-ria/mvc/FormView",["require","er/util","./BaseView","esui/validator/Validity","esui/validator/ValidityState"],function(require){function e(){r.apply(this,arguments);var e={"form:submit":i,"cancel:click":t};this.addUIEvents(e)}function t(){this.fire("cancel")}function i(){this.fire("submit")}var n=require("er/util"),r=require("./BaseView");return n.inherits(e,r),e.prototype.getEntity=function(){return this.getFormData()},e.prototype.notifyErrors=function(e){for(var t=require("esui/validator/Validity"),i=require("esui/validator/ValidityState"),n=this.get("form"),r=0;r<e.fields.length;r++){var a=e.fields[r],o=new i(!1,a.message),s=new t;s.addState("server",o);var l=n.getInputControls(a.field)[0];if(l&&"function"==typeof l.showValidity)l.showValidity(s)}},e.prototype.waitCancelConfirm=function(e){this.waitConfirm(e)},e.prototype.disableSubmit=function(){if(this.viewContext)this.getGroup("submit").disable()},e.prototype.enableSubmit=function(){if(this.viewContext)this.getGroup("submit").enable()},e.prototype.getFormData=function(){var e=this.get("form");return e?e.getData():{}},e}),define("common/FormView",["require","ub-ria/mvc/FormView"],function(require){return require("ub-ria/mvc/FormView")}),define("common/gray",["require"],function(){}),define("common/indicator",["require","er/events"],function(require){function e(){var e=require("er/events");e.on("forwardaction",function(e){!e.isChildAction&&t()}),e.on("enteractioncomplete",function(e){!e.isChildAction&&i()}),e.on("enteractionfail",function(e){if(!e.isChildAction)i()})}function t(){document.getElementById("global-indicator").style.display="block"}function i(){document.getElementById("global-indicator").style.display="none"}return{enable:e,show:t,hide:i}}),define("common/ioc",["require","uioc","common/util"],function(require){function e(e,t){var i={},n=e+"Data",r=e+"RequestStrategy",a=e+"Schema",o=e+"EntityValidator";return i[n]={module:e+"/Data",properties:{requestStrategy:{$ref:e+"RequestStrategy"}}},i[r]={module:"common/RequestStrategy",args:[e,t]},i[a]={module:e+"/schema",scope:"static"},i[o]={module:"ub-ria/mvc/EntityValidator",properties:{schema:{$ref:a}}},i}function t(e){var t={};return n.each(["List","Form","Success","Read","Detail"],function(i){var n=e+i,r=n+"Model",a=n+"View";t[n]={module:e+"/"+i,args:[e],auto:!0,properties:{model:{$ref:r},view:{$ref:a}}};var o={data:{$ref:e+"Data"}};if("Form"===i)o.validator={$ref:e+"EntityValidator"};t[r]={module:e+"/"+i+"Model",auto:!0,properties:o},t[a]={module:e+"/"+i+"View",auto:!0}}),t}var i=require("uioc"),n=require("common/util"),r=new i,a={globalData:{module:"common/GlobalData",scope:"singleton",creator:"getInstance"},session:{module:"common/session",scope:"static"},redirectSubmitHanlder:{module:"ub-ria/mvc/handler/RedirectSubmitHandler",properties:{redirectOptions:{global:!0,force:!0,childFormSubmitRedirect:!1}}},submitHandler:{module:"ub-ria/mvc/handler/ToastSubmitHandler",properties:{nextSubmitHandler:{$ref:"redirectSubmitHanlder"}}},baseModel:{module:"ub-ria/mvc/BaseModel",auto:!0,properties:{data:{$ref:"requestStrategy"}}},requestStrategy:{module:"ub-ria/mvc/RequestManager"}};return r.addComponent(a),r.addComponentsByEntityName=function(i,a,o,s){var l=e(i,a),u=t(i);n.extend(u,l,o||{}),n.each(s,function(e){delete u[e]}),r.addComponent(u)},r}),define("common/IoCActionFactory",["require","common/util","er/Deferred","common/ioc","eoo"],function(require){var e=require("common/util"),t=require("er/Deferred"),i=require("common/ioc"),exports={};exports.constructor=function(e,t){t=t||{},this.actionComponent=e,this.noSchema=t.noSchema||!1},exports.getViewName=function(t){var i=e.compact(t.url.toString().split("/")),n=i[i.length-1];if("create"===n||"update"===n)i[i.length-1]="form";return e.map(i,e.dasherize).join("-")},exports.createRuntimeAction=function(n){var r=new t;return i.getComponent(this.actionComponent,r.resolver.resolve),r.promise.then(e.bind(this.buildAction,this,n))},exports.buildAction=function(e,t){return t.view.name=this.getViewName(e),t};var n=require("eoo").create(exports);return n}),define("ub-ria/mvc/ListAction",["require","./BaseAction","er/util","underscore","er/URL","../util"],function(require){function e(){d.apply(this,arguments)}function t(){this.performSearch()}function i(e){this.model.updatePageSize(e.pageSize).then(f.bind(n,this,e.pageSize))}function n(){var e=this.fire("pagesizechange");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}}function r(){var e=this.fire("pagechange");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();this.reloadWithQueryUpdate(t)}}function a(){var e=this.fire("tablesort");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}}function o(e){var t=this.view.getSelectedItems();this.modifyStatus(t,e.status)}function s(e){this.model[e.statusName](e.ids).then(f.bind(u,this,e),f.bind(this.notifyModifyFail,this,e))}function l(e,t){var i={title:e.command+this.getEntityDescription(),content:t.message};return this.view.waitConfirm(i)}function u(e){this.notifyModifySuccess(e);var t=this.fire("statusupdate",e);if(!t.isDefaultPrevented())this.reload()}function h(e){var t=this.context.url,i=t.getPath(),n=this.model.getDefaultArgs();return e=require("../util").purify(e,n),require("er/URL").withQuery(i,e).toString()}var d=require("./BaseAction"),c=require("er/util"),f=require("underscore"),p=require("er/URL");return c.inherits(e,d),e.prototype.modelType="./ListModel",e.prototype.category="list",e.prototype.performSearch=function(){var e=this.fire("search");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}},e.prototype.redirectForSearch=function(e){var t=this.model.get("url").getPath(),i=p.withQuery(t,e);this.redirect(i,{force:!0})},e.prototype.getURLForPage=function(e){var t=this.context.url,i=t.getPath(),n=t.getQuery();if(1===e)n=f.omit(n,"page");else n.page=e;return require("er/URL").withQuery(i,n).toString()},e.prototype.getSearchQuery=function(){var e=this.view.getSearchArgs();return e.page=this.view.getPageIndex(),e},e.prototype.reloadWithQueryUpdate=function(e){var t=h.call(this,e);this.redirect(t,{force:!0})},e.prototype.modifyStatus=function(e,t){var i=f.pluck(e,"id"),n=f.findWhere(this.model.getStatusTransitions(),{status:t}),r={ids:i,items:e,status:t,statusName:n.statusName,command:n.command};if(this.requireAdviceFor(r)){var a=require("../util").pascalize(r.statusName),o="get"+a+"Advice";this.model[o](r.ids,r.items).then(f.bind(l,this,r)).then(f.bind(s,this,r))}else s.call(this,r)},e.prototype.notifyModifySuccess=function(){},e.prototype.notifyModifyFail=function(e){var t=this.getEntityDescription();if(e.ids.length>1)this.view.alert("无法"+e.command+"部分或全部"+t,e.command+t);else this.view.alert("无法"+e.command+"该"+t,e.command+t)},e.prototype.requireAdviceFor=function(e){return"remove"===e.statusName},e.prototype.initBehavior=function(){d.prototype.initBehavior.apply(this,arguments),this.view.on("search",t,this),this.view.on("pagesizechange",i,this),this.view.on("batchmodify",o,this),this.view.on("pagechange",r,this),this.view.on("tablesort",a,this)},e.prototype.adjustLayout=function(){this.view.adjustLayout()},e}),define("common/ListAction",["require","underscore","eoo","ub-ria/mvc/ListAction"],function(require){function e(){this.performSearch()}function t(e){var t=this.model.getItemById(e.id);this.modifyStatus([t],e.status)}function i(e){var t=this.model.getQuery();t.page=1,t.size=e.pageSize,this.reloadWithQueryUpdate(t)}function n(){var e=this.fire("pagechange");if(!e.isDefaultPrevented()){var t=this.model.getQuery();t.page=this.view.getPageIndex(),this.reloadWithQueryUpdate(t)}}function r(e){var t=this.view.getSelectedItems();this.modifyStatus(t,e.status)}function a(){var e=this.fire("tablesort");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t=s.extend(this.model.getQuery(),t),t.page=1,this.reloadWithQueryUpdate(t)}}function o(e){if("remove"===e.statusName)return void e.preventDefault();else return void s.each(e.ids,function(t){var i=this.model.getItemById(t);i.status=e.status,this.view.updateItem(i),e.preventDefault()},this)}var s=require("underscore"),exports={};exports.initBehavior=function(){this.view.on("search",e,this),this.view.on("pagesizechange",i,this),this.view.on("batchmodify",r,this),this.view.on("pagechange",n,this),this.view.on("tablesort",a,this),this.view.on("modifystatus",t,this),this.on("statusupdate",o,this)},exports.performSearch=function(){var e=this.model,t=e.get("filtersInfo").filters,i=s.omit(this.getSearchQuery(),s.keys(t)),n=this.fire("search");if(!n.isDefaultPrevented())i.page=1,this.reloadWithQueryUpdate(i)};var l=require("eoo").create(require("ub-ria/mvc/ListAction"),exports);return l}),define("common/ListModel",["require","./util","er/URL","eoo","ub-ria/mvc/ListModel"],function(require){function e(e,t){var n=e.get("url"),r=i.omit(n.getQuery(),t);return"#"+require("er/URL").withQuery(n.getPath(),r)}function t(e,t){var n=i.findWhere(this.getStatusTransitions(),{status:e});if(n.accept){var r=i.difference(n.accept,n.deny||[]);return i.contains(r,t.status)}else if(n.deny)return!i.contains(n.deny,t.status);else return!0}var i=require("./util"),exports={};exports.defaultStatusValue="all";var n={pageSize:function(e){var t=e.data("global");return t.getUser().then(function(e){return e.pageSize})}},r={hasResult:function(e){return e.get("data").list.length||!i.isEmpty(e.get("url").getQuery())}};exports.constructor=function(){this.$super(arguments),this.putDatasource(r,1),this.putDatasource(n,0)},exports.getAllItems=function(){return this.get("data").list},exports.setGlobalData=function(e){this.addData("global",e)},exports.getFiltersInfo=function(){var t=!0,n=this.getDefaultArgs(),r={};return i.each(this.getFilters(),function(a,o){var s={text:"function"==typeof a.text?a.text(a):a.text,clearURL:e(this,o),defaultValue:n[o]};if(i.defaults(s,a),s.isDefaultValue=s.hasOwnProperty("isDefaultValue")?s.isDefaultValue:s.defaultValue===s.value,!s.isDefaultValue)t=!1;r[o]=s},this),{filters:r,isAllFiltersDefault:t}},exports.canUpdateToStatus=function(e,n){return i.every(e,i.bind(t,this,n))};var a=require("eoo").create(require("ub-ria/mvc/ListModel"),exports);return a}),define("ui/DrawerActionPanel",["require","esui/lib","ef/ActionPanel","eoo","esui"],function(require){function e(e){if(this.helper.isPart(e.target,"close-btn")||e.target.id===this.helper.getId("mask"))this.hide(),this.fire("close"),this.dispose()}function t(e){this.fire("clickMain",{eventOrigin:e})}function i(e){return e.helper.getPart("mask")||document.body.appendChild(e.helper.createPart("mask"))}function n(){if(!this.helper.getPart("close-btn")){var e=this.main.appendChild(this.helper.createPart("close-btn"),"span");e.title="关闭"}}var r=require("esui/lib"),a=require("ef/ActionPanel"),exports={};exports.type="DrawerActionPanel",exports.initStructure=function(){this.$super(arguments),n.call(this),document.body.appendChild(this.main),this.addState("hidden")},exports.initEvents=function(){this.$super(arguments),this.helper.addDOMEvent(this.main,"click",e),this.on("actionloaded",n)},exports.enterAction=function(){this.action.context.args.isInDrawerPanel=!0,this.$super(arguments)},exports.show=function(){i(this).style.display="block",document.body.style.overflowY="hidden",this.$super(arguments),this.helper.addDOMEvent(this.helper.getPart("mask"),"click",e),this.helper.addDOMEvent(this.main,"click",t)},exports.hide=function(){i(this).style.display="none",document.body.style.overflowY="",this.$super(arguments)},exports.dispose=function(){this.hide(),r.removeNode(this.helper.getId("mask")),r.removeNode(this.main.id),this.$super(arguments)};var o=require("eoo").create(a,exports);return require("esui").register(o),o}),define("ub-ria/mvc/ListView",["require","./BaseView","er/util","underscore","../util"],function(require){function e(){d.apply(this,arguments);var e={pager:{pagesizechange:i,pagechange:n},table:{select:"updateBatchButtonStatus",sort:t},"filter:submit":"submitSearch","filter-switch:click":a,"filter-cancel:click":l,"filter-modify:click":u};this.addUIEvents(e);var r={table:{fields:this.getTableFields()}};this.addUIProperties(r)}function t(e){var t={order:e.order,orderBy:e.field.field};this.sortTable(t)}function i(e){var t=e.target.get("pageSize");this.updatePageSize(t)}function n(){this.updatePageIndex()}function r(e){var t={status:+e.target.getData("status")};this.fire("batchmodify",t)}function a(){var e=this.getSafely("filter");e.isHidden()?o.call(this):l.call(this)}function o(){this.getSafely("filter").show(),this.getSafely("filter-switch").addState("expand")}function s(){this.getSafely("filter").hide(),this.getSafely("filter-switch").removeState("expand")}function l(){if(this.model.get("filtersInfo").isAllFiltersDefault)s.call(this);else this.submitSearchWithoutKey()}function u(){this.getGroup("filter-content").toggle()}function h(e){var t=this.model.defaultArgs[e]||"";this.get(e).setValue(t)}var d=require("./BaseView"),c=require("er/util"),f=require("underscore");return c.inherits(e,d),e.prototype.submitSearch=function(){this.fire("search")},e.prototype.sortTable=function(e){this.fire("tablesort",{tableProperties:e})},e.prototype.updateBatchButtonStatus=function(){var e=this.getSelectedItems();f.each(this.getGroup("batch"),function(t){var i=+t.getData("status"),n=f.isEmpty(e)||!this.model.canUpdateToStatus(e,i);t.set("disabled",n)},this)},e.prototype.updateFilterPanelStatus=function(){if(!this.model.get("filtersInfo").isAllFiltersDefault)o.call(this),u.call(this)},e.prototype.updateSearchBoxStatus=function(){if(this.model.get("keyword"))this.getSafely("keyword").addState("clear")},e.prototype.getSelectedItems=function(){var e=this.get("table");return e?e.getSelectedItems():[]},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var i=this.get("keyword");if(i)t.keyword=require("../util").trim(i.getValue());return t},e.prototype.tableFields=[],e.prototype.getTableFields=function(){return this.tableFields},e.prototype.getPageIndex=function(){return this.get("pager").get("page")},e.prototype.updatePageSize=function(e){this.fire("pagesizechange",{pageSize:e})},e.prototype.updatePageIndex=function(){this.fire("pagechange")},e.prototype.bindEvents=function(){this.getGroup("batch").each(function(e){e.on("click",r,this)},this),this.getGroup("clear-button").each(function(e){var t=e.get("name");e.on("click",function(){this.submitSearchWithoutKey(t)},this)},this),d.prototype.bindEvents.apply(this,arguments)},e.prototype.submitSearchWithoutKey=function(e){if(e)h.call(this,e);else{var t=this;this.getGroup("clear-button").each(function(e){var i=e.get("name");h.call(t,i)})}this.fire("search")},e.prototype.enterDocument=function(){d.prototype.enterDocument.apply(this,arguments),this.updateBatchButtonStatus(),this.updateFilterPanelStatus(),this.updateSearchBoxStatus()},e.prototype.adjustLayout=function(){var e=this.get("table");if(e)e.adjustWidth()},e}),define("common/ListView",["require","common/util","ui/DrawerActionPanel","eoo","ub-ria/mvc/ListView"],function(require){function e(e){var i=s.findWhere(this.model.getStatusTransitions(),{statusName:e.name});if("click"===e.triggerType)if(i){var n={id:parseInt(e.args),status:i.status};this.fire("modifystatus",n)}else if("modify"===e.name){var r=e.args,a=t.call(this,r),o={url:a};this.popDrawerAction(o).show()}}function t(e){var t=this.model.get("url").getPath(),i=t.lastIndexOf("/"),n=t.substring(0,i+1)+"update~"+e;return n}function i(e){e.preventDefault();var t=String(e.target.get("href"));if("#"===t.charAt(0))t=t.slice(1);this.popDrawerAction({url:t}).show()}function n(e){e.preventDefault(),this.dispose()}function r(e){e.stopPropagation(),e.preventDefault(),this.hide()}function a(e){e.target.hide()}function o(){this.fire("close")}var s=require("common/util");require("ui/DrawerActionPanel");var exports={};exports.popDrawerAction=function(e){e.id=e.id||"drawer-action";var t=this.get(e.id);if(!t)t=this.create("DrawerActionPanel",e),t.render(),t.on("action@submitcancel",n),t.on("action@back",r),t.on("action@saveandclose",a),t.on("close",o,this);else t.setProperties(e);return t},exports.enterDocument=function(){this.$super(arguments),this.getSafely("create").on("click",i,this)},exports.commandHandler=e,exports.uiEvents={"table:command":e},exports.updateItem=function(e){var t=this.model.indexOf(e);if(0>t)throw new Error("No row found");this.get("table").updateRowAt(t,e)},exports.adjustLayout=function(){var e=this.get("table");if(e)e.adjustWidth()};var l=require("eoo").create(require("ub-ria/mvc/ListView"),exports);return l}),define("common/shim",[],function(){function e(){document.createElement("aside"),document.createElement("footer"),document.createElement("header"),document.createElement("nav"),document.createElement("section"),document.createElement("article"),document.createElement("figure"),document.createElement("figcaption"),document.createElement("time");for(var e="esui-",t=["button","calendar","crumb","dialog","label","month-view","pager","panel","range-calendar","region","rich-calendar","schedule","search-box","sidebar","select","tab","table","text-box","text-line","tip","tip-layer","tree","wizard","toast","validity","check-box","command-menu","box-group","action-panel","action-dialog","abstract-box-group","partial-form","rich-selector","sidebar","table-rich-selector","tree-rich-selector","toggle-button","toggle-panel","uploader"],i=t.length-1;i>-1;--i)document.createElement(e+t[i])}return{enable:e}}),define("common/main",["require","common/extension/ajax","common/shim","common/indicator","./GlobalData","er/Deferred"],function(require){function e(){var e=a.getInstance();return o.all(e.getUser())}function t(){var e=["er/config","er/permission","ub-ria","common/extension","common/config","common/account","common/Navigator"];if("object"!=typeof JSON)e.push("js!external/json2");require(e,function(e,t,n,r,a,o,s){r.enable(),e.indexURL=i(t),n.start(),o.init(),s.getInstance()})}function i(){return"/marker"}function n(){var e=window.DEBUG?"login.html":"login.html";throw location.href=e+location.hash,new Error("Failed to redirect to login")}function r(){e().then(t,n)}require("common/extension/ajax").enable(),require("common/shim").enable(),require("common/indicator").enable();var a=require("./GlobalData"),o=require("er/Deferred");return{start:r}}),define("common/text",["require"],function(){return{load:function(e,t,i){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.open("GET",t.toUrl(e),!0),n.onreadystatechange=function(){if(4===+n.readyState){if(n.status>=200&&n.status<300)i(n.responseText);n.onreadystatechange=new Function,n=null}},n.send(null)}}}),define("text",["common/text"],function(e){return e}),define("ub-ria/ui/AbstractBoxGroup",["require","underscore","esui/lib","esui/InputControl","esui/painters","esui/main"],function(require){function e(){h.apply(this,arguments)}function t(e){return i(e,"value")}function i(e,t){return e.getAttribute("data-ui-"+t)}function n(e,t,i){e.setAttribute("data-ui-"+t,i)}function r(e){return"checked"===i(e,"checked")}function a(e,n){for(var a=e.children,o=[],s=[],l=n.boxType,u=0,h=a.length;h>u;u++){var d=a[u];if(i(d,"box-type")===l)o.push({value:t(d),text:d.innerHTML||i(d,"text")});if(r(d))s.push(d.value)}if(n.datasource=o,!n.rawValue&&!n.value)n.rawValue=s}function o(e){if(!this.disabled&&!this.readOnly){var i=e.target,n="radio"===this.boxType?[]:l.clone(this.rawValue),r=t(i);if(l.contains(n,r))n=l.without(n,r);else n.push(r);this.set("rawValue",n)}}function s(e,t,i){e.helper.clearDOMEvents();for(var n="",r=e.helper.getPartClasses("wrapper"),a=u.toDictionary(e.rawValue),s=0;s<t.length;s++){var h=t[s],c={wrapperClass:r.concat(e.helper.getPartClasses("wrapper-"+s)).join(" "),id:e.helper.getId("box-"+s),boxType:e.boxType,text:u.trim(h.text),value:h.value,checked:a[h.value]?' data-ui-checked="checked"':"",className:e.helper.getPartClasses(i).join(" ")};n+=u.format(d,c)}e.main.innerHTML=n,l.each(e.getBoxElements(),function(e){this.helper.addDOMEvent(e,"click",o)},e)}var l=require("underscore"),u=require("esui/lib"),h=require("esui/InputControl");e.prototype.type="AbstractBoxGroup",e.prototype.initOptions=function(e){var t={datasource:[],orientation:"horizontal",boxType:"radio"};if(l.extend(t,e),!t.datasource.length)a(this.main,t);if(!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)};var d=['<div class="${wrapperClass}">','<div id="${id}" class="${className}" ${checked}','   data-ui-value="${value}" data-ui-box-type="${boxType}">',"${text}</div>","</div>"];return d=d.join(""),e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=h.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("esui/painters").createRepaint(h.prototype.repaint,{name:["datasource","boxType"],paint:s},{name:"rawValue",paint:function(e,i){i=i||[],e.rawValue=i;var a={};l.each(i,function(e){a[e]=!0}),l.each(e.getBoxElements(),function(i){n(i,"checked",a[t(i)]?"checked":"");var o=e.helper.getPartClasses("wrapper-checked")[0];if(r(i))u.addClass(i.parentNode,o);else u.removeClass(i.parentNode,o)})}},{name:"orientation",paint:function(e,t){e.removeState("vertical"),e.removeState("horizontal"),e.addState(t)}}),e.prototype.parseValue=function(e){return e.split(",")},e.prototype.getBoxElements=function(){var e=this.boxType;return l.filter(this.main.getElementsByTagName("div"),function(t){return i(t,"box-type")===e})},u.inherits(e,h),require("esui/main").register(e),e}),define("ui/CustomAbstractBoxGroup",["require","esui/lib","common/util","ub-ria/ui/AbstractBoxGroup","esui/InputControl","esui"],function(require){function e(){n.apply(this,arguments)}var t=require("esui/lib"),i=require("common/util"),n=require("ub-ria/ui/AbstractBoxGroup"),r=require("esui/InputControl");return t.inherits(e,n),e.prototype.type="CustomAbstractBoxGroup",e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=r.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue")){var n=t.rawValue.newValue,a=t.rawValue.oldValue,o=this.hasallvalue;if("checkbox"==this.boxType&&o&&n&&a&&!parseInt(this.hasselfset)){if(n.indexOf(o)>=0&&a.indexOf(o)<0&&n.length>1||n.length==this.getBoxElements().length-1&&n.indexOf(o)<0||0==n.length)return this.hasselfset=1,this.setValue(o),void(this.hasselfset=0);if(n.indexOf(o)>=0&&a.indexOf(o)>=0)return n.splice(n.indexOf(o),1),this.hasselfset=1,this.setValue(n.join(",")),void(this.hasselfset=0);return}if(this.originValue&&"radio"==this.boxType&&n&&a&&parseInt(this.originValue)>0){var s=(parseInt(this.originValue),i.getIndexOfList(this.datasource,"value",this.originValue));if(s>=0)this.main.children[s].classList.add("origin-value-box");if(this.originValue===n[0])this.main.parentElement.classList.add("origin-equal-value");else if(this.originValue===a[0])this.main.parentElement.classList.remove("origin-equal-value")}this.fire("change")}},require("esui").register(e),e}),define("ui/AttachTagBoxGroup",["require","esui/lib","ui/CustomAbstractBoxGroup","esui/Label","esui/main","common/util","esui/InputControl","esui/painters","esui"],function(require){function e(){a.apply(this,arguments)}function t(e,t){e.helper.clearDOMEvents(),e.helper.disposeChildren(),e.main.innerHTML="",e.children=[],r.each(r.keys(e.childrenIndex),function(t){delete e.childrenIndex[t]});for(var i=0;i<t.length;i++){var a=document.createElement("div");a.classList.add("box-group-container");var o=t[i],s={text:o.text+":",title:o.text},l={boxType:e.boxType,datasource:o.source,alias:o.alias,hasallvalue:e.hasallvalue||null,hasselfset:e.hasselfset||0};if(e.originValue)l.originValue=e.originValue[o.alias];var u=n.create("Label",s),h=n.create("CustomAbstractBoxGroup",l);e.addChild(u),e.addChild(h,h.alias),u.appendTo(a),h.appendTo(a),e.main.appendChild(a)}}var i=require("esui/lib"),n=(require("ui/CustomAbstractBoxGroup"),require("esui/Label"),require("esui/main")),r=require("common/util"),a=require("esui/InputControl");return i.inherits(e,a),e.prototype.type="AttachTagBoxGroup",e.prototype.initOptions=function(e){var t={datasource:[],boxType:"radio"};if(r.extend(t,e),!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)},e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=a.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.refresh=function(){t(this,this.datasource,this.boxType)},e.prototype.repaint=require("esui/painters").createRepaint(a.prototype.repaint,{name:["datasource","boxType"],paint:t},{name:"rawValue",paint:function(e,t){t=t||[],e.rawValue=t;var i=r.filter(e.children,function(e){return"CustomAbstractBoxGroup"===e.type});for(var n in t){var a=r.find(i,function(e){return e.alias===n});if(a)a.setValue(t[n])}}}),e.prototype.getRawValue=function(){var e=r.filter(this.children,function(e){return"CustomAbstractBoxGroup"===e.type}),t={};return r.each(e,function(e){t[e.alias]=e.getValue()}),t},e.prototype.setRawValue=function(e){var t=r.filter(this.children,function(e){return"CustomAbstractBoxGroup"===e.type});for(var i in e){var n=r.find(t,function(e){return e.alias===i});if(n)n.setValue(e[i])}},require("esui").register(e),e}),define("ui/BaseChart",["require","esui/lib","esui/Control","esui/controlHelper","echarts","esui"],function(require){function e(){n.apply(this,arguments)}function t(e){var t=e.chart;t.setOption(e.chartOptions)}var i=require("esui/lib"),n=require("esui/Control"),r=require("esui/controlHelper"),a=require("echarts");i.inherits(e,n),e.prototype.type="BaseChart",e.defaultProperties={height:"300px",datasource:null,width:""},e.prototype.initOptions=function(t){var n={};i.extend(n,e.defaultProperties,t),this.setProperties(n)};var o='<div class="${className}"><div id="${chartId}" style="height:${height}; width: ${width}; margin:0;"></div></div>';return e.prototype.initStructure=function(){var e=r.getId(this,"main"),t={className:r.getPartClasses(this,"frame").join(" "),chartId:e,height:this.get("height")};if(this.get("width"))t.width=this.get("width");this.main.innerHTML=i.format(o,t);var n=a.init(i.g(e));this.chart=n,r.addDOMEvent(this,window,"resize",function(){n.resize()})},e.prototype.repaint=r.createRepaint(n.prototype.repaint,{name:[],paint:function(e){e.chartOptions=e.initChartOptions(),t(e)}}),e.prototype.dispose=function(){if(!r.isInStage(this,"DISPOSED"))n.prototype.dispose.apply(this,arguments)},require("esui").register(e),e}),define("ui/BarChart",["require","esui/lib","common/util","./BaseChart","esui/controlHelper","echarts/chart/bar","esui"],function(require){function e(){n.apply(this,arguments)}var t=require("esui/lib"),i=require("common/util"),n=require("./BaseChart"),r=require("esui/controlHelper");return require("echarts/chart/bar"),t.inherits(e,n),e.prototype.type="BarChart",e.prototype.repaint=r.createRepaint(n.prototype.repaint),e.prototype.initChartOptions=function(){var e=this.get("color").split(","),t=this.get("datasource"),n=i.map(t,function(t,i){return{name:t.name,type:"bar",itemStyle:{normal:{color:e[i],barBorderRadius:0}},data:t.data}});return{legend:{show:!1,data:["正确率"]},toolbox:{show:!1,feature:{}},calculable:!1,xAxis:[{type:"category",splitArea:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},axisLine:{lineStyle:{color:"#eee",width:2,type:"solid"}},data:["准确率"]}],yAxis:[{show:!1,min:0,max:100}],series:n,grid:{borderWidth:0,x:10,y:40,x2:10,y2:10}}},e.prototype.refresh=function(e){this.set("datasource",e),this.repaint()},require("esui").register(e),e}),define("ui/LineChart",["require","esui/lib","./BaseChart","esui/controlHelper","echarts/chart/line","esui"],function(require){function e(){i.apply(this,arguments)}var t=require("esui/lib"),i=require("./BaseChart"),n=require("esui/controlHelper");return require("echarts/chart/line"),t.inherits(e,i),e.prototype.type="LineChart",e.prototype.repaint=n.createRepaint(i.prototype.repaint),e.prototype.initChartOptions=function(){return{tooltip:{trigger:"axis"},legend:{show:!1,data:["意向"]},toolbox:{show:!0,feature:{}},calculable:!1,xAxis:[{axisLine:{show:!0,lineStyle:{color:"#ccc"}},axisTick:{inside:!0,lineStyle:{color:"#ccc"}},boundaryGap:!0,type:"category",splitLine:{show:!1},data:this.get("datasource").xAxisData}],yAxis:[{axisLine:{show:!1},scale:!0,type:"value",splitArea:{show:!1},splitLine:{lineStyle:{color:"#bbb",type:"dashed",width:.5}}}],series:[{name:"维度",type:"line",smooth:!1,itemStyle:{normal:{color:"#6e86e8",areaStyle:{type:"default",color:"rgba(232,238,254,0.7)"}}},data:this.get("datasource").seriesData,symbol:"circle"}],grid:{borderWidth:0}}},e.prototype.refresh=function(e){this.set("datasource",e),this.repaint()},require("esui").register(e),e}),define("ui/PieChart",["require","esui/lib","common/util","./BaseChart","esui/controlHelper","echarts/chart/pie","esui"],function(require){function e(){i.apply(this,arguments)}var t=require("esui/lib"),i=(require("common/util"),require("./BaseChart")),n=require("esui/controlHelper");return require("echarts/chart/pie"),t.inherits(e,i),e.prototype.type="PieChart",e.prototype.repaint=n.createRepaint(i.prototype.repaint),e.prototype.initChartOptions=function(){return{title:{text:this.get("title"),subtext:this.get("subtitle"),x:"center",y:30,textStyle:{color:"#666"},subtextStyle:{color:"#adadad"}},color:this.get("color").split(","),tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",y:"center",data:this.get("datasource").legend},toolbox:{show:!0,feature:{}},calculable:!0,series:this.getSeriesFromDataSource()}},e.prototype.refresh=function(e,t){this.set("datasource",e),this.repaint(),this.chart.setSeries(this.getSeriesFromDataSource(),!0),this.chart.getDom().style.height=t,this.chart.resize(),this.chart.restore()},e.prototype.getSeriesFromDataSource=function(){var e,t=this.get("datasource");if(1==t.data.length)e=[{name:this.get("title"),type:"pie",radius:"55%",center:["50%","60%"],data:this.get("datasource").data[0]}];else if(2==t.data.length)e=[{name:t.name[0]+this.get("title"),type:"pie",radius:"55%",center:["25%","60%"],data:this.get("datasource").data[0]},{name:t.name[1]+this.get("title"),type:"pie",radius:"55%",center:["75%","60%"],data:this.get("datasource").data[1]}];return e},require("esui").register(e),e}),define("ui/TagBoxGroup",["require","esui/lib","ui/AttachTagBoxGroup","esui/Label","esui/main","common/util","esui/InputControl","esui/painters","esui"],function(require){function e(){a.apply(this,arguments)}function t(e,t){e.helper.clearDOMEvents(),e.helper.disposeChildren(),e.main.innerHTML="",e.children=[],r.each(r.keys(e.childrenIndex),function(t){delete e.childrenIndex[t]});for(var i=0;i<t.length;i++){var a=document.createElement("div");a.classList.add("attach-box-group-container");var o=t[i],s=document.createElement("h3");s.classList.add("attach-box-group-title"),s.innerHTML=o.text+"：";var l={boxType:e.boxType,datasource:o.datasource,alias:o.name};if(e.originValue){var u=r.find(e.originValue,function(e){return e.name===o.name});l.originValue=u&&u.value}var h=n.create("AttachTagBoxGroup",l);e.addChild(h,h.alias),a.appendChild(s),h.appendTo(a),e.main.appendChild(a)}}var i=require("esui/lib");require("ui/AttachTagBoxGroup"),require("esui/Label");var n=require("esui/main"),r=require("common/util"),a=require("esui/InputControl");return i.inherits(e,a),e.prototype.type="TagBoxGroup",e.prototype.initOptions=function(e){var t={datasource:[],boxType:"radio"};
if(r.extend(t,e),!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)},e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=a.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.refresh=function(){t(this,this.datasource,this.boxType)},e.prototype.repaint=require("esui/painters").createRepaint(a.prototype.repaint,{name:["datasource","boxType"],paint:t},{name:"rawValue",paint:function(e,t){t=t||[],e.rawValue=t;var i=r.filter(e.children,function(e){return"AttachTagBoxGroup"===e.type});r.each(r.keys(t),function(e){var n=r.find(i,function(t){return t.alias===e});if(n)n.setValue(t[e])})}}),e.prototype.getRawValue=function(){var e=r.filter(this.children,function(e){return"AttachTagBoxGroup"===e.type}),t={};return r.each(e,function(e){t[e.alias]=e.getRawValue()}),t},e.prototype.setRawValue=function(e){var t=r.filter(this.children,function(e){return"AttachTagBoxGroup"===e.type});r.each(r.keys(e),function(i){var n=r.find(t,function(e){return e.alias===i});if(n)n.setRawValue(e[i])})},require("esui").register(e),e}),define("ub-ria/ui/RichSelector",["require","esui/Label","esui/Panel","esui/SearchBox","esui/lib","esui/painters","esui/InputControl","underscore","esui"],function(require){function e(){a.apply(this,arguments)}function t(){this.search()}function i(e){e.removeState("queried");var t=e.getSearchBox();if(t)t.set("text","")}require("esui/Label"),require("esui/Panel"),require("esui/SearchBox");var n=require("esui/lib"),r=require("esui/painters"),a=require("esui/InputControl"),o=require("underscore");return n.inherits(e,a),e.prototype.type="RichSelector",e.prototype.initOptions=function(e){var t={height:340,width:200,hasHead:!0,title:"标题名",needBatchAction:!1,batchActionLabel:"批量操作",hasSearchBox:!0,hasFoot:!0,itemName:"结果",emptyText:"没有相应的搜索结果",holdState:!1,mode:"add",multi:!0};if("false"===e.hasHead)e.hasHead=!1;if("false"===e.hasSearchBox)e.hasSearchBox=!1;if("false"===e.hasFoot)e.hasFoot=!1;if("false"===e.holdState)e.holdState=!1;if("false"===e.multi)e.multi=!1;n.extend(t,e),t.width=Math.max(200,t.width),this.setProperties(t)},e.prototype.getHeadHTML=function(){var e=this.helper,t="";if(this.needBatchAction){var i=e.getPartClassName("batch-action-link"),r=this.helper.getId("batch-action");t='<span class="'+i+'" id="'+r+'" >'+this.batchActionLabel+"</span>"}var a=['<div data-ui="type:Panel;childName:head;"',' class="${headClass}">','<h3 data-ui="type:Label;childName:title;">',"${title}</h3>","${actionLink}","</div>"].join("\n");return a=n.format(a,{headClass:e.getPartClassName("head"),title:this.title,actionLink:t})},e.prototype.getFootHTML=function(){return['<div data-ui="type:Panel;childName:foot;"',' class="'+this.helper.getPartClassName("foot")+'">','<span data-ui="type:Label;childName:totalCount">',"</span>","</div>"].join("\n")},e.prototype.initStructure=function(){var e=["${head}",'<div data-ui="type:Panel;childName:body;"',' class="${bodyClass}">',"${searchInput}",'<div data-ui="type:Panel;childName:content"',' class="${contentClass}">','<div data-ui="type:Label;childName:emptyText"',' class="${emptyTextClass}">${emptyText}</div>','<div data-ui="type:Panel;childName:queryList"',' class="${queryListClass}">',"</div>","</div>","</div>","${footInfo}"],i=this.helper,r="";if(this.hasHead)r=this.getHeadHTML();var a="";if(this.hasSearchBox){var s=this.width-45;a=['<div data-ui="type:Panel;childName:searchBoxArea"',' class="${searchWrapperClass}">','<div data-ui="type:SearchBox;childName:itemSearch;"',' data-ui-skin="magnifier"',' data-ui-width="'+s+'">',"</div>","</div>",'<div data-ui="type:Panel;','childName:generalQueryResultArea"',' class="${generalQueryResultClass}"',' id="${queryResultId}">','<span class="${linkClass}" id="${linkId}">清空</span>','共找到<span id="${queryResultCountId}"></span>个',"</div>"].join("\n"),a=n.format(a,{searchWrapperClass:i.getPartClassName("search-wrapper"),generalQueryResultClass:i.getPartClassName("query-result-general"),queryResultCountId:i.getId("result-count"),linkClass:i.getPartClassName("clear-query-link"),linkId:i.getId("clear-query")})}var l="";if(this.hasFoot)l=this.getFootHTML();if(this.main.style.width=this.width+"px",this.main.innerHTML=n.format(e.join("\n"),{head:r,bodyClass:i.getPartClassName("body"),searchInput:a,contentClass:i.getPartClassName("content-wrapper"),emptyTextClass:i.getPartClassName("empty-text"),emptyText:this.emptyText,queryListClass:i.getPartClassName("query-list"),footInfo:l}),this.initChildren(),"load"===this.mode)this.addState("load");else if("add"===this.mode)this.addState("add");else this.addState("del");var u=i.getPart("batch-action");if(u)i.addDOMEvent(u,"click",o.bind(this.batchAction,this));var h=i.getPart("clear-query");if(h)i.addDOMEvent(h,"click",o.bind(this.clearQuery,this));var d=this.getSearchBox();if(d)d.on("search",t,this);var c=this.getQueryList().main;i.addDOMEvent(c,"click",o.bind(this.eventDispatcher,this))},e.prototype.eventDispatcher=function(){return!1},e.prototype.search=function(){var e={filterData:[]};if(e=this.fire("search",e),!e.isDefaultPrevented()){var t=this.getSearchBox();if(t){var i={value:n.trim(t.getValue())};e.filterData.push(i)}}if(e.filterData.length)this.queryItem(e.filterData),this.refreshResult(),this.refreshFoot(),this.addState("queried"),this.adjustHeight();else this.clearQuery()},e.prototype.refreshResult=function(){var e=this.getCurrentStateItemsCount(),t=this.helper.getPart("result-count");if(t)t.innerHTML=e},e.prototype.clearQuery=function(){return i(this),this.clearData(),this.refreshResult(),this.refreshContent(),this.refreshFoot(),this.adjustHeight(),this.fire("clearquery"),!1},e.prototype.getContent=function(){var e=this.getChild("body");if(e)return e.getChild("content");else return null},e.prototype.getKeyword=function(){var e=this.getSearchBox(),t=this.isQuery();if(e&&t)return n.trim(e.getValue());else return null},e.prototype.getQueryList=function(){var e=this.getContent();if(e)return e.getChild("queryList");else return null},e.prototype.getSearchBox=function(){var e=this.getChild("body").getChild("searchBoxArea");if(e)return e.getChild("itemSearch");else return void 0},e.prototype.getTotalCountPanel=function(){var e=this.getChild("foot");if(!e)return null;else return e.getChild("totalCount")},e.prototype.isQuery=function(){return this.hasState("queried")},e.prototype.batchAction=function(){if("delete"===this.mode)this.deleteAll(),this.refreshFoot();else if("add"===this.mode)this.selectAll();return!1},e.prototype.deleteAll=function(){return!1},e.prototype.addAll=function(){return!1},e.prototype.adjustHeight=function(){var e=this.height,t=28,i=this.hasSearchBox?45:0,n=this.hasFoot?25:0,r=e-t-i-n;if(this.isQuery())r-=30;var a=this.getContent().main;a.style.height=r+"px"},e.prototype.adaptData=function(){},e.prototype.refresh=function(){var e=this.adaptData(),t=!0;if(this.hasSearchBox&&this.isQuery())if(this.holdState)this.search(this.getKeyword()),t=!1;else i(this);if(t)this.refreshContent(),this.processDataAfterRefresh(e),this.refreshFoot(),this.adjustHeight()},e.prototype.processDataAfterRefresh=function(){},e.prototype.refreshFoot=function(){if(this.hasFoot){var e=this.getCurrentStateItemsCount(),t=this.getTotalCountPanel();if(t){var i=o.escape(this.itemName);t.setText("共 "+e+" 个"+i)}}},e.prototype.getCurrentStateItemsCount=function(){return 0},e.prototype.repaint=r.createRepaint(a.prototype.repaint,{name:"title",paint:function(e,t){var i=e.getChild("head"),n=i&&i.getChild("title");n&&n.setText(t)}}),e.prototype.getSelectedItems=function(){return[]},e.prototype.selectItems=function(){},e.prototype.setRawValue=function(e){this.rawValue=e,this.selectItems(e,!0)},e.prototype.getRawValue=function(){return this.getSelectedItems()},e.prototype.stringifyValue=function(e){var t=[];return o.each(e,function(e){t.push(e.id)}),t.join(",")},require("esui").register(e),e}),define("ub-ria/ui/SelectorTreeStrategy",["require","esui/lib","esui/TreeStrategy"],function(require){function e(e){var i={defaultExpand:!0,orientExpand:!1};t.extend(this,i,e)}var t=require("esui/lib"),i=require("esui/TreeStrategy");return t.inherits(e,i),e.prototype.isLeafNode=function(e){return!e.children},e.prototype.shouldExpand=function(){return this.orientExpand},e.prototype.enableSelectStrategy=function(e){var t=this;e.on("select",function(e){var i=!0,n=t.isLeafNode(e.node);if("load"!==t.mode){if(t.onlyLeafSelect&&!n)i=!1}else if(!n)i=!1;if(i)this.selectNode(e.node.id)}),e.on("unselect",function(t){if(e.get("allowUnselectNode"))e.unselectNode(t.node.id)})},e}),define("ub-ria/ui/TreeRichSelector",["require","esui/Tree","esui/painters","esui/main","esui/lib","underscore","../util","./RichSelector","./SelectorTreeStrategy","esui"],function(require){function e(){m.apply(this,arguments)}function t(e,t,n){var r=e.getQueryList().getChild("tree"),a=e.indexData,o=a[t];if(o){if(!e.multi&&n)i(e),e.currentSeletedId=t;if(e.setItemState(t,"isSelected",n),n)r.selectNode(t,!0);else r.unselectNode(t,!0)}}function i(e){var t=e.currentSeletedId;if(t){var i=e.getQueryList().getChild("tree");i.unselectNode(t),e.currentSeletedId=null}}function n(e,i,n){if(e.needSyncParentChild){var r=e.indexData,a=i.node,o=a.children||[];f.each(o,function(i){if(t(e,i.id,n),i.children)f.each(i.children,function(i){t(e,i.id,n)})});var s=i.parentId,l=r[s];if(l){var u=l.node.children||[],h=!0;f.each(u,function(t){if(!e.getItemState(t.id,"isSelected"))h=!1}),t(e,s,h)}}}function r(e,t){var i,n=e.indexData,a=n[t],o=a.parentId,s=n[o];if(!s)i=e.allData;else i=s.node;var l=i.children||[],h=f.without(l,a.node);if(0===h.length&&o!==u(e))r(e,o);else i.children=h,e.refresh()}function a(e){var t=e.children;return f.filter(t,function(e){return this.getItemState(e.id,"isSelected")},this)}function o(e,t){var i=[],n=t.children;return f.each(n,function(t){var n;if(-1!==t.text.indexOf(e))n=f.clone(t);if(t.children&&t.children.length){var r=o(e,t);if(r.length>0){if(!n)n=f.clone(t);n.children=r}}if(n)i.push(n)}),i}function s(e){return!e.children}function l(e,t,i){var n=1;if(i){if(s(t))if(!t.id||t.id===u(e))return 0;else return 1;n=0}else if(t.id===u(e))n=0;return n+=f.reduce(t.children,function(t,n){return t+l(e,n,i)},0)}function u(e){return e.datasource.id}require("esui/Tree");var h=require("esui/painters"),d=require("esui/main"),c=require("esui/lib"),f=require("underscore"),p=require("../util"),m=require("./RichSelector"),g=require("./SelectorTreeStrategy");return c.inherits(e,m),e.prototype.type="TreeRichSelector",e.prototype.styleType="RichSelector",e.prototype.initOptions=function(e){var t={datasource:null,orientExpand:!1,wideToggleArea:!1,onlyLeafSelect:!0,allowUnselectNode:!1,hideRoot:!0,needSyncParentChild:!0};if(c.extend(t,e),"false"===t.onlyLeafSelect)t.onlyLeafSelect=!1;if("false"===t.orientExpand)t.orientExpand=!1;if("false"===t.hideRoot)t.hideRoot=!1;if("false"===t.wideToggleArea)t.wideToggleArea=!1;if("false"===t.multi)t.multi=!1;if(t.multi===!1)t.onlyLeafSelect=!0;if("false"===t.needSyncParentChild)t.needSyncParentChild=!1;m.prototype.initOptions.call(this,t)},e.prototype.initStructure=function(){if(m.prototype.initStructure.apply(this,arguments),c.addClass(this.main,"ui-tree-richselector"),this.onlyLeafSelect)this.addState("only-leaf-selectable")},e.prototype.repaint=h.createRepaint(m.prototype.repaint,{name:"datasource",paint:function(e){e.refresh()}},{name:"selectedData",paint:function(e,t){var i=e.allData;if(i&&i.children){var n=e.getSelectedItems();e.selectItems(n,!1),e.selectItems(t,!0),e.fire("add"),e.fire("change")}}}),e.prototype.adaptData=function(){var e=[];this.allData=this.datasource;var t={};if(this.allData&&this.allData.children)this.walkTree(this.allData,this.allData.children,function(i,n){if(t[n.id]={parentId:i.id,node:n,isSelected:!1},n.hasOwnProperty("isSelected"))t[n.id].isSelected=n.isSelected;if(t[n.id].isSelected===!0)e.push(n)});return this.indexData=t,{indexData:t,selectedData:e}},e.prototype.processDataAfterRefresh=function(e){if("delete"!==this.mode)this.selectItems(e.selectedData,!0)},e.prototype.refreshContent=function(){var e=this.isQuery()?this.queriedData:this.allData;if(!e||!e.children||!e.children.length)this.addState("empty");else this.removeState("empty");if(e&&e.children){var t=this.getQueryList(),i=t.getChild("tree");if(!i){var n={childName:"tree",datasource:e,allowUnselectNode:this.allowUnselectNode,strategy:new g({mode:this.mode,onlyLeafSelect:this.onlyLeafSelect,orientExpand:this.orientExpand}),wideToggleArea:this.wideToggleArea,hideRoot:this.hideRoot,selectMode:this.multi?"multiple":"single"};if(this.getItemHTML)n.getItemHTML=this.getItemHTML;if(this.itemTemplate)n.itemTemplate=this.itemTemplate;i=d.create("Tree",n),t.addChild(i),i.appendTo(t.main);var r=this;i.on("selectnode",function(e){var t=e.node;r.handlerAfterClickNode(t)}),i.on("unselectnode",function(e){r.setItemState(e.node.id,"isSelected",!1)})}else i.setProperties({datasource:p.deepClone(e),keyword:this.getKeyword()})}},e.prototype.getStateNode=function(e){return this.indexData[e]},e.prototype.getItemState=function(e,t){if(this.indexData[e]){var i=this.getStateNode(e);return i[t]}return null},e.prototype.setItemState=function(e,t,i){if(this.indexData[e]){var n=this.getStateNode(e);n[t]=i}},e.prototype.getDatasourceWithState=function(){var e=f.deepClone(this.datasource),t=this.indexData;return this.walkTree(e,e.children,function(e,i){i.isSelected=t[i.id].isSelected}),e},e.prototype.handlerAfterClickNode=function(e){var t=this.indexData[e.id];if(t)if("add"===this.mode)this.actionForAdd(t);else if("delete"===this.mode)this.actionForDelete(t);else if("load"===this.mode)this.actionForLoad(t)},e.prototype.actionForAdd=function(e){if(this.setItemState(e.node.id,"isSelected",!0),!this.multi){if(this.currentSeletedId)this.setItemState(this.currentSeletedId,"isSelected",!1);this.currentSeletedId=e.node.id}else n(this,e,!0);this.fire("add",{item:e.node}),this.fire("change")},e.prototype.selectAll=function(){var e=this.isQuery()?this.queriedData:this.allData,i=e.children,n=this.getLeafItems(i,!1),r=this;f.each(n,function(e){t(r,e.id,!0)}),this.fire("add"),this.fire("change")},e.prototype.selectItems=function(e,i){var r=this.indexData;if(r){var a=this;f.each(e,function(e){var o=void 0!==e.id?e.id:e,s=r[o];if(null!=s&&void 0!==s)t(a,o,i),n(a,s,i)})}},e.prototype.actionForDelete=function(e){var t=this.fire("delete",{items:[e.node]});if(!t.isDefaultPrevented())r(this,e.node.id),this.fire("change")},e.prototype.deleteAll=function(){var e=this.fire("delete",{items:this.allData.children});if(!e.isDefaultPrevented())this.set("datasource",null),this.fire("change")},e.prototype.actionForLoad=function(e){if(this.setItemState(e.node.id,"isActive",!0),this.currentActiveId)if(this.setItemState(this.currentActiveId,"isActive",!1),!this.getStateNode(this.currentActiveId).isSelected){var t=this.getQueryList().getChild("tree");t.unselectNode(this.currentActiveId,!0)}this.currentActiveId=e.node.id,this.fire("load",{item:e.node}),this.fire("change")},e.prototype.getLeafItems=function(e,t){e=e||this.allData&&this.allData.children||[];var i=[],n=this;return f.each(e,function(e){if(s(e)){var r=t===this.getItemState(e.id,"isSelected");if("delete"===n.mode||r)i.push(e)}else i=f.union(i,n.getLeafItems(e.children,t))},this),i},e.prototype.getSelectedItems=function(){if(!this.allData)return[];var e=[],t=this;return this.walkTree(this.allData,this.allData.children,function(i,n){if(t.getStateNode(n.id).isSelected)e.push(n)}),e},e.prototype.getSelectedTree=function(){var e=this,t=p.deepClone(this.allData),i=t.children;f.each(i,function(t){var i=a(t,e);if(i.length)t.children=i;else t.children=null});var n=f.filter(i,function(e){return e.children});return t.children=n,t},e.prototype.clearQuery=function(){if(m.prototype.clearQuery.apply(this,arguments),"delete"!==this.mode){var e=this.getSelectedItems();this.selectItems(e,!0)}return!1},e.prototype.clearData=function(){this.queriedData={}},e.prototype.queryItem=function(e){var t=e[0].value,i=[];i=o(t,this.allData),this.queriedData={id:u(this),text:"符合条件的结果",children:i},this.addState("queried"),this.refreshContent();var n=this.getSelectedItems();if("delete"!==this.mode)this.selectItems(n,!0)},e.prototype.walkTree=function(e,t,i){f.each(t,function(t){i(e,t),this.walkTree(t,t.children,i)},this)},e.prototype.getFilteredItemsCount=function(){var e=this.isQuery()?this.queriedData:this.allData,t=l(this,e,!0);return t},e.prototype.getCurrentStateItemsCount=function(){var e=this.isQuery()?this.queriedData:this.allData;if(!e)return 0;var t=l(this,e,!0);return t},require("esui").register(e),e}),define("ui/TradeChoosePanel",["require","esui/lib","esui/main","ub-ria/ui/TreeRichSelector","common/util","esui/InputControl","esui/painters","esui"],function(require){function e(){u.apply(this,arguments)}function t(e){return e.children[0].id}function i(e,t){var i=l.map(e.children,function(e){return e.id});return i.indexOf(t)}function n(e){var t=[];return l.each(l.keys(e),function(i){var n={id:i,text:e[i].name};t.push(n)}),t}function r(e,t){e.helper.clearDOMEvents(),e.helper.disposeChildren();var i=[{text:"一级行业",alias:"firstTrade"},{text:"二级行业",alias:"secondTrade"},{text:"三级行业",alias:"thirdTrade"}];l.each(i,function(i){var r={onlyLeafSelect:!0,multi:!1,width:90,height:200,hasFoot:!1,hasHead:!1,hasSearchBox:!1,datasource:{id:0,text:i.text}};if("firstTrade"===i.alias)r.datasource.children=n(t);else r.datasource.children=[];var a=document.createElement("div");a.classList.add("rich-selector-group");var o=s.create("TreeRichSelector",r);e.addChild(o,i.alias),o.appendTo(a),e.main.appendChild(a)}),e.addEvent()}function a(e,t){var i=e.childrenIndex.body.main.children[0];i.scrollTop=35*t}var o=require("esui/lib"),s=require("esui/main");require("ub-ria/ui/TreeRichSelector");var l=require("common/util"),u=require("esui/InputControl");return o.inherits(e,u),e.prototype.type="TradeChoosePanel",e.prototype.initOptions=function(e){var t={datasource:[]};if(l.extend(t,e),!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)},e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=u.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("esui/painters").createRepaint(u.prototype.repaint,{name:["datasource"],paint:r},{name:"rawValue",paint:function(e,t){t=t||[]}}),e.prototype.getDefaultValue=function(){var e=this.datasource,t=l.keys(e)[0],i=e[t].data,n=i[l.keys(i)[0]].data;return l.keys(n)[0]},e.prototype.addEvent=function(){var e=this.childrenIndex.firstTrade,t=this.childrenIndex.secondTrade;e.on("add",function(e){var t=e.item.id;this.handleFirstSelect(t)},this),t.on("add",function(e){var t=e.item.id;this.handleSecondSelect(t)},this)},e.prototype.handleFirstSelect=function(e){var i=this.childrenIndex.secondTrade,r=this.childrenIndex.thirdTrade;i.datasource={id:0,text:"二级行业",children:n(this.datasource[e].data)};var o=l.keys(this.datasource[e].data)[0];r.datasource={id:0,text:"三级行业",children:n(this.datasource[e].data[o].data)},delete i.currentSeletedId,delete r.currentSeletedId,i.refresh(),r.refresh(),i.selectItems([o],!0),r.selectItems([t(r.datasource)],!0),a(i,0),a(r,0)},e.prototype.handleSecondSelect=function(e){var i=this.childrenIndex.firstTrade,r=this.childrenIndex.thirdTrade;r.datasource={id:0,text:"三级行业",children:n(this.datasource[i.getValue()].data[e].data)},delete r.currentSeletedId,r.refresh(),r.selectItems([t(r.datasource)],!0),a(r,0)},e.prototype.getRawValue=function(){return this.childrenIndex.thirdTrade.getValue()},e.prototype.getContent=function(){var e="";return l.each(this.children,function(t){e+=t.getRawValue()[0].text+"-"}),e.slice(0,e.length-1)},e.prototype.setRawValue=function(e){var t=e.slice(0,2);this.childrenIndex.firstTrade.selectItems([t],!0),this.handleFirstSelect(t);var n=parseInt(e.slice(2,4),10)+"";this.childrenIndex.secondTrade.selectItems([n],!0),this.handleSecondSelect(n),this.childrenIndex.thirdTrade.selectItems([e],!0),l.each(this.children,function(e){a(e,i(e.datasource,e.getValue()))},this)},require("esui").register(e),e}),define("ui/TagAssembeArea",["require","esui/lib","esui/main","./AttachTagBoxGroup","./TagBoxGroup","./TradeChoosePanel","esui/Label","esui/Panel","esui/Button","esui/TextBox","common/util","esui/InputControl","esui/painters","esui"],function(require){function e(){c.apply(this,arguments)}function t(e,t){d.each(t,function(t){e.classList.add(t)})}function i(e,i){var n=document.createElement(e);return t(n,i),n}function n(e){e.helper.clearDOMEvents(),e.helper.disposeChildren(),a(e,e.isAudit,e.third,e.tagedThird);var t=s(e,e.comment);l(e,e.isAudit),e.main.appendChild(t.node),e.childrenIndex.comment.appendTo(t.textContainer),o(e,e.tradeList),e.addEvent(),e.childrenIndex.tradePanel.toggle()}function r(e){var t=e.childrenIndex.tradeText,i=e.childrenIndex.beforeIcon,n=e.childrenIndex.beforeText;if(t.getText()===e.tagedThird)i.main.classList.remove("after-icon"),n.main.classList.remove("after-color");else i.main.classList.add("after-icon"),n.main.classList.add("after-color")}function a(e,n,r,a){var o=i("div",["single-operation-zone","form-field","trade-name-area"]),s=null,l=h.create("Label",{title:"行业分类",text:"行业分类："});l.main.classList.add("form-field-label"),l.appendTo(o);var u=h.create("Button",{content:"修改",skin:"link"});if(u.main.classList.add("operation-zone-button"),e.addChild(u,"modifyButton"),"true"===n&&a){var d=h.create("Label",{title:"前",text:"前"});d.main.classList.add("before-icon");var c=h.create("Label",{title:a,text:a});if(t(c.main,["operation-zone-tadeName","audit-without-float"]),r!==a)d.main.classList.add("after-icon"),c.main.classList.add("after-color");var f=i("div",["audit-trade-compare"]),p=h.create("Label",{title:"后",text:"后"});p.main.classList.add("before-icon"),s=h.create("Label",{title:r,text:r}),t(s.main,["operation-zone-tadeName","audit-without-float"]),p.appendTo(f),s.appendTo(f),u.appendTo(f),e.addChild(d,"beforeIcon"),e.addChild(c,"beforeText"),d.appendTo(o),c.appendTo(o),o.appendChild(f)}else s=h.create("Label",{title:r,text:r}),t(s.main,["operation-zone-tadeName"]),s.appendTo(o),u.appendTo(o);e.addChild(s,"tradeText"),e.main.appendChild(o)}function o(e,t){var n=h.create("Panel",{});n.main.classList.add("trade-list");var r=i("div",["trade-list-container"]),a=h.create("TradeChoosePanel",{datasource:t});e.addChild(n,"tradePanel"),e.addChild(a,"tradeList"),a.appendTo(r),n.main.appendChild(r),e.main.appendChild(n.main)}function s(e,t){var n=i("div",["single-operation-zone","comment-area"]),r=i("div",["form-field"]),a=h.create("Label",{title:"备注",text:"备注："});a.main.classList.add("form-field-label");var o=i("div",["form-field-value"]),s=h.create("TextBox",{width:250,title:"备注",mode:"textarea",height:25});return s.setValue(t),e.addChild(s,"comment"),a.appendTo(r),r.appendChild(o),n.appendChild(r),{node:n,textContainer:o}}function l(e,n){var r=i("div",["attach-tag-group"]),a=["attach-tagbox--group"],o={name:"attachTag",datasource:e.attachDatasource||[],value:e.attachValue||{},boxType:"radio"};if("true"===n&&e.tagedThird)o.originValue=e.attachOriginValue||{},a.push("audit-box-group");var s=h.create("TagBoxGroup",o);t(s.main,a),e.addChild(s,"attachTag"),s.appendTo(r),e.main.appendChild(r)}var u=require("esui/lib"),h=require("esui/main");require("./AttachTagBoxGroup"),require("./TagBoxGroup"),require("./TradeChoosePanel"),require("esui/Label"),require("esui/Panel"),require("esui/Button"),require("esui/TextBox");var d=require("common/util"),c=require("esui/InputControl");return u.inherits(e,c),e.prototype.type="TagAssembeArea",e.prototype.initOptions=function(e){var t={wuliaoId:"",isAudit:!1,third:null,tagedThird:null,tradeId:null,comment:"",tradeList:{},attachDatasource:[],attachValue:{},attachOriginValue:{},sample:""};if(d.extend(t,e),!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)},e.prototype.addEvent=function(){var e=this.childrenIndex.modifyButton,t=this.childrenIndex.tradePanel,i=this.childrenIndex.tradeList,n=this.childrenIndex.comment;this.helper.addDOMEvent(e.main,"click",function(){if(this.fire("toggleTradePanel",{clickButton:e.main,tradePanel:t}),t.toggle(),this.tradeId&&6===this.tradeId.length)i.setRawValue(this.tradeId);else i.setRawValue(i.getDefaultValue())},this),n.on("input",function(e){this.comment=e.target.getValue()},this),this.helper.addDOMEvent(t.main,"click",function(e){e.stopPropagation()},this)},e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=c.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("esui/painters").createRepaint(c.prototype.repaint,{name:["datasource"],paint:n},{name:"rawValue",paint:function(e,t){t=t||[]}}),e.prototype.getRawValue=function(){return{comment:this.childrenIndex.comment.getValue(),tradeId:this.tradeId,tag:this.childrenIndex.attachTag.getRawValue(),third:this.third,sample:this.sample}},e.prototype.hideTradePanel=function(){var e=this.childrenIndex.tradePanel,t=this.childrenIndex.tradeText,i=this.childrenIndex.tradeList;if(i.getRawValue()&&!e.isHidden()){if(this.tradeId=i.getRawValue(),this.third=i.getContent(),t.setText(i.getContent()),t.setTitle(i.getContent()),"true"===this.isAudit&&this.tagedThird)r(this);e.hide(),this.fire("changeTrade",{tradeId:this.tradeId,id:this.wuliaoId})}},e.prototype.getAllNeedData=function(){var e=this.childrenIndex.attachTag;return{id:this.wuliaoId,isAudit:this.isAudit,third:this.third,tradeId:this.tradeId,tagedThird:this.tagedThird,comment:this.comment,datasource:e.datasource,value:e.getRawValue(),originValue:e.originValue,sample:this.sample}},e.prototype.getTagDatasource=function(){return this.childrenIndex.attachTag.datasource},e.prototype.setTagDatasource=function(e){this.childrenIndex.attachTag.datasource=e,this.childrenIndex.attachTag.refresh()},e.prototype.setRawValue=function(e){var t=this.childrenIndex.tradeText;if(e.comment)this.childrenIndex.comment.setValue(e.comment),this.comment=e.comment;if(e.tradeId)this.tradeId=e.tradeId;if(e.third)if(this.third=e.third,t.setText(e.third),t.setTitle(e.third),"true"===this.isAudit&&this.tagedThird)r(this);if(e.tag)this.childrenIndex.attachTag.setRawValue(e.tag);if(e.sample)this.sample=e.sample},require("esui").register(e),e}),define("ub-ria/ui/extension/AutoSubmit",["require","underscore","esui/lib","esui","esui/Form","esui/Extension"],function(require){function e(e){if(e=e||{},"string"==typeof e.events)e.events=i.map(n.splitTokenList(e.events),n.trim);o.apply(this,arguments)}function t(){var e=this.resolveForm();if(e)e.validateAndSubmit()}var i=require("underscore"),n=require("esui/lib"),r=require("esui"),a=require("esui/Form"),o=require("esui/Extension");return e.prototype.type="AutoSubmit",e.prototype.form=null,e.prototype.events=["click","change","search"],e.prototype.resolveForm=function(){if(this.form)return this.target.viewContext.get(this.form);for(var e=this.target&&this.target.main&&this.target.main.parentNode;e;){var t=r.getControlByDOM(e);if(t&&t instanceof a)return t;e=e.parentNode}return null},e.prototype.activate=function(){i.each(this.events,function(e){this.target.on(e,t,this)},this),o.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){i.each(this.events,function(e){this.target.un(e,t,this)},this),o.prototype.inactivate.apply(this,arguments)},n.inherits(e,o),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/ExternSearch",["require","esui/lib","esui/Extension","esui"],function(require){function e(e){e=e||{},a.apply(this,arguments)}function t(){this.target.search()}function i(e){var t=this.resolveControl(),i={value:t.getValue()};if(t.dataKeys)i.keys=r.splitTokenList(t.dataKeys);e.filterData.push(i),e.preventDefault()}function n(){var e=this.resolveControl();e.set("text","")}var r=require("esui/lib"),a=require("esui/Extension");return e.prototype.type="ExternSearch",e.prototype.searchBox=null,e.prototype.resolveControl=function(){var e;if(!this.searchBox&&this.searchbox)this.searchBox=this.searchbox;if(this.searchBox){if(e=this.target.viewContext.get(this.searchBox),!e&&this.active)throw new Error('Cannot find related searchBox "#'+e+'" in view context')}else throw new Error("searchBox cannot be null");return e},e.prototype.activate=function(){var e=this.resolveControl();e.on("search",t,this),this.target.on("clearquery",n,this),this.target.on("search",i,this),a.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){a.prototype.inactivate.apply(this,arguments);var e=this.resolveControl();if(e)e.un("search",t,this);this.target.un("clearquery",n,this),this.target.un("search",i,this)},r.inherits(e,a),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/ExternSelect",["require","underscore","esui/lib","esui/Extension","esui"],function(require){function e(e){e=e||{},o.apply(this,arguments)}function t(){this.target.search()}function i(e){this.handleControls(function(t){var i=t.getSelectedItem();if(""!==i.value&&t.dataKey)e.filterData.push({keys:[t.dataKey],value:i.value})}),e.preventDefault()}function n(){this.handleControls(function(e){e.un("change",t,this),e.setProperties({selectedIndex:0}),e.on("change",t,this)})}var r=require("underscore"),a=require("esui/lib"),o=require("esui/Extension");return e.prototype.type="ExternSelect",e.prototype.selects=null,e.prototype.resolveControls=function(){var e=[];if(this.selects){var t;if(r.isString(this.selects))t=a.splitTokenList(this.selects);else t=this.selects;if(r.isArray(t))r.each(t,function(t){var t=this.target.viewContext.get(t);if(t)e.push(t);else if(this.active)throw new Error('Cannot find related select "#'+t+'" in view context')},this);else throw new Error("selects can only be Array or String")}else throw new Error("selects cannot be null");return e},e.prototype.activate=function(){this.handleControls(function(e){e.on("change",t,this)}),this.target.on("clearquery",n,this),this.target.on("search",i,this),o.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){o.prototype.inactivate.apply(this,arguments),this.handleControls(function(e){e.un("change",t,this)},!0),this.target.un("clearquery",n,this),this.target.un("search",i,this)},e.prototype.handleControls=function(e){var t=this.resolveControls();if(t.length)r.each(t,e,this)},a.inherits(e,o),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/TableTip",["require","esui/lib","esui","underscore","esui/Extension","esui/TipLayer"],function(require){function e(){a.apply(this,arguments)}function t(e){return o.exec(e.className)[1]}var i=require("esui/lib"),n=require("esui"),r=require("underscore"),a=require("esui/Extension");require("esui/TipLayer"),e.prototype.type="TableTip";var o=/table-operation-(\w+)/;return e.prototype.createAndAttachTip=function(e,t){var a={id:"table-operation-tip-"+r.escape(t),viewContext:this.target.viewContext,content:i.getText(e[0]),arrow:!0,skin:"table-tip"},o=n.create("TipLayer",a);o.appendTo(document.body),r.each(e,function(e){var t={targetDOM:e,showMode:"over",delayTime:200,positionOpt:{bottom:"bottom",left:"left"}};o.attachTo(t)})},e.prototype.initTips=function(){if(document.querySelectorAll){var e=document.querySelectorAll(".table-operation");r.chain(e).groupBy(t).each(r.bind(this.createAndAttachTip,this))}},e.prototype.activate=function(){a.prototype.activate.apply(this,arguments),this.target.on("afterrender",this.initTips,this)},e.prototype.inactivate=function(){this.target.un("afterrender",this.initTips,this),a.prototype.inactivate.apply(this,arguments)},i.inherits(e,a),n.registerExtension(e),e}),define("ub-ria/ui/extension/WordCount",["require","esui/lib","esui/validator/Validity","esui/Extension","esui"],function(require){function e(){r.apply(this,arguments)
}function t(){var e=this.getMaxLength(),t=this.target.getValue().length,i={max:e,current:t,available:e-t},r=i.available<0?"error":"hint",a=this.getHintMessage(i),o=new n;o.setCustomValidState(r),o.setCustomMessage(a),this.target.showValidity(o)}var i=require("esui/lib"),n=require("esui/validator/Validity"),r=require("esui/Extension");return e.prototype.type="WordCount",e.prototype.initialTemplate="最多可输入${available}个字符",e.prototype.remainingTemplate="还可输入${available}个字符",e.prototype.exceededTemplate="已超出${available}个字符",e.prototype.getHintMessage=function(e){var t;if(!e.current)t=this.initialTemplate;else if(e.available>=0)t=this.remainingTemplate;else t=this.exceededTemplate,e.available=-e.available;return i.format(t,e)},e.prototype.getMaxLength=function(){if(-1===+this.target.get("maxLength"))return this.target.get("length");else return this.target.get("maxLength")},e.prototype.activate=function(){var e=this.getMaxLength();if(e)this.target.on("input",t,this),this.target.on("afterrender",t,this);r.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){this.target.un("input",t,this),this.target.un("afterrender",t,this),r.prototype.inactivate.apply(this,arguments)},i.inherits(e,r),require("esui").registerExtension(e),e}),define("ub-ria/ui/PartialForm",["require","esui/lib","ef/ActionPanel","esui/Form","esui/validator/Validity","esui/validator/ValidityState","esui"],function(require){function e(){n.apply(this,arguments)}function t(e){var t=require("esui/Form"),n={main:i.g(e.view.container),viewContext:e.view.viewContext};return new t(n)}var i=require("esui/lib"),n=require("ef/ActionPanel");return e.prototype.type="PartialForm",e.prototype.validate=function(){var e=this.get("action");if(!e)return!0;if("function"==typeof e.validate)return e.validate();var i=e.view&&e.view.viewContext;if(!i)return!0;var n=require("esui/validator/Validity"),r=new n,a={validity:r};this.fire("beforevalidate",a);for(var o=t(e),s=o.getInputControls(),l=!0,u=0;u<s.length;u++){var h=s[u];if(!h.isDisabled())l&=h.validate();else;}if(!l)this.fire("invalid",a);return this.fire("aftervalidate",a),l},e.prototype.notifyErrors=function(e){for(var i=require("esui/validator/Validity"),n=require("esui/validator/ValidityState"),r=this.get("action"),a=t(r),o=a.getInputControls(),s=e.fields,l=0;l<o.length&&s.length>0;l++){var u=o[l];if("function"!=typeof u.notifyErrors)for(var h=0;h<s.length;h++){var d=s[h];if(u.name===d.field){var c=new n(!1,d.message),f=new i;if(f.addState("server",c),"function"==typeof u.showValidity)u.showValidity(f)}}else s=u.notifyErrors(e)||s}},e.prototype.getRawValue=function(){var e=this.get("action");if(!e)return null;if("function"==typeof e.getRawValue)return e.getRawValue();if("function"==typeof e.getValue)return e.getValue();else return void 0},e.prototype.getCategory=function(){return"input"},i.inherits(e,n),require("esui").register(e),e}),define("ub-ria/ui/TableRichSelector",["require","esui/lib","esui/painters","underscore","../util","./RichSelector","esui"],function(require){function e(){m.apply(this,arguments)}function t(e){for(var t=e.helper.getPartClassName("head-table"),i=['<table border=0 class="'+t+'"><tr>'],n=e.fields.length,r=0;n>r;r++){var a=e.fields[r];i.push('<th class="th'+r+'" style="width:'+a.width+'px;">'+a.title||"</th>")}return i.push('<th style="width:30px;"></th>'),i.push("</tr></table>"),i.join(" ")}function i(e,t){var i=e.indexData,r=e.helper,a=r.getPartClassName("content-table"),o=['<table border=0 class="'+a+'">'],s=r.getPartClassName("row"),l=r.getPartClassName("row-selected"),u=r.getPartClassName("row-disabled");return f.each(t,function(t,r){var a=[s];if(t.isSelected)a.push(l);if(t.isDisabled)a.push(u);o.push(d.format(e.rowTpl,{rowId:e.helper.getId("row-"+t.id),rowClass:a.join(" "),index:i[t.id],content:n(e,t,r)}))}),o.push("</table>"),o.join(" ")}function n(e,t,i,n){var r=e.fields,a=[],o=e.helper.getPartClassName("row-field"),s=0;f.each(r,function(r,l){var u=r.content,h="function"==typeof u?u.call(e,t,i,l):t[u];if(n){var d=n.insertCell(l);d.style.width=r.width+"px",d.title=h,d.innerHTML=h}else{var c='<td class="'+o+'" title="'+h+'" style="width:'+r.width+'px;">'+h+"</td>";a.push(c)}s++});var l=e.helper.getPartClassName("row-action-icon"),u='<span class="'+l+'"></span>';if(n){var h=n.insertCell(s);h.style.width="30px",h.innerHTML=u}else return a.push('<td style="width:30px;">'+u+"</td>"),a.join(" ")}function r(e,t,i){var n=e.helper.getPartClassName("row-selected"),r=!1;if(d.hasClass(t,n)){if(!e.multi)a(e,i.id,!1),r=!0}else a(e,i.id,!0),r=!0;if(r)e.fire("add",{item:i}),e.fire("change")}function a(e,t,i){var n=e.indexData,r=e.allData,a=n[t],l=r[a];if(!e.multi)o(e),e.currentSelectedId=i?t:null;s(e,l,i)}function o(e){var t=e.currentSelectedId;if(t){var i=e.indexData[t],n=e.allData[i];s(e,n,!1),e.currentSelectedId=null}}function s(e,t,i){if(t){t.isSelected=i;var n=e.helper.getPart("row-"+t.id),r=i?d.addClass:d.removeClass;r(n,e.helper.getPartClassName("row-selected"))}}function l(e,t,i){u(e,i.id),e.fire("delete",{items:[i]}),e.fire("change")}function u(e,t){var i=e.indexData,n=i[t],r=[].slice.call(e.datasource,0);r.splice(n,1),e.set("datasource",r)}function h(e,t,i){var n=e.helper.getPartClassName("row-selected");if(!d.hasClass(t,n))a(e,i.id,!0),e.fire("load"),e.fire("change")}var d=require("esui/lib"),c=require("esui/painters"),f=require("underscore"),p=require("../util"),m=require("./RichSelector");return d.inherits(e,m),e.prototype.type="TableRichSelector",e.prototype.styleType="RichSelector",e.prototype.initOptions=function(e){var t={hasRowHead:!0,hasIcon:!0,firedOnIcon:!1,datasource:[],selectedData:[],fields:[{field:"name",content:"name",searchScope:"partial",isDefaultSearchField:!0}]};if("false"===e.hasRowHead)e.hasRowHead=!1;if("false"===e.hasIcon)e.hasIcon=!1;if("false"===e.firedOnIcon)e.firedOnIcon=!1;d.extend(t,e),m.prototype.initOptions.call(this,t)},e.prototype.initStructure=function(){m.prototype.initStructure.apply(this,arguments),d.addClass(this.main,"ui-table-richselector")},e.prototype.repaint=c.createRepaint(m.prototype.repaint,{name:["datasource","selectedData","disabledData"],paint:function(e){e.refresh(),e.fire("change")}}),e.prototype.adaptData=function(){var e=p.deepClone(this.datasource),t={};f.each(e,function(e,i){t[e.id]=i}),this.indexData=t;var i=this.selectedData||[];if(!this.multi)if(!f.isArray(i))this.currentSelectedId=i,i=[{id:i}];else if(i.length)this.currentSelectedId=i[0].id;f.each(i,function(i){var n=t[i.id];if(void 0!==n)e[n].isSelected=!0});var n=this.disabledData||[];f.each(n,function(i){var n=t[i.id];if(void 0!==n)e[n].isDisabled=!0}),this.allData=e,this.fieldsIndex={},this.defaultSearchFields=[],f.each(this.fields,function(e){if(this.fieldsIndex[e.field]=e,e.isDefaultSearchField)this.defaultSearchFields.push(e.field)},this)},e.prototype.refreshContent=function(){var e=this.isQuery()?this.queriedData:this.allData;if(!e||0===e.length)this.addState("empty");else this.removeState("empty");var n=[];if(this.hasRowHead)n.push(t(this));n.push(i(this,e));var r=this.getQueryList();r.setContent(n.join(""))},e.prototype.rowTpl='<tr id="${rowId}" class="${rowClass}" index="${index}">${content}</tr>',e.prototype.eventDispatcher=function(e){for(var t=e.target,i=this.helper,n=i.getPartClassName("row"),r=i.getPartClassName("row-action-icon");t&&t!==document.body;){var a;if(this.hasIcon&&this.fireOnIcon&&d.hasClass(t,r))a=t.parentNode;else if(d.hasClass(t,n))a=t;if(a)return void this.operateRow(a);t=t.parentNode}},e.prototype.operateRow=function(e){var t=this.helper.getPartClassName("row-disabled");if(!d.hasClass(e,t)){var i=parseInt(e.getAttribute("index"),10),n=this.allData[i];if(n)if("add"===this.mode)r(this,e,n);else if("delete"===this.mode)l(this,e,n);else if("load"===this.mode)h(this,e,n)}},e.prototype.selectAll=function(){var e=this.isQuery()?this.queriedData:this.allData,t=this;f.each(e,function(e){a(t,e.id,!0)}),this.fire("add"),this.fire("change")},e.prototype.selectItems=function(e,t){var i=this.allData,n=this.indexData,r=this;f.each(e,function(e){var o=void 0!==e.id?e.id:e,s=n[o];if(null!==s&&void 0!==s){var l=i[s];a(r,l.id,t)}})},e.prototype.deleteAll=function(){var e=f.clone(this.datasource);this.set("datasource",[]),this.fire("delete",{items:e}),this.fire("change")},e.prototype.queryItem=function(e){function t(e,t,i){var n=!1;if("string"==typeof t)t=d.trim(t);if("partial"===this.fieldsIndex[e].searchScope){if(-1!==i[e].indexOf(t))n=!0}else if(i[e]===t)n=!0;return n}function i(i){return!f.any(e,function(e){var n=[];if(void 0===e.keys)n=this.defaultSearchFields;else n=e.keys;return!f.any(n,function(n){return t.call(this,n,e.value,i)},this)},this)}e=e||[],this.queriedData=f.filter(this.allData,i,this),this.addState("queried"),this.refreshContent()},e.prototype.clearData=function(){this.queriedData=[]},e.prototype.getSelectedItems=function(){var e=this.datasource,t=this.allData,i=this.mode;if("delete"===i)return t;var n=f.filter(e,function(e,i){return t[i].isSelected});return n},e.prototype.getCurrentStateItemsCount=function(){var e=this.isQuery()?this.queriedData:this.allData;return e=e||[],e.length},require("esui").register(e),e}),define("ub-ria/ui/ToggleButton",["require","esui/lib","esui/InputControl","esui/painters","esui"],function(require){function e(){n.apply(this,arguments)}function t(e,t){var i=e.helper.getId(t),n=e.helper.getPartClassName("part-"+t),r='<span id="'+i+'" class="'+n+'"></span>';return r}var i=require("esui/lib"),n=require("esui/InputControl");e.prototype.type="ToggleButton",e.prototype.getCategory=function(){return"check"},e.prototype.createMain=function(){return document.createElement("div")},e.prototype.initOptions=function(e){var t={onText:"ON",offText:"OFF",checked:!1};if(i.extend(t,e),!t.title)t.title=this.main.title;if(i.isInput(this.main))this.helper.extractOptionsFromInput(this.main,t);else{var r=i.getChildren(this.main);if(r.length>1){if(!e.onText)t.onText=i.getText(r[0]);if(!e.offText)t.offText=i.getText(r[1])}}n.prototype.initOptions.call(this,t)},e.prototype.initStructure=function(){this.main.innerHTML=t(this,"on")+t(this,"off"),this.helper.addDOMEvent(this.main,"click",i.bind(this.toggle,this))};var r=require("esui/painters");return e.prototype.repaint=r.createRepaint(n.prototype.repaint,r.text("onText","on"),r.text("offText","off"),r.attribute("title"),r.style("width"),r.style("height"),r.state("checked")),e.prototype.setProperties=function(){if(this.hasOwnProperty("checked"))this.checked=!!this.checked;var e=n.prototype.setProperties.apply(this,arguments);if(e.hasOwnProperty("checked"))this.fire("change")},e.prototype.isChecked=function(){return this.checked},e.prototype.toggle=function(){this.set("checked",!this.checked)},i.inherits(e,n),require("esui").register(e),e}),define("ub-ria/ui/TogglePanel",["require","esui/Control","esui/lib","esui","esui/Panel","esui/painters"],function(require){function e(){i.apply(this,arguments)}function t(){this.toggleContent()}var i=require("esui/Control"),n=require("esui/lib"),r=require("esui");require("esui/Panel"),e.prototype.type="TogglePanel",e.prototype.initOptions=function(e){var t={expanded:!1},i=n.extend(t,e);this.setProperties(i)},e.prototype.initStructure=function(){var e=n.getChildren(this.main),i=e[0],a=e[1],o=r.create("Panel",{main:i});this.helper.addPartClasses("title",o.main),this.addChild(o,"title"),o.render(),this.set("title",i&&i.innerHTML),o.helper.addDOMEvent(o.main,"click",n.bind(t,this));var s={main:a,childName:"content",viewContext:this.viewContext,renderOptions:this.renderOptions},l=r.create("Panel",s);this.helper.addPartClasses("content",l.main),this.addChild(l,"content"),l.render()},e.prototype.toggleContent=function(){this.toggleState("expanded"),this.fire("change")};var a=require("esui/painters");return e.prototype.repaint=a.createRepaint(i.prototype.repaint,a.state("expanded"),{name:"title",paint:function(e,t){e.getChild("title").set("content",t)}},{name:"content",paint:function(e,t){e.getChild("content").set("content",t)}}),e.prototype.isExpanded=function(){return this.hasState("expanded")},n.inherits(e,i),r.register(e),e}),define("error/NotFound",["require","./View","./Action","tpl!b1c6f6b6.tpl.html","er/util"],function(require){function e(){i.apply(this,arguments)}var t=require("./View"),i=require("./Action");return require("tpl!b1c6f6b6.tpl.html"),e.prototype.createView=function(){var e=new t;return e.name="not-found",e.template="notFound",e},require("er/util").inherits(e,i),e}),define("marker/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.search=function(e){return this.request("marker/search",e,{method:"POST",url:"/getPagedTasks.do",urlPrefix:"ctp/task"})},exports.updateStatus=function(e,t){return this.request("marker/updateStatus",{status:e,tasks:t},{method:"POST",url:"/changeTaskStatus.do",urlPrefix:"ctp/task"})},exports.getUsers=function(e){return this.request("marker/getUsers",{name:e},{method:"GET",url:"/getUserByNameLike.do",urlPrefix:"ctp/user"})};var i=require("eoo").create(t,exports),n={search:{name:"marker/search",scope:"instance",policy:"auto"},updateStatus:{name:"marker/updateStatus",scope:"instance",policy:"auto"},getUsers:{name:"marker/getUsers",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("marker/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"toBegin",text:"未开始",value:0},{alias:"doing",text:"进行中",value:1},{alias:"done",text:"已完成",value:2},{alias:"closed",text:"已关闭",value:3}),exports.ModUserLevel=new e({alias:"inner",text:"内部任务",value:0},{alias:"outter",text:"外部任务",value:1}),exports}),define("marker/List",["require","esui/Toast","common/util","./enum","ub-ria/util","common/ListAction","eoo"],function(require){function e(e){this.performSearchAllKey(e)}function t(e){this.redirect("/marker/task/list~taskId="+e.data)}function i(e){this.model[e.statusName](e.ids).then(function(t){if(t.hasSuccess)e.responseList=t.data,n.call(this,e);else{var i=a.error(t.resultInfo);i.show()}}.bind(this),o.bind(this.notifyModifyFail,this,e))}function n(e){this.notifyModifySuccess(e);var t=this.fire("statusupdate",e);if(!t.isDefaultPrevented())this.reload()}function r(e){if("remove"===e.statusName)return void e.preventDefault();if("download"===e.statusName)return void e.preventDefault();else return void o.each(e.responseList,function(t){var i=this.model.getItemById(t.id);i.status=t.status>=10?s.closed:t.status,i.orignStatus=t.status,this.view.updateItem(i),e.preventDefault()},this)}var a=require("esui/Toast"),o=require("common/util"),exports={},s=require("./enum").Status;exports.group="resource",exports.entityDescription="标注任务列表",exports.initBehavior=function(){this.$super(arguments),this.view.on("searchAllKey",e,this),this.view.on("beginMarker",t,this),this.on("statusupdate",r,this)},exports.performSearchAllKey=function(e){var t=this.fire("search");if(!t.isDefaultPrevented()){var i=this.getSearchQuery();i.page=1;var n=new Date(e.end);if(e.begin===e.end&&Date.parse(n.toDateString())===o.getToday())delete e.begin,delete e.end;i.beginTime=e.begin,i.endTime=e.end,this.reloadWithQueryUpdate(i)}},exports.modifyStatus=function(e,t){var n=o.pluck(e,"id"),r=o.findWhere(this.model.getStatusTransitions(),{status:t}),a={ids:n,items:e,status:t,statusName:r.statusName,command:r.command};if(this.requireAdviceFor(a)){var s=require("ub-ria/util").pascalize(a.statusName),l="get"+s+"Advice";this.model[l](a.ids,a.items).then(o.bind(waitConfirmForAdvice,this,a)).then(o.bind(i,this,a))}else i.call(this,a)};var l=require("common/ListAction"),u=require("eoo").create(l,exports);return u}),define("ub-ria/mvc/filterHelper",["require","underscore"],function(require){var e=require("underscore"),t={},i=t.select={};return i.getText=function(t){var i=e.find(t.datasource,function(e){return e.value==t.value});return i&&i.text||""},t}),define("marker/ListModel",["require","common/util","ub-ria/mvc/filterHelper","er/datasource","er/permission","./enum","common/ListModel","eoo"],function(require){var e=require("common/util"),t=require("ub-ria/mvc/filterHelper"),i=require("er/datasource"),n=require("er/permission"),exports={},r=require("./enum").Status,a=r.toArray();a.unshift({text:"全部状态",value:"all"});var o={statuses:i.constant(a)},s={canBatchModify:i.constant(!0)};if(n.isAllow("outerMarkerRole")||n.isAllow("outerAuditRole"))s={canBatchModify:i.constant(!1)};exports.constructor=function(){this.$super(arguments),this.putDatasource(s),this.putDatasource(o)},exports.statusTransitions=[{status:3,deny:[3],statusName:"pause",command:"关闭"},{status:0,accept:[3],statusName:"restore",command:"启用"}],exports.prepare=function(){this.$super(arguments);var t=this.get("data");t.canCreateMarker=!0,t.canBatchDownload=!0,t.canBatchClose=!1;var i=this.get("data").list;if(n.isAllow("outerMarkerRole")||n.isAllow("outerAuditRole"))t.canCreateMarker=!1,t.canBatchDownload=!1;if(n.isAllow("managerRole")||n.isAllow("innerAuditRole"))t.canBatchClose=!0;e.each(i,function(e){if(e.orignStatus=e.status,e.status>=10)e.status=r.closed})},exports.getQuery=function(){var e=this.get("beginTime"),t=this.get("endTime"),i={id:this.get("id"),beginTime:e,endTime:t,taskName:this.get("taskName"),addUser:this.get("addUser"),size:this.get("size"),keyword:this.get("keyword"),status:parseInt(this.get("status"))===r.closed?10:this.get("status"),order:this.get("order"),orderBy:this.get("orderBy"),page:this.get("page")||1};if(!i.status)i.status=this.getDefaultStatusValue();else if("all"===i.status)i.status="";return i},exports.pause=function(e){return this.updateStatus(!1,e)},exports.restore=function(e){return this.updateStatus(!0,e)},exports.getFilters=function(){var i,n;if(this.get("beginTime"))i=e.formatTime(new Date(parseInt(this.get("beginTime"))));if(this.get("endTime"))n=e.formatTime(new Date(parseInt(this.get("endTime"))));return{status:{value:this.get("status"),text:t.select.getText,datasource:this.get("statuses")},beginTime:{value:i,text:i},endTime:{value:n,text:n},id:{value:this.get("id"),text:this.get("id")},taskName:{value:this.get("taskName"),text:this.get("taskName")},addUser:{value:this.get("addUser"),text:this.get("addUser")}}};var l=require("common/ListModel"),u=require("eoo").create(l,exports);return u}),define("marker/ListView",["require","common/util","tpl!b1c6f6b6.tpl.html","etpl","./enum","er/permission","esui/Table","common/ListView","eoo"],function(require){function e(e){var t=e.name,i=this.getSafely("nameContainer");if("name-fetch"===t){var r=this.getSafely("addUser").getValue();this.model.data().getUsers(r).then(function(e){i.setContent(n.render("autoName",{list:e.data})),i.show()})}}function t(e){var t=e.target.getElementsByClassName("auto-name-list-name")[0]||e.target;if(t){var i=t.innerText;this.getSafely("addUser").setValue(i)}}var i=require("common/util");require("tpl!b1c6f6b6.tpl.html");var n=require("etpl"),r=require("./enum").Status,a=require("er/permission"),o=require("./enum").ModUserLevel,exports={};exports.tableFields=[{title:"任务ID",field:"id",sortable:!0,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+e.id+"</span>"}},{title:"任务名称",field:"taskName",sortable:!1,resizable:!1,width:50,stable:!0,content:function(e){return"<span>"+e.taskName+"</span>"}},{title:"任务类型",field:"taskTypeName",sortable:!1,resizable:!1,width:20,stable:!0,content:function(e){return"<span>"+e.taskTypeName+"</span>"}},{title:"创建人",field:"addUser",sortable:!1,resizable:!1,width:40,stable:!0,content:function(e){return"<span>"+e.addUser+"</span>"}},{title:"创建日期",field:"addTime",sortable:!0,resizable:!1,width:50,stable:!0,content:function(e){var t=new Date(e.addTime);return i.formatTimeToSecond(t)}},{title:"状态",field:"status",sortable:!1,resizable:!1,width:40,stable:!0,content:function(e){var t="";switch(r.fromValue(e.status).alias){case"closed":t="task-status-closed";break;case"toBegin":t="task-status-toBegin";break;case"done":t="task-status-done";break;case"doing":t="task-status-doing"}return'<span class="'+t+'">'+r.fromValue(e.status).text+"</span>"}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){var t=e.status;if(t!==r.toBegin)return'<a data-ui-type="Link" class="table-command-text"href="#/marker/statistics~taskId='+e.id+'">统计</a>';else return void 0}},{title:"",field:"Marker",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){var t=e.status,i=require("esui/Table"),n=null;if(t===r.toBegin||t===r.doing)n={command:"marker",args:e.id,className:"table-command-text",text:"标注"};return i.command(n)}},{title:"",field:"download",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){var t=e.status;if(!(t!==r.closed&&t!==r.done||a.isAllow("outerMarkerRole")||a.isAllow("outerAuditRole")))return'<a data-ui-type="Link" class="table-command-text" target="_blank"href="ctp/task/download.do?taskId='+e.id+'">下载</a>';else return void 0}},{title:"",field:"createAudit",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){var t=e.status,i=require("esui/Table"),n=null;if(!(t!==r.closed||a.isAllow("outerMarkerRole")||a.isAllow("innerMarkerRole")&&e.moduserLevel===o.inner))n={command:"createAudit",args:e.id,className:"table-command-text",text:"生成审核"};return i.command(n)}},{title:"",field:"changeStatus",sortable:!1,resizable:!1,width:40,stable:!0,content:function(e){var t=e.status,i=require("esui/Table"),n=null;if(a.isAllow("managerRole")||a.isAllow("innerAuditRole"))if(t===r.closed)n={command:"restore",args:e.id,className:"table-status-off",text:"启用"};else n={command:"pause",args:e.id,className:"table-status-on",text:"关闭"};return i.command(n)}}],exports.template="markerList",exports.uiEvents={"table:command":"commandHandler","addUser:command":e,"addUser:blur":"hideNamePanel"},exports.enterDocument=function(){this.$super(arguments),this.hideNamePanel();var e=this.getSafely("nameContainer");if(e)e.helper.addDOMEvent(e.main,"click",i.bind(t,this))},exports.commandHandler=function(e){this.$super(arguments);var t=e.name,i=JSON.parse(e.args);if("marker"===t)this.fire("beginMarker",{data:i});else if("createAudit"===t){var n=this.model.getItemById(i).taskName,r="/audit/create~fromPath=marker&id="+i+"&selectIdDimesion="+n,a={url:r};this.popDrawerAction(a).show()}},exports.hideNamePanel=function(){var e=this;setTimeout(function(){e.getSafely("nameContainer").hide()},200)},exports.updateBatchButtonStatus=function(){this.$super(arguments);var e=this.getSelectedItems(),t="javascript:void(0)",n="ctp/task/download.do",o=i.pluck(e,"id"),s=this.getSafely("download");if(i.all(e,function(e){return(e.status===r.closed||e.status===r.done)&&!(a.isAllow("outerMarkerRole")||a.isAllow("outerAuditRole"))})&&e.length)n+="?taskId="+o.join(","),s.removeState("disabled"),s.set("href",n);else s.addState("disabled"),s.set("href",t);if(i.all(e,function(e){return e.status===r.closed&&(a.isAllow("managerRole")||a.isAllow("innerAuditRole"))}))this.getSafely("close").hide(),this.getSafely("restore").show();if(i.all(e,function(e){return e.status!==r.closed&&(a.isAllow("managerRole")||a.isAllow("innerAuditRole"))}))this.getSafely("close").show(),this.getSafely("restore").hide()},exports.submitSearch=function(){var e=this.get("time"),t=e.getRawValue();this.fire("searchAllKey",{begin:t.begin.getTime(),end:t.end.getTime()})};var s=require("common/ListView"),l=require("eoo").create(s,exports);return l}),define("marker/schema",["require"],function(){return{}}),define("marker/statistics/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.getBasicInfo=function(e){return this.request("statistics/getBasicInfo",e,{method:"GET",url:"/getBasicInfo.do",urlPrefix:"ctp/statistics"})};var i=require("eoo").create(t,exports),n={getDimention:{name:"statistics/getBasicInfo",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("marker/statistics/dimension/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.getDimention=function(e){return this.request("dimension/getDimention",e,{method:"GET",url:"/getDimentionInfo.do",urlPrefix:"ctp/statistics"})};var i=require("eoo").create(t,exports),n={getDimention:{name:"dimension/getDimention",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("marker/statistics/dimension/Dimension",["require","ub-ria/mvc/BaseAction","eoo"],function(require){var exports={};exports.entityDescription="维度统计饼图",exports.initBehavior=function(){if(this.$super(arguments),"change"===this.model.get("change"))document.body.scrollTop=600;this.view.on("dimensionChange",function(e){this.redirect("/marker/statistics/dimension~taskId="+e.taskId+"&index="+e.index+"&change=change")},this)};var e=require("ub-ria/mvc/BaseAction"),t=require("eoo").create(e,exports);return t}),define("marker/statistics/dimension/DimensionModel",["require","common/util","ub-ria/mvc/BaseModel","eoo"],function(require){function e(e){var n=[];return i.each(e,function(e,i){if(i%3===0)n.push([]);n[n.length-1].push({name:e.name,text:e.text,color:t(i)})}),n}function t(e){var t=["#38b1e0,#65c3f9,#8ed9ff","#ffb03f,#ffc86b,#ffdeb5","#ff7546,#ffad97,#ffeeee","#1a428a,#385dae,#94a8cb","#426ba9,#4e86db,#a4c8fa","#6950a1,#9477d3,#c6b1f2","#973d3f,#ba505c,#f0a9b1","#87481f,#f9a755,#fcd1a6","#fdaf17,#ffcb65,#ffe4af","#cac547,#efeb70,#f7f4b1","#155b7d,#01a6ac,#78cdd0"];return t[e%11]}var exports={},i=require("common/util"),n={dimensionInfo:function(e){var t=e.getQuery(),i=e.data().getDimention(t).then(function(e){return e});return i}};exports.constructor=function(){this.$super(arguments),this.putDatasource(n)},exports.getQuery=function(){return{taskId:this.get("taskId")||""}},exports.prepare=function(){this.$super(arguments);var t=this.get("dimensionInfo"),n=this.get("dimensionInfo").data,r=parseInt(this.get("index")||1),a=n[r-1];t.index=r,t.showData={name:a.name,text:a.text,data:e(a.data)},i.each(a.data,function(e){t[e.name]={legend:i.map(e.data,function(e){return e.text}),data:[i.map(e.data,function(e){return{value:e.data,name:e.text}})]}}),t.taskId=this.get("taskId"),t.tabData=i.map(n,function(e,t){return{text:e.text,value:t+1}})};var r=require("ub-ria/mvc/BaseModel"),a=require("eoo").create(r,exports);return a}),define("marker/statistics/dimension/DimensionView",["require","tpl!b1c6f6b6.tpl.html","ub-ria/mvc/BaseView","eoo"],function(require){require("tpl!b1c6f6b6.tpl.html");var exports={};exports.bindEvents=function(){this.$super(arguments);var e=this,t=this.get("dimesionSelect");t.helper.addDOMEvent(t.main,"click",function(t){if(t.target.hasAttribute("data-index")&&!t.target.classList.contains("active-dimension")){var i=t.target.getAttribute("data-index");e.fire("dimensionChange",{index:i,taskId:e.model.get("taskId")})}})},exports.template="dimensionView";var e=require("ub-ria/mvc/BaseView"),t=require("eoo").create(e,exports);return t}),define("marker/statistics/rank/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.search=function(e){return this.request("rank/search",e,{method:"GET",url:"/getUserInfo.do",urlPrefix:"ctp/statistics"})},exports.getTrendInfo=function(e){return this.request("rank/getTrendInfo",e,{method:"GET",url:"/getTrendInfo.do",urlPrefix:"ctp/statistics"})};var i=require("eoo").create(t,exports),n={search:{name:"rank/search",scope:"instance",policy:"auto"},getTrendInfo:{name:"rank/getTrendInfo",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("marker/statistics/rank/enum",["require"],function(){var exports={};return exports}),define("marker/statistics/rank/List",["require","common/util","common/ListAction","eoo"],function(require){function e(e){this.model.refreshDimension(e.userName).done(t.bind(this.refreshChart,this))}var t=require("common/util"),exports={};exports.entityDescription="任务统计人员排名",exports.initBehavior=function(){this.$super(arguments),this.view.on("dimensionChange",e)};var i=require("common/ListAction"),n=require("eoo").create(i,exports);return n}),define("marker/statistics/rank/ListModel",["require","er/Deferred","common/ListModel","eoo"],function(require){var e=require("er/Deferred"),exports={},t={memberDimenson:function(e){var t={taskId:e.getQuery().taskId,username:null},i=e.data().getTrendInfo(t).then(function(e){return{trendStatisticsList:e.data}});return i}};exports.constructor=function(){this.$super(arguments),this.putDatasource(t)},exports.prepare=function(){this.$super(arguments);var e=this.get("data");e.memberList=e.list.map(function(e){return{text:e.userName,value:e.userName}}),e.memberList.unshift({text:"全部维度",value:null}),this.formataData(this.get("memberDimenson"))},exports.formataData=function(e){var t=this.get("memberDimenson");t.xAxisData=[],t.seriesData=[],e.trendStatisticsList.forEach(function(e){t.xAxisData.push(e.time),t.seriesData.push(e.isDoneAds)})},exports.getQuery=function(){var e={taskId:this.get("taskId")||"",size:this.get("size"),page:this.get("page")||1,order:this.get("order"),orderBy:this.get("orderBy")};return e},exports.refreshDimension=function(t){var i={taskId:this.getQuery().taskId,username:t},n=this;return this.data().getTrendInfo(i).then(function(t){return n.formataData({trendStatisticsList:t.data}),e.resolved()})};var i=require("common/ListModel"),n=require("eoo").create(i,exports);return n}),define("marker/statistics/rank/ListView",["require","tpl!b1c6f6b6.tpl.html","common/ListView","eoo"],function(require){function e(e){var t=e.target.getRawValue();this.fire("dimensionChange",{userName:t})}require("tpl!b1c6f6b6.tpl.html");var exports={};exports.tableFields=[{title:"排名",field:"ranking",sortable:!1,resizable:!1,width:10,stable:!0,content:function(e){return'<span class="rank-number rank-number-'+e.ranking+'">'+e.ranking+"</span>"}},{title:"账号",field:"userName",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return e.userName}},{title:"已标注推广组数",field:"isDoneGroups",sortable:!0,resizable:!1,width:30,stable:!0,content:function(e){return e.isDoneGroups}},{title:"已标注创意数",field:"isDoneAds",sortable:!0,resizable:!1,width:30,stable:!0,content:function(e){return e.isDoneAds}}],exports.enterDocument=function(){this.$super(arguments)},exports.refreshChart=function(){this.getSafely("memberChart").refresh(this.model.get("memberDimenson"))},exports.uiEvents={"memberName:change":e},exports.template="memberRankList";var t=require("common/ListView"),i=require("eoo").create(t,exports);return i}),define("marker/statistics/Statistics",["require","ub-ria/mvc/BaseAction","eoo"],function(require){var exports={};exports.entityDescription="任务统计";var e=require("ub-ria/mvc/BaseAction"),t=require("eoo").create(e,exports);return t}),define("marker/statistics/StatisticsModel",["require","./../enum","ub-ria/mvc/BaseModel","eoo"],function(require){var e=require("./../enum").Status,exports={},t={basicInfo:function(e){var t=e.getQuery(),i=e.data().getBasicInfo(t).then(function(e){return e.data});return i}};exports.constructor=function(){this.$super(arguments),this.putDatasource(t)},exports.getQuery=function(){return{taskId:this.get("taskId")||""}},exports.prepare=function(){this.$super(arguments);var t=this.get("basicInfo");if(t.taskStatus>=10)t.taskStatus=e.closed;t.statusPrefix=e.fromValue(t.taskStatus).alias,t.totalGroups=t.isDoneGroups+t.notDoneGroups,t.doneGroupsRate=(t.isDoneGroups/t.totalGroups*100).toFixed(1)+"%",t.notDoneGroupsRate=(t.notDoneGroups/t.totalGroups*100).toFixed(1)+"%",t.totalAds=t.isDoneAds+t.notDoneAds,t.doneAdsRate=(t.isDoneAds/t.totalAds*100).toFixed(1)+"%",t.notDoneAdsRate=(t.notDoneAds/t.totalAds*100).toFixed(1)+"%"
};var i=require("ub-ria/mvc/BaseModel"),n=require("eoo").create(i,exports);return n}),define("marker/statistics/StatisticsView",["require","tpl!b1c6f6b6.tpl.html","ub-ria/mvc/BaseView","eoo"],function(require){require("tpl!b1c6f6b6.tpl.html");var exports={};exports.template="markerStatisticsView";var e=require("ub-ria/mvc/BaseView"),t=require("eoo").create(e,exports);return t}),define("task/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.search=function(e){var t="marker"===e.inType?"ctp/task/group":"/ctp/review/task/group";if(e.id)return this.request("task/search",{id:e.id},{method:"GET",url:"/getTasksByGroupId.do",urlPrefix:t});else if(e.taskId)return this.request("task/search",{taskId:e.taskId},{method:"GET",url:"/distributeNewGroup.do",urlPrefix:t})},exports.getTrade=function(e){return this.request("task/tradeList",e,{method:"GET",url:"/getAllIndustryType.do",urlPrefix:"ctp/task/group"})},exports.commitAnswer=function(t){var i="marker"===t.inType?"ctp/task/group":"/ctp/review/task/group";return t=e.omit(t,"inType"),this.request("task/commitAnswer",t,{method:"POST",url:"/submitTasksByGroupId.do",urlPrefix:i})},exports.giveUpGroup=function(t){var i="marker"===t.inType?"ctp/task/group":"/ctp/review/task/group",n=t.async,r={method:"GET",url:"/giveUpGroup.do",urlPrefix:i,async:n};if(!n)r.timeout=t.timeout;return t=e.omit(t,["inType","async","timeout"]),this.request("task/giveUpGroup",t,r)},exports.getDetail=function(e){return this.request("task/getDetail",e,{method:"GET",url:"/getTaskById.do",urlPrefix:"ctp/generalTask"})},exports.getImgUrl=function(t){var i=t.timeout;return t=e.omit(t,["timeout"]),this.request("task/getImgUrl",t,{method:"GET",url:"/getImgUrl.do",urlPrefix:"ctp/generalTask",timeout:i})},exports.getImgUrlList=function(t){var i=t.timeout;return t=e.omit(t,["timeout"]),this.request("task/getImgUrlList",t,{method:"POST",url:"/getImgUrlList.do",urlPrefix:"ctp/generalTask",timeout:i})},exports.getFlashAdAnalysisType=function(t){var i=t.timeout;return t=e.omit(t,["timeout"]),this.request("task/getFlashAdAnalysisType",t,{method:"GET",url:"/getFlashAdAnalysisType.do",urlPrefix:"ctp/analysis",timeout:i})},exports.changeTrade=function(e){return this.request("task/changeTrade",e,{method:"GET",url:"/changeTrade.do",urlPrefix:"ctp/task/group"})};var i=require("eoo").create(t,exports),n={search:{name:"task/search",scope:"instance",policy:"auto"},getTrade:{name:"task/tradeList",scope:"global",policy:"reuse"},commitAnswer:{name:"task/commitAnswer",scope:"instance",policy:"auto"},giveUpGroup:{name:"task/giveUpGroup",scope:"instance",policy:"auto"},getDetail:{name:"task/getDetail",scope:"instance",policy:"auto"},getImgUrl:{name:"task/getImgUrl",scope:"instance",policy:"auto"},getImgUrlList:{name:"task/getImgUrlList",scope:"instance",policy:"auto"},getFlashAdAnalysisType:{name:"task/getFlashAdAnalysisType",scope:"instance",policy:"auto"},changeTrade:{name:"task/changeTrade",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("task/Detail",["require","common/util","ub-ria/mvc/BaseAction","eoo"],function(require){var exports={},e=require("common/util");exports.entityDescription="物料详情",exports.initBehavior=function(){this.$super(arguments);var t=this.view;this.view.on("refresh",function(){this.reload()},this),this.view.on("tradeChange",e.bind(function(e){var i=e.tradeId,n=e.callback;this.model.data().changeTrade({adTradeId:i,taskType:e.taskType}).then(function(e){if(e.hasSuccess)t.model.formatTagBoxData(e.data.list),t.get("tagCtrl").set("sample",e.data.sample),n()})},this))};var t=require("ub-ria/mvc/BaseAction"),i=require("eoo").create(t,exports);return i}),define("task/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.WuliaoType=new e({alias:"invalid",text:"非法类型",value:0},{alias:"text",text:"文本",value:1},{alias:"picture",text:"图片",value:2},{alias:"flash",text:"FLASH",value:3},{alias:"richMedia",text:"富媒体",value:4},{alias:"picText",text:"图文",value:5},{alias:"video",text:"视频广告",value:6},{alias:"html",text:"HTML",value:9}),exports.DataType=new e({alias:"beidou",text:"北斗",value:0},{alias:"qiushi",text:"秋实",value:1},{alias:"dsp",text:"DSP",value:2},{alias:"baidudsp",text:"百度 DSP",value:3}),exports.ThirdTrade=new e,exports}),define("task/DetailModel",["require","common/util","./enum","common/GlobalData","ub-ria/mvc/BaseModel","eoo"],function(require){var e=require("common/util"),t=require("./enum").WuliaoType,i=require("./enum").DataType,n=require("common/GlobalData").getInstance(),exports={},r={detailInfo:function(e){var t=e.getQuery(),i=e.data().getDetail(t).then(function(e){return e.data});return i}},a={tradeList:function(){var e=n.getTrade().then(function(e){return e.levelThree});return e}},o={tagMap:function(){var t=n.getTrade().then(function(t){return e.formatTagmap(t.tagTypeInfo)});return t}};exports.constructor=function(){this.$super(arguments),this.putDatasource(r),this.putDatasource(a),this.putDatasource(o)},exports.prepare=function(){this.$super(arguments);var e=this.get("detailInfo");if(e){if(e.tagInfo=n.getDetailData(),this.set("attachDatasource",e.tagInfo.datasource),this.set("attachValue",e.tagInfo.value),this.set("attachOriginValue",e.tagInfo.originValue),t.fromValue(e.wuliaoType))e.wuliaoTypeText=t.fromValue(e.wuliaoType).text,e.wuliaoTypeAlias=t.fromValue(e.wuliaoType).alias;if(e.dataTypeAlias=i.fromValue(e.dataType).alias,"video"===e.wuliaoTypeAlias&&e.imgUrl&&e.imgUrl.indexOf(".flv")>=0)e.wuliaoTypeAlias="flv"}},exports.getQuery=function(){var t={id:this.get("id"),dataType:this.get("dataType"),region:this.get("region")||null};if(null===t.region)return e.omit(t,"region");else return t},exports.formatTagBoxData=function(t){var i=this.get("tagMap"),n=[],r={};e.each(t,function(t){n.push({text:t.text,name:t.name,datasource:e.assembleAttachGroupData(t.tags,i)}),r[t.name]=e.assembleAttachGroupValue(this.get("id"),t.tags,i)},this),this.set("attachDatasource",n),this.set("attachValue",r)};var s=require("ub-ria/mvc/BaseModel"),l=require("eoo").create(s,exports);return l}),define("task/DetailView",["require","er/events","tpl!b1c6f6b6.tpl.html","esui/controlHelper","ub-ria/mvc/BaseView","eoo"],function(require){function e(){if("修改"!==event.target.innerHTML&&this.get("tagCtrl"))this.get("tagCtrl").hideTradePanel()}function t(){this.fire("refresh")}var exports={},i=require("er/events");require("tpl!b1c6f6b6.tpl.html");var n=require("esui/controlHelper");exports.template="taskDetail",exports.uiEvents={"refresh:click":t,"tagCtrl:changeTrade":"changeTrade","tagCtrl:toggleTradePanel":"toggleTradeList"},exports.enterDocument=function(){this.$super(arguments),n.addDOMEvent(this,this.get("detailView").main,"click",e)},exports.changeTrade=function(e){this.fire("tradeChange",{tradeId:e.tradeId,taskType:this.model.get("detailInfo").taskType,callback:function(){this.get("tagCtrl").setTagDatasource(this.model.get("attachDatasource")),this.get("tagCtrl").setRawValue({tag:this.model.get("attachValue")})}.bind(this)})},exports.toggleTradeList=function(e){var t=e.clickButton.getBoundingClientRect(),i=e.target.main.getBoundingClientRect(),n=e.tradePanel.main;n.style.top=t.bottom-i.top+"px"},exports.dispose=function(){var e=this.get("tagCtrl");if(e&&""!==e.getAllNeedData().id)i.fire("detailSubmit",{value:e.getAllNeedData()});this.$super(arguments)};var r=require("ub-ria/mvc/BaseView"),a=require("eoo").create(r,exports);return a}),define("task/List",["require","common/extension/CustomToastHandler","common/util","common/ListAction","eoo"],function(require){var e=require("common/extension/CustomToastHandler"),t=new e,i=require("common/util"),exports={};exports.group="resource",exports.entityDescription="标注任务列表",exports.initBehavior=function(){this.$super(arguments);var e=this,n=this.view,r=this.model.get("inType"),a="#/"+r;n.table=n.get("table"),n.scrollToTop=n.get("scroll-to-top"),n.initBehave(),n.enterDocument(!0),n.on("commitAnswer",i.bind(function(i){var n=this.model.get("data").task.id;this.model.commitAnswer({inType:this.model.get("inType"),list:i.answers,groupId:this.model.get("data").group.id}).then(function(r){if(i.button.enable(),r.hasSuccess){var o={content:"该题已提交！将自动进入下一题"};t.handle(r,o),e.leave(),e.redirect(a+"/task/list~taskId="+n,{force:!0})}else if(t.handle(r,{content:r.resultInfo}),r.resultInfo.indexOf("BELONG TO THIS USER")>0)e.leave(),e.redirect(a+"/task/list~taskId="+n,{force:!0})}).fail(function(){i.button.enable()})},this)),n.on("giveUpGroup",i.bind(function(t){var i=!0;if(t.close)i=!1;if(this.model.data().giveUpGroup({inType:this.model.get("inType"),id:this.model.get("data").group.id,async:i,timeout:1e3}).then(function(i){if(!t.close)if(i.hasSuccess&&!t.url){if(t.args)return void e.redirect(a+"/statistics~reviewTaskId="+t.args);e.redirect(a+"/list")}}),t.url)return void this.redirect(t.url);else return void 0},this)),n.on("gotToLastGroup",i.bind(function(){var t=this.model.getLatestGroupIndex(),i=e.model.get("data").historyGroup;if(-1===t||0===i.length)this.view.noHistoryShow();else if(t>=0){var n=this.model.get("data").historyGroup[t].id;e.redirect(a+"/task/list~id="+n)}else if(-2===t)n=i[i.length-1].id,e.redirect(a+"/task/list~id="+n)},this)),n.on("gotToNextGroup",i.bind(function(){var t=this.model.getLatestGroupIndex(),i=this.model.get("data").historyGroup[t+2].id;e.redirect(a+"/task/list~id="+i)},this)),n.on("redirectToList",i.bind(function(){this.redirect(a+"/list")},this)),n.on("redirectToStatistics",i.bind(function(){var e=this.model.get("data").task.id;if("marker"===r)this.redirect(a+"/statistics~taskId="+e);else if("audit"===r)this.redirect(a+"/statistics~reviewTaskId="+e)},this)),n.on("loadBatchFlashAndImg",i.bind(function(e){var t=e.loadItems,r=e.batchItems,a=Math.ceil(t.length/20),o=e.loadIndex;if(r&&r.length)this.model.data().getImgUrlList({list:i.map(r,function(e){return e.id}),dataType:r[0].dataType,timeout:3e3}).then(function(e){if(o+=1,a>o)n.fire("loadBatchFlashAndImg",{loadItems:t,batchItems:t.slice(20*o,20*o+20),loadIndex:o});if(e.hasSuccess){var s=i.map(r,function(t){return{id:t.originId,imgUrl:e.data[t.originId].imgUrl,type:e.data[t.originId].wuliaoType}});n.loadFlashAndImgs(s)}})},this)),n.on("loadFlashClass",i.bind(function(e){var t=e.loadItems,i=e.loadIndex,r=t[i];if(r)this.model.data().getFlashAdAnalysisType({mcId:r.mcId,mcVersionId:r.mcVersionId,timeout:3e3}).then(function(e){if(i+=1,i<t.length)n.fire("loadFlashClass",{loadItems:t,loadIndex:i});if(e.hasSuccess)n.setFlashContent({id:r.id,info:e.data})})},this)),n.on("tradeChange",i.bind(function(e){var t=e.adTradeId,i=e.id,r=e.callback,a=e.taskType;this.model.data().changeTrade({adTradeId:t,taskType:a}).then(function(e){if(e.hasSuccess)n.model.formatTagBoxData(i,e.data.list),n.getSafetyControl(i+"-tagCtr").set("sample",e.data.sample),r()})},this))};var n=require("common/ListAction"),r=require("eoo").create(n,exports);return r}),define("audit/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.Status=new e({alias:"toBegin",text:"未开始",value:0},{alias:"doing",text:"进行中",value:1},{alias:"done",text:"已完成",value:2}),exports.ModUserLevel=new e({alias:"inner",text:"内部人员",value:0},{alias:"outter",text:"外部人员",value:1},{alias:"all",text:"全体人员",value:2}),exports.Blind=new e({alias:"blind",text:"明审",value:0},{alias:"noBlind",text:"盲审",value:1}),exports}),define("task/ListModel",["require","common/util","er/datasource","er/Deferred","marker/enum","audit/enum","./enum","common/GlobalData","common/ListModel","eoo"],function(require){function e(e){i.each(i.keys(e),function(t){var n=e[t].data;i.each(i.keys(n),function(r){var a=e[t].name,o=n[r].name,s=n[r].data;i.each(i.keys(s),function(e){var t=s[e].name,i=1===e.length?"0"+e:e,n={alias:i,text:a+"-"+o+"-"+t,value:i};l.addElement(n)})})})}function t(e,t){i.extend(e,t);var n=this.getLatestGroupIndex();if(e.hasPrevious=!0,e.hasNext=!0,-1===n)e.hasPrevious=!1;if(-2===n||n+2>=this.get("data").historyGroup.length)e.hasNext=!1;var r=0;if(e.task.addTime&&0!==e.task.addTime)r=new Date(e.task.addTime),e.task.addTime=i.formatTimeToSecond(r);else e.task.addTime=null;if(e.group.doneTime&&0!==e.group.doneTime)r=new Date(e.group.doneTime),e.group.doneTime=i.formatTimeToSecond(r);else e.group.doneTime=null;if(e.isReview){var l=e.task.blind?o.blind:o.noBlind;e.task.reviewTypeDesc=s.fromValue(e.task.moduserLevel).text+"/"+o.fromValue(l).text}e.task.statusAlias=a.fromValue(e.task.status).alias,e.task.statusText=a.fromValue(e.task.status).text,e.list.forEach(function(t){t.dataTypeAlias=e.dataTypeAlias}),e.historyGroup.forEach(function(e){if(e.doneTime)r=new Date(e.doneTime),e.doneTime=i.formatTimeToSecond(r);if(e.startTime)r=new Date(e.startTime),e.startTime=i.formatTimeToSecond(r)})}var i=require("common/util"),n=require("er/datasource"),r=require("er/Deferred"),a=require("marker/enum").Status,o=require("audit/enum").Blind,s=require("audit/enum").ModUserLevel,l=require("./enum").ThirdTrade,u=require("./enum").DataType,h=require("./enum").WuliaoType,d=require("common/GlobalData").getInstance(),exports={},c={canBatchModify:n.constant(!0)},f={tradeList:function(){var e=d.getTrade().then(function(e){return e.levelThree});return e}},p={tagMap:function(){var e=d.getTrade().then(function(e){return i.formatTagmap(e.tagTypeInfo)});return e}};exports.constructor=function(){this.$super(arguments),this.putDatasource(c),this.putDatasource(f),this.putDatasource(p)},exports.prepare=function(){this.$super(arguments);var n=this.get("data");if(!Array.isArray(n.list)||0!==n.list.length){var r=[],a=[];if(i.each(n.list,function(e){var t=e.wuliaoType;if(t===h.picture||t===h.flash||t===h.picText)r.push({type:h.fromValue(t).alias,id:e.refAdId||e.id,dataType:e.dataType,originId:e.id});if(t===h.flash&&n.group.dataType!==u.dsp)a.push({id:e.id,mcId:e.mcId,mcVersionId:e.mcVersionId});if(this.formatTagBoxData(e.id,e.tagInfo.tag),e.tagInfo.boxData=i.map(e.tagInfo.tag,function(e){return{name:e.name,text:e.text}}),e.tagedTagInfo&&e.tagedTagInfo.tag)this.set(e.id+"-attachOriginValue",i.map(e.tagedTagInfo.tag,function(e){return e.value=i.clone(e.tags),i.omit(e,"tags","text")}))},this),this.formatTagBoxData("batch",this.getDefaultTrade().tagInfo.tag),n.list.length)n.hasValue=!0;else n.hasValue=!1;if(this.set("imgUrlList",r),this.set("flashAdList",a),n.dataTypeAlias=u.fromValue(n.group.dataType).alias,n.dataTypeText=u.fromValue(n.group.dataType).text,t.call(this,n,{taskId:this.get("taskId")}),0===l.toArray().length)e(this.get("tradeList"))}},exports.getQuery=function(){var e={};if(this.get("taskId"))e.taskId=this.get("taskId");if(this.get("id"))e.id=this.get("id");if(this.get("inType"))e.inType=this.get("inType");return e},exports.getDataAdIds=function(){var e=this.get("data").list;return e.map(function(e){return e.id})},exports.commitAnswer=function(e){if(e&&this.getDataAdIds().length!==e.list.length)return r.rejected();else return this.data().commitAnswer(e)},exports.getDefaultTrade=function(){var e=this.get("data").list,t=null;if(this.get("data").isReview)t=i.find(e,function(e){return null!==e.tagInfo.adTradeIdLevel3||null!==e.tagedTagInfo.adTradeIdLevel3}),t.defaultTradeId=t.tagInfo.adTradeIdLevel3||t.tagedTagInfo.adTradeIdLevel3;else t=i.find(e,function(e){return null!==e.tagInfo.adTradeIdLevel3}),t.defaultTradeId=t.tagInfo.adTradeIdLevel3;return t},exports.getLatestGroupIndex=function(){var e=this.get("data").historyGroup,t=this.get("data").group.id,i=-1;if(e.forEach(function(e,n){if(e.id===t)i=n}),0===e.length)return-1;else return i-1},exports.setTagDatasource=function(e,t){this.set(e+"-attachDatasource",t)},exports.setDetailData=function(e){d.setDetailData(e)},exports.formatTagBoxData=function(e,t){var n=this.get("tagMap"),r=[],a={};i.each(t,function(t){r.push({text:t.text,name:t.name,datasource:i.assembleAttachGroupData(t.tags,n)}),a[t.name]=i.assembleAttachGroupValue(e,t.tags,n)},this),this.set(e+"-attachDatasource",r),this.set(e+"-attachValue",a)};var m=require("common/ListModel"),g=require("eoo").create(m,exports);return g}),define("task/ListView",["require","common/util","tpl!b1c6f6b6.tpl.html","etpl","esui/Toast","er/events","./enum","common/ListView","eoo"],function(require){function e(){if(this.viewContext)if(document.body.scrollTop>=200)this.scrollToTop.show();else this.scrollToTop.hide()}function t(e){e.preventDefault(),document.body.scrollTop=0}function i(e){var t="/task/detail~id="+e.id+"&dataType="+e.dataType,i=this.getSafetyControl(e.id+"-tagCtr");this.model.setDetailData(i.getAllNeedData());var n={url:t,title:"创意物料预览"};this.popDrawerAction(n).show()}function n(e){var t={content:"离开此页将放弃该题，是否确定？",title:"提示",callBack:c.bind(this.giveUpGroup,this,{url:e.url})};this.showDialog(t),e.preventDefault()}function r(e){var t=e.value.id;this.getSafetyControl(t+"-tagCtr").setTagDatasource(e.value.datasource),this.getSafetyControl(t+"-tagCtr").setRawValue({tag:e.value.value,comment:e.value.comment,tradeId:e.value.tradeId,third:e.value.third,sample:e.value.sample})}function a(e){var t=e.target.main,i=t.parentNode;t.classList.toggle("history-toggle-show"),i.classList.toggle("operation-bar-show")}function o(e){var t=this.table.viewContext.getGroup("headerInfo"),i=this.getSafetyControl("operationBar");if(c.hasClass(i.main,"operation-zero-bar"))i.main.classList.remove("operation-zero-bar"),e.target.setContent("收起头部信息");else i.main.classList.add("operation-zero-bar"),e.target.setContent("展开头部信息");c.each(t,function(e){e.toggle()})}function s(){var e={value:this.getSafetyControl("batch-tagCtr").getRawValue(),datasource:this.getSafetyControl("batch-tagCtr").getTagDatasource()};this.setBatchTableData(e)}function l(){var e={content:"当前题目还未完成，若进行下一题，当前答题内容将不会保存",title:"提示",callBack:function(){this.fire("gotToLastGroup")}};this.showDialog(e)}function u(e){var t=this.collectAnswers();if(0===t.noFinishItems.length)e.target.disable(),this.fire("commitAnswer",{answers:t.results,button:e.target});else{this.table.setAllRowSelected(!1),this.table.setRowSelected(t.noFinishItems,!0);var i=p.success("尚有题目未答完，请答完后点击提交！");i.show()}}function h(){var e={content:"当前题目还未完成，若进行下一题，当前答题内容将不会保存",title:"提示",callBack:function(){this.fire("gotToNextGroup")}};this.showDialog(e)}function d(e){if(e=parseInt(e,10),0===e)return"未标注";else if(e>0){if(5===(e+"").length)e="0"+e;return y.fromValue(e).text}}var c=require("common/util");require("tpl!b1c6f6b6.tpl.html");var f=require("etpl"),p=require("esui/Toast"),m=require("er/events"),g=require("./enum").WuliaoType,y=require("./enum").ThirdTrade,exports={};exports.template="taskList",exports.currentTradeId=null,exports.tableFields=[{title:"物料信息",field:"taskInfo",sortable:!1,resizable:!0,width:400,stable:!1,content:function(e){var t="",i=g.getAliasFromValue(e.wuliaoType);if(g.fromValue(e.wuliaoType))t=g.fromValue(e.wuliaoType).text;return f.render("taskInfo",{id:e.id,adId:e.adId,wuliaoType:t,wuliaoTypeAlias:i,showUrl:e.showUrl,targetUrl:e.targetUrl,adTradeNameLevel2:e.adTradeNameLevel2,imgUrl:e.imgUrl,flash:e.flash,title:e.title,description1:e.description1,description2:e.description2,dataTypeAlias:e.dataTypeAlias})}},{title:"标签标注",field:"operation",sortable:!1,resizable:!0,width:750,stable:!1,content:function(e){var t=!1,i=d(e.tagInfo.adTradeIdLevel3||e.tagedTagInfo&&e.tagedTagInfo.adTradeIdLevel3),n=null;if(e.tagedTagInfo)t=!0,n=d(e.tagedTagInfo.adTradeIdLevel3);var r={isAudit:t,id:e.id,third:i,tagedThird:n,comment:e.tagInfo.comment,tradeId:e.tagInfo.adTradeIdLevel3||e.tagedTagInfo&&e.tagedTagInfo.adTradeIdLevel3,attachTagGroup:e.tagInfo.boxData,sample:e.tagInfo.sample};return f.render("operationZone",r)}}],exports.uiEvents={"table:command":"commandHandler","previous:click":l,"next:click":h,"historyToggle:click":a,"headerToggle:click":o,"batchModifySubmit:click":s,"end-cancel:click":"backToList","backToAuditDetail:click":"backToDetail","end-submit:click":u,"scroll-to-top:click":t,"crumb:click":"backToList"},exports.enterDocument=function(t){if(this.$super(arguments),t){var i=this;i.allLoaded=!1,i.loadIndex=0;var n=this.model.getDataAdIds();if(n.forEach(function(e){var t=i.get(e+"-showDetail");if(t)t.helper.delegateDOMEvent(t.main,"click")}),window.onscroll=c.bind(e,i),window.onbeforeunload=c.bind(i.giveUpGroup,i,{close:!0}),this.model.get("hasResult")===!0){var r=this.alert("题目已全部分配完","提示");r.on("ok",function(){i.fire("redirectToStatistics")})}else if(this.model.getDefaultTrade()&&this.model.getDefaultTrade().defaultTradeId){var a=this.model.getDefaultTrade().defaultTradeId+"",o=y.getTextFromAlias(a);this.getSafetyControl("batch-tagCtr").setRawValue({tradeId:a,third:o})}setTimeout(function(){i.loadAllLeftContent()},100),this.table.setAllRowSelected(!0),c.each(this.table.viewContext.getGroup("headerInfo"),function(e){e.hide()})}},exports.dispose=function(){this.$super(arguments),m.un("navigatorChange",n,this),m.un("detailSubmit",r,this),window.onscroll=null,window.onbeforeunload=null,window.onclick=null},exports.initBehave=function(){var e=this.model.getDataAdIds();this.bindListEvents(e),this.scrollToTop.hide(),this.viewContext.disposePool(),m.on("navigatorChange",n,this),m.on("detailSubmit",r,this),window.onclick=function(e){if("修改"!==e.target.innerHTML)this.hideAllTradePanel()}.bind(this)},exports.commandHandler=function(e){this.$super(arguments);var t=e.name,n=JSON.parse(e.args),r=this.model.getItemById(n).dataType;if("showDetail"===t)i.call(this,{id:n,dataType:r})},exports.getSafetyControl=function(e){return this.get(e)||this.table.viewContext.get(e)},exports.bindListEvents=function(e){c.each(e,function(e){this.uiEvents[e+"-tagCtr:toggleTradePanel"]=this.toggleTradeList,this.uiEvents[e+"-tagCtr:changeTrade"]=this.changeTrade},this);var t=this.getSafetyControl("batch-tagCtr");if(t)t.on("toggleTradePanel",function(e){this.toggleTradeList(e)},this),t.on("changeTrade",function(e){this.changeTrade(e)},this)},exports.toggleTradeList=function(e){var t=e.clickButton.getBoundingClientRect(),i=e.tradePanel.main;this.hideAllTradePanel(e.tradePanel),i.style.top=t.bottom+document.body.scrollTop-60+"px",i.style.left=t.left-300+"px"},exports.hideAllTradePanel=function(e){var t=this.model.getDataAdIds();if(t.length)t.push("batch");c.each(t,function(t){var i=this.getSafetyControl(t+"-tagCtr").childrenIndex.tradePanel;if(!e||e.id!==i.id)this.getSafetyControl(t+"-tagCtr").hideTradePanel()},this)},exports.loadAllLeftContent=function(){var e=this.model.get("imgUrlList"),t=this.model.get("flashAdList");if(e&&e.length)this.fire("loadBatchFlashAndImg",{loadItems:e,batchItems:e.slice(0,20),loadIndex:0});if(t&&t.length)this.fire("loadFlashClass",{loadItems:t,loadIndex:0})},exports.loadFlashAndImgs=function(e){c.each(e,function(e,t){var i=this;setTimeout(function(){i.loadSingleFlashAndImg(e)},500*t)},this)},exports.loadSingleFlashAndImg=function(e){if(e&&e.type){var t=g.fromValue(e.type).alias,i="",n=null;if("flash"===t){if(i=e.id+"-flashContainerPanel",n=document.getElementById(i))window.swfobject.embedSWF(e.imgUrl,n,"100%",150,10)}else if("picture"===t||"picText"===t){i=e.id+"-imgContainerPanel";var r=new Image;if(r.src=e.imgUrl,r.alt="图片",n=document.getElementById(i))n.innerHTML=r.outerHTML}}},exports.setFlashContent=function(e){var t=document.getElementById(e.id+"-flashClass");if(t)t.innerText=e.info},exports.collectAnswers=function(){var e=this.model.getDataAdIds(),t=[],i=[];return c.each(e,function(e,n){var r=this.get(e+"-tagCtr").getRawValue(),a={},o=r.tag;c.each(c.keys(o),function(e){c.each(c.keys(o[e]),function(t){a[t]=o[e][t]})});var s=r.comment,l=r.tradeId;if(""!==l){var u=this.model.getItemById(e),h={id:u.tagInfo.id,refId:u.tagInfo.refId,adTradeIdLevel3:l,comment:s,tag:a,sample:r.sample};t.push(h)}else i.push(n)},this),{results:t,noFinishItems:i}},exports.setBatchTableData=function(e){var t=this.table.getSelectedItems(),i=this;t.forEach(function(t){var n=parseInt(t.id,10);i.get(n+"-tagCtr").setTagDatasource(e.datasource),i.get(n+"-tagCtr").setRawValue(e.value)})},exports.showDialog=function(e){var t=this,i=this.confirm(e.content,e.title);i.on("ok",function(){e.callBack.call(t)})},exports.backToDetail=function(){var e={content:"返回详情页该题内容不会保存，是否继续？",title:"提示",callBack:c.bind(this.giveUpGroup,this,{args:this.model.get("data").task.id})};this.showDialog(e)},exports.backToList=function(e){if(!e.item||e.item.href){e.preventDefault();var t={content:"退出后答题内容不会保存，是否取消答题？",title:"提示",callBack:this.giveUpGroup};this.showDialog(t)}},exports.giveUpGroup=function(e){if(e&&e.args)this.fire("giveUpGroup",{args:e.args});else if(e&&e.url)this.fire("giveUpGroup",{url:e.url});else if(e&&e.close)this.fire("giveUpGroup",{close:e.close});else this.fire("giveUpGroup")},exports.noHistoryShow=function(){this.alert("没有上一题可供分配","提示")},exports.changeTrade=function(e){var t=e.id;this.fire("tradeChange",{adTradeId:e.tradeId,id:t,taskType:this.model.get("data").task.taskType,callback:function(){this.getSafetyControl(t+"-tagCtr").setTagDatasource(this.model.get(t+"-attachDatasource")),this.getSafetyControl(t+"-tagCtr").setRawValue({tag:this.model.get(t+"-attachValue")})}.bind(this)})};var V=require("common/ListView"),U=require("eoo").create(V,exports);return U}),define("task/schema",["require"],function(){return{}}),define("audit/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.search=function(e){return this.request("audit/search",e,{method:"POST",url:"/getPagedTasks.do",urlPrefix:"ctp/review/task"})},exports.save=function(e){return this.request("audit/save",e,{method:"POST",url:"/createNewReviewTask.do",urlPrefix:"ctp/review/task"})},exports.getTasks=function(e){return this.request("audit/getTasks",e,{method:"GET",url:"/getTasks.do",urlPrefix:"ctp/review/task"})},exports.getTrade=function(e){return this.request("audit/getTrade",e,{method:"GET",url:"/getAllIndustryType.do",urlPrefix:"ctp/task/group"})},exports.getGroupNum=function(e){return this.request("audit/getGroupNum",e,{method:"POST",url:"/getGroupNum.do",urlPrefix:"ctp/review/task"})},exports.getUsers=function(e){return this.request("audit/getUsers",{name:e},{method:"GET",url:"/getUserByNameLike.do",urlPrefix:"ctp/user"})},exports.updateStatus=function(e,t){return this.request("audit/updateStatus",{taskIds:t},{method:"POST",url:"/delete.do",urlPrefix:"ctp/review/task"})},exports.downloadWhenCreateReview=function(e){return this.request("audit/downloadWhenCreateReview",e,{method:"POST",url:"/downloadWhenCreateReview.do",urlPrefix:"ctp/review/task",timeout:12e4})},exports.getTagsByTradeIdList=function(e){return this.request("audit/getTagsByTradeIdList",e,{method:"POST",url:"/getTagsByTradeIdList.do",urlPrefix:"/ctp/task/group"})};var i=require("eoo").create(t,exports),n={search:{name:"audit/search",scope:"instance",policy:"auto"},save:{name:"audit/save",scope:"instance",policy:"auto"},getTasks:{name:"audit/getTasks",scope:"instance",policy:"auto"},getTrade:{name:"audit/getTrade",scope:"global",policy:"reuse"},getUsers:{name:"audit/getUsers",scope:"instance",policy:"auto"},updateStatus:{name:"audit/updateStatus",scope:"instance",policy:"auto"},downloadWhenCreateReview:{name:"audit/downloadWhenCreateReview",scope:"instance",policy:"auto"},getTagsByTradeIdList:{name:"audit/getTagsByTradeIdList",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("audit/Form",["require","esui/Toast","common/util","common/extension/FormWithSuccessHandler","common/FormAction","eoo"],function(require){var e=require("esui/Toast"),t=require("common/util"),i=require("common/extension/FormWithSuccessHandler"),n=new i,exports={};exports.entityDescription="新增审核任务",exports.initBehavior=function(){this.$super(arguments),this.setSubmitHandler(n);var i=this.view;i.on("syncHasSelectedList",t.bind(function(t){this.model.setSelectDatasource(t.rawValue,t.targetTree),this.view.refreshSelectUI(t.targetTree);var i=this.view.getEntity();if("trade-id"===t.targetTree.id||this.view.isTradePanelShow())this.model.data().getTagsByTradeIdList({tradeIds:i.reviewTaskCondition.adTradeType,taskType:i.taskType}).then(function(t){if(t.hasSuccess)this.model.setTagDatasource(t.data),this.view.syncTagGroupUI();else{var i=e.error(t.resultInfo);i.show()}}.bind(this))},this))},exports.redirectAfterSubmit=function(e){if(e.hasSuccess){var t="/"+this.getEntityName()+"/"+this.model.get("formType")+"/success~id="+e.data.id+"&taskName="+e.data.taskName+"&groupNumActual="+e.data.groupNumActual;if(e.data.groupNumActual<e.data.groupNum)this.redirect(t+"&groupNum="+e.data.groupNum);else this.redirect(t)}else this.redirect("/"+this.getEntityName()+"/"+this.model.get("formType")+"/success~error=error&resultInfo="+e.resultInfo)};var r=require("common/FormAction"),a=require("eoo").create(r,exports);return a}),define("audit/FormModel",["require","common/util","er/datasource","er/permission","./enum","common/GlobalData","common/FormModel","eoo"],function(require){function e(t,i){var n=[];for(var r in t)if(0!==r){var a={id:10>r?"0"+r:r,text:t[r].name};if(i&&new String(r).length<6)a.id=i+""+a.id;if(t[r].data)a.children=e(t[r].data,r);n.push(a)}return n}function t(e){var t=this.get("originTrade"),n=[];return i.each(e,function(e){if(2===e.id.length)n.push(e);else if(4===e.id.length){if(0===n.length||n.length>0&&n[n.length-1].id!==e.id.slice(0,2))n.push({id:e.id.slice(0,2),text:t[e.id.slice(0,2)].name,children:[e]});else if(n.length>0&&n[n.length-1].id===e.id.slice(0,2))n[n.length-1].children.push(e)}else if(6===e.id.length)if(0===n.length||n.length>0&&n[n.length-1].id!==e.id.slice(0,2))n.push({id:e.id.slice(0,2),text:t[e.id.slice(0,2)].name,children:[{id:e.id.slice(0,4),text:t[e.id.slice(0,2)].data[parseInt(e.id.slice(2,4))].name,children:[e]}]});else if(n.length>0&&n[n.length-1].id===e.id.slice(0,2)){var r=i.find(n[n.length-1].children,function(t){return t.id===e.id.slice(0,4)});if(r)r.children.push(e);else n[n.length-1].children.push({id:e.id.slice(0,4),text:t[e.id.slice(0,2)].data[parseInt(e.id.slice(2,4))].name,children:[e]})}}),n}var i=require("common/util"),n=require("er/datasource"),r=require("er/permission"),a=require("./enum").ModUserLevel,o=require("common/GlobalData").getInstance(),exports={},s=a.toArray(),l={moduserLevels:n.constant(s)},u={tradeList:function(t){var i=o.getTrade().then(function(i){return t.set("originTrade",i.levelThree),{children:e(i.levelThree)}});return i}},h={tagMap:function(){var e=o.getTrade().then(function(e){return i.formatTagmap(e.tagTypeInfo)});return e}},d={canUseTasks:function(e){var t=e.data().getTasks().then(function(e){return{children:i.each(e.data,function(e){e.text=e.id+" "+e.taskName})}});return t}};exports.constructor=function(){if(this.$super(arguments),this.store.entity=1,this.putDatasource(l),r.isAllow("managerRole")||r.isAllow("innerAuditRole"))this.putDatasource(d),this.putDatasource(u),this.putDatasource(h),this.set("allSelectedTrade",{children:[]})},exports.prepare=function(){if(r.isAllow("managerRole")||r.isAllow("innerAuditRole")){this.set("role","all");var e=this.get("tagMap"),t=[],n={};i.each(i.keys(e),function(r){if(i.each(e[r].source,function(e){e.text+="&nbsp"}),e[r].source.unshift({text:"全选",value:"0"}),"general"===e[r].group)t.push(e[r]),n[r]="0"}),this.set("tagDatasource",t),this.set("tagValue",n)}if(r.isAllow("innerMarkerRole"))this.set("role","inner");if(r.isAllow("outerAuditRole"))this.set("role","outer");if("create"===this.get("fromPath"))this.set("allSelectedTask",{children:[]});else if("marker"===this.get("fromPath"))this.set("taskName","每日日常审核任务"),this.set("allSelectedTask",{children:[{id:this.get("id"),text:this.get("selectIdDimesion")}]})},exports.setSelectDatasource=function(e,i){if("id-dimension"===i.id)this.set("allSelectedTask",{children:e});else if("trade-id"===i.id)this.set("allSelectedTrade",{children:t.call(this,this.omitValue(e))})
},exports.omitValue=function(e,t){var n=[];return i.each(e,function(e,i){var r=n[n.length-1],a="",o=e.id;if(t)a=r,o=e;else if(0!==i)a=r.id;if(0===i||a.length>=o.length||o.slice(0,a.length)!=a&&a.length<o.length)n.push(e)}),n},exports.setTagDatasource=function(e){var t=this.get("tagMap"),n=[],r={};i.each(e,function(e){n.push(t[e]),r[e]="0"}),this.set("tagDatasource",n),this.set("tagValue",r)},exports.fillEntity=function(e){var t=/^\d+$/;if(t.test(e.groupNum)&&0!==parseInt(e.groupNum))e.groupNum=parseInt(e.groupNum);return e};var c=require("common/FormModel"),f=require("eoo").create(c,exports);return f}),define("audit/FormView",["require","common/util","er/permission","tpl!b1c6f6b6.tpl.html","task/enum","common/FormView","eoo"],function(require){function e(e){if("time"===e.target.getValue())this.getSafely("task-time-dimension").show(),this.getSafely("task-id-dimension").hide(),this.getSafely("id-dimension").setDisabled(!0);else this.getSafely("task-time-dimension").hide(),this.getSafely("task-id-dimension").show(),this.getSafely("id-dimension").required=!0,this.getSafely("id-dimension").setDisabled(!1)}function t(e){if("0"===e.target.getValue())this.getSafely("task-custom-condition").hide(),this.getSafely("trade-id").setDisabled(!0);else this.getSafely("task-custom-condition").show(),this.getSafely("qiushiWuliaoType").hide(),this.getSafely("dspWuliaoType").hide(),this.getSafely("baidudspWuliaoType").hide()}function i(e){if("0"===e.target.getValue())this.getSafely("custom-group-num").hide(),this.getSafely("availableNum").setText(""),this.getSafely("custom-group-num").setDisabled(!0);else this.getSafely("custom-group-num").show(),this.getSafely("custom-group-num").setDisabled(!1),this.getSafely("custom-group-num").required=!0}function n(e){if("0"===e.target.getValue())this.getSafely("customTrade").hide(),this.getSafely("trade-id").setDisabled(!0);else this.getSafely("customTrade").show(),this.getSafely("trade-id").required=!0,this.getSafely("trade-id").setDisabled(!1)}function r(e){if(this.getSafely("beidouWuliaoType").hide(),this.getSafely("qiushiWuliaoType").hide(),this.getSafely("dspWuliaoType").hide(),this.getSafely("baidudspWuliaoType").hide(),"0"===e.target.getValue())this.getSafely("beidouWuliaoType").show();else if("1"===e.target.getValue())this.getSafely("qiushiWuliaoType").show();else if("2"===e.target.getValue())this.getSafely("dspWuliaoType").show();else if("3"===e.target.getValue())this.getSafely("baidudspWuliaoType").show()}function a(e,t){var i=u.omit(this.getEntity(),["taskName","groupNum","isBlind","moduserLevel"]);this.model.data().getGroupNum(i).then(function(e){if(e.hasSuccess){if(this.getSafely("availableNum").setText("1~"+e.data),t)this.getSafely("custom-group-num").setValue(e.data>300?300:e.data)}else this.getSafely("availableNum").setText(e.resultInfo)}.bind(this))}function o(e){var t=e.target,i=t.getRawValue();if(u.every(i,function(t){return t.taskType===e.item.taskType}))t.showValidationMessage("valid",""),this.fire("syncHasSelectedList",{rawValue:i,targetTree:t});else t.selectItems([e.item.id],!1),t.showValidationMessage("invalid","与已选择的任务的标注标签类型不同")}function s(e){var t=e.target,i=t.getValue(),n=this.getSafely(t.targetTree);n.selectItems(i.split(","),!1),o.call(this,{target:n,item:e.item})}function l(){var e="提示",t="是否下载该文件",i=null,n=u.omit(this.getEntity(),["taskName","isBlind","moduserLevel"]);this.model.data().getGroupNum(n).then(function(r){if(r.hasSuccess){var a=parseInt(n.groupNum,10);a=a>r.data?r.data:a,t="该条件下共有"+a+"道题,是否确定下载？",n.groupNum=a,i=function(){this.model.data().downloadWhenCreateReview(n).then(function(e){if(e.hasSuccess)window.open(e.data)})}.bind(this);var o=this.confirm(t,e);o.on("ok",i)}else t=r.resultInfo,this.alert(t,e)}.bind(this))}var u=require("common/util"),h=require("er/permission");require("tpl!b1c6f6b6.tpl.html");var d=require("task/enum").DataType,exports={};exports.template="auditForm",exports.getEntity=function(){var e=this.$super(arguments),t={taskName:this.getSafely("task-name").getValue(),moduserLevel:parseInt(this.getSafely("moduserLevel").getValue(),10),conditionType:parseInt(this.getSafely("conditionType").getValue(),10),isBlind:parseInt(this.getSafely("isBlind").getValue(),10)};if("id"===this.getSafely("taskDimension").getValue()){if(t.taskList=this.getSafely("id-dimension").getValue().split(","),t.taskType=null,this.getSafely("id-dimension").getRawValue().length)t.taskType=this.getSafely("id-dimension").getRawValue()[0].taskType}else if("time"===this.getSafely("taskDimension").getValue())t.beginTime=e.timeDimension.begin.getTime(),t.endTime=e.timeDimension.end.getTime();else t.taskList=[this.model.get("id")];if("1"===this.getSafely("conditionType").getValue()){var i=parseInt(e.dataType[0],10),n=d.fromValue(i).alias+"WuliaoType",r=u.pick(e.tagGroup,function(e){return"0"!==e});if(u.each(u.keys(r),function(e){r[e]=r[e].split(",")}),t.reviewTaskCondition={dataType:i,wuliaoType:"0000"===e[n][0]?null:e[n].join(","),tagValue:r},"1"===this.getSafely("belongTrade").getValue()){var a=this.getSafely("trade-id").getValue().split(",");if(""===this.getSafely("trade-id").getValue())a=[];t.reviewTaskCondition.adTradeType=u.map(this.model.omitValue(a,!0),function(e){return parseInt(e,10)})}}if("1"===this.getSafely("groupNum").getValue())t.groupNum=e.customGroupNum;return t},exports.uiEvents={"taskDimension:change":e,"conditionType:change":t,"groupNum:change":i,"belongTrade:change":n,"dataType:change":r,"custom-group-num:focus":a,"id-dimension:add":o,"trade-id:add":o,"id-selected-dimension:add":s,"trade-selected-id:add":s,"download:click":l},exports.enterDocument=function(){if(this.$super(arguments),this.getSafely("task-custom-condition").hide(),"create"===this.model.get("fromPath"))this.getSafely("custom-group-num").hide(),this.getSafely("task-time-dimension").hide();else{if(this.getSafely("task-time-dimension").hide(),this.getSafely("custom-group-num").required=!0,h.isAllow("managerRole")||h.isAllow("innerAuditRole"))this.getSafely("id-dimension").selectItems([this.model.get("id")],!0),this.getSafely("id-dimension").required=!0;a.call(this,null,!0)}this.getSafely("customTrade").hide()},exports.refreshSelectUI=function(e){if("id-dimension"===e.id)this.getSafely(e.targetTree).datasource=this.model.get("allSelectedTask");else if("trade-id"===e.id)this.getSafely(e.targetTree).datasource=this.model.get("allSelectedTrade");this.getSafely(e.targetTree).refresh()},exports.syncTagGroupUI=function(){this.get("tagGroup").set("datasource",this.model.get("tagDatasource")),this.get("tagGroup").refresh(),this.get("tagGroup").setRawValue(this.model.get("tagValue"))},exports.isTradePanelShow=function(){return"1"===this.getSafely("belongTrade").getValue()};var c=require("common/FormView"),f=require("eoo").create(c,exports);return f}),define("audit/List",["require","esui/Toast","common/util","common/ListAction","eoo"],function(require){function e(e){this.performSearchAllKey(e)}function t(e){if("remove"===e.statusName){var t=i.success("删除成功");t.show(),this.reload()}}var i=require("esui/Toast"),n=require("common/util"),exports={};exports.group="resource",exports.entityDescription="审核任务列表",exports.initBehavior=function(){this.$super(arguments),this.view.on("searchAllKey",e,this),this.on("statusupdate",t,this)},exports.performSearchAllKey=function(e){var t=this.fire("search");if(!t.isDefaultPrevented()){var i=this.getSearchQuery();i.page=1;var r=new Date(e.end);if(e.begin===e.end&&Date.parse(r.toDateString())===n.getToday())delete e.begin,delete e.end;i.beginTime=e.begin,i.endTime=e.end,this.reloadWithQueryUpdate(i)}};var r=require("common/ListAction"),a=require("eoo").create(r,exports);return a}),define("audit/ListModel",["require","common/util","er/datasource","ub-ria/mvc/filterHelper","er/permission","./enum","er/Deferred","common/ListModel","eoo"],function(require){var e=require("common/util"),t=require("er/datasource"),i=require("ub-ria/mvc/filterHelper"),n=require("er/permission"),r=require("./enum").Status,exports={};exports.statusTransitions=[{status:0,statusName:"remove",command:"删除"}];var a="你确定要删除这些审核任务吗？该审核任务下的所有信息将被一并删除，删除后不可恢复。",o="你确定要删除该审核任务吗？该审核任务下的所有信息将被一并删除，删除后不可恢复。",s=r.toArray();s.unshift({text:"全部状态",value:"all"});var l={statuses:t.constant(s)},u={canBatchModify:t.constant(!0)};if(n.isAllow("outerAuditRole"))u={canBatchModify:t.constant(!1)};exports.constructor=function(){this.$super(arguments),this.putDatasource(u),this.putDatasource(l)},exports.prepare=function(){this.$super(arguments);var e=this.get("data");if(e.canCreateAudit=!1,e.canBatchDownload=!0,e.canBatchDelete=!1,n.isAllow("innerAuditRole")||n.isAllow("managerRole"))e.canCreateAudit=!0,e.canBatchDelete=!0;if(n.isAllow("outerAuditRole"))e.canBatchDownload=!1},exports.getRemoveAdvice=function(t){var i=require("er/Deferred"),n=this.get("entityDescription"),r=a;if(1===t.length)r=o;var s={message:e.template(r,{entityDescription:n})};return i.resolved(s)},exports.getQuery=function(){var e=this.get("beginTime"),t=this.get("endTime"),i={id:this.get("id"),beginTime:e,endTime:t,taskName:this.get("taskName"),addUser:this.get("addUser"),size:this.get("size"),keyword:this.get("keyword"),status:this.get("status"),order:this.get("order"),orderBy:this.get("orderBy"),page:this.get("page")||1};if(!i.status)i.status=this.getDefaultStatusValue();else if("all"===i.status)i.status="";return i},exports.getFilters=function(){var t,n;if(this.get("beginTime"))t=e.formatTime(new Date(parseInt(this.get("beginTime"))));if(this.get("endTime"))n=e.formatTime(new Date(parseInt(this.get("endTime"))));return{status:{value:this.get("status"),text:i.select.getText,datasource:this.get("statuses")},beginTime:{value:t,text:t},endTime:{value:n,text:n},id:{value:this.get("id"),text:this.get("id")},taskName:{value:this.get("taskName"),text:this.get("taskName")},addUser:{value:this.get("addUser"),text:this.get("addUser")}}};var h=require("common/ListModel"),d=require("eoo").create(h,exports);return d}),define("audit/ListView",["require","common/util","tpl!b1c6f6b6.tpl.html","etpl","./enum","er/permission","esui/Table","common/ListView","eoo"],function(require){function e(e){var t=n.findWhere(this.model.getStatusTransitions(),{statusName:e.name});if("click"===e.triggerType)if(t){var i={id:parseInt(e.args),status:t.status};this.fire("modifystatus",i)}}function t(e){var t=e.name,i=this.getSafely("nameContainer");if("name-fetch"===t){var n=this.getSafely("addUser").getValue();this.model.data().getUsers(n).then(function(e){i.setContent(r.render("autoName",{list:e.data})),i.show()})}}function i(e){var t=e.target.getElementsByClassName("auto-name-list-name")[0]||e.target;if(t){var i=t.innerText;this.getSafely("addUser").setValue(i)}}var n=require("common/util");require("tpl!b1c6f6b6.tpl.html");var r=require("etpl"),a=require("./enum").Status,o=require("er/permission"),s=require("./enum").ModUserLevel,exports={};exports.template="auditList",exports.tableFields=[{title:"任务ID",field:"id",sortable:!0,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+e.id+"</span>"}},{title:"任务名称",field:"taskName",sortable:!1,resizable:!1,width:50,stable:!0,content:function(e){return'<a data-ui-type="Link" class="table-command-pure-text" href="#/audit/statistics~reviewTaskId='+e.id+'">'+e.taskName+"</a>"}},{title:"创建人",field:"addUser",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+e.addUser+"</span>"}},{title:"创建时间",field:"addTime",sortable:!0,resizable:!1,width:40,stable:!0,content:function(e){var t=new Date(e.addTime);return n.formatTimeToSecond(t)}},{title:"状态",field:"status",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){var t="";switch(a.fromValue(e.status).alias){case"toBegin":t="task-status-toBegin";break;case"done":t="task-status-done";break;case"doing":t="task-status-doing"}return'<span class="'+t+'">'+a.fromValue(e.status).text+"</span>"}},{title:"审核人员",field:"moduserLevel",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+s.fromValue(e.moduserLevel).text+"</span>"}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:25,stable:!0,content:function(e){var t=e.moduserLevel;if(!(s.outter===t&&o.isAllow("innerMarkerRole")||s.inner===t&&o.isAllow("outerAuditRole")))if("done"===a.fromValue(e.status).alias)return'<a data-ui-type="Link" class="table-command-text" href="#/audit/statistics~reviewTaskId='+e.id+'">进入审核</a>';else return'<a data-ui-type="Link" class="table-command-text"href="#/audit/task/list~taskId='+e.id+'">进入审核</a>'}},{title:"",field:"download",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){var t=e.status;if(t===a.done&&!o.isAllow("outerAuditRole"))return'<a data-ui-type="Link" class="table-command-text" target="_blank"href="ctp/review/task/download.do?taskId='+e.id+'">下载</a>';else return void 0}},{title:"",field:"delete",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){var t=require("esui/Table"),i=null;if(o.isAllow("innerAuditRole")||o.isAllow("managerRole"))i={command:"remove",args:e.id,className:"table-command-text",text:"删除"};return t.command(i)}}],exports.uiEvents={"table:command":e,"addUser:command":t,"addUser:blur":"hideNamePanel"},exports.hideNamePanel=function(){setTimeout(function(){this.getSafely("nameContainer").hide()}.bind(this),200)},exports.enterDocument=function(){this.$super(arguments),this.hideNamePanel();var e=this.getSafely("nameContainer");if(e)e.helper.addDOMEvent(e.main,"click",n.bind(i,this))},exports.submitSearch=function(){var e=this.get("time"),t=e.getRawValue();this.fire("searchAllKey",{begin:t.begin.getTime(),end:t.end.getTime()})},exports.updateBatchButtonStatus=function(){this.$super(arguments);var e=this.getSelectedItems(),t="javascript:void(0)",i="ctp/review/task/download.do",r=n.pluck(e,"id"),s=this.getSafely("download");if(n.all(e,function(e){return e.status===a.done&&!o.isAllow("outerAuditRole")})&&e.length)i+="?taskId="+r.join(","),s.removeState("disabled"),s.set("href",i);else s.addState("disabled"),s.set("href",t)};var l=require("common/ListView"),u=require("eoo").create(l,exports);return u}),define("audit/schema",["require"],function(){return{taskName:["string","任务名称",{required:!0,maxLength:30}],customGroupNum:["number","标注数量",{required:!1}]}}),define("audit/statistics/auditResult/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.search=function(e){return this.request("auditResult/search",e,{method:"GET",url:"/getReviewPageInfo.do",urlPrefix:"ctp/review"})};var i=require("eoo").create(t,exports),n={search:{name:"auditResult/search",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("audit/statistics/auditResult/enum",["require"],function(){var exports={};return exports}),define("audit/statistics/auditResult/RightList",["require","common/ListAction","eoo"],function(require){var exports={};exports.entityDescription="审核正确列表",exports.initBehavior=function(){this.$super(arguments)};var e=require("common/ListAction"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/auditResult/RightListModel",["require","common/ListModel","eoo"],function(require){var exports={};exports.getQuery=function(){var e={reviewTaskId:this.get("reviewTaskId")||"",size:this.get("size"),page:this.get("page")||1,tabType:2};return e};var e=require("common/ListModel"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/auditResult/RightListView",["require","tpl!b1c6f6b6.tpl.html","common/ListView","eoo"],function(require){require("tpl!b1c6f6b6.tpl.html");var exports={};exports.tableFields=[{title:"推广组ID",field:"groupId",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return'<a data-ui-type="Link" class="table-command-pure-text" data-redirect="global force"href="#/audit/task/list~id='+e.reviewGroupId+'">'+e.groupId+"</a>"}},{title:"所属标注任务名",field:"taskName",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return e.taskName}},{title:"创意数",field:"adCount",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){return e.adCount}},{title:"标注人",field:"tagUser",sortable:!1,resizable:!1,width:20,stable:!0,content:function(e){return e.tagUser}},{title:"审核人",field:"reviewUser",sortable:!1,resizable:!1,width:20,stable:!0,content:function(e){return e.reviewUser}},{title:"审核详细",field:"auditDetail",sortable:!1,resizable:!1,width:60,stable:!0,content:function(){return'<span style="color: #83cd82">正确</span>'}}],exports.enterDocument=function(){this.$super(arguments)},exports.template="rightList";var e=require("common/ListView"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/auditResult/ToBeginList",["require","common/ListAction","eoo"],function(require){var exports={};exports.entityDescription="未审核列表";var e=require("common/ListAction"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/auditResult/ToBeginListModel",["require","common/ListModel","eoo"],function(require){var exports={};exports.constructor=function(){this.$super(arguments)},exports.getQuery=function(){var e={reviewTaskId:this.get("reviewTaskId")||"",size:this.get("size"),page:this.get("page")||1,tabType:1};return e};var e=require("common/ListModel"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/auditResult/ToBeginListView",["require","tpl!b1c6f6b6.tpl.html","common/ListView","eoo"],function(require){require("tpl!b1c6f6b6.tpl.html");var exports={};exports.tableFields=[{title:"推广组ID",field:"groupId",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return'<a data-ui-type="Link" class="table-command-pure-text" data-redirect="global force"href="#/audit/task/list~id='+e.reviewGroupId+'">'+e.groupId+"</a>"}},{title:"所属标注任务名",field:"taskName",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return e.taskName}},{title:"创意数",field:"adCount",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){return e.adCount}},{title:"标注人",field:"tagUser",sortable:!1,resizable:!1,width:20,stable:!0,content:function(e){return e.tagUser}},{title:"审核人",field:"reviewUser",sortable:!1,resizable:!1,width:20,stable:!0,content:function(e){return e.reviewUser}},{title:"审核详细",field:"auditDetail",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return'<a data-ui-type="Link" class="table-command-text" data-redirect="global force"href="#/audit/task/list~id='+e.reviewGroupId+'">未审核</a>'}}],exports.enterDocument=function(){this.$super(arguments)},exports.template="toBeginList";var e=require("common/ListView"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/auditResult/WrongList",["require","common/ListAction","eoo"],function(require){var exports={};exports.entityDescription="审核错误列表",exports.initBehavior=function(){this.$super(arguments)};var e=require("common/ListAction"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/auditResult/WrongListModel",["require","common/util","common/ListModel","eoo"],function(require){var e=require("common/util"),exports={};exports.constructor=function(){this.$super(arguments)},exports.prepare=function(){this.$super(arguments);var t=this.get("data").list;e.each(t,function(e){e.id=e.groupId})},exports.getQuery=function(){var e={reviewTaskId:this.get("reviewTaskId")||"",size:this.get("size"),page:this.get("page")||1,tabType:3};return e};var t=require("common/ListModel"),i=require("eoo").create(t,exports);return i}),define("audit/statistics/auditResult/WrongListView",["require","tpl!b1c6f6b6.tpl.html","etpl","esui/Table","common/ListView","eoo"],function(require){require("tpl!b1c6f6b6.tpl.html");var e=require("etpl"),exports={};exports.tableFields=[{title:"推广组ID",field:"groupId",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return'<a data-ui-type="Link" class="table-command-pure-text" data-redirect="global force"href="#/audit/task/list~id='+e.reviewGroupId+'">'+e.groupId+"</a>"}},{title:"所属标注任务名",field:"taskName",sortable:!1,resizable:!1,width:60,stable:!0,content:function(e){return e.taskName}},{title:"创意数",field:"adCount",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){return e.adCount}},{title:"标注人",field:"tagUser",sortable:!1,resizable:!1,width:20,stable:!0,content:function(e){return e.tagUser}},{title:"审核人",field:"reviewUser",sortable:!1,resizable:!1,width:20,stable:!0,content:function(e){return e.reviewUser}},{title:"审核详细",field:"auditDetail",sortable:!1,resizable:!1,width:40,stable:!0,content:function(e){var t=require("esui/Table"),i={command:"showDetail",args:e.groupId,className:"table-command-text",text:"查看明细"};return t.command(i)}}],exports.enterDocument=function(){this.$super(arguments),this.hideDetail()},exports.template="wrongList",exports.uiEvents={"table:command":"commandHandler","detailCloseButton:click":"hideDetail"},exports.commandHandler=function(t){this.$super(arguments);var i=t.name,n=JSON.parse(t.args);if("showDetail"===i){var r=this.model.getItemById(n),a=this.model.indexOf(r);this.getSafely("allInfoContainer").setContent(e.render("wrongInfo",{wrongTagInfoList:r.wrongTagInfoList,wrongTradeInfoList:r.wrongTradeInfoList})),this.showDetail(a)}},exports.hideDetail=function(){this.getSafely("auditDetail").hide()},exports.showDetail=function(e){var t=this.getSafely("auditDetail"),i=37*(e+2);t.setStyle("top",i+"px"),t.show()};var t=require("common/ListView"),i=require("eoo").create(t,exports);return i}),define("audit/statistics/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.getBasicInfo=function(e){return this.request("statistics/getBasicInfo",e,{method:"GET",url:"/getBasicInfo.do",urlPrefix:"ctp/review"})};var i=require("eoo").create(t,exports),n={getDimention:{name:"statistics/getBasicInfo",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("audit/statistics/dimension/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.getReviewTaskAccuracy=function(e){return this.request("auditDimension/getReviewTaskAccuracy",e,{method:"GET",url:"/getReviewTaskAccuracy.do",urlPrefix:"ctp/review"})},exports.getReviewTagAccuracy=function(e){return this.request("auditDimension/getReviewTagAccuracy",e,{method:"GET",url:"/getReviewTagAccuracy.do",urlPrefix:"ctp/review"})};var i=require("eoo").create(t,exports),n={getReviewTaskAccuracy:{name:"auditDimension/getReviewTaskAccuracy",scope:"instance",policy:"auto"},getReviewTagAccuracy:{name:"auditDimension/getReviewTagAccuracy",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("audit/statistics/dimension/Dimension",["require","common/util","ub-ria/mvc/BaseAction","eoo"],function(require){function e(e){this.model.refreshDimension(e).then(t.bind(function(){this.refreshChart(e.targetChart,e.toType)},this))}var t=require("common/util"),exports={};exports.entityDescription="",exports.initBehavior=function(){this.$super(arguments),this.view.on("dimensionChange",e)};var i=require("ub-ria/mvc/BaseAction"),n=require("eoo").create(i,exports);return n}),define("audit/statistics/dimension/DimensionModel",["require","er/Deferred","common/util","ub-ria/mvc/BaseModel","eoo"],function(require){function e(e){var t=i.reduce(e,function(e,t){return e+t.value},0);return i.map(e,function(e){return 0===t?0:(e.value/t*100).toFixed(2)})}var t=require("er/Deferred"),i=require("common/util"),exports={},n={reviewTaskAccuracy:function(e){var t=e.getQuery(),i=e.data().getReviewTaskAccuracy(t).then(function(e){return e.data});return i}},r={reviewTagAccuracy:function(e){var t=e.getQuery(),i=e.data().getReviewTagAccuracy(t).then(function(e){return e.data});return i}};exports.constructor=function(){this.$super(arguments),this.putDatasource(n,0),this.putDatasource(r,1)},exports.getQuery=function(){return{reviewTaskId:this.get("reviewTaskId")||""}},exports.refreshDimension=function(e){var i=this.get("reviewTagAccuracy"),n=e.targetChart.prefix;if(1==e.toType)i[n].data.splice(1,1);else if(2==e.toType)i[n].data.push(i[n+"BeforeData"]);return t.resolved()},exports.prepare=function(){this.$super(arguments);var t=this.get("reviewTaskAccuracy"),i=this.get("reviewTagAccuracy");i.beautyBeforeData=[{value:i.tagHighBeautyNum,name:"高"},{value:i.tagNormalBeautyNum,name:"中"},{value:i.tagLowBeautyNum,name:"低"}],i.vulgarBeforeData=[{value:i.tagBlackVulgarNum,name:"黑"},{value:i.tagGrayVulagrNum,name:"灰"},{value:i.tagWhiteVulgarNum,name:"白"}],i.dangerBeforeData=[{value:i.tagIsCheatNum,name:"是"},{value:i.tagNotCheatNum,name:"否"}],i.cheatBeforeData=[{value:i.tagIsHighDangerNum,name:"是"},{value:i.tagNotHighDangerNum,name:"否"}],i.beauty={legend:["高","中","低"],name:["审核后","审核前"],data:[[{value:i.reviewHighBeautyNum,name:"高"},{value:i.reviewNormalBeautyNum,name:"中"},{value:i.reviewLowBeautyNum,name:"低"}],i.beautyBeforeData]},i.vulgar={legend:["黑","灰","白"],name:["审核后","审核前"],data:[[{value:i.reviewBlackVulgarNum,name:"黑"},{value:i.reviewGrayVulagrNum,name:"灰"},{value:i.reviewWhiteVulgarNum,name:"白"}],i.vulgarBeforeData]},i.danger={legend:["是","否"],name:["审核后","审核前"],data:[[{value:i.reviewIsCheatNum,name:"是"},{value:i.reviewNotCheatNum,name:"否"}],i.dangerBeforeData]},i.cheat={legend:["是","否"],name:["审核后","审核前"],data:[[{value:i.reviewIsHighDangerNum,name:"是"},{value:i.reviewNotHighDangerNum,name:"否"}],i.cheatBeforeData]},i.beautyRate={before:e(i.beautyBeforeData),after:e(i.beauty.data[0])},i.vulgarRate={before:e(i.vulgarBeforeData),after:e(i.vulgar.data[0])},i.dangerRate={before:e(i.dangerBeforeData),after:e(i.danger.data[0])},i.cheatRate={before:e(i.cheatBeforeData),after:e(i.cheat.data[0])},t.wuliao=[{name:"任务准确率",data:[t.taskAccuracy]},{name:"文字类准确率",data:[t.textAdAccuracy]},{name:"非文字类准确率",data:[t.otherAdAccuracy]}],t.tag=[{name:"所属行业准确率",data:[t.tradeAccuracy]},{name:"美观准确率",data:[t.beautyAccuracy]},{name:"低俗度准确率",data:[t.vulgarAccuracy]},{name:"欺诈度准确率",data:[t.cheatAccuracy]},{name:"高危度准确率",data:[t.highDangerAccuracy]}],t.taskAccuracy=t.taskAccuracy.toFixed(2)+"%",t.textAdAccuracy=t.textAdAccuracy.toFixed(2)+"%",t.otherAdAccuracy=t.otherAdAccuracy.toFixed(2)+"%",t.tradeAccuracy=t.tradeAccuracy.toFixed(2)+"%",t.beautyAccuracy=t.beautyAccuracy.toFixed(2)+"%",t.vulgarAccuracy=t.vulgarAccuracy.toFixed(2)+"%",t.cheatAccuracy=t.cheatAccuracy.toFixed(2)+"%",t.highDangerAccuracy=t.highDangerAccuracy.toFixed(2)+"%"};var a=require("ub-ria/mvc/BaseModel"),o=require("eoo").create(a,exports);return o}),define("audit/statistics/dimension/DimensionView",["require","tpl!b1c6f6b6.tpl.html","ub-ria/mvc/BaseView","eoo"],function(require){function e(e){var t=e.target,i=parseInt(e.target.getValue()),n=this.getSafely(t.targetChart),r=this.getSafely(t.targetTable);if(1===i)r.show(),n.main.style.height="300px",this.fire("dimensionChange",{toType:2,targetChart:n});else r.hide(),n.main.style.height="440px",this.fire("dimensionChange",{toType:1,targetChart:n})}require("tpl!b1c6f6b6.tpl.html");var exports={};exports.enterDocument=function(){this.$super(arguments)},exports.uiEvents={"beautyShowBefore:change":e,"vulgarShowBefore:change":e,"dangerShowBefore:change":e,"cheatShowBefore:change":e},exports.refreshChart=function(e,t){e.refresh(this.model.get("reviewTagAccuracy")[e.prefix],1===t?"440px":"300px")},exports.template="auditDimensionView";var t=require("ub-ria/mvc/BaseView"),i=require("eoo").create(t,exports);return i}),define("audit/statistics/Statistics",["require","ub-ria/mvc/BaseAction","eoo"],function(require){var exports={};exports.entityDescription="任务统计",exports.initBehavior=function(){this.$super(arguments)};var e=require("ub-ria/mvc/BaseAction"),t=require("eoo").create(e,exports);return t}),define("audit/statistics/StatisticsModel",["require","./../enum","ub-ria/mvc/BaseModel","eoo"],function(require){var e=require("./../enum").Status,exports={},t={basicInfo:function(e){var t=e.getQuery(),i=e.data().getBasicInfo(t).then(function(e){return e.data});return i}};exports.constructor=function(){this.$super(arguments),this.putDatasource(t)},exports.getQuery=function(){return{reviewTaskId:this.get("reviewTaskId")||""}},exports.prepare=function(){this.$super(arguments);var t=this.get("basicInfo");t.statusPrefix=e.fromValue(t.taskStatus).alias,t.totalGroups=t.isReviewedGroups+t.notReviewedGroups,t.doneGroupsRate=(t.isReviewedGroups/t.totalGroups*100).toFixed(1)+"%",t.notDoneGroupsRate=(t.notReviewedGroups/t.totalGroups*100).toFixed(1)+"%",t.totalAds=t.isReviewedAds+t.notReviewedAds,t.doneAdsRate=(t.isReviewedAds/t.totalAds*100).toFixed(1)+"%",t.notDoneAdsRate=(t.notReviewedAds/t.totalAds*100).toFixed(1)+"%"};var i=require("ub-ria/mvc/BaseModel"),n=require("eoo").create(i,exports);return n}),define("audit/statistics/StatisticsView",["require","tpl!b1c6f6b6.tpl.html","ub-ria/mvc/BaseView","eoo"],function(require){function e(e){var t=e.target;if(this.getSafely("auditProgressBar").toggle(),"1"===t.needOpen)t.needOpen="0",t.set("content","收起详情");else t.needOpen="1",t.set("content","展开详情")}require("tpl!b1c6f6b6.tpl.html");var exports={};exports.uiEvents={"toggle-detail-button:click":e},exports.template="auditStatisticsView",exports.enterDocument=function(){this.$super(arguments),this.getSafely("auditProgressBar").hide(),this.getSafely("statisticsTab").set("activeIndex",3)};var t=require("ub-ria/mvc/BaseView"),i=require("eoo").create(t,exports);return i}),define("audit/Success",["require","ub-ria/mvc/BaseAction","eoo"],function(require){var e=require("ub-ria/mvc/BaseAction"),t=require("eoo"),exports={};exports.initBehavior=function(){this.$super(arguments),this.view.on("backToHistory",function(){this.back()},this)},exports.group="audit",exports.entityDescription="审核任务";var i=t.create(e,exports);return i}),define("audit/SuccessModel",["require","ub-ria/mvc/BaseModel","eoo"],function(require){var e=require("ub-ria/mvc/BaseModel"),exports={};exports.constructor=function(){this.$super(arguments),this.set("entityDescription","审核任务")};var t=require("eoo").create(e,exports);return t}),define("audit/SuccessView",["require","tpl!b1c6f6b6.tpl.html","ub-ria/mvc/BaseView","eoo"],function(require){function e(){this.fire("backToHistory")}require("tpl!b1c6f6b6.tpl.html"),require("tpl!b1c6f6b6.tpl.html");var t=require("ub-ria/mvc/BaseView"),exports={};exports.uiEvents={"backToHistory:click":e},exports.template="auditSuccess",exports.enterDocument=function(){this.$super(arguments)};var i=require("eoo").create(t,exports);return i}),define("permission/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.search=function(e){return this.request("permission/search",e,{method:"GET",url:"/getInfoList.do",urlPrefix:"ctp/user"})},exports.save=function(e){return this.request("permission/save",e,{method:"POST",url:"/add.do",urlPrefix:"ctp/user"})},exports.update=function(e){return this.request("permission/update",e,{method:"POST",url:"/update.do",urlPrefix:"ctp/user"})},exports.updateStatus=function(e,t){return this.request("permission/updateStatus",{userIdList:t},{method:"POST",url:"/delete.do",urlPrefix:"ctp/user"})},exports.thaw=function(e){return this.request("permission/thaw",{userIdList:e},{method:"POST",url:"/thawByIdList.do",urlPrefix:"ctp/user"})};var i=require("eoo").create(t,exports),n={search:{name:"permission/search",scope:"instance",policy:"auto"},save:{name:"permission/save",scope:"instance",policy:"auto"},update:{name:"permission/update",scope:"instance",policy:"auto"},updateStatus:{name:"permission/updateStatus",scope:"instance",policy:"auto"},thaw:{name:"permission/thaw",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");
return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("permission/enum",["require","er/Enum"],function(require){var e=require("er/Enum"),exports={};return exports.UserRole=new e({alias:"manager",text:"管理员",value:0},{alias:"innerMarker",text:"内部标注",value:1},{alias:"innerAudit",text:"内部审核",value:2},{alias:"outerMarker",text:"外部标注",value:10},{alias:"outerAudit",text:"外部审核",value:11}),exports.FreezedState=new e({alias:"noFreezed",text:"未冻结",value:2},{alias:"freezed",text:"已冻结",value:3}),exports}),define("ub-ria/mvc/handler/RedirectSubmitHandler",["require","underscore","./SubmitHandler","eoo"],function(require){var e=require("underscore"),t=require("./SubmitHandler"),exports={};exports.template="/${entityName}/list",exports.redirectOptions=null,exports.setTemplate=function(e){this.template=e},exports.getTemplate=function(){return this.template},exports.setRedirectOptions=function(e){this.redirectOptions=e},exports.getRedirectOptions=function(){return this.redirectOptions},exports.handle=function(t,i){var n=this.getData(t,i),r=e.template(this.getTemplate(),n);this.redirect(i,r,this.getRedirectOptions()),this.next(t,i)},exports.redirect=function(e,t,i){e.redirect(t,i)},exports.getData=function(e,t){return{entityName:t.getEntityName()}};var i=require("eoo").create(t,exports);return i}),define("permission/Form",["require","common/extension/CustomToastHandler","ub-ria/mvc/handler/RedirectSubmitHandler","common/FormAction","eoo"],function(require){var e=require("common/extension/CustomToastHandler"),t=require("ub-ria/mvc/handler/RedirectSubmitHandler"),i=new e,n=new t,exports={};exports.group="resource",exports.entityDescription="开通账户",exports.initBehavior=function(){this.$super(arguments),i.setNextSubmitHandler(n),n.setRedirectOptions({global:!0,force:!0}),this.setSubmitHandler(i)};var r=require("common/FormAction"),a=require("eoo").create(r,exports);return a}),define("permission/FormModel",["require","er/datasource","./enum","common/FormModel","eoo"],function(require){var e=require("er/datasource"),t=require("./enum").UserRole,exports={},i=t.toArray();i.shift();var n={userRoles:e.constant(i)},r={innerUserRoles:e.constant(i.slice(0,2))},a={outerUserRoles:e.constant(i.slice(2))};exports.constructor=function(){this.$super(arguments),this.store.entity=1,this.putDatasource(n,0),this.putDatasource(r),this.putDatasource(a)};var o=require("common/FormModel"),s=require("eoo").create(o,exports);return s}),define("permission/schema",["require"],function(){return{password:["string","初始密码",{required:!0,minLength:6,maxLength:16}]}}),define("permission/FormView",["require","common/util","common/dom","tpl!b1c6f6b6.tpl.html","./enum","./schema","common/FormView","eoo"],function(require){function e(e){var t=r.getAliasFromValue(e);return t.indexOf("inner")}function t(){var e=r.getAliasFromValue(this.get("roleType").getValue());if("create"===this.model.get("formType"))if("innerMarker"===e||"innerAudit"===e)this.removeValidator();else this.resetValidator()}var i=require("common/util"),n=require("common/dom");require("tpl!b1c6f6b6.tpl.html");var r=require("./enum").UserRole,a=require("./schema"),exports={};exports.template="permissionForm",exports.getEntity=function(){var t=this.model.getValidator();if("inner"===this.model.get("userRoleType"))t.setSchema({}),this.model.setValidator(t);var n=this.$super(arguments);if(this.model.get("id"))n.id=parseInt(this.model.get("id"));else if(n.userName)if(n.userName=i.filter(n.userName.split("\n"),function(e){return""!==e}),e(n.roleType)>=0)delete n.password;return n},exports.uiEvents={"roleType:change":t},exports.removeValidator=function(){var e=this.model.getValidator();if(this.get("password")){var t=this.get("password").main.parentNode.parentNode;n.addClass(t,"hide-info"),this.get("password").setValue("1111111111"),e.setSchema({})}this.model.setValidator(e)},exports.resetValidator=function(){var e=this.model.getValidator();if(this.get("password")){var t=this.get("password").main.parentNode.parentNode;n.removeClass(t,"hide-info"),this.get("password").setValue(""),e.setSchema(a)}this.model.setValidator(e)},exports.enterDocument=function(){if(this.$super(arguments),"create"===this.model.get("formType"))this.removeValidator()};var o=require("common/FormView"),s=require("eoo").create(o,exports);return s}),define("permission/List",["require","esui/Toast","common/ListAction","eoo"],function(require){function e(e){this.performSearchAllKey(e)}function t(e){if("remove"===e.statusName){var t=i.success("删除成功");t.show(),this.reload()}if("thaw"===e.statusName)return void e.preventDefault();else return void 0}var i=require("esui/Toast"),exports={};exports.group="resource",exports.entityDescription="账户",exports.initBehavior=function(){this.$super(arguments),this.view.on("searchAllKey",e,this),this.on("statusupdate",t,this)},exports.performSearchAllKey=function(e){var t=this.fire("search");if(!t.isDefaultPrevented()){var i=this.getSearchQuery();if(i.page=1,e.roleType.length)i.roleType=e.roleType.join(",");else if(this.model.get("roleType"))i.roleType=this.model.get("roleType");this.reloadWithQueryUpdate(i)}};var n=require("common/ListAction"),r=require("eoo").create(n,exports);return r}),define("permission/ListModel",["require","common/util","er/datasource","./enum","er/Deferred","common/ListModel","eoo"],function(require){var e=require("common/util"),t="你确定要删除这些用户吗？该用户下的所有信息将被一并删除，删除后不可恢复。",i="你确定要删除该用户吗？该用户下的所有信息将被一并删除，删除后不可恢复。",n=require("er/datasource"),r=require("./enum").UserRole,exports={};exports.statusTransitions=[{status:0,deny:[0],statusName:"remove",command:"删除"},{status:1,statusName:"restore",command:"启用"},{status:2,accept:[3],statusName:"thaw",command:"解冻"},{status:3,accept:[2],statusName:"freeze",command:"冻结"}];var a={canBatchModify:n.constant(!0)},o=r.toArray(),s={roles:n.constant(o)};exports.constructor=function(){this.$super(arguments),this.putDatasource(a),this.putDatasource(s)},exports.prepare=function(){this.$super(arguments);var t=this.get("data").list;e.each(t,function(e){e.status=e.isFreezed+2})},exports.getQuery=function(){var e={id:this.get("id"),userName:this.get("keyword"),roleType:this.get("roleType"),size:this.get("size"),order:this.get("order"),orderBy:this.get("orderBy"),page:this.get("page")||1};return e},exports.getRemoveAdvice=function(n){var r=require("er/Deferred"),a=this.get("entityDescription"),o=t;if(1===n.length)o=i;var s={message:e.template(o,{entityDescription:a})};return r.resolved(s)},exports.getFilters=function(){var t=[];if(this.get("roleType"))t=this.get("roleType").split(",");var i=e.map(t,function(e){return r.getTextFromValue(e)});return{userRoles:{value:this.get("roleType"),text:i.join(", ")}}},exports.thaw=function(e){var t=this.data();return t.thaw(e||{})};var l=require("common/ListModel"),u=require("eoo").create(l,exports);return u}),define("permission/ListView",["require","common/util","tpl!b1c6f6b6.tpl.html","./enum","esui/Table","common/ListView","eoo"],function(require){function e(e){var t=r.getAliasFromValue(e);return t.indexOf("inner")}function t(e){var t=n.findWhere(this.model.getStatusTransitions(),{statusName:e.name});if("click"===e.triggerType)if(t){var r={id:parseInt(e.args),status:t.status};this.fire("modifystatus",r)}else if("modify"===e.name){var a=e.args,o=i.call(this,a),s={url:o};this.popDrawerAction(s).show()}}function i(e){var t,i=this.model.get("url").getPath(),n=i.lastIndexOf("/");if(e.indexOf("inner")>=0)t=i.substring(0,n+1)+"innerUpdate~"+e;else t=i.substring(0,n+1)+"outerUpdate~"+e;return t}var n=require("common/util");require("tpl!b1c6f6b6.tpl.html");var r=require("./enum").UserRole,a=require("./enum").FreezedState,exports={};exports.template="permissionList",exports.tableFields=[{title:"帐户名",field:"userName",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+e.userName+"</span>"}},{title:"权限角色",field:"roleType",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+r.fromValue(e.roleType).text+"</span>"}},{title:"密码",field:"password",sortable:!1,resizable:!1,width:40,stable:!0,content:function(e){return"<span>"+e.password+"</span>"}},{title:"创建日期",field:"addTime",sortable:!0,resizable:!1,width:40,stable:!0,content:function(e){var t=new Date(e.addTime);return n.formatTime(t)}},{title:"用户状态",field:"isFreezed",sortable:!0,resizable:!1,width:40,stable:!0,content:function(e){var t=require("esui/Table");if(e.status===a.noFreezed)return"<span>"+a.fromValue(e.status).text+"</span>";else if(e.status===a.freezed){var i={command:"thaw",args:e.id,className:"table-command-text",text:"已冻结"};return t.command(i)}}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:60,stable:!0,content:function(t){var i,n=require("esui/Table");if(e(t.roleType)>=0)i="id="+t.id+"&roleType="+t.roleType+"&userName="+t.userName+"&password="+t.password+"&inner=true";else i="id="+t.id+"&roleType="+t.roleType+"&userName="+t.userName+"&password="+t.password;var a=[{command:"modify",args:i,text:"更改"},{command:"remove",args:t.id,text:"删除"}];if(t.roleType===r.manager)a.shift();return n.operations(a)}}],exports.uiEvents={"table:command":t},exports.submitSearch=function(){var e=[];if(this.getSafely("innerMarker").checked)e.push(r.getValueFromAlias("innerMarker"));if(this.getSafely("innerAudit").checked)e.push(r.getValueFromAlias("innerAudit"));if(this.getSafely("outerMarker").checked)e.push(r.getValueFromAlias("outerMarker"));if(this.getSafely("outerAudit").checked)e.push(r.getValueFromAlias("outerAudit"));if(this.getSafely("manager").checked)e.push(r.getValueFromAlias("manager"));this.fire("searchAllKey",{roleType:e})},exports.updateFilterPanelStatus=function(){};var o=require("common/ListView"),s=require("eoo").create(o,exports);return s}),define("log/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={};exports.search=function(e){return this.request("log/search",e,{method:"GET",url:"/getAllOperationRecord.do",urlPrefix:"ctp/operationRecord"})};var i=require("eoo").create(t,exports),n={search:{name:"log/search",scope:"instance",policy:"auto"}},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("log/enum",["require"],function(){var exports={};return exports}),define("log/List",["require","common/ListAction","eoo"],function(require){var exports={};exports.entityDescription="权限操作日志",exports.initBehavior=function(){this.$super(arguments)};var e=require("common/ListAction"),t=require("eoo").create(e,exports);return t}),define("log/ListModel",["require","common/ListModel","eoo"],function(require){var exports={};exports.constructor=function(){this.$super(arguments)},exports.prepare=function(){this.$super(arguments)},exports.getQuery=function(){var e={size:this.get("size"),order:this.get("order"),orderBy:this.get("orderBy"),page:this.get("page")||1,type:this.get("logType")||"user"};return e};var e=require("common/ListModel"),t=require("eoo").create(e,exports);return t}),define("log/ListView",["require","common/util","tpl!b1c6f6b6.tpl.html","common/ListView","eoo"],function(require){var e=require("common/util");require("tpl!b1c6f6b6.tpl.html");var exports={};exports.template="logList",exports.tableFields=[{title:"操作时间",field:"updateTime",sortable:!0,resizable:!1,width:30,stable:!0,content:function(t){var i=new Date(t.updateTime);return e.formatTimeToSecond(i)}},{title:"操作类型",field:"operationType",sortable:!0,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+e.operationType+"</span>"}},{title:"操作对象",field:"operatorName",sortable:!1,resizable:!1,width:40,stable:!0,content:function(e){return"<span>"+e.operatorName+"</span>"}},{title:"操作内容",field:"operation",sortable:!1,resizable:!1,width:40,stable:!0,content:function(e){return"<span>"+e.operation+"</span>"}}],exports.uiEvents={};var t=require("common/ListView"),i=require("eoo").create(t,exports);return i}),define("account/Data",["require","common/util","common/BaseData","eoo","ub-ria/mvc/RequestManager"],function(require){var e=require("common/util"),t=require("common/BaseData"),exports={},i=require("eoo").create(t,exports),n={},r=require("ub-ria/mvc/RequestManager");return e.each(n,function(e){r.register(i,e.name,e)}),i}),define("account/enum",["require"],function(){var exports={};return exports}),define("account/Form",["require","common/extension/PasswordHandler","common/FormAction","eoo"],function(require){function e(){this.redirect("/marker")}var t=require("common/extension/PasswordHandler"),exports={};exports.group="resource",exports.entityDescription="修改密码",exports.initBehavior=function(){this.$super(arguments);var i=new t;this.setSubmitHandler(i),this.on("handlefinish",e)},exports.redirectAfterCancel=function(){this.redirect("/marker")};var i=require("common/FormAction"),n=require("eoo").create(i,exports);return n}),define("account/FormModel",["require","common/GlobalData","er/Deferred","common/FormModel","eoo"],function(require){var e=require("common/GlobalData").getInstance(),t=require("er/Deferred"),exports={},i={user:function(){var t=e.getUser().then(function(e){return e});return t}};exports.constructor=function(){this.$super(arguments),this.putDatasource(i),this.set("entityDescription","修改密码")},exports.prepare=function(){this.$super(arguments)},exports.update=function(i){i=this.fillEntity(i);var n=this.validateEntity(i),r=i.oldPass,a=i.newPass,o=i.newAgainPass;if(a!==o)n.push({field:"newAgainPass",message:"与新密码不一致"});if(r===a)n.push({field:"newPass",message:"新密码应和旧密码不同"});if(n.length>0)return t.rejected({fields:n});else return e.updateUser(i)};var n=require("common/FormModel"),r=require("eoo").create(n,exports);return r}),define("account/FormView",["require","tpl!b1c6f6b6.tpl.html","common/FormView","eoo"],function(require){require("tpl!b1c6f6b6.tpl.html");var exports={};exports.template="accountForm",exports.getEntity=function(){var e=this.$super(arguments);return e},exports.enterDocument=function(){this.$super(arguments),this.get("userName").setText(this.model.get("user").userName)};var e=require("common/FormView"),t=require("eoo").create(e,exports);return t}),define("account/schema",["require"],function(){return{oldPass:["string","原密码",{required:!0}],newPass:["string","新密码",{required:!0}],newAgainPass:["string","再输一次",{required:!0,sameAs:!0}]}}),define("startup/biz",[],{});