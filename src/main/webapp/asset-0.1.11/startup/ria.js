/*! 2015 Baidu Inc. All Rights Reserved */
void function(e){e("eoo/defineAccessor",["require"],function(){function e(e){var t="return typeof this."+i+" === 'object' ? this."+i+"['"+e+"'] : undefined;";return new Function(t)}function t(e){var t="this."+i+" = this."+i+" || {};\nthis."+i+"['"+e+"'] = value;";return new Function("value",t)}var i="__eooPrivateMembers__";return function(i,n,r){var a=n.charAt(0).toUpperCase()+n.slice(1),o="get"+a,s="set"+a;if(!r)i[o]=!r||"function"!=typeof r.get?e(n):r.get,i[s]=!r||"function"!=typeof r.set?t(n):r.set;else"function"==typeof r.get&&(i[o]=r.get),"function"==typeof r.set&&(i[s]=r.set)}})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),void function(e){e("eoo/oo",[],function(){function e(){return e.create.apply(e,arguments)}function t(t){var i=function(){return i.prototype.constructor.apply(this,arguments)};a.prototype=t.prototype;var n=i.prototype=new a;if(n.$self=i,!("$super"in n))n.$super=e.prototype.$super;return i.$superClass=t,i}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function n(e,t){for(var n in e)i(e,n)&&t(e[n],n,e);if(l)for(var r=h.length-1;r>-1;--r){var a=h[r];i(e,a)&&t(e[a],a,e)}}function r(){return this.prototype.constructor.toString()}var a=function(){},o="__eooName__",s="__eooOwner__";e.create=function(i,a){if(a=a||{},i=i||e,"object"==typeof i)a=i,i=e;var l=t(i),h=l.prototype;return n(a,function(e,t){if("function"==typeof e)e[o]=t,e[s]=l;h[t]=e}),l.toString=r,l},e["static"]="function"==typeof Object.create?Object.create:function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return a.prototype=e,new a},e.toString=function(){return"function Class() { [native code] }"},e.prototype={constructor:function(){},$self:e,$superClass:Object,$super:function(e){var t=this.$super.caller,i=t[o],n=t[s].$superClass,r=n.prototype[i];if("function"!=typeof r)throw new TypeError("Call the super class's "+i+", but it is not a function!");return r.apply(this,e)}};var l=!{toString:1}.propertyIsEnumerable("toString"),h=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"];return e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),void function(e){e("eoo/main",["require","./oo","./defineAccessor"],function(require){var e=require("./oo");return e.defineAccessor=require("./defineAccessor"),e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)}),define("eoo",["eoo/main"],function(e){return e}),void function(e,t){e("uioc/util",[],function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function i(e,t){if("function"==typeof d&&e.indexOf===d)return e.indexOf(t);for(var i=0,n=e.length;n>i;++i)if(e[i]===t)return i;return-1}function n(e,t){return i(e,t)>-1}function r(e,t){!n(e,t)&&e.push(t)}function a(){if("undefined"!=typeof console)Function.prototype.apply.call(console.warn,console,arguments)}function o(e){return null!==e&&e!==t&&"[object Object]"===Object.prototype.toString.call(e)}function s(e){return o(e)&&"string"==typeof e.$ref}function l(e){return o(e)&&"string"==typeof e.$import}function h(e){var t=f.call(arguments,1);if("function"==typeof e.bind&&e.bind===p)return e.bind.apply(e,t);else return function(){var i=t.shift();t.push.apply(t,arguments),Function.prototype.apply.call(e,i,t)}}function u(){for(var e={},t=0,i=arguments.length;i>t;++t){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function c(e,t){this.message=e,this.component=t}var d=Array.prototype.indexOf,f=Array.prototype.slice,p=Function.prototype.bind;return c.prototype=Error.prototype,c.prototype.print=function(){a(this.message)},{CircularError:c,hasOwn:e,contains:n,addToSet:r,merge:u,isObject:o,bind:h,indexOf:i,hasReference:s,hasImport:l,warn:a}})}("function"==typeof define&&define.amd?define:function(e){module.exports=e}),void function(e){e("uioc/Container",["require","./util"],function(require){function e(e){this.context=e,this.singletons={}}function t(e,t,n){var r=t.args,a=r.length,o=Array(a);if(!a)return n(o);for(var s=function(e){return function(t){o[e]=t,0===--a&&n(o)}},l=r.length-1;l>-1;--l){var h=r[l];i.hasReference(h)?e.context.getComponent(h.$ref,s(l)):s(l)(h)}}var i=require("./util");return e.prototype.createInstance=function(e,i){if(!e)return i(null);var n=e.id;if("singleton"===e.scope&&this.singletons.hasOwnProperty(n))return i(this.singletons[n]);if("static"===e.scope)return i(e.creator);var r=this;t(this,e,function(t){var a=e.creator.apply(null,t);if("singleton"===e.scope)r.singletons[n]=a;i(a)})},e.prototype.dispose=function(){var e=this.singletons;for(var t in e){var i=e[t];i&&"function"==typeof i.dispose&&i.dispose()}this.singletons=null},e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e}),void function(e){e("uioc/DependencyTree",[],function(){var e=function(){this.data=[],this.children=[],this.parent=null};return e.prototype.appendChild=function(e){return e.parent=this,this.children.push(e),e},e.prototype.checkForCircular=function(e){var t=this.parent;if(null!==t)for(var i=t.data,n=i.length-1;n>-1;--n)if(t.data[n].id&&t.data[n].id===e)return t.data[n];else return t.checkForCircular(e);return null},e.prototype.addData=function(e,t){if(t=!!t,t&&this.checkForCircular(e.id))return!1;else return this.data.push(e),!0},e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e}),void function(e){e("uioc/DependencyParser",["require","./util","./DependencyTree"],function(require){function e(e){this.context=e}function t(e,r,a,o,s){if(e){var module=e.module;if("function"!=typeof e.creator&&module)a[module]=a[module]||[],a[module].push(e);var l=o.checkForCircular(e.id);if(l){var h=e.id+" has circular dependencies ";throw new i.CircularError(h,e)}o.addData(e);var u=o.appendChild(new n);s=s||e.argDeps.concat(e.propDeps).concat(e.setterDeps||[]);for(var c=s.length-1;c>-1;--c)t(r.getComponentConfig(s[c]),r,a,u)}return a}var i=require("./util"),n=require("./DependencyTree"),r=/^set([A-Z].*)$/;return e.prototype.getPropertyFromSetter=function(e){var t=null,i=e.match(r);if(i)t=i[1],t=t.charAt(0).toLowerCase()+t.slice(1);return t},e.prototype.getDepsFromArgs=function(e){for(var t=[],n=e.length-1;n>-1;--n)i.hasReference(e[n])&&i.addToSet(t,e[n].$ref);return t},e.prototype.getDepsFromProperties=function(e){var t=[];for(var n in e)if(i.hasOwn(e,n)){var r=e[n];i.hasReference(r)&&i.addToSet(t,r.$ref)}return t},e.prototype.getDepsFromSetters=function(e,t){t=t||{};var i=[],n=null;for(var r in e)if("function"==typeof e[r])n=this.getPropertyFromSetter(r),n&&!t.hasOwnProperty(n)&&this.context.hasComponent(n)&&i.push(n);return i},e.prototype.getDepsFromInterfaces=function(){},e.prototype.getDependentModules=function(e,i,r){return t(e,this.context,i||{},new n,r)},e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e}),void function(e,t,i){e("uioc/main",["require","./Container","./util","./DependencyParser"],function(require){function e(t){if(t=t||{},!(this instanceof e))return new e(t);else return this.moduleLoader=t.loader||g,this.parser=new m(this),this.components={},this.container=new f(this),void this.addComponent(t.components||{})}function n(e,t){var n={id:e,args:t.args||[],properties:t.properties||{},anonyDeps:null,argDeps:null,propDeps:null,setterDeps:null,scope:t.scope||"transient",creator:t.creator||null,module:t.module||i,isFactory:!!t.isFactory,auto:!!t.auto,instance:null};return"function"==typeof n.creator&&r(n),n}function r(e,module){var t=e.creator=e.creator||module;if("string"==typeof t){var i=module[t],n=function(){return i.apply(module,arguments)};t=!e.isFactory||"static"===e.scope?i:n,e.creator=t}if(!e.isFactory&&"static"!==e.scope)e.creator=function(){return v.prototype=t.prototype,new v(t,arguments)}}function a(e,t,i,n){var r=i.$import,a=e.getComponentConfig(r);if(!a)throw new Error("$import `%s` component, but it is not exist, please check!!",i.$import);var o=t.id+"-"+n+r;return i.id=o=(-1!==o.indexOf(y)?"":y)+o,delete i.$import,e.addComponent(o,p.merge(a,i)),o}function o(e,t){t.anonyDeps=[];for(var i=t.args,n=null,r=i.length-1;r>-1;--r)if(p.hasImport(i[r]))n=a(e,t,i[r],"$arg."),i[r]={$ref:n},t.anonyDeps.push(n);var o=t.properties;for(var s in o)if(p.hasImport(o[s]))n=a(e,t,o[s],"$prop."),o[s]={$ref:n},t.anonyDeps.push(n)}function s(e,t,i){var n=[];for(var a in t)n.push(a);e.moduleLoader(n,function(){for(var e=arguments.length-1;e>-1;--e)for(var module=arguments[e],a=t[n[e]],o=a.length-1;o>-1;--o){var s=a[o];"function"!=typeof s.creator&&r(s,module)}i()})}function l(e,t){var i=Array(e.length);if(0===e.length)return t.apply(null,i);for(var n=this.container,r=this.parser,a=this,o={},l=e.length,u=function(){0===--l&&t.apply(null,i)},c=function(e,t){return function(n){if(i[e]=n,t){if(o=r.getDependentModules(t,{},t.propDeps),!t.setterDeps&&t.auto)t.setterDeps=r.getDepsFromSetters(n,t.properties),o=r.getDependentModules(t,o,t.setterDeps);s(a,o,p.bind(h,a,n,t,u))}else u()}},d=e.length-1;d>-1;--d){var f=this.components[e[d]];n.createInstance(f,c(d,f))}}function h(e,t,i){var n={prop:!1,setter:!1},r=function(e){n[e]=!0,n.prop&&n.setter&&i()};c(this,e,t,p.bind(r,null,"prop")),u(this,e,t,p.bind(r,null,"setter"))}function u(e,t,i,n){var r=i.setterDeps||[];e.getComponent(r,function(){for(var e=r.length-1;e>-1;--e){var i=r[e];d(t,i,arguments[e])}n()})}function c(e,t,i,n){var r=i.propDeps,a=i.properties;e.getComponent(r,function(){for(var e in a){var i=a[e];if(p.hasReference(i))i=arguments[p.indexOf(r,i.$ref)];d(t,e,i)}n()})}function d(e,t,i){var n="set"+t.charAt(0).toUpperCase()+t.slice(1);"function"==typeof e[n]?e[n](i):e[t]=i}var f=require("./Container"),p=require("./util"),m=require("./DependencyParser"),g=t.require,y="^uioc-",v=function(e,t){return e.apply(this,t)};return e.prototype.addComponent=function(e,t){var i=[];if("string"==typeof e){var r={};r[e]=t,this.addComponent(r)}else for(var a in e)if(!this.components[e])this.components[a]=n.call(this,a,e[a]),i.push(a);else p.warn(e+" has been add! This will be no effect");for(var s=i.length-1;s>-1;--s){var l=this.getComponentConfig(i[s]);!l.anonyDeps&&o(this,l),l.argDeps=this.parser.getDepsFromArgs(l.args),l.propDeps=this.parser.getDepsFromProperties(l.properties)}},e.prototype.getComponent=function(e,t){e=e instanceof Array?e:[e];for(var i={},n=this,r=n.parser,a=0,o=e.length;o>a;++a){var h=e[a],u=this.components[h];if(!u)p.warn("`%s` has not been added to the Ioc",h);else i=r.getDependentModules(u,i,u.argDeps)}return s(this,i,p.bind(l,this,e,t)),this},e.prototype.hasComponent=function(e){return!!this.components[e]},e.prototype.getComponentConfig=function(e){return this.components[e]},e.prototype.loader=function(e){this.moduleLoader=e},e.prototype.dispose=function(){this.container.dispose(),this.components=null,this.parser=null},e})}("function"==typeof define&&define.amd?define:function(e){module.exports=e},this),define("uioc",["uioc/main"],function(e){return e}),function(e){function t(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}function i(){this.raw=[],this.length=0}function n(){return"___"+I++}function r(e,t){var i=new Function;i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e){return M[e]}function o(e){return'"'+e.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function s(e){var t=arguments;return e.replace(/\{([0-9]+)\}/g,function(e,i){return t[i-0+1]})}function l(e){return e=e.replace(/^\s*\*/,""),s('gv({0},["{1}"])',o(e),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(e,t){return"."+t}).split(".").join('","'))}function h(e,t,i,n,r,a){for(var o=i.length,s=e.split(t),l=0,h=[],u=0,c=s.length;c>u;u++){var d=s[u];if(u){var f=1;for(l++;;){var p=d.indexOf(i);if(0>p){h.push(l>1&&f?t:"",d);break}if(l=n?l-1:0,h.push(l>0&&f?t:"",d.slice(0,p),l>0?i:""),d=d.slice(p+o),f=0,0===l)break}if(0===l)r(h.join("")),a(d),h=[]}else d&&a(d)}if(l>0&&h.length>0)a(t),a(h.join(""))}function u(e,t,i){var n,r=[],a=t.options,s="",c="",d="",f="";if(i)s="ts(",c=")",d=W,f=A,n=a.defaultFilter;return h(e,a.variableOpen,a.variableClose,1,function(e){if(i&&e.indexOf("|")<0&&n)e+="|"+n;var a=e.indexOf("|"),o=(a>0?e.slice(0,a):e).replace(/^\s+/,"").replace(/\s+$/,""),h=a>0?e.slice(a+1):"",p=0===o.indexOf("*"),m=[p?"":s,l(o),p?"":c];if(h){h=u(h,t);for(var g=h.split("|"),y=0,v=g.length;v>y;y++){var b=g[y];if(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(b)){if(m.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3)m.push(",",RegExp.$3);m.push(")")}}}r.push(d,m.join(""),f)},function(e){r.push(d,i?o(e):e,f)}),r.join("")}function c(e,t){this.value=e,this.engine=t}function d(e,t){this.value=e,this.engine=t,this.children=[]}function f(e,t){var i=e.stack,n=t?i.find(function(e){return e instanceof t}):i.bottom();if(n){var r;do{if(r=i.top(),!r.autoClose)throw new Error(r.type+" must be closed manually: "+r.value);r.autoClose(e)}while(r!==n)}return n}function p(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(\s*master\s*=\s*([a-z0-9_-]+)\s*\))?\s*/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.master=RegExp.$3,this.name=RegExp.$1,d.call(this,e,t),this.contents={}}function m(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(\s*master\s*=\s*([a-z0-9_-]+)\s*\))?\s*/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.master=RegExp.$3,this.name=RegExp.$1,d.call(this,e,t),this.contents={}}function g(e,t){if(!/^\s*([a-z0-9_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,d.call(this,e,t)}function y(e,t){if(!/^\s*([a-z0-9_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,d.call(this,e,t)}function v(e,t){if(!/^\s*([a-z0-9_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,d.call(this,e,t)}function b(e,t){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.expr=RegExp.$2,d.call(this,e,t)}function _(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,d.call(this,e,t)}function V(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,d.call(this,e,t)}function x(e,t){if(!/^\s*(\$\{[\s\S]+\})\s+as\s+\$\{([0-9a-z_]+)\}\s*(,\s*\$\{([0-9a-z_]+)\})?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,d.call(this,e,t)}function U(e,t){d.call(this,e,t)}function k(e,t){U.call(this,e,t)}function w(e,t){d.call(this,e,t)}function L(e,t){t.targetOrMaster=e;var i=t.engine,n=e.name,r=e instanceof p,a=r?"targets":"masters";if(i[a][n])switch(i.options.namingConflict){case"override":i[a][n]=e,r&&t.targets.push(n);case"ignore":break;default:throw new Error((r?"Target":"Master")+" is exists: "+n)}else i[a][n]=e,r&&t.targets.push(n)}function T(e,t){z[e]=t,t.prototype.type=e}function S(e){this.options={commandOpen:"<!--",commandClose:"-->",variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(e),this.masters={},this.targets={},this.filters=t({},E)}function C(e,t){function n(){if(p.length>0){var e=p.join(""),i=new c(e,t);if(i.beforeAdd(u),l.top().addTextNode(i),p=[],t.options.strip&&u.current instanceof d)i.value=e.replace(/^[\x20\t\r]*\n/,"");u.current=i}}function r(e){return e instanceof a}var a,o=t.options.commandOpen,s=t.options.commandClose,l=new i,u={engine:t,targets:[],stack:l},p=[];return h(e,o,s,0,function(e){var i=/^\s*(\/)?([a-z]+)\s*(:([\s\S]*))?$/.exec(e);if(i&&(a=z[i[2].toLowerCase()])&&"function"==typeof a){n();var h=u.current;if(t.options.strip&&h instanceof c)h.value=h.value.replace(/\r?\n[\x20\t]*$/,"\n");if(i[1])h=l.find(r),h&&h.close(u);else{if(h=new a(i[4],t),"function"==typeof h.beforeOpen)h.beforeOpen(u);h.open(u)}u.current=h}else if(!/^\s*\/\//.test(e))p.push(o,e,s);a=null},function(e){p.push(e)}),n(),f(u),u.targets}i.prototype={push:function(e){this.raw[this.length++]=e},pop:function(){if(this.length>0){var e=this.raw[--this.length];return this.raw.length=this.length,e}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(e){for(var t=this.length;t--;){var i=this.raw[t];if(e(i))return i}}};var I=178245,M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},E={html:function(e){return e.replace(/[&<>"']/g,a)},url:encodeURIComponent,raw:function(e){return e}},D='var r="";',W="r+=",A=";",X="return r;";if("undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8)D="var r=[],ri=0;",W="r[ri++]=",X='return r.join("");';c.prototype={getRendererBody:function(){var e=this.value,t=this.engine.options;if(!e||t.strip&&/^\s*$/.test(e))return"";else return u(e,this.engine,1)},getContent:function(){return this.value}},d.prototype={addChild:function(e){this.children.push(e)},open:function(e){var t=e.stack.top();this.parent=t,t&&t.addChild(this),e.stack.push(this)},close:function(e){for(;e.stack.pop().constructor!==this.constructor;);},addTextNode:function(e){this.addChild(e)},getRendererBody:function(){for(var e=[],t=this.children,i=0;i<t.length;i++)e.push(t[i].getRendererBody());return e.join("")}};var P='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';r(p,d),r(m,d),r(g,d),r(y,d),r(v,d),r(b,d),r(_,d),r(V,d),r(x,d),r(U,d),r(k,U),r(w,d);var F={READING:1,READED:2,APPLIED:3,READY:4};m.prototype.close=m.prototype.autoClose=p.prototype.close=p.prototype.autoClose=function(e){d.prototype.close.call(this,e),this.state=this.master?F.READED:F.APPLIED,e.targetOrMaster=null},p.prototype.applyMaster=m.prototype.applyMaster=function(){if(this.state>=F.APPLIED)return 1;var e=this.engine.masters[this.master];if(e&&e.applyMaster()){this.children=[];for(var t=0,i=e.children.length;i>t;t++){var n=e.children[t];if(n instanceof y)this.children.push.apply(this.children,(this.contents[n.name]||n).children);else this.children.push(n)}return this.state=F.APPLIED,1}},p.prototype.isReady=function(){function e(n){for(var r=0,a=n.children.length;a>r;r++){var o=n.children[r];if(o instanceof v){var s=t.targets[o.name];i=i&&s&&s.isReady(t)}else if(o instanceof d)e(o)}}if(this.state>=F.READY)return 1;var t=this.engine,i=1;if(this.applyMaster())return e(this),i&&(this.state=F.READY),i;else return void 0},p.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function("data","engine",[P,D,this.getRendererBody(),X].join("\n")),t=this.engine;return this.renderer=function(i){return e(i,t)},this.renderer}return null},p.prototype.getContent=function(){if(this.isReady()){for(var e=[],t=this.children,i=0;i<t.length;i++)e.push(t[i].getContent());return e.join("")}return""},p.prototype.open=m.prototype.open=function(e){f(e),d.prototype.open.call(this,e),this.state=F.READING,L(this,e)},v.prototype.open=b.prototype.open=V.prototype.open=function(e){var t=e.stack.top();this.parent=t,t.addChild(this)},V.prototype.beforeOpen=v.prototype.beforeOpen=b.prototype.beforeOpen=x.prototype.beforeOpen=_.prototype.beforeOpen=U.prototype.beforeOpen=c.prototype.beforeAdd=function(e){if(!e.stack.bottom()){var t=new p(n(),e.engine);t.open(e)}},V.prototype.close=v.prototype.close=w.prototype.close=b.prototype.close=function(){},v.prototype.getContent=function(){var e=this.engine.targets[this.name];return e.getContent()},v.prototype.getRendererBody=function(){var e=this.engine.targets[this.name];return e.getRendererBody()},V.prototype.getRendererBody=function(){return s("{0}engine.render({2},{{3}}){1}",W,A,o(this.name),u(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(e,t,i){return(t||"")+o(i)+":"}))},b.prototype.getRendererBody=function(){if(this.expr)return s("v[{0}]={1};",o(this.name),u(this.expr,this.engine));else return""},U.prototype.getRendererBody=function(){var e=s("if({0}){{1}}",u(this.value,this.engine),d.prototype.getRendererBody.call(this)),t=this["else"];if(t)return[e,s("else{{0}}",t.getRendererBody())].join("");else return e},x.prototype.getRendererBody=function(){return s('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',n(),u(this.list,this.engine),o(this.index||n()),o(this.item),n(),n(),d.prototype.getRendererBody.call(this))},_.prototype.getRendererBody=function(){var e=this.args;return s("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",D,X,W,A,d.prototype.getRendererBody.call(this),o(this.name),e?","+u(e,this.engine):"")},g.prototype.open=function(e){f(e,g),d.prototype.open.call(this,e),e.targetOrMaster.contents[this.name]=this},y.prototype.open=function(e){f(e,y),d.prototype.open.call(this,e)},g.prototype.autoClose=U.prototype.autoClose=d.prototype.close,y.prototype.autoClose=function(e){var t=this.parent.children;t.push.apply(t,this.children),this.children.length=0,this.close(e)},U.prototype.addChild=function(e){var t=this["else"];(t?t.children:this.children).push(e)},k.prototype.open=function(e){var t=new w;t.open(e);var i=f(e,U);i.addChild(this),e.stack.push(this)},w.prototype.open=function(e){var t=f(e,U);t["else"]=this,e.stack.push(t)};var z={};T("target",p),T("master",m),T("content",g),T("contentplaceholder",y),T("import",v),T("use",V),T("var",b),T("for",x),T("if",U),T("elif",k),T("else",w),T("filter",_),S.prototype.config=function(e){t(this.options,e)},S.prototype.compile=S.prototype.parse=function(e){if(e){var t=C(e,this);if(t.length)return this.targets[t[0]].getRenderer()}return new Function('return ""')},S.prototype.getRenderer=function(e){var t=this.targets[e];if(t)return t.getRenderer();else return void 0},S.prototype.get=function(e){var t=this.targets[e];if(t)return t.getContent();else return""},S.prototype.render=function(e,t){var i=this.getRenderer(e);if(i)return i(t);else return""},S.prototype.addFilter=function(e,t){if("function"==typeof t)this.filters[e]=t};var K=new S;if(K.Engine=S,"object"==typeof exports&&"object"==typeof module)exports=module.exports=K;else if("function"==typeof define&&define.amd)define("etpl/main",[],K);else e.etpl=K}(this),define("etpl",["etpl/main"],function(e){return e}),define("etpl/tpl",["require","exports","module","."],function(require,exports,module){var e=require(".");return{load:function(t,i,n){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.open("GET",i.toUrl(t),!0),r.onreadystatechange=function(){if(4==r.readyState){if(r.status>=200&&r.status<300){var t=r.responseText,i=module.config();if("undefined"==typeof i.autoCompile||i.autoCompile)e.compile(t);n(t)}r.onreadystatechange=new Function,r=null}},r.send(null)}}}),define("mini-event/lib",["require"],function(){var e={};return e.extend=function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i){for(var n in i)if(i.hasOwnProperty(n))e[n]=i[n]}else;}return e},e}),define("mini-event/Event",["require","./lib"],function(require){function e(){return!0}function t(){return!1}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(e,t){if("object"==typeof e)t=e,e=t.type;if(i(t))r.extend(this,t);else if(t)this.data=t;if(e)this.type=e}var r=require("./lib");n.prototype.isDefaultPrevented=t,n.prototype.preventDefault=function(){this.isDefaultPrevented=e},n.prototype.isPropagationStopped=t,n.prototype.stopPropagation=function(){this.isPropagationStopped=e},n.prototype.isImmediatePropagationStopped=t,n.prototype.stopImmediatePropagation=function(){this.isImmediatePropagationStopped=e,this.stopPropagation()};var a=function(){return this}();n.fromDOMEvent=function(e,t,i){e=e||a.event;var r=new n(t,i);return r.preventDefault=function(){if(e.preventDefault)e.preventDefault();else e.returnValue=!1;n.prototype.preventDefault.call(this)},r.stopPropagation=function(){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=!0;n.prototype.stopPropagation.call(this)},r.stopImmediatePropagation=function(){if(e.stopImmediatePropagation)e.stopImmediatePropagation();n.prototype.stopImmediatePropagation.call(this)},r};var o={type:!0,target:!0,preventDefault:!0,isDefaultPrevented:!0,stopPropagation:!0,isPropagationStopped:!0,stopImmediatePropagation:!0,isImmediatePropagationStopped:!0};return n.fromEvent=function(e,t){var i={type:e.type,preserveData:!1,syncState:!1};t=r.extend(i,t);var a=new n(t.type);if(t.preserveData)for(var s in e)if(e.hasOwnProperty(s)&&!o.hasOwnProperty(s))a[s]=e[s];if(t.extend)r.extend(a,t.extend);if(t.syncState)a.preventDefault=function(){e.preventDefault(),n.prototype.preventDefault.call(this)},a.stopPropagation=function(){e.stopPropagation(),n.prototype.stopPropagation.call(this)},a.stopImmediatePropagation=function(){e.stopImmediatePropagation(),n.prototype.stopImmediatePropagation.call(this)};return a},n.delegate=function(e,t,i,a,o){var s="string"==typeof t,l={object:e,type:s?t:i},h={object:s?i:t,type:s?a:i},u=s?o:a;if(u=r.extend({preserveData:!1},u),"function"==typeof l.object.on&&"function"==typeof h.object.on&&"function"==typeof h.object.fire){var c=function(e){var t=n.fromEvent(e,u);t.type=h.type,t.target=h.object,h.object.fire(h.type,t)};l.object.on(l.type,c)}},n}),define("mini-event/EventQueue",["require","./lib"],function(require){function e(e,t,i){return e&&e.handler===t&&e.thisObject==i}function t(){this.queue=[]}var i=require("./lib");return t.prototype.add=function(t,n){if(t!==!1&&"function"!=typeof t)throw new Error("event handler must be a function or const false");var r={handler:t};i.extend(r,n);for(var a=0;a<this.queue.length;a++){var o=this.queue[a];if(e(o,t,r.thisObject))return}this.queue.push(r)},t.prototype.remove=function(t,i){if(!t)return void this.clear();for(var n=0;n<this.queue.length;n++){var r=this.queue[n];if(e(r,t,i))return void(this.queue[n]=null)}},t.prototype.clear=function(){this.queue.length=0},t.prototype.execute=function(e,t){for(var i=this.queue,n=0;n<i.length;n++){if("function"==typeof e.isImmediatePropagationStopped&&e.isImmediatePropagationStopped())return;var r=i[n];if(r){var a=r.handler;if(a===!1){if("function"==typeof e.preventDefault)e.preventDefault();if("function"==typeof e.stopPropagation)e.stopPropagation()}else a.call(r.thisObject||t,e);if(r.once)this.remove(r.handler,r.thisObject)}else;}},t.prototype.getLength=function(){for(var e=0,t=0;t<this.queue.length;t++)if(this.queue[t])e++;return e},t.prototype.length=t.prototype.getLength,t.prototype.dispose=function(){this.clear(),this.queue=null},t}),define("mini-event/EventTarget",["require","./lib","./Event","./EventQueue"],function(require){function e(){}var t=require("./lib"),i=require("./Event"),n=require("./EventQueue");return e.prototype.on=function(e,i,r,a){if(!this.miniEventPool)this.miniEventPool={};if(!this.miniEventPool.hasOwnProperty(e))this.miniEventPool[e]=new n;var o=this.miniEventPool[e];if(a=t.extend({},a),r)a.thisObject=r;o.add(i,a)},e.prototype.once=function(e,i,n,r){r=t.extend({},r),r.once=!0,this.on(e,i,n,r)},e.prototype.un=function(e,t,i){if(this.miniEventPool&&this.miniEventPool.hasOwnProperty(e)){var n=this.miniEventPool[e];n.remove(t,i)}},e.prototype.fire=function(e,t){if(1===arguments.length&&"object"==typeof e)t=e,e=t.type;if(!e)throw new Error("No event type specified");if("*"===e)throw new Error("Cannot fire global event");var n=t instanceof i?t:new i(e,t);n.target=this;var r=this["on"+e];if("function"==typeof r)r.call(this,n);if(this.miniEventPool&&this.miniEventPool.hasOwnProperty(e)){var a=this.miniEventPool[e];a.execute(n,this)}if(this.miniEventPool&&this.miniEventPool.hasOwnProperty("*")){var o=this.miniEventPool["*"];o.execute(n,this)}return n},e.prototype.destroyEvents=function(){if(this.miniEventPool){for(var e in this.miniEventPool)if(this.miniEventPool.hasOwnProperty(e))this.miniEventPool[e].dispose();this.miniEventPool=null}},e.enable=function(i){i.miniEventPool={},t.extend(i,e.prototype)},e}),define("mini-event/main",["require","./Event"],function(require){var e=require("./Event");return{version:"1.0.2",Event:e,fromDOMEvent:e.fromDOMEvent,fromEvent:e.fromEvent,delegate:e.delegate}}),define("mini-event",["mini-event/main"],function(e){return e}),define("underscore/underscore",["require","exports","module"],function(require,exports,module){(function(){var e=this,t=e._,i={},n=Array.prototype,r=Object.prototype,a=Function.prototype,o=n.push,s=n.slice,l=n.concat,h=r.toString,u=r.hasOwnProperty,c=Array.isArray,d=Object.keys,f=a.bind,p=function(e){if(e instanceof p)return e;if(!(this instanceof p))return new p(e);else return void(this._wrapped=e)};if("undefined"!=typeof exports){if("undefined"!=typeof module&&module.exports)exports=module.exports=p;exports._=p}else e._=p;p.VERSION="1.6.0";var m=function(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,r){return e.call(t,i,n,r)};case 4:return function(i,n,r,a){return e.call(t,i,n,r,a)}}return function(){return e.apply(t,arguments)}},g=function(e,t,i){if(null==e)return p.identity;if(p.isFunction(e))return m(e,t,i);if(p.isObject(e))return p.matches(e);else return p.property(e)};p.each=p.forEach=function(e,t,n){var r,a;if(null==e)return e;if(t=m(t,n),e.length===+e.length)for(r=0,a=e.length;a>r&&t(e[r],r,e)!==i;r++);else{var o=p.keys(e);for(r=0,a=o.length;a>r&&t(e[o[r]],o[r],e)!==i;r++);}return e},p.map=p.collect=function(e,t,i){var n=[];if(null==e)return n;else return t=g(t,i),p.each(e,function(e,i,r){n.push(t(e,i,r))}),n};var y="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,i,n){var r=arguments.length>2;if(null==e)e=[];if(t=m(t,n,4),p.each(e,function(e,n,a){if(!r)i=e,r=!0;else i=t(i,e,n,a)}),!r)throw TypeError(y);return i},p.reduceRight=p.foldr=function(e,t,i,n){var r=arguments.length>2;if(null==e)e=[];var a=e.length;if(t=m(t,n,4),a!==+a){var o=p.keys(e);a=o.length}if(p.each(e,function(n,s,l){if(s=o?o[--a]:--a,!r)i=e[s],r=!0;else i=t(i,e[s],s,l)}),!r)throw TypeError(y);return i},p.find=p.detect=function(e,t,i){var n;return t=g(t,i),p.some(e,function(e,i,r){if(t(e,i,r))return n=e,!0;else return void 0}),n},p.filter=p.select=function(e,t,i){var n=[];if(null==e)return n;else return t=g(t,i),p.each(e,function(e,i,r){if(t(e,i,r))n.push(e)}),n},p.reject=function(e,t,i){return p.filter(e,p.negate(g(t)),i)},p.every=p.all=function(e,t,n){var r=!0;if(null==e)return r;else return t=g(t,n),p.each(e,function(e,n,a){if(r=t(e,n,a),!r)return i;else return void 0}),!!r},p.some=p.any=function(e,t,n){var r=!1;if(null==e)return r;else return t=g(t,n),p.each(e,function(e,n,a){if(r=t(e,n,a))return i;else return void 0}),!!r},p.contains=p.include=function(e,t){if(null==e)return!1;if(e.length===+e.length)return p.indexOf(e,t)>=0;else return p.some(e,function(e){return e===t})},p.invoke=function(e,t){var i=s.call(arguments,2),n=p.isFunction(t);return p.map(e,function(e){return(n?t:e[t]).apply(e,i)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,i){var n,r,a=-1/0,o=-1/0;if(!t&&p.isArray(e)){for(var s=0,l=e.length;l>s;s++)if(n=e[s],n>a)a=n}else t=g(t,i),p.each(e,function(e,i,n){if(r=t(e,i,n),r>o||r===-1/0&&a===-1/0)a=e,o=r});return a},p.min=function(e,t,i){var n,r,a=1/0,o=1/0;if(!t&&p.isArray(e)){for(var s=0,l=e.length;l>s;s++)if(n=e[s],a>n)a=n}else t=g(t,i),p.each(e,function(e,i,n){if(r=t(e,i,n),o>r||1/0===r&&1/0===a)a=e,o=r});return a},p.shuffle=function(e){var t,i=0,n=[];
return p.each(e,function(e){t=p.random(i++),n[i-1]=n[t],n[t]=e}),n},p.sample=function(e,t,i){if(null==t||i){if(e.length!==+e.length)e=p.values(e);return e[p.random(e.length-1)]}return p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,i){return t=g(t,i),p.pluck(p.map(e,function(e,i,n){return{value:e,index:i,criteria:t(e,i,n)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index-t.index}),"value")};var v=function(e){return function(t,i,n){var r={};return i=g(i,n),p.each(t,function(n,a){var o=i(n,a,t);e(r,n,o)}),r}};p.groupBy=v(function(e,t,i){if(p.has(e,i))e[i].push(t);else e[i]=[t]}),p.indexBy=v(function(e,t,i){e[i]=t}),p.countBy=v(function(e,t,i){if(p.has(e,i))e[i]++;else e[i]=1}),p.sortedIndex=function(e,t,i,n){i=g(i,n,1);for(var r=i(t),a=0,o=e.length;o>a;){var s=a+o>>>1;if(i(e[s])<r)a=s+1;else o=s}return a},p.toArray=function(e){if(!e)return[];if(p.isArray(e))return s.call(e);if(e.length===+e.length)return p.map(e,p.identity);else return p.values(e)},p.size=function(e){if(null==e)return 0;else return e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,i){t=g(t,i);var n=[],r=[];return p.each(e,function(e,i,a){(t(e,i,a)?n:r).push(e)}),[n,r]},p.first=p.head=p.take=function(e,t,i){if(null==e)return void 0;if(null==t||i)return e[0];if(0>t)return[];else return s.call(e,0,t)},p.initial=function(e,t,i){return s.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))},p.last=function(e,t,i){if(null==e)return void 0;if(null==t||i)return e[e.length-1];else return s.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,i){return s.call(e,null==t||i?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var b=function(e,t,i,n){if(t&&p.every(e,p.isArray))return l.apply(n,e);for(var r=0,a=e.length;a>r;r++){var s=e[r];if(!p.isArray(s)&&!p.isArguments(s)){if(!i)n.push(s)}else if(t)o.apply(n,s);else b(s,t,i,n)}return n};p.flatten=function(e,t){return b(e,t,!1,[])},p.without=function(e){return p.difference(e,s.call(arguments,1))},p.uniq=p.unique=function(e,t,i,n){if(null==e)return[];if(p.isFunction(t))n=i,i=t,t=!1;if(i)i=g(i,n);for(var r=[],a=[],o=0,s=e.length;s>o;o++){var l=e[o];if(i)l=i(l,o,e);if(t?!o||a!==l:!p.contains(a,l)){if(t)a=l;else a.push(l);r.push(e[o])}}return r},p.union=function(){return p.uniq(b(arguments,!0,!0,[]))},p.intersection=function(e){if(null==e)return[];for(var t=[],i=arguments.length,n=0,r=e.length;r>n;n++){var a=e[n];if(!p.contains(t,a)){for(var o=1;i>o&&p.contains(arguments[o],a);o++);if(o===i)t.push(a)}else;}return t},p.difference=function(e){var t=b(s.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(null==e)return[];for(var t=p.max(arguments,"length").length,i=Array(t),n=0;t>n;n++)i[n]=p.pluck(arguments,n);return i},p.object=function(e,t){if(null==e)return{};for(var i={},n=0,r=e.length;r>n;n++)if(t)i[e[n]]=t[n];else i[e[n][0]]=e[n][1];return i},p.indexOf=function(e,t,i){if(null==e)return-1;var n=0,r=e.length;if(i)if("number"==typeof i)n=0>i?Math.max(0,r+i):i;else return n=p.sortedIndex(e,t),e[n]===t?n:-1;for(;r>n;n++)if(e[n]===t)return n;return-1},p.lastIndexOf=function(e,t,i){if(null==e)return-1;for(var n=null==i?e.length:i;n--;)if(e[n]===t)return n;return-1},p.range=function(e,t,i){if(arguments.length<=1)t=e||0,e=0;i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),r=0,a=Array(n);n>r;)a[r++]=e,e+=i;return a};var _=function(){};p.bind=function(e,t){var i,n;if(f&&e.bind===f)return f.apply(e,s.call(arguments,1));if(!p.isFunction(e))throw TypeError("Bind must be called on a function");return i=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(s.call(arguments)));_.prototype=e.prototype;var r=new _;_.prototype=null;var a=e.apply(r,i.concat(s.call(arguments)));if(Object(a)===a)return a;else return r}},p.partial=function(e){var t=s.call(arguments,1);return function(){for(var i=0,n=t.slice(),r=0,a=n.length;a>r;r++)if(n[r]===p)n[r]=arguments[i++];for(;i<arguments.length;)n.push(arguments[i++]);return e.apply(this,n)}},p.bindAll=function(e){var t,i=1,n=arguments.length;if(1>=n)throw Error("bindAll must be passed function names");for(;n>i;i++)t=arguments[i],e[t]=m(e[t],e,1/0);return e},p.memoize=function(e,t){var i=function(n){var r=i.cache,a=t?t.apply(this,arguments):n;if(!p.has(r,a))r[a]=e.apply(this,arguments);return r[n]};return i.cache={},i},p.delay=function(e,t){var i=s.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(s.call(arguments,1)))},p.throttle=function(e,t,i){var n,r,a,o=null,s=0;if(!i)i={};var l=function(){if(s=i.leading===!1?0:p.now(),o=null,a=e.apply(n,r),!o)n=r=null};return function(){var h=p.now();if(!s&&i.leading===!1)s=h;var u=t-(h-s);if(n=this,r=arguments,0>=u||u>t){if(clearTimeout(o),o=null,s=h,a=e.apply(n,r),!o)n=r=null}else if(!o&&i.trailing!==!1)o=setTimeout(l,u);return a}},p.debounce=function(e,t,i){var n,r,a,o,s,l=function(){var h=p.now()-o;if(t>h&&h>0)n=setTimeout(l,t-h);else if(n=null,!i)if(s=e.apply(a,r),!n)a=r=null};return function(){a=this,r=arguments,o=p.now();var h=i&&!n;if(!n)n=setTimeout(l,t);if(h)s=e.apply(a,r),a=r=null;return s}},p.once=function(e){var t,i=!1;return function(){if(i)return t;else return i=!0,t=e.apply(this,arguments),e=null,t}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},p.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments);else return void 0}},p.keys=function(e){if(!p.isObject(e))return[];if(d)return d(e);var t=[];for(var i in e)if(p.has(e,i))t.push(i);return t},p.values=function(e){for(var t=p.keys(e),i=t.length,n=Array(i),r=0;i>r;r++)n[r]=e[t[r]];return n},p.pairs=function(e){for(var t=p.keys(e),i=t.length,n=Array(i),r=0;i>r;r++)n[r]=[t[r],e[t[r]]];return n},p.invert=function(e){for(var t={},i=p.keys(e),n=0,r=i.length;r>n;n++)t[e[i[n]]]=i[n];return t},p.functions=p.methods=function(e){var t=[];for(var i in e)if(p.isFunction(e[i]))t.push(i);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;for(var t,i,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(i in t)e[i]=t[i]}return e},p.pick=function(e,t,i){var n,r={};if(p.isFunction(t))for(n in e){var a=e[n];if(t.call(i,a,n,e))r[n]=a}else for(var o=l.apply([],s.call(arguments,1)),h=0,u=o.length;u>h;h++)if(n=o[h],n in e)r[n]=e[n];return r},p.omit=function(e,t,i){if(p.isFunction(t))t=p.negate(t);else{var n=p.map(l.apply([],s.call(arguments,1)),String);t=function(e,t){return!p.contains(n,t)}}return p.pick(e,t,i)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,i=arguments.length;i>t;t++){var n=arguments[t];for(var r in n)if(void 0===e[r])e[r]=n[r]}return e},p.clone=function(e){if(!p.isObject(e))return e;else return p.isArray(e)?e.slice():p.extend({},e)},p.tap=function(e,t){return t(e),e};var V=function(e,t,i,n){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;if(e instanceof p)e=e._wrapped;if(t instanceof p)t=t._wrapped;var r=h.call(e);if(r!==h.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(e!=+e)return t!=+t;else return 0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var a=i.length;a--;)if(i[a]===e)return n[a]===t;var o=e.constructor,s=t.constructor;if(o!==s&&"constructor"in e&&"constructor"in t&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(s)&&s instanceof s))return!1;i.push(e),n.push(t);var l,u;if("[object Array]"===r){if(l=e.length,u=l===t.length)for(;l--&&(u=V(e[l],t[l],i,n)););}else{var c,d=p.keys(e);if(l=d.length,u=p.keys(t).length==l)for(;l--&&(c=d[l],u=p.has(t,c)&&V(e[c],t[c],i,n)););}return i.pop(),n.pop(),u};if(p.isEqual=function(e,t){return V(e,t,[],[])},p.isEmpty=function(e){if(null==e)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return 0===e.length;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!(!e||1!==e.nodeType)},p.isArray=c||function(e){return"[object Array]"===h.call(e)},p.isObject=function(e){return e===Object(e)},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return h.call(t)==="[object "+e+"]"}}),!p.isArguments(arguments))p.isArguments=function(e){return p.has(e,"callee")};if("function"!=typeof/./)p.isFunction=function(e){return"function"==typeof e};p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===h.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return void 0===e},p.has=function(e,t){return null!=e&&u.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){return function(t){if(null==t)return p.isEmpty(e);if(t===e)return!0;for(var i in e)if(e[i]!==t[i])return!1;return!0}},p.times=function(e,t,i){var n=Array(Math.max(0,e));t=m(t,i,1);for(var r=0;e>r;r++)n[r]=t(r);return n},p.random=function(e,t){if(null==t)t=e,e=0;return e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var x={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};x.unescape=p.invert(x.escape);var U={escape:RegExp("["+p.keys(x.escape).join("")+"]","g"),unescape:RegExp("("+p.keys(x.unescape).join("|")+")","g")};p.each(["escape","unescape"],function(e){p[e]=function(t){if(null==t)return"";else return(""+t).replace(U[e],function(t){return x[e][t]})}}),p.result=function(e,t){if(null==e)return void 0;var i=e[t];return p.isFunction(i)?e[t]():i};var k=0;p.uniqueId=function(e){var t=++k+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var w=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},T=/\\|'|\r|\n|\u2028|\u2029/g,S=function(e){return"\\"+L[e]};p.template=function(e,t,i){i=p.defaults({},i,p.templateSettings);var n=RegExp([(i.escape||w).source,(i.interpolate||w).source,(i.evaluate||w).source].join("|")+"|$","g"),r=0,a="__p+='";if(e.replace(n,function(t,i,n,o,s){if(a+=e.slice(r,s).replace(T,S),r=s+t.length,i)a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'";else if(n)a+="'+\n((__t=("+n+"))==null?'':__t)+\n'";else if(o)a+="';\n"+o+"\n__p+='";return t}),a+="';\n",!i.variable)a="with(obj||{}){\n"+a+"}\n";a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var o=Function(i.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(t)return o(t,p);var l=function(e){return o.call(this,e,p)},h=i.variable||"obj";return l.source="function("+h+"){\n"+a+"}",l},p.chain=function(e){var t=p(e);return t._chain=!0,t};var C=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var i=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),C.call(this,i.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var i=this._wrapped;if(t.apply(i,arguments),("shift"===e||"splice"===e)&&0===i.length)delete i[0];return C.call(this,i)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return C.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped}}).call(this)}),define("underscore",["underscore/underscore"],function(e){return e}),define("moment/moment",["require","exports","module"],function(require,exports,module){(function(e){function t(e,t,i){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:i;default:throw new Error("Implement me")}}function i(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function n(e,t){function i(){if(ct.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn)console.warn("Deprecation warning: "+e)}var n=!0;return h(function(){if(n)i(),n=!1;return t.apply(this,arguments)},t)}function r(e,t){return function(i){return d(e.call(this,i),t)}}function a(e,t){return function(i){return this.lang().ordinal(e.call(this,i),t)}}function o(){}function s(e){w(e),h(this,e)}function l(e){var t=v(e),i=t.year||0,n=t.quarter||0,r=t.month||0,a=t.week||0,o=t.day||0,s=t.hour||0,l=t.minute||0,h=t.second||0,u=t.millisecond||0;this._milliseconds=+u+1e3*h+6e4*l+36e5*s,this._days=+o+7*a,this._months=+r+3*n+12*i,this._data={},this._bubble()}function h(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];if(t.hasOwnProperty("toString"))e.toString=t.toString;if(t.hasOwnProperty("valueOf"))e.valueOf=t.valueOf;return e}function u(e){var t,i={};for(t in e)if(e.hasOwnProperty(t)&&Ut.hasOwnProperty(t))i[t]=e[t];return i}function c(e){if(0>e)return Math.ceil(e);else return Math.floor(e)}function d(e,t,i){for(var n=""+Math.abs(e),r=e>=0;n.length<t;)n="0"+n;return(r?i?"+":"":"-")+n}function f(e,t,i,n){var r=t._milliseconds,a=t._days,o=t._months;if(n=null==n?!0:n,r)e._d.setTime(+e._d+r*i);if(a)st(e,"Date",ot(e,"Date")+a*i);if(o)at(e,ot(e,"Month")+o*i);if(n)ct.updateOffset(e,a||o)}function p(e){return"[object Array]"===Object.prototype.toString.call(e)}function m(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function g(e,t,i){var n,r=Math.min(e.length,t.length),a=Math.abs(e.length-t.length),o=0;for(n=0;r>n;n++)if(i&&e[n]!==t[n]||!i&&_(e[n])!==_(t[n]))o++;return o+a}function y(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=Qt[e]||Zt[t]||t}return e}function v(e){var t,i,n={};for(i in e)if(e.hasOwnProperty(i))if(t=y(i))n[t]=e[i];return n}function b(t){var i,n;if(0===t.indexOf("week"))i=7,n="day";else if(0===t.indexOf("month"))i=12,n="month";else return;ct[t]=function(r,a){var o,s,l=ct.fn._lang[t],h=[];if("number"==typeof r)a=r,r=e;if(s=function(e){var t=ct().utc().set(n,e);return l.call(ct.fn._lang,t,r||"")},null!=a)return s(a);else{for(o=0;i>o;o++)h.push(s(o));return h}}}function _(e){var t=+e,i=0;if(0!==t&&isFinite(t))if(t>=0)i=Math.floor(t);else i=Math.ceil(t);return i}function V(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function x(e,t,i){return tt(ct([e,11,31+t-i]),t,i).week}function U(e){return k(e)?366:365}function k(e){return e%4===0&&e%100!==0||e%400===0}function w(e){var t;if(e._a&&-2===e._pf.overflow){if(t=e._a[gt]<0||e._a[gt]>11?gt:e._a[yt]<1||e._a[yt]>V(e._a[mt],e._a[gt])?yt:e._a[vt]<0||e._a[vt]>23?vt:e._a[bt]<0||e._a[bt]>59?bt:e._a[_t]<0||e._a[_t]>59?_t:e._a[Vt]<0||e._a[Vt]>999?Vt:-1,e._pf._overflowDayOfYear&&(mt>t||t>yt))t=yt;e._pf.overflow=t}}function L(e){if(null==e._isValid)if(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict)e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length;return e._isValid}function T(e){return e?e.toLowerCase().replace("_","-"):e}function S(e,t){return t._isUTC?ct(e).zone(t._offset||0):ct(e).local()}function C(e,t){if(t.abbr=e,!xt[e])xt[e]=new o;return xt[e].set(t),xt[e]}function I(e){delete xt[e]}function M(e){var t,i,n,r,a=0,o=function(e){if(!xt[e]&&kt)try{require("./lang/"+e)}catch(t){}return xt[e]};if(!e)return ct.fn._lang;if(!p(e)){if(i=o(e))return i;e=[e]}for(;a<e.length;){for(r=T(e[a]).split("-"),t=r.length,n=T(e[a+1]),n=n?n.split("-"):null;t>0;){if(i=o(r.slice(0,t).join("-")))return i;if(n&&n.length>=t&&g(r,n,!0)>=t-1)break;t--}a++}return ct.fn._lang}function E(e){if(e.match(/\[[\s\S]/))return e.replace(/^\[|\]$/g,"");else return e.replace(/\\/g,"")}function D(e){var t,i,n=e.match(St);for(t=0,i=n.length;i>t;t++)if(ri[n[t]])n[t]=ri[n[t]];else n[t]=E(n[t]);return function(r){var a="";for(t=0;i>t;t++)a+=n[t]instanceof Function?n[t].call(r,e):n[t];return a}}function W(e,t){if(!e.isValid())return e.lang().invalidDate();if(t=A(t,e.lang()),!ei[t])ei[t]=D(t);return ei[t](e)}function A(e,t){function i(e){return t.longDateFormat(e)||e}var n=5;for(Ct.lastIndex=0;n>=0&&Ct.test(e);)e=e.replace(Ct,i),Ct.lastIndex=0,n-=1;return e}function X(e,t){var i,n=t._strict;switch(e){case"Q":return Kt;case"DDDD":return Nt;case"YYYY":case"GGGG":case"gggg":return n?Rt:Et;case"Y":case"G":case"g":return Jt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return n?Bt:Dt;case"S":if(n)return Kt;case"SS":if(n)return Ot;case"SSS":if(n)return Nt;case"DDD":return Mt;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return At;case"a":case"A":return M(t._l)._meridiemParse;case"X":return Ft;case"Z":case"ZZ":return Xt;case"T":return Pt;case"SSSS":return Wt;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return n?Ot:It;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return It;case"Do":return zt;default:return i=new RegExp(J(B(e.replace("\\","")),"i"))}}function P(e){e=e||"";var t=e.match(Xt)||[],i=t[t.length-1]||[],n=(i+"").match(jt)||["-",0,0],r=+(60*n[1])+_(n[2]);return"+"===n[0]?-r:r}function F(e,t,i){var n,r=i._a;switch(e){case"Q":if(null!=t)r[gt]=3*(_(t)-1);break;case"M":case"MM":if(null!=t)r[gt]=_(t)-1;break;case"MMM":case"MMMM":if(n=M(i._l).monthsParse(t),null!=n)r[gt]=n;else i._pf.invalidMonth=t;break;case"D":case"DD":if(null!=t)r[yt]=_(t);break;case"Do":if(null!=t)r[yt]=_(parseInt(t,10));break;case"DDD":case"DDDD":if(null!=t)i._dayOfYear=_(t);break;case"YY":r[mt]=ct.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":r[mt]=_(t);break;case"a":case"A":i._isPm=M(i._l).isPM(t);break;case"H":case"HH":case"h":case"hh":r[vt]=_(t);break;case"m":case"mm":r[bt]=_(t);break;case"s":case"ss":r[_t]=_(t);break;case"S":case"SS":case"SSS":case"SSSS":r[Vt]=_(1e3*("0."+t));break;case"X":i._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=P(t);break;case"dd":case"ddd":case"dddd":if(n=M(i._l).weekdaysParse(t),null!=n)i._w=i._w||{},i._w.d=n;else i._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":if(e=e.substr(0,2),t)i._w=i._w||{},i._w[e]=_(t);break;case"gg":case"GG":i._w=i._w||{},i._w[e]=ct.parseTwoDigitYear(t)}}function z(e){var i,n,r,a,o,s,l,h;if(i=e._w,null!=i.GG||null!=i.W||null!=i.E)o=1,s=4,n=t(i.GG,e._a[mt],tt(ct(),1,4).year),r=t(i.W,1),a=t(i.E,1);else if(h=M(e._l),o=h._week.dow,s=h._week.doy,n=t(i.gg,e._a[mt],tt(ct(),o,s).year),r=t(i.w,1),null!=i.d){if(a=i.d,o>a)++r}else if(null!=i.e)a=i.e+o;else a=o;l=it(n,r,a,s,o),e._a[mt]=l.year,e._dayOfYear=l.dayOfYear}function K(e){var i,n,r,a,o=[];if(!e._d){if(r=N(e),e._w&&null==e._a[yt]&&null==e._a[gt])z(e);if(e._dayOfYear){if(a=t(e._a[mt],r[mt]),e._dayOfYear>U(a))e._pf._overflowDayOfYear=!0;n=$(a,0,e._dayOfYear),e._a[gt]=n.getUTCMonth(),e._a[yt]=n.getUTCDate()}for(i=0;3>i&&null==e._a[i];++i)e._a[i]=o[i]=r[i];for(;7>i;i++)e._a[i]=o[i]=null==e._a[i]?2===i?1:0:e._a[i];if(e._d=(e._useUTC?$:j).apply(null,o),null!=e._tzm)e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm)}}function O(e){var t;if(!e._d)t=v(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],K(e)}function N(e){var t=new Date;if(e._useUTC)return[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()];else return[t.getFullYear(),t.getMonth(),t.getDate()]}function R(e){if(e._f===ct.ISO_8601)return void Y(e);e._a=[],e._pf.empty=!0;var t,i,n,r,a,o=M(e._l),s=""+e._i,l=s.length,h=0;for(n=A(e._f,o).match(St)||[],t=0;t<n.length;t++){if(r=n[t],i=(s.match(X(r,e))||[])[0]){if(a=s.substr(0,s.indexOf(i)),a.length>0)e._pf.unusedInput.push(a);s=s.slice(s.indexOf(i)+i.length),h+=i.length}if(ri[r]){if(i)e._pf.empty=!1;else e._pf.unusedTokens.push(r);F(r,i,e)}else if(e._strict&&!i)e._pf.unusedTokens.push(r)}if(e._pf.charsLeftOver=l-h,s.length>0)e._pf.unusedInput.push(s);if(e._isPm&&e._a[vt]<12)e._a[vt]+=12;if(e._isPm===!1&&12===e._a[vt])e._a[vt]=0;K(e),w(e)}function B(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,n,r){return t||i||n||r})}function J(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function H(e){var t,n,r,a,o;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(0/0));for(a=0;a<e._f.length;a++)if(o=0,t=h({},e),t._pf=i(),t._f=e._f[a],R(t),L(t)){if(o+=t._pf.charsLeftOver,o+=10*t._pf.unusedTokens.length,t._pf.score=o,null==r||r>o)r=o,n=t}else;h(e,n||t)}function Y(e){var t,i,n=e._i,r=Ht.exec(n);if(r){for(e._pf.iso=!0,t=0,i=qt.length;i>t;t++)if(qt[t][1].exec(n)){e._f=qt[t][0]+(r[6]||" ");break}for(t=0,i=Gt.length;i>t;t++)if(Gt[t][1].exec(n)){e._f+=Gt[t][0];break}if(n.match(Xt))e._f+="Z";R(e)}else e._isValid=!1}function q(e){if(Y(e),e._isValid===!1)delete e._isValid,ct.createFromInputFallback(e)}function G(t){var i=t._i,n=wt.exec(i);if(i===e)t._d=new Date;else if(n)t._d=new Date(+n[1]);else if("string"==typeof i)q(t);else if(p(i))t._a=i.slice(0),K(t);else if(m(i))t._d=new Date(+i);else if("object"==typeof i)O(t);else if("number"==typeof i)t._d=new Date(i);else ct.createFromInputFallback(t)}function j(e,t,i,n,r,a,o){var s=new Date(e,t,i,n,r,a,o);if(1970>e)s.setFullYear(e);return s}function $(e){var t=new Date(Date.UTC.apply(null,arguments));if(1970>e)t.setUTCFullYear(e);return t}function Q(e,t){if("string"==typeof e)if(!isNaN(e))e=parseInt(e,10);else if(e=t.weekdaysParse(e),"number"!=typeof e)return null;return e}function Z(e,t,i,n,r){return r.relativeTime(t||1,!!i,e,n)}function et(e,t,i){var n=pt(Math.abs(e)/1e3),r=pt(n/60),a=pt(r/60),o=pt(a/24),s=pt(o/365),l=n<ti.s&&["s",n]||1===r&&["m"]||r<ti.m&&["mm",r]||1===a&&["h"]||a<ti.h&&["hh",a]||1===o&&["d"]||o<=ti.dd&&["dd",o]||o<=ti.dm&&["M"]||o<ti.dy&&["MM",pt(o/30)]||1===s&&["y"]||["yy",s];return l[2]=t,l[3]=e>0,l[4]=i,Z.apply({},l)}function tt(e,t,i){var n,r=i-t,a=i-e.day();if(a>r)a-=7;if(r-7>a)a+=7;return n=ct(e).add("d",a),{week:Math.ceil(n.dayOfYear()/7),year:n.year()}}function it(e,t,i,n,r){var a,o,s=$(e,0,1).getUTCDay();return s=0===s?7:s,i=null!=i?i:r,a=r-s+(s>n?7:0)-(r>s?7:0),o=7*(t-1)+(i-r)+a+1,{year:o>0?e:e-1,dayOfYear:o>0?o:U(e-1)+o}}function nt(t){var i=t._i,n=t._f;if(null===i||n===e&&""===i)return ct.invalid({nullInput:!0});if("string"==typeof i)t._i=i=M().preparse(i);if(ct.isMoment(i))t=u(i),t._d=new Date(+i._d);else if(n)if(p(n))H(t);else R(t);else G(t);return new s(t)}function rt(e,t){var i,n;if(1===t.length&&p(t[0]))t=t[0];if(!t.length)return ct();for(i=t[0],n=1;n<t.length;++n)if(t[n][e](i))i=t[n];return i}function at(e,t){var i;if("string"==typeof t)if(t=e.lang().monthsParse(t),"number"!=typeof t)return e;return i=Math.min(e.date(),V(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,i),e}function ot(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function st(e,t,i){if("Month"===t)return at(e,i);else return e._d["set"+(e._isUTC?"UTC":"")+t](i)}function lt(e,t){return function(i){if(null!=i)return st(this,e,i),ct.updateOffset(this,t),this;else return ot(this,e)}}function ht(e){ct.duration.fn[e]=function(){return this._data[e]}}function ut(e,t){ct.duration.fn["as"+e]=function(){return+this/t}}for(var ct,dt,ft="2.7.0",pt=("undefined"!=typeof global?global:this,Math.round),mt=0,gt=1,yt=2,vt=3,bt=4,_t=5,Vt=6,xt={},Ut={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_tzm:null,_isUTC:null,_offset:null,_pf:null,_lang:null},kt="undefined"!=typeof module&&module.exports,wt=/^\/?Date\((\-?\d+)/i,Lt=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Tt=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,St=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Ct=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,It=/\d\d?/,Mt=/\d{1,3}/,Et=/\d{1,4}/,Dt=/[+\-]?\d{1,6}/,Wt=/\d+/,At=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Xt=/Z|[\+\-]\d\d:?\d\d/gi,Pt=/T/i,Ft=/[\+\-]?\d+(\.\d{1,3})?/,zt=/\d{1,2}/,Kt=/\d/,Ot=/\d\d/,Nt=/\d{3}/,Rt=/\d{4}/,Bt=/[+-]?\d{6}/,Jt=/[+-]?\d+/,Ht=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Yt="YYYY-MM-DDTHH:mm:ssZ",qt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Gt=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],jt=/([\+\-]|\d\d)/gi,$t=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),Qt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Zt={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ei={},ti={s:45,m:45,h:22,dd:25,dm:45,dy:345},ii="DDD w W M D d".split(" "),ni="M D H h m s w W".split(" "),ri={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return d(this.year()%100,2)},YYYY:function(){return d(this.year(),4)},YYYYY:function(){return d(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+d(Math.abs(e),6)},gg:function(){return d(this.weekYear()%100,2)},gggg:function(){return d(this.weekYear(),4)},ggggg:function(){return d(this.weekYear(),5)},GG:function(){return d(this.isoWeekYear()%100,2)},GGGG:function(){return d(this.isoWeekYear(),4)},GGGGG:function(){return d(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return _(this.milliseconds()/100)},SS:function(){return d(_(this.milliseconds()/10),2)},SSS:function(){return d(this.milliseconds(),3)},SSSS:function(){return d(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";if(0>e)e=-e,t="-";return t+d(_(e/60),2)+":"+d(_(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";if(0>e)e=-e,t="-";return t+d(_(e/60),2)+d(_(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},ai=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ii.length;)dt=ii.pop(),ri[dt+"o"]=a(ri[dt],dt);for(;ni.length;)dt=ni.pop(),ri[dt+dt]=r(ri[dt],2);for(ri.DDDD=r(ri.DDD,3),h(o.prototype,{set:function(e){var t,i;for(i in e)if(t=e[i],"function"==typeof t)this[i]=t;else this["_"+i]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,i,n;if(!this._monthsParse)this._monthsParse=[];for(t=0;12>t;t++){if(!this._monthsParse[t])i=ct.utc([2e3,t]),n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[t]=new RegExp(n.replace(".",""),"i");if(this._monthsParse[t].test(e))return t}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,i,n;if(!this._weekdaysParse)this._weekdaysParse=[];for(t=0;7>t;t++){if(!this._weekdaysParse[t])i=ct([2e3,1]).day(t),n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[t]=new RegExp(n.replace(".",""),"i");if(this._weekdaysParse[t].test(e))return t}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];if(!t&&this._longDateFormat[e.toUpperCase()])t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t;return t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){if(e>11)return i?"pm":"PM";else return i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var i=this._calendar[e];return"function"==typeof i?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,n){var r=this._relativeTime[i];return"function"==typeof r?r(e,t,i,n):r.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return tt(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),ct=function(t,n,r,a){var o;if("boolean"==typeof r)a=r,r=e;return o={},o._isAMomentObject=!0,o._i=t,o._f=n,o._l=r,o._strict=a,o._isUTC=!1,o._pf=i(),nt(o)},ct.suppressDeprecationWarnings=!1,ct.createFromInputFallback=n("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i)}),ct.min=function(){var e=[].slice.call(arguments,0);return rt("isBefore",e)},ct.max=function(){var e=[].slice.call(arguments,0);return rt("isAfter",e)},ct.utc=function(t,n,r,a){var o;if("boolean"==typeof r)a=r,r=e;return o={},o._isAMomentObject=!0,o._useUTC=!0,o._isUTC=!0,o._l=r,o._i=t,o._f=n,o._strict=a,o._pf=i(),nt(o).utc()},ct.unix=function(e){return ct(1e3*e)},ct.duration=function(e,t){var i,n,r,a=e,o=null;if(ct.isDuration(e))a={ms:e._milliseconds,d:e._days,M:e._months};else if("number"==typeof e)if(a={},t)a[t]=e;else a.milliseconds=e;else if(o=Lt.exec(e))i="-"===o[1]?-1:1,a={y:0,d:_(o[yt])*i,h:_(o[vt])*i,m:_(o[bt])*i,s:_(o[_t])*i,ms:_(o[Vt])*i};else if(o=Tt.exec(e))i="-"===o[1]?-1:1,r=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*i},a={y:r(o[2]),M:r(o[3]),d:r(o[4]),h:r(o[5]),m:r(o[6]),s:r(o[7]),w:r(o[8])};if(n=new l(a),ct.isDuration(e)&&e.hasOwnProperty("_lang"))n._lang=e._lang;return n},ct.version=ft,ct.defaultFormat=Yt,ct.ISO_8601=function(){},ct.momentProperties=Ut,ct.updateOffset=function(){},ct.relativeTimeThreshold=function(t,i){if(ti[t]===e)return!1;
else return ti[t]=i,!0},ct.lang=function(e,t){var i;if(!e)return ct.fn._lang._abbr;if(t)C(T(e),t);else if(null===t)I(e),e="en";else if(!xt[e])M(e);return i=ct.duration.fn._lang=ct.fn._lang=M(e),i._abbr},ct.langData=function(e){if(e&&e._lang&&e._lang._abbr)e=e._lang._abbr;return M(e)},ct.isMoment=function(e){return e instanceof s||null!=e&&e.hasOwnProperty("_isAMomentObject")},ct.isDuration=function(e){return e instanceof l},dt=ai.length-1;dt>=0;--dt)b(ai[dt]);ct.normalizeUnits=function(e){return y(e)},ct.invalid=function(e){var t=ct.utc(0/0);if(null!=e)h(t._pf,e);else t._pf.userInvalidated=!0;return t},ct.parseZone=function(){return ct.apply(null,arguments).parseZone()},ct.parseTwoDigitYear=function(e){return _(e)+(_(e)>68?1900:2e3)},h(ct.fn=s.prototype,{clone:function(){return ct(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=ct(this).utc();if(0<e.year()&&e.year()<=9999)return W(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");else return W(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return L(this)},isDSTShifted:function(){if(this._a)return this.isValid()&&g(this._a,(this._isUTC?ct.utc(this._a):ct(this._a)).toArray())>0;else return!1},parsingFlags:function(){return h({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=W(this,e||ct.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var i;if("string"==typeof e&&"string"==typeof t)i=ct.duration(isNaN(+t)?+e:+t,isNaN(+t)?t:e);else if("string"==typeof e)i=ct.duration(+t,e);else i=ct.duration(e,t);return f(this,i,1),this},subtract:function(e,t){var i;if("string"==typeof e&&"string"==typeof t)i=ct.duration(isNaN(+t)?+e:+t,isNaN(+t)?t:e);else if("string"==typeof e)i=ct.duration(+t,e);else i=ct.duration(e,t);return f(this,i,-1),this},diff:function(e,t,i){var n,r,a=S(e,this),o=6e4*(this.zone()-a.zone());if(t=y(t),"year"===t||"month"===t){if(n=432e5*(this.daysInMonth()+a.daysInMonth()),r=12*(this.year()-a.year())+(this.month()-a.month()),r+=(this-ct(this).startOf("month")-(a-ct(a).startOf("month")))/n,r-=6e4*(this.zone()-ct(this).startOf("month").zone()-(a.zone()-ct(a).startOf("month").zone()))/n,"year"===t)r/=12}else n=this-a,r="second"===t?n/1e3:"minute"===t?n/6e4:"hour"===t?n/36e5:"day"===t?(n-o)/864e5:"week"===t?(n-o)/6048e5:n;return i?r:c(r)},from:function(e,t){return ct.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(ct(),e)},calendar:function(e){var t=e||ct(),i=S(t,this).startOf("day"),n=this.diff(i,"days",!0),r=-6>n?"sameElse":-1>n?"lastWeek":0>n?"lastDay":1>n?"sameDay":2>n?"nextDay":7>n?"nextWeek":"sameElse";return this.format(this.lang().calendar(r,this))},isLeapYear:function(){return k(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();if(null!=e)return e=Q(e,this.lang()),this.add({d:e-t});else return t},month:lt("Month",!0),startOf:function(e){switch(e=y(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if("week"===e)this.weekday(0);else if("isoWeek"===e)this.isoWeekday(1);if("quarter"===e)this.month(3*Math.floor(this.month()/3));return this},endOf:function(e){return e=y(e),this.startOf(e).add("isoWeek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)>+ct(e).startOf(t)},isBefore:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)<+ct(e).startOf(t)},isSame:function(e,t){return t=t||"ms",+this.clone().startOf(t)===+S(e,this).startOf(t)},min:n("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=ct.apply(null,arguments),this>e?this:e}),max:n("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=ct.apply(null,arguments),e>this?this:e}),zone:function(e,t){var i=this._offset||0;if(null!=e){if("string"==typeof e)e=P(e);if(Math.abs(e)<16)e=60*e;if(this._offset=e,this._isUTC=!0,i!==e)if(!t||this._changeInProgress)f(this,ct.duration(i-e,"m"),1,!1);else if(!this._changeInProgress)this._changeInProgress=!0,ct.updateOffset(this,!0),this._changeInProgress=null}else return this._isUTC?i:this._d.getTimezoneOffset();return this},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){if(this._tzm)this.zone(this._tzm);else if("string"==typeof this._i)this.zone(this._i);return this},hasAlignedHourOffset:function(e){if(!e)e=0;else e=ct(e).zone();return(this.zone()-e)%60===0},daysInMonth:function(){return V(this.year(),this.month())},dayOfYear:function(e){var t=pt((ct(this).startOf("day")-ct(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=tt(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=tt(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=tt(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return x(this.year(),1,4)},weeksInYear:function(){var e=this._lang._week;return x(this.year(),e.dow,e.doy)},get:function(e){return e=y(e),this[e]()},set:function(e,t){if(e=y(e),"function"==typeof this[e])this[e](t);return this},lang:function(t){if(t===e)return this._lang;else return this._lang=M(t),this}}),ct.fn.millisecond=ct.fn.milliseconds=lt("Milliseconds",!1),ct.fn.second=ct.fn.seconds=lt("Seconds",!1),ct.fn.minute=ct.fn.minutes=lt("Minutes",!1),ct.fn.hour=ct.fn.hours=lt("Hours",!0),ct.fn.date=lt("Date",!0),ct.fn.dates=n("dates accessor is deprecated. Use date instead.",lt("Date",!0)),ct.fn.year=lt("FullYear",!0),ct.fn.years=n("years accessor is deprecated. Use year instead.",lt("FullYear",!0)),ct.fn.days=ct.fn.day,ct.fn.months=ct.fn.month,ct.fn.weeks=ct.fn.week,ct.fn.isoWeeks=ct.fn.isoWeek,ct.fn.quarters=ct.fn.quarter,ct.fn.toJSON=ct.fn.toISOString,h(ct.duration.fn=l.prototype,{_bubble:function(){var e,t,i,n,r=this._milliseconds,a=this._days,o=this._months,s=this._data;s.milliseconds=r%1e3,e=c(r/1e3),s.seconds=e%60,t=c(e/60),s.minutes=t%60,i=c(t/60),s.hours=i%24,a+=c(i/24),s.days=a%30,o+=c(a/30),s.months=o%12,n=c(o/12),s.years=n},weeks:function(){return c(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*_(this._months/12)},humanize:function(e){var t=+this,i=et(t,!e,this.lang());if(e)i=this.lang().pastFuture(t,i);return this.lang().postformat(i)},add:function(e,t){var i=ct.duration(e,t);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(e,t){var i=ct.duration(e,t);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(e){return e=y(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=y(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:ct.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),i=Math.abs(this.days()),n=Math.abs(this.hours()),r=Math.abs(this.minutes()),a=Math.abs(this.seconds()+this.milliseconds()/1e3);if(!this.asSeconds())return"P0D";else return(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(i?i+"D":"")+(n||r||a?"T":"")+(n?n+"H":"")+(r?r+"M":"")+(a?a+"S":"")}});for(dt in $t)if($t.hasOwnProperty(dt))ut(dt,$t[dt]),ht(dt.toLowerCase());if(ut("Weeks",6048e5),ct.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},ct.lang("en",{ordinal:function(e){var t=e%10,i=1===_(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+i}}),kt)module.exports=ct}).call(this)}),define("moment",["moment/moment"],function(e){return e}),define("er/util",[],function(){var e=+new Date,t={};t.guid=function(){return"er"+e++},t.mix=function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i){for(var n in i)if(i.hasOwnProperty(n))e[n]=i[n]}else;}return e};var i=Function.prototype.bind;t.bind=i?function(e){return i.apply(e,[].slice.call(arguments,1))}:function(e,t){var i=[].slice.call(arguments,2);return function(){var n=i.concat([].slice.call(arguments));return e.apply(t,n)}},t.noop=function(){};var n=!{toString:1}.propertyIsEnumerable("toString");t.inherits=function(e,t){var i=function(){};i.prototype=t.prototype;var r=new i,a=e.prototype;e.prototype=r;for(var o in a)r[o]=a[o];if(n){if(a.hasOwnProperty("toString"))r.toString=a.toString;if(a.hasOwnProperty("valueOf"))r.valueOf=a.valueOf}return e.prototype.constructor=e,e},t.parseJSON=function(e){if(!e)return void 0;if(window.JSON&&"function"==typeof JSON.parse)return JSON.parse(e);else return new Function("return ("+e+");")()};var r=/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g;return t.trim=function(e){return e.replace(r,"")},t.encodeHTML=function(e){return e+="",e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},t.getElement=function(e){if("string"==typeof e)e=document.getElementById(e);return e},t}),define("er/assert",[],function(){if(window.DEBUG){var e=function(e,t){if(!e)throw new Error(t)};return e.has=function(t,i){e(null!=t,i)},e.equals=function(t,i,n){e(t===i,n)},e.hasProperty=function(t,i,n){e(null!=t[i],n)},e.lessThan=function(t,i,n){e(i>t,n)},e.greaterThan=function(t,i,n){e(t>i,n)},e.lessThanOrEquals=function(t,i,n){e(i>=t,n)},e.greaterThanOrEquals=function(t,i,n){e(t>=i,n)},e}else{var e=function(){};return e.has=e,e.equals=e,e.hasProperty=e,e.lessThan=e,e.greaterThan=e,e.lessThanOrEquals=e,e.greaterThanOrEquals=e,e}}),define("er/Deferred",["require","./util","./assert","eoo","mini-event/EventTarget"],function(require){function e(e){function t(){for(var t=0;t<i.length;t++){var n=i[t];try{n.apply(e.promise,e._args)}catch(r){}}}if("pending"!==e.state){var i="resolved"===e.state?e._doneCallbacks.slice():e._failCallbacks.slice();if(e.syncModeEnabled)t();else r(t);e._doneCallbacks=[],e._failCallbacks=[]}}function t(e,t,i,n){return function(){if("function"==typeof i){var r=t.resolver;try{var o=i.apply(e.promise,arguments);if(a.isPromise(o))o.then(r.resolve,r.reject);else r.resolve(o)}catch(s){a.fire("exception",{deferred:e,args:[s],reason:s}),r.reject(s)}}else t[n].apply(t,e._args)}}var i=require("./util"),n=require("./assert"),r="function"==typeof window.setImmediate?function(e){window.setImmediate(e)}:function(e){window.setTimeout(e,0)},exports={};exports.constructor=function(){this.state="pending",this._args=null,this._doneCallbacks=[],this._failCallbacks=[],this.promise={done:i.bind(this.done,this),fail:i.bind(this.fail,this),ensure:i.bind(this.ensure,this),then:i.bind(this.then,this)},this.promise.promise=this.promise,this.resolver={resolve:i.bind(this.resolve,this),reject:i.bind(this.reject,this)}},exports.syncModeEnabled=!1,exports.resolve=function(){if("pending"===this.state)this.state="resolved",this._args=[].slice.call(arguments),a.fire("resolve",{deferred:this,args:this._args,reason:this._args[0]}),e(this)},exports.reject=function(){if("pending"===this.state)this.state="rejected",this._args=[].slice.call(arguments),a.fire("reject",{deferred:this,args:this._args,reason:this._args[0]}),e(this)},exports.done=function(e){return this.then(e)},exports.fail=function(e){return this.then(null,e)},exports.ensure=function(e){return this.then(e,e)},exports.then=function(i,n){var r=new a;return r.syncModeEnabled=this.syncModeEnabled,this._doneCallbacks.push(t(this,r,i,"resolve")),this._failCallbacks.push(t(this,r,n,"reject")),e(this),r.promise};var a=require("eoo").create(exports);return require("mini-event/EventTarget").enable(a),a.isPromise=function(e){return e&&"function"==typeof e.then},a.all=function(){function e(e){o--,n.greaterThanOrEquals(o,0,"workingCount should be positive");var t=[].slice.call(arguments,1);if(t.length<=1)t=t[0];if(l[e]=t,0===o)h[s].apply(h,l)}function t(){s="reject",e.apply(this,arguments)}var r=[].concat.apply([],arguments),o=r.length;if(!o)return a.resolved();for(var s="resolve",l=[],h=new a,u=0;u<r.length;u++){var c=r[u];c.then(i.bind(e,c,u),i.bind(t,c,u))}return h.promise},a.resolved=function(){var e=new a;return e.resolve.apply(e,arguments),e.promise},a.rejected=function(){var e=new a;return e.reject.apply(e,arguments),e.promise},a.when=function(e){if(a.isPromise(e))return e;var t=new a;return t.syncModeEnabled=!0,t.resolve(e),t.promise},a.require=function(e){var t=new a;return window.require(e,t.resolver.resolve),t.promise.abort=t.resolver.reject,t.promise},a}),define("er/events",["require","eoo","mini-event/EventTarget"],function(require){var exports={};exports.notifyError=function(e){if("string"==typeof e)e=new Error(e);return this.fire("error",{error:e}),e};var e=require("eoo").create(require("mini-event/EventTarget"),exports),t=new e;return t.EventBus=e,t}),define("er/config",[],{mainElement:"main",indexURL:"/",systemName:"",noAuthorityLocation:"/401",notFoundLocation:"/404"}),define("er/locator",["require","./config","./events","mini-event/EventTarget"],function(require){function e(){var e=location.href.indexOf("#"),t=-1===e?"":location.href.slice(e);return t}function t(){var t=e();a.redirect(t)}function i(e){if(window.addEventListener)window.addEventListener("hashchange",t,!1);else if("onhashchange"in window&&document.documentMode>7)window.attachEvent("onhashchange",t);else s=setInterval(t,100);if(e)l=setTimeout(t,0)}function n(){if(s)clearInterval(s),s=null;if(l)clearTimeout(l),l=null;if(window.removeEventListener)window.removeEventListener("hashchange",t,!1);else if("onhashchange"in window&&document.documentMode>7)window.detachEvent("onhashchange",t)}function r(t,r){var a=o!==t;if(a&&e()!==t)if(r.silent)n(),location.hash=t,i(!1);else location.hash=t;return o=t,a}var a={},o="",s=0,l=1;return a.start=function(){i(!0)},a.stop=n,a.resolveURL=function(e){if(e+="",0===e.indexOf("#"))e=e.slice(1);if(!e||"/"===e)e=require("./config").indexURL;return e},a.redirect=function(e,t){t=t||{},e=a.resolveURL(e);var i=o,n=r(e,t),s=n||t.force;if(s){if(!t.silent)a.fire("redirect",{url:e,referrer:i});require("./events").fire("redirect",{url:e,referrer:i})}return s},a.reload=function(){if(o)a.redirect(o,{force:!0})},require("mini-event/EventTarget").enable(a),a}),define("er/Action",["require","./util","./Deferred","./events","./locator","eoo","mini-event/EventTarget"],function(require){function e(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(!i.success)e.push(i)}return this.handleError(e)}var t=require("./util"),exports={};exports.constructor=function(){this.disposed=!1,this.initialize()},exports.initialize=t.noop,exports.context=null,exports.modelType=null,exports.viewType=null,exports.enter=function(i){this.context=i||{},this.fire("enter");var n=t.mix({},i&&i.args);if(this.model)this.model.fill(n);else this.model=this.createModel(n);if(this.fire("beforemodelload"),this.model&&"function"==typeof this.model.load){var r=this.model.load();return r.then(t.bind(this.forwardToView,this),t.bind(e,this))}else return this.forwardToView(),require("./Deferred").resolved(this)},exports.handleError=function(e){throw e},exports.createModel=function(e){if(this.modelType){var t=new this.modelType(e);return t}else return{}},exports.forwardToView=function(){if(this.disposed)return this;if(this.fire("modelloaded"),!this.view)this.view=this.createView();if(this.view){if(this.view.model=this.model,!this.view.container)this.view.container=this.context.container;this.fire("beforerender"),this.view.render(),this.fire("rendered"),this.initBehavior(),this.fire("entercomplete")}else{var e=require("./events");e.notifyError("No view attached to this action")}return this},exports.createView=function(){return this.viewType?new this.viewType:null},exports.initBehavior=t.noop,exports.filterRedirect=t.noop,exports.leave=function(){if(this.disposed)return this;if(this.disposed=!0,this.fire("beforeleave"),this.model){if("function"==typeof this.model.dispose)this.model.dispose();this.model=null}if(this.view){if("function"==typeof this.view.dispose)this.view.dispose();this.view=null}this.fire("leave"),this.destroyEvents()},exports.redirect=function(e,t){var i=require("./locator");i.redirect(e,t)},exports.reload=function(){var e=require("./locator");e.reload()},exports.back=function(e){var t=this.context&&this.context.referrer,i=t||e;if(i)this.redirect(i)};var i=require("eoo").create(require("mini-event/EventTarget"),exports);return i}),define("er/ajax",["require","./assert","./util","./Deferred","eoo","mini-event/EventTarget"],function(require){function e(e,t){for(var i=e?encodeURIComponent(e):"",n=[],r=0;r<t.length;r++){var a=t[r];n[r]=this.serializeData("",a)}return i?i+"="+n.join(","):n.join(",")}function t(e,t){if(1===arguments.length)t=e,e="";if(null==t)t="";var i=this.serializeData.getKey,n=e?encodeURIComponent(e):"",r=Object.prototype.toString.call(t);switch(r){case"[object Array]":return this.serializeArray(e,t);case"[object Object]":var a=[];for(var o in t){var s=i(o,e),l=this.serializeData(s,t[o]);a.push(l)}return a.join("&");default:return n?n+"="+encodeURIComponent(t):encodeURIComponent(t)}}var i="_";t.getKey=function(e,t){return t?t+"."+e:e};var exports={};exports.constructor=function(){this.hooks={serializeData:t,serializeArray:e},this.config={cache:!1,timeout:0,charset:""}},exports.request=function(e){if("function"==typeof this.hooks.beforeExecute)this.hooks.beforeExecute(e);var t=require("./assert");t.hasProperty(e,"url","url property is required");var n={method:"POST",data:{},cache:this.config.cache,timeout:this.config.timeout,charset:this.config.charset,async:!0},r=require("./util");e=r.mix(n,e);var a=require("./Deferred"),o=new a;if("function"==typeof this.hooks.beforeCreate){var s=this.hooks.beforeCreate(e,o);if(s===!0){var l=o.promise;return l.abort=function(){},l.setRequestHeader=function(){},l}}var h=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");r.mix(h,e.xhrFields);var l=o.promise,u={abort:function(){h.onreadystatechange=null;try{h.abort()}catch(e){}if(!l.status)l.status=0;l.readyState=h.readyState,l.responseText="",l.responseXML="",o.reject(l)},setRequestHeader:function(e,t){h.setRequestHeader(e,t)},getAllResponseHeaders:function(){return h.getAllResponseHeaders()},getResponseHeader:function(e){return h.getResponseHeader(e)},getRequestOption:function(t){return e[t]}};r.mix(l,u);var c={xhr:l,options:e};l.then(r.bind(this.fire,this,"done",c),r.bind(this.fire,this,"fail",c));var d=function(){if(4===h.readyState){var t=l.status||h.status;if(1223===t)t=204;if(l.status=l.status||t,l.readyState=h.readyState,l.responseText=h.responseText,l.responseXML=h.responseXML,"function"==typeof this.hooks.afterReceive)this.hooks.afterReceive(l,e);if(200>t||t>=300&&304!==t)return void o.reject(l);var i=h.responseText;if("json"===e.dataType)try{i=r.parseJSON(i)}catch(n){return l.error=n,void o.reject(l)}if("function"==typeof this.hooks.afterParse)try{i=this.hooks.afterParse(i,l,e)}catch(n){return l.error=n,void o.reject(l)}o.resolve(i)}};h.onreadystatechange=r.bind(d,this);var f=e.method.toUpperCase(),p={};if("GET"===f)r.mix(p,e.data);if(e.cache===!1)p[i]=+new Date;var m=this.hooks.serializeData("",p,"application/x-www-form-urlencoded"),g=e.url;if(m){var y=g.indexOf("?")>=0?"&":"?";g+=y+m}if(h.open(f,g,e.async),"function"==typeof this.hooks.beforeSend)this.hooks.beforeSend(l,e);if("GET"===f)h.send();else{var v=e.contentType||"application/x-www-form-urlencoded",m=this.hooks.serializeData("",e.data,v,l);if(e.charset)v+=";charset="+e.charset;h.setRequestHeader("Content-Type",v),h.send(m)}if(e.timeout>0){var b=function(){this.fire("timeout",{xhr:l,options:e}),l.status=408,l.abort()},_=setTimeout(r.bind(b,this),e.timeout);l.ensure(function(){clearTimeout(_)})}return l},exports.get=function(e,t,i){var n={method:"GET",url:e,data:t,cache:i||this.config.cache};return this.request(n)},exports.getJSON=function(e,t,i){var n={method:"GET",url:e,data:t,dataType:"json",cache:i||this.config.cache};return this.request(n)},exports.post=function(e,t,i){var n={method:"POST",url:e,data:t,dataType:i||"json"};return this.request(n)},exports.log=function(e,t){var i=new Image,n=window.ER_LOG_POOL||(window.ER_LOG_POOL={}),r=+new Date;n[r]=i,i.onload=i.onerror=i.onabort=function(){i.onload=i.onerror=i.onabort=null,n[r]=null,i=null};var a=this.hooks.serializeData("",t,"application/x-www-form-urlencoded");if(a){var o=e.indexOf("?")>=0?":":"?";e+=o+a}i.src=e};var n=require("eoo").create(require("mini-event/EventTarget"),exports),r=new n;return r.Ajax=n,r}),define("er/URL",["require","./util","eoo"],function(require){var e=require("./util"),exports={};exports.constructor=function(i,n,r){i=i||"/",n=n||"",r=r||"~",this.toString=function(){return n?i+r+n:i},this.getPath=function(){return i},this.getSearch=function(){return n};var a=null;this.getQuery=function(i){if(!a)a=t.parseQuery(n);return i?a[i]:e.mix({},a)}},exports.compare=function(e){if("string"==typeof e)e=t.parse(e);var i={},n=this.getPath(),r=e.getPath();if(n===r)i.path=!1;else i.path={key:"path",self:n,other:r};var a=this.getQuery(),o=e.getQuery(),s={},l=[],h=!1;for(var u in a)if(a.hasOwnProperty(u)){var c=a[u],d=o[u];if(c!==d){h=!0;var f={key:u,self:c,other:d};l.push(f),s[u]=f}}for(var u in o)if(o.hasOwnProperty(u)&&!a.hasOwnProperty(u)){h=!0;var f={key:u,self:void 0,other:o[u]};l.push(f),s[u]=f}return i.queryDifference=l,i.query=h?s:!1,i};var t=require("eoo").create(exports);return t.parse=function(i,n){var r={querySeparator:"~"};n=e.mix(r,n);var a=i.indexOf(n.querySeparator);if(a>=0)return new t(i.slice(0,a),i.slice(a+1),n.querySeparator);else return new t(i,"",n.querySeparator)},t.withQuery=function(i,n,r){i+="";var a={querySeparator:"~"};r=e.mix(a,r);var o=i.indexOf(r.querySeparator)<0?r.querySeparator:"&",s=t.serialize(n),l=i+o+s;return t.parse(l,r)},t.parseQuery=function(e){for(var t=e.split("&"),i={},n=0;n<t.length;n++){var r=t[n];if(r){var a=r.indexOf("="),o=0>a?decodeURIComponent(r):decodeURIComponent(r.slice(0,a)),s=0>a?!0:decodeURIComponent(r.slice(a+1));if(i.hasOwnProperty(o)){if(s!==!0)i[o]=[].concat(i[o],s)}else i[o]=s}else;}return i},t.serialize=function(e){if(!e)return"";var t="";for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(n)}return t.slice(1)},t.empty=new t,t}),define("er/router",["require","./URL","eoo","mini-event/EventTarget","./locator","./events"],function(require){function e(e){for(var t=require("./URL").parse(e.url),i=t.getPath(),n=0;n<this.routes.length;n++){var r=this.routes[n];if(r.rule instanceof RegExp&&r.rule.test(i)||r.rule===i)return void r.handler.call(this,t)}if(this.backup)this.backup(t);this.getEventBus().fire("route",{url:t,router:this})}var exports={};exports.constructor=function(){this.routes=[],this.backup=null},exports.add=function(e,t){this.routes.push({rule:e,handler:t})},exports.setBackup=function(e){this.backup=e},exports.getLocator=function(){return this.locator},exports.setLocator=function(e){this.locator=e},exports.getEventBus=function(){return this.eventBus},exports.setEventBus=function(e){this.eventBus=e},exports.start=function(){this.getLocator().on("redirect",e,this)};var t=require("eoo").create(require("mini-event/EventTarget"),exports),i=new t;return i.setLocator(require("./locator")),i.setEventBus(require("./events")),i.Router=t,i}),define("er/permission",[],function(){var e={},t={add:function(t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if("object"==typeof n)this.add(n);else e[i]=n}},isAllow:function(t){return!!e[t]}};return t}),define("er/controller",["require","./Deferred","./URL","./config","./util","./assert","mini-event/EventTarget","eoo","./locator","./router","./events","./permission"],function(require){function e(e,t,i){var n=e.childActionMapping[t.id];if(n){if(e.childActionMapping[t.id]=void 0,n.hijack)if(t.removeEventListener)t.removeEventListener("click",n.hijack,!1);else t.detachEvent("onclick",n.hijack);if(n.action){if(!i)i={url:null,referrer:n.url,container:t.id,isChildAction:!0};if(e.getEventBus().fire("leaveaction",{controller:e,action:n.action,to:i}),"function"==typeof n.action.leave)n.action.leave()}}}function t(t,i,n,r,a){if(e(t,i,a),i.addEventListener)i.addEventListener("click",r,!1);else i.attachEvent("onclick",r);var o={url:a.url,container:i.id,action:n,hijack:r};t.childActionMapping[i.id]=o;var s=require("mini-event/EventTarget");if(n instanceof s)n.on("leave",function(){e(t,i)})}var i=require("./Deferred"),n=require("./URL"),r=require("./config"),a=require("./util"),o=require("./assert"),exports={};exports.constructor=function(){this.actionPathMapping={},this.childActionMapping={},this.currentURL=null,this.currentAction=null,this.globalActionLoader=null,this.childActionLoaders={}},exports.registerAction=function(e){if(!e.hasOwnProperty("length"))e=[e];for(var t=0;t<e.length;t++){var i=e[t];o.hasProperty(i,"path",'action config should contains a "path" property'),this.actionPathMapping[i.path]=i}},exports.getDefaultTitle=function(){return this.defaultTitle},exports.setDefaultTitle=function(e){this.defaultTitle=e},exports.getRouter=function(){return this.router},exports.setRouter=function(e){this.router=e},exports.getLocator=function(){return this.locator},exports.setLocator=function(e){this.locator=e},exports.getEventBus=function(){return this.eventBus},exports.setEventBus=function(e){this.eventBus=e},exports.getPermissionProvider=function(){return this.permissionProvider},exports.setPermissionProvider=function(e){this.permissionProvider=e},exports.getMainContainer=function(){return this.mainContainer||r.mainElement},exports.setMainContainer=function(e){this.mainContainer=e},exports.getNoAuthorityLocation=function(){return this.noAuthorityLocation||r.noAuthorityLocation},exports.setNoAuthorityLocation=function(e){this.noAuthorityLocation=e},exports.getNotFoundLocation=function(){return this.notFoundLocation||r.notFoundLocation},exports.setNotFoundLocation=function(e){this.notFoundLocation=e},exports.start=function(){if(!this.getDefaultTitle())this.setDefaultTitle(r.systemName||document.title);this.getRouter().setBackup(a.bind(this.renderAction,this))},exports.findActionConfig=function(e){var t=e.url.getPath(),i=this.actionPathMapping[t];return i},exports.resolveActionConfig=function(e){return e},exports.checkAuthority=function(e,t){var i=e.authority;if(!i)return!0;var n=this.getPermissionProvider();if("function"==typeof i)return i(t,e,n);if("string"==typeof i)i=i.split("|");for(var r=0;r<i.length;r++)if(n.isAllow(a.trim(i[r])))return!0;return!1},exports.findEligibleActionConfig=function(e){var t=this.findActionConfig(e);if(t&&t.movedTo)return this.getEventBus().fire("actionmoved",{controller:this,url:e.url,config:t,movedTo:t.movedTo}),e.originalURL=e.url,e.url=n.parse(t.movedTo),this.findEligibleActionConfig(e);if(t&&t.childActionOnly&&!e.isChildAction)t=null;if(!t)if(this.getEventBus().fire("actionnotfound",a.mix({controller:this,failType:"NotFound",reason:"Not found"},e)),e.originalURL=e.url,e.url=n.parse(this.getNotFoundLocation()),!this.actionPathMapping[e.url.getPath()])return null;else return this.findEligibleActionConfig(e);var i=this.checkAuthority(t,e);if(!i){this.getEventBus().fire("permissiondenied",a.mix({controller:this,failType:"PermissionDenied",reason:"Permission denied",config:t},e));var r=t.noAuthorityLocation||this.getNoAuthorityLocation();return e.originalURL=e.url,e.url=n.parse(r),this.findEligibleActionConfig(e)}return t},exports.loadAction=function(e){var t=this.findEligibleActionConfig(e);if(t=this.resolveActionConfig(t,e),!t){var n=new i;return n.syncModeEnabled=!1,n.reject("no action configured for url "+e.url.getPath()),n.promise}if(t.title)e.title=t.title,e.args.title=t.title;if(t.documentTitle)e.documentTitle=t.documentTitle,e.args.documentTitle=t.documentTitle;if(t.args)for(var r in t.args)if(t.args.hasOwnProperty(r)){if(!e.args.hasOwnProperty(r))e.args[r]=t.args[r];if(!e.hasOwnProperty(r))e[r]=t.args[r]}var o=new i;o.syncModeEnabled=!1;var s=o.promise,l=!1,h=function(){if(!l)l=!0,this.getEventBus().fire("actionabort",a.mix({controller:this},e))};if(s.abort=a.bind(h,this),!e.isChildAction)this.currentURL=e.url;var u=function(n){if(!l){if(!n){var r="No action implement for "+t.type,s=a.mix({controller:this,failType:"NoModule",config:t,reason:r},e);return this.getEventBus().fire("actionfail",s),this.getEventBus().notifyError(s),void o.reject(r)}if(this.getEventBus().fire("actionloaded",{controller:this,url:e.url,config:t,action:n}),"function"==typeof n)o.resolve(new n,e);else if("function"==typeof n.createRuntimeAction){var h=function(i){if(!i){var n="Action factory returns non-action",r=a.mix({controller:this,failType:"InvalidFactory",config:t,reason:n,action:i},e);this.getEventBus().fire("actionfail",r),this.getEventBus().notifyError(r),o.reject(n)}else o.resolve(i,e)};h=a.bind(h,this);var u=n.createRuntimeAction(e);i.when(u).then(h)}else o.resolve(n,e)}};if(u=a.bind(u,this),"string"==typeof t.type)window.require([t.type],u);else u(t.type);return s},exports.enterAction=function(e,t){if(!t.isChildAction){if(t.url!==this.currentURL)return;if(this.currentAction)if(this.getEventBus().fire("leaveaction",{controller:this,action:this.currentAction,to:a.mix({},t)}),"function"==typeof this.currentAction.leave)this.currentAction.leave();this.currentAction=e,document.title=t.title||t.documentTitle||this.getDefaultTitle()}this.getEventBus().fire("enteraction",a.mix({controller:this,action:e},t));var i=function(){this.getEventBus().fire("enteractioncomplete",a.mix({controller:this,action:e},t))};i=a.bind(i,this);var n=function(e){var i="";if(!e)i="Invoke action.enter() causes error";else if(e.message){if(i=e.message,e.stack)i+="\n"+e.stack}else if(window.JSON&&"function"==typeof JSON.stringify)try{i=JSON.stringify(e)}catch(n){i=e}else i=e;var r=a.mix({failType:"EnterFail",reason:i},t);this.getEventBus().fire("enteractionfail",r),this.getEventBus().notifyError(r)};n=a.bind(n,this);var r=e.enter(t);return r.then(i,n),r},exports.forward=function(e,t,i,n){var r={url:e,container:t,isChildAction:!!n};if(n){var s=this.childActionMapping[t];r.referrer=s?s.url:null}else r.referrer=this.currentURL;a.mix(r,i),r.args=a.mix({},r),a.mix(r.args,e.getQuery()),this.getEventBus().fire("forwardaction",a.mix({controller:this},r));var l=this.loadAction(r);return o.has(l,"loadAction should always return a Promise"),l},exports.renderAction=function(e){if("string"==typeof e)e=n.parse(e);if(this.globalActionLoader&&"function"==typeof this.globalActionLoader.abort)this.globalActionLoader.abort();if(this.currentAction&&"function"==typeof this.currentAction.filterRedirect&&this.currentAction.filterRedirect(e)===!1)return i.rejected("Redirect aborted by previous action");this.globalActionLoader=this.forward(e,this.getMainContainer(),null,!1);var t=this.getEventBus();return this.globalActionLoader.then(a.bind(this.enterAction,this)).fail(a.bind(t.notifyError,t))
},exports.enterChildAction=function(i,n){function r(t,i,r){i=i||{};var t=h.resolveURL(t,i);if(i.global){var a=document.getElementById(n.container),o=h.redirect(t,i);if(o&&a)e(u,a);return o}var s=u.childActionMapping[n.container],l=t.toString()!==s.url.toString(),c=l||i.force;if(c)if(i.silent)s.url=t;else u.renderChildAction(t,s.container,r);return c}function o(e){if(e.isChildActionRedirected)return!0;for(var t=e.target||e.srcElement;t&&(!t.id||!u.childActionMapping[t.id]);)t=t.parentNode;if(t.id!==n.container)return e.isChildActionRedirected=!0,!0;else return!1}function s(e){e=e||window.event;var t=e.target||e.srcElement;if("a"===t.nodeName.toLowerCase()){var i=t.getAttribute("href",2)||"";if("#"===i.charAt(0))if(!o(e)){if(e.preventDefault)e.preventDefault();else e.returnValue=!1;for(var n=i.substring(1),s=(t.getAttribute("data-redirect")||"").split(/[,\s]/),l={},h=0;h<s.length;h++){var u=a.trim(s[h]);l[u]=!0}r(n,l)}}}this.childActionLoaders[n.container]=null;var l=document.getElementById(n.container);if(l){var h=this.getLocator(),u=this;return i.redirect=r,i.reload=function(e){this.redirect(n.url,{force:!0},e)},i.back=function(e,t){var i=this.context&&this.context.referrer,n=i||e;this.redirect(n,null,t)},t(this,l,i,s,n),this.enterAction(i,n)}},exports.renderChildAction=function(e,t,r){if(o.has(t),"string"==typeof e)e=n.parse(e);var s=this.childActionLoaders[t];if(s&&"function"==typeof s.abort)s.abort();var l=this.childActionMapping[t],h=l&&l.action;if(h&&"function"==typeof h.filterRedirect&&h.filterRedirect(e)===!1)return i.rejected("Redirect aborted by previous action");var u=this.forward(e,t,r,!0),c=this.getEventBus(),d=u.then(a.bind(this.enterChildAction,this)).fail(a.bind(c.notifyError,c));return d.abort=u.abort,this.childActionLoaders[t]=d,d};var s=require("eoo").create(require("mini-event/EventTarget"),exports),l=new s;return l.setLocator(require("./locator")),l.setRouter(require("./router")),l.setEventBus(require("./events")),l.setPermissionProvider(require("./permission")),l.Controller=s,l}),define("er/datasource",["require","./util","./ajax","./permission"],function(require){var e={};return e.constant=function(e){return function(){return e}},e.remote=function(e,t){return function(i){if(t=require("./util").mix({url:e,dataType:"json"},t),"function"==typeof t.data)t.data=t.data(i);var n=require("./ajax");return n.request(t)}},e.permission=function(e){return function(){var t=require("./permission");return t.isAllow(e)}},e.defaultValue=function(e,t){return function(i,n){if(!n.name&&!t)throw new Error("No property name specified to determine whether value exists in this model");var r=t||n.name;return i.hasValue(r)?i.get(r):e}},e.convertTo=function(e,t){return function(i,n){if(!n.name&&!t)throw new Error("No property name specified to convert");var r=t||n.name,a=i.get(r);switch(e){case"number":return parseInt(a,10);case"string":return a+"";case"boolean":return!!a;default:return a}}},e}),define("er/Enum",["require","eoo"],function(require){var exports={};exports.constructor=function(){this.valueIndex=[],this.aliasIndex={},this.textIndex={};for(var e=0;e<arguments.length;e++){var t=arguments[e];if(null==t.value)t.value=e;this.addElement(t)}},exports.addElement=function(e){if(this.hasOwnProperty(e.value))throw new Error("Already defined an element with value"+e.value+" in this enum type");if(this.hasOwnProperty(e.alias))throw new Error('Already defined an element with alias "'+e.alias+'" in this enum type');this[e.value]=e.alias,this[e.alias]=e.value,this.valueIndex[e.value]=e,this.aliasIndex[e.alias]=e,this.textIndex[e.text]=e},exports.fromValue=function(e){return this.valueIndex[e]},exports.fromAlias=function(e){return this.aliasIndex[e]},exports.fromText=function(e){return this.textIndex[e]},exports.getTextFromValue=function(e){return this.fromValue(e).text},exports.getTextFromAlias=function(e){return this.fromAlias(e).text},exports.getValueFromAlias=function(e){return this.fromAlias(e).value},exports.getValueFromText=function(e){return this.fromText(e).value},exports.getAliasFromValue=function(e){return this.fromValue(e).alias},exports.getAliasFromText=function(e){return this.fromText(e).alias},exports.toArray=function(){var e=[];if(arguments.length>0)for(var t=0;t<arguments.length;t++){var i=arguments[t];if("string"==typeof i)e.push(this.fromAlias(i));else e.push(i)}else for(var t=0;t<this.valueIndex.length;t++)if(this.valueIndex[t])e.push(this.valueIndex[t]);return e};var e=require("eoo").create(exports);return e}),define("er/main",["require","./controller","./router","./locator"],function(require){var e={version:"3.1.0-beta.5",start:function(){require("./controller").start(),require("./router").start(),require("./locator").start()}};return e}),define("er",["er/main"],function(e){return e}),define("er/Model",["require","./util","./Deferred","eoo","mini-event/EventTarget"],function(require){function e(e,t){function i(i){if(t.dump)e.fill(i,h);else e.set(t.name,i,h);return{success:!0,name:t.name,options:t,value:i}}function n(e){return{success:!1,name:t.name,options:t,error:e}}try{var r=t.retrieve(e,t);if(l.isPromise(r)){if("function"==typeof r.abort)e.addPendingWorker(r);return r.then(i,function(t){t=n(t);try{var r=e.handleError(t);return i(r)}catch(a){if(a.success===!1)throw a;else throw n(a)}})}else{var a=i(r);return l.resolved(a)}}catch(o){var s=n(o);return l.rejected(s)}}function t(e,t){for(var i=l.resolved(),r=0;r<t.length;r++){var a=t[r],o=s.bind(n,null,e,a);i=i.then(o)}return i}function i(e,t){var i=[];for(var r in t)if(t.hasOwnProperty(r)){var a=t[r];if("function"==typeof a)a={retrieve:a,name:r};else if("function"==typeof a.retrieve)a=s.mix({name:r},a);i.push(n(e,a))}return l.all(i)}function n(n,r){if(!r)return l.resolved();if("function"==typeof r){var a={retrieve:r,dump:!0};return e(n,a)}if(r instanceof Array)return t(n,r);if("function"==typeof r.retrieve)return e(n,r);else return i(n,r)}function r(e,t){for(var i=0;i<e.pendingWorkers.length;i++)if(e.pendingWorkers[i]===t)return void e.pendingWorkers.splice(i,1)}function a(){function e(e){var t={success:!1,name:"$prepare",options:{},error:e};throw t}try{var t=this.prepare();if(l.isPromise(t))return t.fail(e);else return t}catch(i){e(i)}}function o(e,t,i){var n=e.store.hasOwnProperty(t)?"change":"add",r=e.store[t];if(e.store[t]=i,r!==i)return{type:n,name:t,oldValue:r,newValue:i};else return null}var s=require("./util"),l=require("./Deferred"),h={silent:!0},exports={};exports.constructor=function(e){if(this.store={},this.pendingWorkers=[],e)this.fill(e,h);this.initialize()},exports.initialize=s.noop,exports.addPendingWorker=function(e){this.pendingWorkers.push(e),e.ensure(s.bind(r,null,this,e))},exports.datasource=null,exports.getDatasource=function(){return this.datasource},exports.load=function(){try{var e=this.getDatasource(),t=n(this,e);return t.then(s.bind(a,this))}catch(i){return l.rejected(i)}},exports.prepare=s.noop,exports.get=function(e){return this.store[e]},exports.set=function(e,t,i){i=i||{};var n=o(this,e,t);if(n&&!i.silent){var r={changes:[n]};this.fire("change",r)}return t},exports.fill=function(e,t){t=t||{};var i=[];for(var n in e)if(e.hasOwnProperty(n)){var r=o(this,n,e[n]);if(r)i.push(r)}if(i.length&&!t.silent){var a={changes:i};this.fire("change",a)}return e},exports.remove=function(e,t){if(this.store.hasOwnProperty(e)){t=t||{};var i=this.store[e];if(delete this.store[e],!t.silent){var n={changes:[{type:"remove",name:e,oldValue:i,newValue:void 0}]};this.fire("change",n)}return i}},exports.getAsModel=function(e){var t=this.get(e);if(!t||"[object Object]"!=={}.toString.call(t))return new u;else return new u(t)},exports.dump=function(){return s.mix({},this.store)},exports.has=function(e){return this.store.hasOwnProperty(e)},exports.hasValue=function(e){return this.has(e)&&null!=this.store[e]},exports.hasReadableValue=function(e){return this.hasValue(e)&&""!==this.store[e]},exports.valueOf=function(){return this.dump()},exports.clone=function(){return new u(this.store)},exports.handleError=function(e){throw e},exports.dispose=function(){if(this.pendingWorkers){for(var e=0;e<this.pendingWorkers.length;e++){var t=this.pendingWorkers[e];if("function"==typeof t.abort)try{t.abort()}catch(i){}}this.pendingWorkers=null}};var u=require("eoo").create(require("mini-event/EventTarget"),exports);return u}),define("er/Observable",["require","mini-event/EventTarget"],function(require){return require("mini-event/EventTarget")}),define("er/template",["require","etpl/main"],function(require){var e=require("etpl/main");return e.merge=function(t,i,n){var r="";try{var r=e.render(i,n)}catch(a){}if(t)t.innerHTML=r;return r},e}),define("er/tpl",["require","etpl/tpl"],function(require){return require("etpl/tpl")}),define("er/View",["require","./util","./Model","etpl","eoo","mini-event/EventTarget"],function(require){var e=require("./util"),exports={};exports.constructor=function(){this.initialize()},exports.initialize=e.noop,exports.template="",exports.getTemplateName=function(){return this.template||""},exports.model=null,exports.container="",exports.getContainerElement=function(){return e.getElement(this.container)||null},exports.getTemplateData=function(){var e=this.model;if(e&&"function"!=typeof e.get){var t=require("./Model");e=new t(e)}var i=function(t){for(var i=t.replace(/\[(\d+)\]/g,".$1").split("."),n=i.shift(),r=e.get(n);r&&(n=i.shift());)r=r[n];return r};return{get:i,relatedModel:e}},exports.render=function(){var e=this.getContainerElement();if(!e){var t=this.model&&"function"==typeof this.model.get&&this.model.get("url");throw new Error("Container not found when rendering "+(t?'"'+t+'"':"view"))}var i=require("etpl"),n=i.render(this.getTemplateName(),this.getTemplateData());e.innerHTML=n,this.enterDocument()},exports.enterDocument=require("./util").noop,exports.dispose=function(){var e=this.getContainerElement();e&&(e.innerHTML="")};var t=require("eoo").create(require("mini-event/EventTarget"),exports);return t}),define("er-track/events",["require","er/events","er/Deferred","er/ajax"],function(require){return{pageView:function(e){require("er/events").on("redirect",function(t){e(["trackPageView",[t]])})},exception:function(e){require("er/Deferred").on("exception",function(t){e(["trackException",[t]])})},requestTimeout:function(e){require("er/ajax").on("timeout",function(t){var i=[t.options.url,t.options];e(["trackRequestTimeout",i])})},enterAction:function(e){require("er/events").on("enteractioncomplete",function(t){e(["trackEnterAction",[t]])})},leaveAction:function(e){require("er/events").on("leaveaction",function(t){e(["trackLeaveAction",[t]])})}}}),define("er-track/loadScript",["require"],function(){return function(e,t){var i=document.createElement("script");if(i.charset="utf-8",i.async=!0,i.src=e,t){var n=!1;i.onload=i.onreadystatechange=function(){if(!(n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))n=!0,t()}}var r=document.getElementsByTagName("script")[0];if(r&&r.parentNode)r.parentNode.insertBefore(i,r);else{var a=document.getElementsByTagName("head")[0]||document.body;a.insertBefore(i,a.firstChild)}}}),define("er-track/main",["require","./events"],function(require){var exports={},e={packageName:"er-track"};return exports.config=function(t,i){return e[t]=i,this},exports.create=function(){function t(t){return a[t]||e[t]||null}function i(e,t){for(var i in o)if(o.hasOwnProperty(i)){var n=o[i];n[e]&&n[e].apply(n,t)}}function n(){for(var e=0;e<l.length;e++){var t=l[e][0],n=l[e][1];i(t,n)}}function r(){l.push.apply(l,arguments)}var a={},o={},s={};s.config=function(e,t){return a[e]=t,this},s.use=function(e){if(o[e])return o[e];var t={name:e,configuration:{},config:function(e,t){return this.configuration[e]=t,this},setAccount:function(e){return this.config("account",e)}};return o[e]=t,t};var l=[];s.start=function(){var e=[];for(var r in o)if(o.hasOwnProperty(r)){var a=t("packageName")+"/trackers/"+r;e.push(a)}window.require(e,function(){function e(){if(t--,0===t)n(),l={push:function(e){i(e[0],e[1])}}}for(var t=arguments.length,r=0;r<arguments.length;r++){var a=arguments[r],s=o[a.name].configuration,h=a.create(s);o[a.name]=h,h.load(e)}})};var h=require("./events");return s.include=function(e){if(h.hasOwnProperty(e))h[e](r);return this},s.includeAll=function(){for(var e in h)s.include(e);return this},s},exports}),define("er-track",["er-track/main"],function(e){return e}),define("er-track/trackers/baidu",["require","../loadScript"],function(require){if(!window._hmt)window._hmt=[];var exports={name:"baidu"};return exports.create=function(e){return{name:"baidu",trackPageView:function(e){var t=e.referrer||document.referrer;return window._hmt.push(["_setReferrerOverride",t]),window._hmt.push(["_trackPageview",e.url]),this},load:function(t){if(!e.account)return t();var i=e.scriptURL||"//hm.baidu.com/hm.js";i+="?"+e.account;var n=require("../loadScript");n(i,t)}}},exports}),define("er-track/trackers/console",["require"],function(){function e(e){if(window.console)if("function"==typeof console.log)console.log.apply(console,e);else console.log(e.join(" "))}function t(t){if(window.console)if(console.groupCollapsed){console.groupCollapsed(t);for(var i=1;i<arguments.length;i++)e(arguments[i]);console.groupEnd(t)}else{console.log("➤"+t);for(var n="├───",i=1;i<arguments.length;i++){if(i===arguments.length-1)n="└───";var r=arguments[i];if("string"==typeof r)r=n+r;else r[0]=n+r[0];e(r)}}}var exports={name:"console"};return exports.create=function(){return{name:"console",trackException:function(e){var i=["我靠，有个Promise出异常了",["出事的Deferred对象: ",e.deferred],["出事时给的参数: ",e.args],["出事的原因大概是: "+e.reason]];if(e.reason instanceof Error)i.push("好像是一个异常对象，所以把调用堆栈给你看看好了：\n"+e.reason.stack);t.apply(null,i)},trackEnterAction:function(e){t('亲你正在进入"'+e.url+'"',["Action：",e.action],["Model：",e.action.model],["Model里的数据：",e.action.model.dump()],["View：",e.action.view],["DOM容器：",e.action.view.getContainerElement()])},trackLeaveAction:function(e){t('亲你已经离开"'+e.action.context.url+'"',["当前的Action：",e.action],["前往的URL："+e.to.url])},load:function(e){e()}}},exports}),define("ub-ria/extension/ajax",["require","er/ajax","underscore"],function(require){function e(){var e=require("er/ajax"),t=e.hooks.serializeData;e.hooks.serializeData=function(i,n,r){if(!i&&"application/json"===r)return JSON.stringify(n);else return t.apply(e.hooks,arguments)},e.hooks.serializeData.getKey=t.getKey}return{enable:require("underscore").once(e)}}),define("ub-ria/extension/mvc",["require","underscore","er/util","er/events"],function(require){function e(){r.on("enteractioncomplete",function(e){if(e.action&&e.action.getPageCategories){var t=n.getElement(e.container);if(t){var r=e.action.getPageCategories();if(t.classList)i.each(r,function(e){t.classList.add(e)});else{var a=t.className?t.className.split(/\s+/):[];a=i.union(a,r),t.className=a.join(" ")}}}}),r.on("leaveaction",function(e){if(e.action&&e.action.getPageCategories){var t=n.getElement(e.action.context.container);if(t){var r=e.action.getPageCategories();if(t.classList)i.each(r,function(e){t.classList.remove(e)});else{var a=t.className?t.className.split(/\s+/):[],o=i.difference(a,r);if(o.length!==a.length)t.className=o.join(" ")}}}})}function t(){e()}var i=require("underscore"),n=require("er/util"),r=require("er/events");return{enable:i.once(t)}}),define("ub-ria/extension/ui",["require","underscore","esui/lib","esui/validator/MaxLengthRule","esui/validator/MinLengthRule","esui/validator/RequiredRule","esui/validator/PatternRule","esui/validator/MaxRule","esui/validator/MinRule","esui/validator/Rule","esui/Table","esui/CommandMenu","esui/Tab"],function(require){function e(){function e(e){var t=e.get("min"),i=e.get("max"),n=e.get("pattern")+"";if(null!=t&&null!=i&&l.hasOwnProperty(n)){var a=/\B(?=(\d{3})+(?!\d))/g,s=(t+"").replace(a,","),h=(i+"").replace(a,",");if(o.hasOwnProperty(n))return r.escape(e.get("title"))+"请填写≥"+s+"且≤"+h+"的整数";else return r.escape(e.get("title"))+"请填写≥"+s+"且≤"+h+"的数字，最多可保存至小数点后两位"}else return null}require("esui/validator/MaxLengthRule"),require("esui/validator/MinLengthRule");var t=require("esui/validator/RequiredRule"),i=require("esui/validator/PatternRule"),n=require("esui/validator/MaxRule"),a=require("esui/validator/MinRule");t.prototype.errorMessage="请填写${title}";var o={"^\\d+$":!0,"/^\\d+$/":!0},s={"^\\d+(\\.\\d{1,2})?$":!0,"/^\\d+(\\.\\d{1,2})?$/":!0},l=r.extend({},o,s),h=require("esui/validator/Rule");n.prototype.getErrorMessage=function(t){if(t.get("maxErrorMessage")){var i=h.prototype.getErrorMessage;return i.apply(this,arguments)}var n=e(t);if(n)return n;else return h.prototype.getErrorMessage.apply(this,arguments)},a.prototype.getErrorMessage=function(t){if(t.get("minErrorMessage")){var i=h.prototype.getErrorMessage;return i.apply(this,arguments)}var n=e(t);if(n)return n;else return h.prototype.getErrorMessage.apply(this,arguments)},i.prototype.getErrorMessage=function(t){var i=t.get("pattern")+"";if(t.get("patternErrorMessage")||!l.hasOwnProperty(i)){var n=h.prototype.getErrorMessage;return n.apply(this,arguments)}var r=e(t);if(r)return r;else return h.prototype.getErrorMessage.apply(this,arguments)}}function t(){var e=require("esui/Table");e.command=function(e){var t={tagName:"span",text:""};r.extend(t,e);var i=r.escape(t.tagName),n="<"+i;if(t.className)n+=' class="'+r.escape(t.className)+'"';if(n+=' data-command="'+r.escape(t.command)+'"',t.args)n+=' data-command-args="'+r.escape(t.args)+'"';return n+=">"+r.escape(t.text)+"</"+i+">"},e.operations=function(t){var i="",n=r.map(t,function(t){if(r.isString(t))return i='<span class="table-operation-separator">'+r.escape(t)+"</span>";if(t.auth===!1)return"";if(t.url){var n=[];if(n.push('<a href="'+r.escape(t.url)+'"'),n.push(' class="table-operation table-operation-'),n.push(r.escape(t.type)+'"'),"_blank"===t.target)n.push(' target="_blank"');if(!t.redirectOptions)n.push(' data-redirect="global">');else if(0===t.redirectOptions.length)n.push(">");else if(r.isArray(t.redirectOptions))n.push(' data-redirect="'+t.redirectOptions.join(" ")+'">');return n.push(r.escape(t.text)),n.push("</a>"),n.join("")}else{var a="table-operation table-operation-"+r.escape(t.type),o={className:a,text:t.text,command:t.command,args:t.args};if(t.tagName)o.tagName=t.tagName;return e.command(o)}});n=r.without(n,"");for(var a=0;a<n.length-1;)if(n[a]===i&&n[a+1]===i)n.splice(a,1);else a++;if(n[0]===i)n.shift();if(n[n.length-1]===i)n.pop();return n.join("")},e.slideOperations=function(t){var i=e.operations(t),n='<span class="table-operation-trigger">操作</span><div class="table-operation-layer-wrapper">    <div class="table-operation-layer">'+i+"    </div></div>";return n},e.status=function(e){return'<span class="table-status-'+r.escape(e.type)+'">'+e.text+"</span>"}}function i(){var e=require("esui/CommandMenu");e.prototype.linkTemplate='<a target="${target}" href="${href}">${text}</a>',e.prototype.getItemHTML=function(e){var t={text:a.encodeHTML(e.text),href:e.href&&a.encodeHTML(e.href),target:e.target||"_self"},i=e.href?this.linkTemplate:this.itemTemplate;return a.format(i,t)};var t=require("esui/Tab");t.prototype.linkTemplate='<a href="${href}">${title}</a>',t.prototype.getContentHTML=function(e){var t={title:a.encodeHTML(e.title),href:e.href&&a.encodeHTML(e.href)},i=e.href?this.linkTemplate:this.contentTemplate;return a.format(i,t)}}function n(){e(),t(),i()}var r=require("underscore"),a=require("esui/lib");return{enable:r.once(n)}}),define("ub-ria/extension/underscore",["require","underscore"],function(require){function e(){t.templateSettings={interpolate:/\$\{(.+?)\}/g,escape:/\$\{\:(.+?)\}/g}}var t=require("underscore");return{enable:t.once(e)}}),define("ub-ria/filterTree",["require","underscore"],function(require){function e(i,n){if(n.children)n.children=t.filter(n.children,t.partial(e,i));if(n.children&&n.children.length||i(n))return n;else return null}var t=require("underscore"),exports={};return exports.byFunction=function(i,n){var r=e(n,i);if(!r)r=t.omit(i,"children"),r.children=[];return r},exports.byKeyword=function(e,t){var i=function(e){return e.text.indexOf(t)>=0};return exports.byFunction(e,i)},exports}),define("ub-ria/main",["require","./extension/underscore","./extension/mvc","./extension/ajax","./extension/ui","er"],function(require){var e={version:"1.0.0-alpha.7",enableExtensions:function(){require("./extension/underscore").enable(),require("./extension/mvc").enable(),require("./extension/ajax").enable(),require("./extension/ui").enable()},start:function(){e.enableExtensions(),require("er").start()}};return e}),define("ub-ria",["ub-ria/main"],function(e){return e}),define("ub-ria/util",["require","underscore"],function(require){var e=require("underscore"),t={},i={};return i.purify=function n(i,r,a){r=r||t;var o={};return e.each(i,function(e,t){var i=null==e||""===e,s=r.hasOwnProperty(t)&&r[t]===e;if(!i&&!s)if(a&&"object"==typeof e)o[t]=n(e,r[t],a);else o[t]=e}),o},i.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},i.pascalize=function(e){if(e+="",/^[A-Z\-_]$/.test(e))e=e.toLowerCase();return e=e.replace(/[\s-\/_]+(.)/g,function(e,t){return t.toUpperCase()}),e=e.charAt(0).toUpperCase()+e.slice(1)},i.pascalize=e.memoize(i.pascalize),i.camelize=function(e){return e=i.pascalize(e),e.charAt(0).toLowerCase()+e.slice(1)},i.camelize=e.memoize(i.camelize),i.dasherize=function(e){if(e=i.pascalize(e),e=e.replace(/[A-Z]{2,}$/g,function(e){return e.charAt(0)+e.slice(1).toLowerCase()}),e=e.replace(/[A-Z]{2,}/g,function(e){return e.charAt(0)+e.slice(1,-1).toLowerCase()+e.charAt(e.length-1)}),e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),"-"===e.charAt(0))e=e.substring(1);return e},i.dasherize=e.memoize(i.dasherize),i.constlize=function(e){return e=i.pascalize(e),e.toUpperCase()},i.constlize=e.memoize(i.constlize),i.pluralize=function(e){return e.replace(/y$/,"ie")+"s"},i.pluralize=e.memoize(i.pluralize),i.formatNumber=function(e,t,i,n){if("number"!=typeof arguments[1])n=arguments[2],i=arguments[1],t=0;if(n=n||"",i=i||"",null==e||isNaN(e))return n+i;e=parseFloat(e).toFixed(t);var r=e.split("."),a=r[0],o=r[1];a=a.replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");var s=n+a;if(o)s+="."+o;return s},i.pad=function(e,t,i){e+="";var n=i-e.length;if(n>0){var r=new Array(n+1).join(t);return r+e}else return e},i.padRight=function(e,t,i){e+="";var n=i-e.length;if(n>0){var r=new Array(n+1).join(t);return e+r}else return e},i.deepClone=function(t){if(!e.isObject(t)||e.isFunction(t)||e.isRegExp(t))return t;if(e.isArray(t))return e.map(t,i.deepClone);var n={};return e.each(t,function(e,t){n[t]=i.deepClone(e)}),n},i}),define("ef/UIModel",["require","er/Model","eoo"],function(require){function e(e){return e+="",1===e.length?"0"+e:e}var t=require("er/Model"),exports={},i={date:function(t){return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())},dateRange:function(e){return i.date(e.begin)+","+i.date(e.end)},time:function(t){return i.date(t)+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())},timeRange:function(e){return i.time(e.begin)+","+i.time(e.end)}};exports.formatters={},exports.set=function(e,t,i){if(this.formatters.hasOwnProperty(e))t=this.formatters[e](t);this.$super([e,t,i])},exports.fill=function(e){for(var t in e)if(e.hasOwnProperty(t)&&this.formatters.hasOwnProperty(t)){var i=this.formatters[t],n=e[t];e[t]=i(n)}this.$super(arguments)},exports.getPart=function(e){if("[object Array]"!==Object.prototype.toString.call(e))e=[].slice.call(arguments);for(var t={},i=0;i<e.length;i++){var n=e[i];t[n]=this.get(n)}return t};var n=require("eoo").create(t,n);return n.formatters=i,n}),define("ub-ria/mvc/BaseModel",["require","underscore","er/util","ef/UIModel"],function(require){function e(){n.apply(this,arguments)}var t=require("underscore"),i=require("er/util"),n=require("ef/UIModel");return i.inherits(e,n),e.prototype.addData=function(e,t){if(!this.dataPool)this.dataPool={};if(arguments.length<2)t=e,e="default";if(!e)e="default";if(!this.dataPool[e])this.dataPool[e]=t},e.prototype.setData=function(e){this.addData(e)},e.prototype.data=function(e){if(!e)e="default";return this.dataPool[e]||null},e.prototype.putDatasource=function(e,i){if(e=t.clone(e),!this.datasource)this.datasource=[];else if(!t.isArray(this.datasource))this.datasource=[this.datasource];if(void 0===i)this.datasource.push(e);else{var n=this.datasource[i]||{};if(t.isArray(n))n.push(e);else t.extend(n,e);this.datasource[i]=n}},e.prototype.dispose=function(){n.prototype.dispose.apply(this,arguments),t.each(this.dataPool,function(e){e.dispose()}),this.dataPool=null},e}),define("ub-ria/mvc/BaseAction",["require","er/util","underscore","er/Action","../util","er/Model","./BaseModel"],function(require){function e(e){n.apply(this,arguments),this.entityName=e}var t=require("er/util"),i=require("underscore"),n=require("er/Action");return t.inherits(e,n),e.prototype.getEntityName=function(){if(!this.entityName){var e=this.context.url.getPath();this.entityName=e.split("/")[1]}return this.entityName},e.prototype.entityDescription="",e.prototype.getEntityDescription=function(){return this.entityDescription||""},e.prototype.group="",e.prototype.getGroup=function(){return this.group},e.prototype.category="",e.prototype.getCategory=function(){return this.category||""},e.prototype.getPageCategories=function(){var e=[],t=require("../util").dasherize(this.getCategory()),i=require("../util").dasherize(this.getEntityName());if(t)e.push(t+"-page");if(i)e.push(i+"-page");if(t&&i)e.push(i+"-"+this.category+"-page");return e},e.prototype.createModel=function(e){e.entityDescription=this.getEntityDescription();var t=n.prototype.createModel.apply(this,arguments),r=require("er/Model");if(!(t instanceof r)&&i.isEmpty(t)){var a=require("./BaseModel"),o=this.getEntityName();t=new a(o,e)}return t},e.prototype.setModel=function(e){e.set("entityDescription",this.getEntityDescription()),this.model=e},e}),define("ef/ActionPanel",["require","er/events","esui/Panel","mini-event","er/Deferred","esui/painters","er/controller","eoo","esui"],function(require){function e(e){var t=require("mini-event").fromEvent(e,{preserveData:!0,syncState:!0});t.type="action@"+e.type,this.fire(t)}function t(t){if(t.isChildAction&&t.container===this.main.id){if(this.action=t.action,"function"==typeof this.action.on)this.action.on("*",e,this);this.fire("actionattach")}}function i(e){if(e.isChildAction&&e.container===this.main.id)this.fire("actionloaded")}function n(e){if(e.isChildAction&&e.container===this.main.id)this.action=null,this.fire("actionloadfail",{failType:e.failType,reason:e.reason})}function r(e){if(e.isChildAction&&e.container===this.main.id)this.fire("actionloadabort")}var a=require("er/events"),o=require("esui/Panel"),exports={};exports.type="ActionPanel",exports.setContent=function(){},exports.actionType=null,exports.action=null,exports.initStructure=function(){a.on("enteraction",t,this),a.on("enteractioncomplete",i,this),a.on("actionnotfound",n,this),a.on("permissiondenied",n,this),a.on("actionfail",n,this),a.on("enteractionfail",n,this),a.on("actionabort",r,this)},exports.disposeAction=function(){var t=require("er/Deferred"),i=this.action;if(i){if(t.isPromise(i)&&"function"==typeof i.abort)i.abort();else{if("function"==typeof i.un)i.un("*",e,this);if("function"==typeof i.leave)i.leave()}this.action=null}},exports.repaint=require("esui/painters").createRepaint(o.prototype.repaint,{name:["url","actionOptions"],paint:function(e,t,i){if(e.disposeAction(),t)if(!e.lazy||!e.helper.isInStage("INITED")){var n=require("er/controller");if(e.action=n.renderChildAction(t,e.main.id,i),"function"!=typeof e.action.abort)e.action=null}}}),exports.dispose=function(){this.disposeAction(),a.un("enteraction",t,this),a.un("enteractioncomplete",i,this),a.un("actionnotfound",n,this),a.un("permissiondenied",n,this),a.un("actionfail",n,this),a.un("enteractionfail",n,this),a.un("actionabort",r,this),this.$super(arguments)},exports.reload=function(e){var t=this.url;this.url=null,this.setProperties({url:t,actionOptions:e})};var s=require("eoo").create(o,exports);return require("esui").register(s),s}),define("ef/ActionDialog",["require","esui/main","esui/Dialog","./ActionPanel","mini-event","esui/painters","eoo","esui"],function(require){var e=require("esui/main"),t=require("esui/Dialog");require("./ActionPanel");var exports={};exports.type="ActionDialog",exports.styleType="Dialog",exports.setContent=function(){},exports.createBF=function(t,i){if(i)this.content=i.innerHTML;else i=document.createElement("div"),this.main.appendChild(i);this.helper.addPartClasses(t+"-panel",i);var n={main:i},r="Panel";if("body"===t)n.url=this.url,n.actionOptions=this.actionOptions,r="ActionPanel";var a=e.create(r,n);if("body"===t){a.on("actionattach",function(){if(this.resize(),this.autoClose){var e=this.get("action");if("function"==typeof e.on)e.on("handlefinish",!1),e.on("handlefinish",this.dispose,this)}this.fire("actionattach")},this),a.on("*",function(e){if(0===e.type.indexOf("action@"))this.fire(e)},this);var o=require("mini-event");o.delegate(a,this,"actionloaded"),o.delegate(a,this,"actionloadfail"),o.delegate(a,this,"actionloadabort")}return a.render(),this.addChild(a,t),a},exports.repaint=require("esui/painters").createRepaint(t.prototype.repaint,{name:["url","actionOptions"],paint:function(e,t,i){var n=e.getBody(),r={url:t,actionOptions:i};n.setProperties(r)}}),exports.getAction=function(){var e=this.getBody();if(e)return e.get("action");else return null},exports.reload=function(){var e=this.getBody();if(e)e.reload()};var i=require("eoo").create(t,exports);return require("esui").register(i),i}),define("ef/UIView",["require","underscore","er/View","ef/ActionDialog","esui","esui/Dialog","esui/main","esui/ViewContext","eoo"],function(require){function e(e,t){for(var i=e,n=0;n<t.length;n++)i=i[t[n]];return i}function t(e,t,i,n){if("string"==typeof n)n=e[n];if("function"!=typeof n)return n;var r=e.get(t);if(r)r.on(i,n,e);return n}function i(){return"ef-"+a++}var n=require("underscore"),r=require("er/View");require("ef/ActionDialog");var exports={};exports.replaceValue=function(t){if("string"!=typeof t)return t;if("@@"===t||"**"===t)return this.model;var i=t.charAt(0),n=t.substring(1);if("@"===i||"*"===i){var r=n.split("."),t=this.model.get(r[0]);return r.length>1?e(t,r.slice(1)):t}else return t},exports.get=function(e){return this.viewContext.get(e)},exports.getSafely=function(e){return this.viewContext.getSafely(e)},exports.getGroup=function(e){return this.viewContext.getGroup(e)},exports.create=function(e,t){if(t=t||{},!t.viewContext)t.viewContext=this.viewContext;return require("esui").create(e,t)},exports.alert=function(e,t){var i="string"==typeof e?{title:t||document.title,content:e}:n.clone(e);if(!i.viewContext)i.viewContext=this.viewContext;var r=require("esui/Dialog");return r.alert(i)},exports.confirm=function(e,t){var i="string"==typeof e?{title:t||document.title,content:e}:n.clone(e);if(!i.viewContext)i.viewContext=this.viewContext;var r=require("esui/Dialog");return r.confirm(i)},exports.popActionDialog=function(e){var t=document.createElement("div");document.body.appendChild(t);var i={width:600,needFoot:!1,draggable:!0,closeOnHide:!0,autoClose:!0,main:t,viewContext:this.viewContext};e=n.defaults({},e,i);var r=require("esui/main"),a=r.create("ActionDialog",e);return a.render(),a.show(),a},exports.uiEvents=null,exports.getUIEvents=function(){return this.uiEvents||{}},exports.uiProperties=null,exports.getUIProperties=function(){return this.uiProperties},exports.bindEvents=function(){var e=this.getUIEvents();if(e)for(var i in e)if(e.hasOwnProperty(i)){var n=i.split(":");if(n.length>1){var r=n[0],a=n[1],o=e[i];t(this,r,a,o)}else{var s=e[i];if("object"!=typeof s)return;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];t(this,i,a,o)}}}else;};var a=8785925;exports.getViewName=function(){if(this.name)return this.name;var e=this.constructor&&this.constructor.name;if(!e&&this.constructor){var t=this.constructor.toString(),n=/function\s+([^\(]*)/.exec(t);
e=n&&n[1].replace(/\s+$/g,"")}if(!e)e=i();if(e=e.replace(/View$/,""),e=e.replace(/[A-Z]{2,}/g,function(e){return e.charAt(0)+e.slice(1,-1).toLowerCase()+e.charAt(e.length-1)}),e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),"-"===e.charAt(0))e=e.substring(1);return e},exports.createViewContext=function(){var e=require("esui/ViewContext"),t=this.getViewName();return new e(t||null)},exports.enterDocument=function(){this.viewContext=this.createViewContext();var e=this.getContainerElement(),t={viewContext:this.viewContext,properties:this.getUIProperties(),valueReplacer:n.bind(this.replaceValue,this)};try{require("esui").init(e,t)}catch(i){var r=new Error("ESUI initialization error on view because: "+i.message);throw r.actualError=i,r}this.bindEvents()},exports.dispose=function(){if(this.viewContext)this.viewContext.dispose(),this.viewContext=null;this.$super(arguments)};var o=require("eoo").create(r,exports);return o}),define("ub-ria/mvc/BaseView",["require","underscore","er/util","ef/UIView","er/Deferred"],function(require){function e(){n.apply(this,arguments)}var t=require("underscore"),i=require("er/util"),n=require("ef/UIView");return i.inherits(e,n),e.prototype.addUIEvents=function(e){var i=[e];t.each(e,function(n,r){if(t.isArray(n)){for(;n.length>1;){var a={};a[r]=n.splice(-1)[0],i.push(a)}if(n.length)e[r]=n.splice(-1)[0]}});var n=this.uiEvents;this.uiEvents=n&&[].concat(n)||[],this.uiEvents=this.uiEvents.concat(i)},e.prototype.getUIEventsCollection=function(){var e=this.uiEvents;return e&&[].concat(e)||[]},e.prototype.bindEvents=function(){t.each(this.getUIEventsCollection(),function(e){this.uiEvents=e,n.prototype.bindEvents.apply(this,arguments)},this)},e.prototype.addUIProperties=function(e){this.uiProperties=this.uiProperties||{};var i=this.uiProperties;t.each(e,function(e,n){if(i.hasOwnProperty(n))t.extend(i[n],e);else i[n]=e})},e.prototype.getUIProperties=function(){return this.uiProperties||{}},e.prototype.getTemplateName=function(){var e=n.prototype.getTemplateName.apply(this,arguments);if(this.model&&this.model.get("isChildAction"))e+="Main";return e},e.prototype.waitConfirm=function(){var e=this.confirm.apply(this,arguments),t=require("er/Deferred"),i=new t;return e.on("ok",i.resolver.resolve),e.on("cancel",i.resolver.reject),i.promise},e.prototype.waitActionDialog=function(){var e=this.popActionDialog.apply(this,arguments),t=require("er/Deferred"),i=new t;return e.on("actionloaded",i.resolver.resolve),e.on("actionloadfail",i.resolver.reject),e.on("actionloadabort",i.resolver.reject),i.promise},e}),define("ub-ria/mvc/checker/enumChecker",["require"],function(){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].datasource,n=i.fromValue(e);return!!n}var t={name:"enum",errorMessage:"${title}的值不合法",priority:20,check:e};return t}),define("ub-ria/mvc/checker/maxChecker",["require"],function(){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].max;return i>=e}var t={name:"max",errorMessage:"${title}不能大于${max}",priority:20,check:e};return t}),define("ub-ria/mvc/checker/maxLengthChecker",["require"],function(){function e(e,t){var i=t[2].maxLength;return!(e&&0!==e.length&&e.length>i)}var t={name:"maxLength",errorMessage:{array:"${title}不能超过${maxLength}个",string:"${title}不能超过${maxLength}个字符"},priority:20,check:e};return t}),define("ub-ria/mvc/checker/minChecker",["require"],function(){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].min;return e>=i}var t={name:"min",errorMessage:"${title}不能小于${min}",priority:20,check:e};return t}),define("ub-ria/mvc/checker/minLengthChecker",["require"],function(){function e(e,t){var i=t[2].minLength;return!(e&&0!==e.length&&e.length<i)}var t={name:"minLength",errorMessage:{array:"${title}不能小于${minLength}个",string:"${title}不能小于${minLength}个字符"},priority:20,check:e};return t}),define("ub-ria/mvc/checker/patternChecker",["require"],function(){function e(e,t){if(!e&&0!==e)return!0;var i=new RegExp(t[2].pattern);return i.test(e)}var t={name:"pattern",errorMessage:"${title}格式不符合要求",priority:30,check:e};return t}),define("ub-ria/mvc/checker/rangeChecker",["require"],function(){function e(e,t){if(!e&&0!==e)return!0;var i=t[2].min,n=t[2].max;if(i>n){var r=n;n=i,i=r}return e>=i&&n>=e}var t={name:"range",errorMessage:"${title}必须是≥${min}且≤${max}的数字",priority:20,check:e};return t}),define("ub-ria/mvc/checker/rangeLengthChecker",["require"],function(){function e(e,t){var i=t[2].minLength,n=t[2].maxLength;if(i>n){var r=n;n=i,i=r}return!e||0===e.length||e.length>=i&&e.length<=n}var t={name:"rangeLength",errorMessage:{array:"${title}不能小于${minLength}个，且不能超过${maxLength}个",string:"${title}不能小于${minLength}个字符，且不能超过${maxLength}个字符"},priority:20,check:e};return t}),define("ub-ria/mvc/checker/requiredChecker",["require","underscore"],function(require){function e(e){return!t.isEmpty(e)||t.isNumber(e)||t.isBoolean(e)}var t=require("underscore"),i={name:"required",errorMessage:"${title}不能为空",priority:1,check:e};return i}),define("ub-ria/mvc/checker/typeChecker",["require","underscore"],function(require){function e(e,i){var n=i[0],r={Undefined:!0,Null:!0,Array:["array"],String:["string"],Number:["number","enum"],Boolean:["bool"],Object:["object"]},a="";if(null===e)a="Null";else if(void 0===e)a="Undefined";else a=Object.prototype.toString.call(e),a=a.substring(8,a.length-1);return r[a]===!0||t.indexOf(r[a],n)>=0}var t=require("underscore"),i={name:"type",errorMessage:"${title}的类型不符合要求",priority:10,check:e};return i}),define("ub-ria/mvc/DetailAction",["require","underscore","../util","er/URL","./BaseAction","eoo"],function(require){function e(e){var t=this.context.url,i=t.getPath();return e=require("../util").purify(e),require("er/URL").withQuery(i,e).toString()}function t(e,t){e.preventDefault();var i={id:this.model.get("id")},r=this.view.getListQuery();if(!t)r.page=1;n.each(r,function(e,t){i["list."+t]=e}),this.reloadWithQueryUpdate(i)}function i(e){t.call(this,e,!0)}var n=require("underscore"),exports={};exports.category="detail",exports.reloadWithQueryUpdate=function(t){var i=e.call(this,t);this.redirect(i,{force:!0})},exports.initBehavior=function(){this.$super(arguments),this.view.on("listrefresh",t,this),this.view.on("pagechange",i,this)};var r=require("./BaseAction"),a=require("eoo").create(r,exports);return a}),define("ub-ria/mvc/SingleEntityModel",["require","underscore","er/util","./BaseModel"],function(require){function e(e){return this.fill(e),e}function t(){r.apply(this,arguments),this.putDatasource(a)}var i=require("underscore"),n=require("er/util"),r=require("./BaseModel"),a={entity:function(t){var n=t.get("id");if(n){var r=t.get("entity");if(r)return e.call(t,r);else return t.findById(n).then(i.bind(e,t))}else return{}}};return n.inherits(t,r),t.prototype.findById=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.findById)throw new Error("No findById method implemented on default data object");return t.findById(e)},t}),define("ub-ria/mvc/DetailModel",["require","underscore","er/URL","./SingleEntityModel","eoo"],function(require){function e(){var e=this.getListActionURL();this.set("listActionURL",e)}var t=require("underscore"),exports={};exports.getListActionURL=function(){var e=this.get("url").getQuery(),i={};if(t.each(e,function(e,t){if(0===t.indexOf("list."))i[t.substring(5)]=e}),e.id)i[this.entityName+"Id"]=e.id;var n=require("er/URL"),r=n.withQuery("/"+this.getListActionName()+"/list",i);return r+""},exports.getListActionName=function(){return this.entityName},exports.getTreeNodeEntityName=function(){return this.entityName},exports.load=function(){var i=this.$super(arguments);return i.then(t.bind(e,this))};var i=require("./SingleEntityModel"),n=require("eoo").create(i,exports);return n}),define("ub-ria/mvc/DetailView",["require","mini-event","./BaseView","eoo"],function(require){var exports={};exports.bindEvents=function(){var e=require("mini-event").delegate,t=this.getSafely("detail-list");e(t,"action@search",this,"listrefresh",{preserveData:!0,syncState:!0}),e(t,"action@pagechange",this,"pagechange",{preserveData:!0,syncState:!0}),e(t,"action@statusupdate",this,"listrefresh",{preserveData:!0,syncState:!0}),e(t,"action@pagesizechange",this,"listrefresh",{preserveData:!0,syncState:!0}),e(t,"action@tablesort",this,"listrefresh",{preserveData:!0,syncState:!0}),this.$super(arguments)},exports.getListQuery=function(){var e=this.getSafely("detail-list").get("action");if(e)return e.getSearchQuery();else return{}};var e=require("./BaseView"),t=require("eoo").create(e,exports);return t}),define("ub-ria/mvc/EntityValidator",["require","../util","underscore","./checker/requiredChecker","./checker/typeChecker","./checker/rangeLengthChecker","./checker/maxLengthChecker","./checker/minLengthChecker","./checker/rangeChecker","./checker/maxChecker","./checker/minChecker","./checker/enumChecker","./checker/patternChecker"],function(require){function e(){this.initCheckers()}function t(e,i,n,r){for(var a in e)if("id"!==a){var o=i[a],s=e[a],h=this.getFieldCheckers(s),u=r.length>0?r.join(".")+"."+a:a,c={value:o,fieldPath:u,fieldSchema:s},d=this.excuteCheckers(h,c);if(!d)if(!l.isEmpty(o)){if("object"===s[0])r.push(a),t.call(this,s[2].content,i[a],n,r),r.pop();else if("array"===s[0]){r.push(a);for(var f=0;f<o.length;f++){var p={};p[f]=s[2].item,t.call(this,p,o,n,r)}r.pop()}}else;else n.push(d)}else;}function i(e,t){for(var i={},n=/\$\{(.+?)\}/g,r=n.exec(e),a=t[2]||{};r;){var o=r[1];if(i[o]=a[o],!i[o])i[o]=t[1];r=n.exec(e)}return l.template(e,i,{interpolate:n})}function n(e){var t=e[2];if(!t)return e;for(var i=["maxLength","minLength","min","max","pattern"],n=l.keys(t),a=l.intersection(i,n),o=0;o<a.length;o++){var s=a[o],h=t[s];if(l.isString(h)){var u=h.split(".");u=u.slice(1);var c=this.rule[u[0]];c=u.length>1?r(c,u.slice(1)):c,t[s]=c}else;}return e}function r(e,t){for(var i=e,n=0;n<t.length;n++)i=i[t[n]];return i}function a(e){var t=["content","item","datasource"],i=[],n=e[0],r=e[2]||{};if(r=l.omit(r,t),r.required===!1)delete r.required;if([].push.apply(i,l.keys(r)),"reference"!==n&&"reference-set"!==n)i.push("type");return i=o(i,"rangeLength","minLength","maxLength"),i=o(i,"range","min","max")}function o(e,t,i,n){if(l.indexOf(e,i)>=0&&l.indexOf(e,n)>=0)e=l.without(e,i,n),e.push(t);return e}var s=require("../util"),l=require("underscore"),h={required:require("./checker/requiredChecker"),type:require("./checker/typeChecker"),rangeLength:require("./checker/rangeLengthChecker"),maxLength:require("./checker/maxLengthChecker"),minLength:require("./checker/minLengthChecker"),range:require("./checker/rangeChecker"),max:require("./checker/maxChecker"),min:require("./checker/minChecker"),"enum":require("./checker/enumChecker"),pattern:require("./checker/patternChecker")};return e.prototype.initCheckers=function(){this.checkers=s.deepClone(h)},e.prototype.setErrorMessages=function(e){if(e){var t=this.getCheckers();l.each(e,function(e,i){var n=t[i];if(n)n.errorMessage=e})}},e.prototype.addChecker=function(e){if(e&&e.name&&e.errorMessage&&e.check&&e.priority){var t=this.getCheckers();return t[e.name]=e,this.checkers[e.name]}return null},e.prototype.removeChecker=function(e){var t=this.getCheckers();return delete t[e]},e.prototype.getCheckers=function(){return this.checkers||{}},e.prototype.setSchema=function(e){this.schema=e},e.prototype.getSchema=function(){return this.schema},e.prototype.setRule=function(e){this.rule=e},e.prototype.getRule=function(){return this.rule},e.prototype.validate=function(e){var i=this.getSchema(),n=[],r=[];return t.call(this,i,e,n,r),n},e.prototype.excuteCheckers=function(e,t){var r=t.value,a=t.fieldPath,o=s.deepClone(t.fieldSchema);o=n.call(this,o);for(var h=0;h<e.length;h++){var u=e[h],c=u.check(r,o);if(!c){var d=u.errorMessage;if("object"==typeof d)d=d[o[0]];if(!l.isString(d))throw new Error("未找到对应错误信息模板");var f=i(d,o),p={field:a,message:f};return p}}return null},e.prototype.getFieldCheckers=function(e){for(var t=a(e),i=this.getCheckers(),n=[],r=0;r<t.length;r++)if(i[t[r]])n.push(i[t[r]]);return n.sort(function(e,t){return e.priority-t.priority}),n},e}),define("ub-ria/mvc/filterHelper",["require","underscore"],function(require){var e=require("underscore"),t={},i=t.select={};return i.getText=function(t){var i=e.find(t.datasource,function(e){return e.value==t.value});return i&&i.text||""},t}),define("ub-ria/mvc/FormModel",["require","er/util","./SingleEntityModel","er/Deferred"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("./SingleEntityModel"),n=require("er/Deferred");return t.inherits(e,i),e.prototype.fillEntity=function(e){return e},e.prototype.setValidator=function(e){if(e)e.setRule(this.get("rule"));this.validator=e},e.prototype.getValidator=function(){return this.validator},e.prototype.validateEntity=function(e){var t=this.getValidator();if(!t)throw new Error("No validator object attached to this Model");return t.validate(e)},e.prototype.save=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.save)throw new Error("No save method implemented on default data object");e=this.fillEntity(e);var i=this.validateEntity(e);if(i.length>0)return n.rejected({fields:i});else return t.save(e)},e.prototype.update=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.update)throw new Error("No update method implemented on default data object");e=this.fillEntity(e),e.id=this.get("id");var i=this.validateEntity(e);if(i.length>0)return n.rejected({fields:i});else return t.update(e)},e}),define("ub-ria/mvc/FormAction",["require","er/util","underscore","er/Deferred","./BaseAction","./FormModel","er/events"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=this.handleSubmitError(e);if(!t)require("er/events").notifyError(e.responseText)}function i(){var e=this.fire("submitcancel"),t=this.fire("handlefinish");if(!e.isDefaultPrevented()&&!t.isDefaultPrevented())this.redirectAfterCancel()}function n(){var e=this.view.getEntity();this.view.disableSubmit(),require("er/Deferred").when(this.submitEntity(e)).ensure(a.bind(this.view.enableSubmit,this.view))}var r=require("er/util"),a=require("underscore"),o=require("er/Deferred"),s=require("./BaseAction");return r.inherits(e,s),e.prototype.modelType=require("./FormModel"),e.prototype.category="form",e.prototype.handleSubmitError=function(e){if(409===e.status)e=r.parseJSON(e.responseText);if(e.fields)return this.view.notifyErrors(e),!0;else return!1},e.prototype.handleSubmitResult=function(e){var t=this.fire("entitysave",{entity:e});if(!t.isDefaultPrevented()){var i=this.getSubmitHandler();if(i)i.handle(e,this)}this.fire("handlefinish")},e.prototype.getSubmitHandler=function(){return this.submitHandler},e.prototype.setSubmitHandler=function(e){this.submitHandler=e},e.prototype.getMethod=function(e){var t={create:"save",update:"update",copy:"save"};return t[e]||null},e.prototype.submitEntity=function(e){var i=this.getMethod(this.context.formType);try{if(i)return this.model[i](e).then(a.bind(this.handleSubmitResult,this),a.bind(t,this));else throw new Error("Cannot find formType in methodMap")}catch(n){return o.rejected(n)}},e.prototype.cancelConfirmTitle="确认取消编辑",e.prototype.getCancelConfirmTitle=function(){return this.cancelConfirmTitle},e.prototype.cancelConfirmMessage="取消编辑将不保留已经填写的数据，确定继续吗？",e.prototype.getCancelConfirmMessage=function(){return this.cancelConfirmMessage},e.prototype.cancelEdit=function(){var e=this.model.get("initialFormData");if(this.isFormDataChanged(e)){var t={title:this.getCancelConfirmTitle(),content:this.getCancelConfirmMessage()};this.view.waitCancelConfirm(t).then(a.bind(i,this))}else i.call(this)},e.prototype.redirectAfterCancel=function(){this.back("/"+this.getEntityName()+"/list")},e.prototype.isFormDataChanged=function(){return!1},e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments);var e=this.view.getFormData();this.model.set("initialFormData",e,{silent:!0}),this.view.on("submit",n,this),this.view.on("cancel",this.cancelEdit,this)},e}),define("ub-ria/mvc/FormView",["require","er/util","./BaseView","esui/validator/Validity","esui/validator/ValidityState"],function(require){function e(){r.apply(this,arguments);var e={"form:submit":i,"cancel:click":t};this.addUIEvents(e)}function t(){this.fire("cancel")}function i(){this.fire("submit")}var n=require("er/util"),r=require("./BaseView");return n.inherits(e,r),e.prototype.getEntity=function(){return this.getFormData()},e.prototype.notifyErrors=function(e){for(var t=require("esui/validator/Validity"),i=require("esui/validator/ValidityState"),n=this.get("form"),r=0;r<e.fields.length;r++){var a=e.fields[r],o=new i(!1,a.message),s=new t;s.addState("server",o);var l=n.getInputControls(a.field)[0];if(l&&"function"==typeof l.showValidity)l.showValidity(s)}},e.prototype.waitCancelConfirm=function(e){this.waitConfirm(e)},e.prototype.disableSubmit=function(){if(this.viewContext)this.getGroup("submit").disable()},e.prototype.enableSubmit=function(){if(this.viewContext)this.getGroup("submit").enable()},e.prototype.getFormData=function(){var e=this.get("form");return e?e.getData():{}},e}),define("ub-ria/mvc/handler/SubmitHandler",["require","eoo"],function(require){var exports={};exports.nextSubmitHandler=null,exports.setNextSubmitHandler=function(e){this.nextSubmitHandler=e},exports.getNextSubmitHandler=function(){return this.nextSubmitHandler},exports.handle=function(e,t){this.next(e,t)},exports.next=function(e,t){var i=this.getNextSubmitHandler();if(i)i.handle(e,t)};var e=require("eoo").create(exports);return e}),define("ub-ria/mvc/handler/RedirectSubmitHandler",["require","underscore","./SubmitHandler","eoo"],function(require){var e=require("underscore"),t=require("./SubmitHandler"),exports={};exports.template="/${entityName}/list",exports.redirectOptions=null,exports.setTemplate=function(e){this.template=e},exports.getTemplate=function(){return this.template},exports.setRedirectOptions=function(e){this.redirectOptions=e},exports.getRedirectOptions=function(){return this.redirectOptions},exports.handle=function(t,i){var n=this.getData(t,i),r=e.template(this.getTemplate(),n);this.redirect(i,r,this.getRedirectOptions()),this.next(t,i)},exports.redirect=function(e,t,i){e.redirect(t,i)},exports.getData=function(e,t){return{entityName:t.getEntityName()}};var i=require("eoo").create(t,exports);return i}),define("ub-ria/mvc/handler/ToastSubmitHandler",["require","underscore","esui/Toast","./SubmitHandler","eoo"],function(require){var e=require("underscore"),t=require("esui/Toast"),i=require("./SubmitHandler"),exports={};exports.template="",exports.setTemplate=function(e){this.template=e},exports.getTemplate=function(){return this.template},exports.handle=function(e,i){var n=this.getToastMessage(e,i);if(n){var r=t.success(n);r.show()}this.next(e,i)},exports.getToastMessage=function(t,i){var n=this.getTemplate();if(null==n)return"";if(n)return e.template(n,t||{});else{var r="update"===i.context.formType?"修改":"创建";return"您"+r+"的"+i.getEntityDescription()+"[<strong>"+e.escape(t.name)+"</strong>]已经成功保存"}};var n=require("eoo").create(i,exports);return n}),define("ub-ria/mvc/ListAction",["require","./BaseAction","er/util","underscore","er/URL","../util"],function(require){function e(){c.apply(this,arguments)}function t(){this.performSearch()}function i(e){this.model.updatePageSize(e.pageSize).then(f.bind(n,this,e.pageSize))}function n(){var e=this.fire("pagesizechange");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}}function r(){var e=this.fire("pagechange");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();this.reloadWithQueryUpdate(t)}}function a(){var e=this.fire("tablesort");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}}function o(e){var t=this.view.getSelectedItems();this.modifyStatus(t,e.status)}function s(e){this.model[e.statusName](e.ids).then(f.bind(h,this,e),f.bind(this.notifyModifyFail,this,e))}function l(e,t){var i={title:e.command+this.getEntityDescription(),content:t.message};return this.view.waitConfirm(i)}function h(e){this.notifyModifySuccess(e);var t=this.fire("statusupdate",e);if(!t.isDefaultPrevented())this.reload()}function u(e){var t=this.context.url,i=t.getPath(),n=this.model.getDefaultArgs();return e=require("../util").purify(e,n),require("er/URL").withQuery(i,e).toString()}var c=require("./BaseAction"),d=require("er/util"),f=require("underscore"),p=require("er/URL");return d.inherits(e,c),e.prototype.modelType="./ListModel",e.prototype.category="list",e.prototype.performSearch=function(){var e=this.fire("search");if(!e.isDefaultPrevented()){var t=this.getSearchQuery();t.page=1,this.reloadWithQueryUpdate(t)}},e.prototype.redirectForSearch=function(e){var t=this.model.get("url").getPath(),i=p.withQuery(t,e);this.redirect(i,{force:!0})},e.prototype.getURLForPage=function(e){var t=this.context.url,i=t.getPath(),n=t.getQuery();if(1===e)n=f.omit(n,"page");else n.page=e;return require("er/URL").withQuery(i,n).toString()},e.prototype.getSearchQuery=function(){var e=this.view.getSearchArgs();return e.page=this.view.getPageIndex(),e},e.prototype.reloadWithQueryUpdate=function(e){var t=u.call(this,e);this.redirect(t,{force:!0})},e.prototype.modifyStatus=function(e,t){var i=f.pluck(e,"id"),n=f.findWhere(this.model.getStatusTransitions(),{status:t}),r={ids:i,items:e,status:t,statusName:n.statusName,command:n.command};if(this.requireAdviceFor(r)){var a=require("../util").pascalize(r.statusName),o="get"+a+"Advice";this.model[o](r.ids,r.items).then(f.bind(l,this,r)).then(f.bind(s,this,r))}else s.call(this,r)},e.prototype.notifyModifySuccess=function(){},e.prototype.notifyModifyFail=function(e){var t=this.getEntityDescription();if(e.ids.length>1)this.view.alert("无法"+e.command+"部分或全部"+t,e.command+t);else this.view.alert("无法"+e.command+"该"+t,e.command+t)},e.prototype.requireAdviceFor=function(e){return"remove"===e.statusName},e.prototype.initBehavior=function(){c.prototype.initBehavior.apply(this,arguments),this.view.on("search",t,this),this.view.on("pagesizechange",i,this),this.view.on("batchmodify",o,this),this.view.on("pagechange",r,this),this.view.on("tablesort",a,this)},e.prototype.adjustLayout=function(){this.view.adjustLayout()},e}),define("ub-ria/mvc/ListModel",["require","./BaseModel","er/util","underscore","../util","er/URL","er/Deferred"],function(require){function e(){n.apply(this,arguments),a.each(this.getDefaultArgs(),function(e,t){if(!this.has(t))this.set(t,e)},this),this.putDatasource(o,0),this.putDatasource(s,0),this.putDatasource(l,1)}function t(){var e=this.get("canBatchModify");this.set("selectMode",e?"multi":"")}function i(e,t){var i=a.findWhere(this.getStatusTransitions(),{status:e});if(i.accept){var n=a.difference(i.accept,i.deny||[]);return a.contains(n,t.status)}else if(i.deny)return!a.contains(i.deny,t.status);else return!0}var n=require("./BaseModel"),r=require("er/util"),a=require("underscore"),o={list:{retrieve:function(e){var t=e.getQuery();return t=require("../util").purify(t,null,!0),e.search(t)},dump:!0}},s={listWithoutKeywordURL:function(e){var t=e.get("url"),i=t.getPath(),n=t.getQuery();n=a.omit(n,"keyword");var r="#"+require("er/URL").withQuery(i,n);return r}},l={hasResult:function(e){return e.get("results").length||!a.isEmpty(e.get("url").getQuery())}};return r.inherits(e,n),e.prototype.statusTransitions=[{status:0,deny:[0],statusName:"remove",command:"删除"},{status:1,deny:[1],statusName:"restore",command:"启用"}],e.prototype.getStatusTransitions=function(){return this.statusTransitions},e.prototype.defaultStatusValue=1,e.prototype.getDefaultStatusValue=function(){return this.defaultStatusValue||""},e.prototype.defaultArgs={},e.prototype.getDefaultArgs=function(){var e=this.defaultArgs||{},t=this.getDefaultStatusValue();if(!e.hasOwnProperty("status")&&t)e.status=t;return e},e.prototype.load=function(){return n.prototype.load.apply(this,arguments).then(a.bind(t,this))},e.prototype.prepare=function(){this.set("filtersInfo",this.getFiltersInfo())},e.prototype.getQuery=function(){var e={keyword:this.get("keyword"),status:this.get("status"),order:this.get("order"),orderBy:this.get("orderBy"),pageNo:this.get("page")||1};if(!e.status)e.status=this.getDefaultStatusValue();else if("all"===e.status)e.status="";return e},e.prototype.canUpdateToStatus=function(e,t){return a.any(e,a.bind(i,this,t))},e.prototype.updatePageSize=function(e){var t=this.data("global");if(!t)throw new Error("No global data object attached to this Model");if("function"!=typeof t.updatePageSize)throw new Error("No updatePageSize method implemented on global data object");return t.updatePageSize(e)},e.prototype.getAllItems=function(){return this.get("results")},e.prototype.getItemById=function(e){var t=this.getAllItems();return t?a.findWhere(t,{id:e}):null},e.prototype.indexOf=function(e){var t=this.getAllItems();if(!t)return-1;if("object"==typeof e)return a.indexOf(t,e);else{for(var i=0;i<t.length;i++)if(t[i].id===e)return i;return-1}},e.prototype.search=function(e){var t=this.data();if(!t)throw new Error("No default data object attached to this Model");if("function"!=typeof t.search)throw new Error("No search method implemented on default data object");return t.search(e||{})},e.prototype.updateStatus=function(e,t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.updateStatus)throw new Error("No updateStatus method implemented on default data object");return i.updateStatus(e,t)},e.prototype.remove=a.partial(e.prototype.updateStatus,0),e.prototype.restore=a.partial(e.prototype.updateStatus,1),e.prototype.getAdvice=function(e,t){var i=this.data();if(!i)throw new Error("No default data object attached to this Model");if("function"!=typeof i.getAdvice)throw new Error("No getAdvice method implemented on default data object");return i.getAdvice(e,t)},e.prototype.getRemoveAdvice=function(e){var t=require("er/Deferred"),i=e.length,n=this.get("entityDescription"),r="您确定要删除已选择的"+i+"个"+n+"吗？";if(1>=i)r="您确定要删除该"+n+"吗？";var a={message:r};return t.resolved(a)},e.prototype.getRestoreAdvice=a.partial(e.prototype.getAdvice,1),e.prototype.getFilters=function(){return{}},e.prototype.getFiltersInfo=function(){var e=!0,t=this.getDefaultArgs(),i={};return a.each(this.getFilters(),function(n,r){var o={text:"function"==typeof n.text?n.text(n):n.text,defaultValue:t[r],name:r};if(a.defaults(o,n),o.isDefaultValue=o.hasOwnProperty("isDefaultValue")?o.isDefaultValue:o.defaultValue==o.value,!o.isDefaultValue)e=!1;i[r]=o},this),{filters:i,isAllFiltersDefault:e}},e}),define("ub-ria/mvc/ListView",["require","./BaseView","er/util","underscore","../util"],function(require){function e(){c.apply(this,arguments);var e={pager:{pagesizechange:i,pagechange:n},table:{select:"updateBatchButtonStatus",sort:t},"filter:submit":"submitSearch","filter-switch:click":a,"filter-cancel:click":l,"filter-modify:click":h};this.addUIEvents(e);var r={table:{fields:this.getTableFields()}};this.addUIProperties(r)}function t(e){var t={order:e.order,orderBy:e.field.field};this.sortTable(t)}function i(e){var t=e.target.get("pageSize");this.updatePageSize(t)}function n(){this.updatePageIndex()}function r(e){var t={status:+e.target.getData("status")};this.fire("batchmodify",t)}function a(){var e=this.getSafely("filter");e.isHidden()?o.call(this):l.call(this)}function o(){this.getSafely("filter").show(),this.getSafely("filter-switch").addState("expand")}function s(){this.getSafely("filter").hide(),this.getSafely("filter-switch").removeState("expand")}function l(){if(this.model.get("filtersInfo").isAllFiltersDefault)s.call(this);else this.submitSearchWithoutKey()}function h(){this.getGroup("filter-content").toggle()}function u(e){var t=this.model.defaultArgs[e]||"";this.get(e).setValue(t)}var c=require("./BaseView"),d=require("er/util"),f=require("underscore");return d.inherits(e,c),e.prototype.submitSearch=function(){this.fire("search")},e.prototype.sortTable=function(e){this.fire("tablesort",{tableProperties:e})},e.prototype.updateBatchButtonStatus=function(){var e=this.getSelectedItems();f.each(this.getGroup("batch"),function(t){var i=+t.getData("status"),n=f.isEmpty(e)||!this.model.canUpdateToStatus(e,i);t.set("disabled",n)},this)},e.prototype.updateFilterPanelStatus=function(){if(!this.model.get("filtersInfo").isAllFiltersDefault)o.call(this),h.call(this)},e.prototype.updateSearchBoxStatus=function(){if(this.model.get("keyword"))this.getSafely("keyword").addState("clear")},e.prototype.getSelectedItems=function(){var e=this.get("table");return e?e.getSelectedItems():[]},e.prototype.getSearchArgs=function(){var e=this.get("filter"),t=e?e.getData():{};t.order=this.get("table").order,t.orderBy=this.get("table").orderBy;var i=this.get("keyword");if(i)t.keyword=require("../util").trim(i.getValue());return t},e.prototype.tableFields=[],e.prototype.getTableFields=function(){return this.tableFields},e.prototype.getPageIndex=function(){return this.get("pager").get("page")},e.prototype.updatePageSize=function(e){this.fire("pagesizechange",{pageSize:e})},e.prototype.updatePageIndex=function(){this.fire("pagechange")},e.prototype.bindEvents=function(){this.getGroup("batch").each(function(e){e.on("click",r,this)},this),this.getGroup("clear-button").each(function(e){var t=e.get("name");e.on("click",function(){this.submitSearchWithoutKey(t)},this)},this),c.prototype.bindEvents.apply(this,arguments)},e.prototype.submitSearchWithoutKey=function(e){if(e)u.call(this,e);else{var t=this;this.getGroup("clear-button").each(function(e){var i=e.get("name");u.call(t,i)})}this.fire("search")},e.prototype.enterDocument=function(){c.prototype.enterDocument.apply(this,arguments),this.updateBatchButtonStatus(),this.updateFilterPanelStatus(),this.updateSearchBoxStatus()},e.prototype.adjustLayout=function(){var e=this.get("table");if(e)e.adjustWidth()},e}),define("ub-ria/mvc/ReadAction",["require","er/util","./BaseAction"],function(require){function e(){n.apply(this,arguments)}function t(){this.back("/"+this.getEntityName()+"/list")}var i=require("er/util"),n=require("./BaseAction");return i.inherits(e,n),e.prototype.category="read",e.prototype.initBehavior=function(){this.view.on("return",t,this)},e}),define("ub-ria/mvc/ReadModel",["require","er/util","./SingleEntityModel"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("./SingleEntityModel");t.inherits(e,i);var n={url:!0,referrer:!0,isChildAction:!0,container:!0,entity:!0};return e.prototype.defaultDisplayText="--",e.prototype.get=function(e){var t=i.prototype.get.call(this,e);if(n.hasOwnProperty(e))return t;else return this.hasReadableValue(e)?t:this.defaultDisplayText},e}),define("ub-ria/mvc/ReadView",["require","er/util","./BaseView","mini-event"],function(require){function e(){i.apply(this,arguments)}var t=require("er/util"),i=require("./BaseView");return t.inherits(e,i),e.prototype.bindEvents=function(){i.prototype.bindEvents.apply(this,arguments);var e=this.get("return");if(e){var t=require("mini-event").delegate;t(e,"click",this,"return")}},e}),define("ub-ria/mvc/RequestManager",["require","underscore","er/util","er/ajax"],function(require){function e(e,t){this.entityName=e,this.backendEntityName=t,this.runningRequests={}}function t(e,t){if(!t)return null;var i=r.findWhere(o,{type:e.constructor});return i&&i.config[t]||s[t]||null}function i(e,t,i){var n=e.runningRequests[t.name];if(n){var a=t.policy;if("auto"===a){var o=i.method.toUpperCase();a=r.isEqual(i,n.options)?"reuse":"GET"===o||"PUT"===o?"parallel":"abort"}switch(a){case"reuse":return n.xhr;case"abort":return void n.xhr.abort();default:return}}}function n(e,t,i){if(e.runningRequests&&e.runningRequests[t]&&e.runningRequests[t].xhr===i)e.runningRequests[t]=null;if(l&&l[t]&&l[t].xhr===i)l[t]=null}var r=require("underscore"),a=require("er/util"),o=[],s={},l={};
e.register=function(e,t,i){var n={name:t,scope:"instance",policy:"auto"};if(i=a.mix(n,i),"instance"===i.scope){var l=r.findWhere(o,{type:e});if(!l)l={type:e,config:{}},o.push(l);var h=l.config;if(h.hasOwnProperty(t))throw new Error('An instance request config "'+t+'" has already been registered');h[t]=i}else{if(s.hasOwnProperty(t))throw new Error('A global request config "'+t+'" has already been registered');s[t]=i}},e.prototype.getEntityName=function(){return this.entityName||""},e.prototype.getBackendEntityName=function(){return this.backendEntityName||this.getEntityName()},e.prototype.setRequestStrategy=function(e){this.requestStrategy=e},e.prototype.getRequestStrategy=function(){return this.requestStrategy},e.prototype.getRequest=function(e,i,n){var r=this.getRequestStrategy();if("string"!=typeof e)n=e,e=null;e=r.formatName(e,n);var o=t(this,e);if(n=a.mix({},o&&o.options,n),"function"==typeof i)i=i(this,n);if("function"==typeof n.data)n.data=n.data(this,n);if(i)n.data=a.mix({},n.data,i);n=r.formatOptions(n);var s={name:e,options:n,config:o};if(s.options.url)s.options.url=r.formatURL(s.options.url,s.options);return s};var h=require("er/ajax");return e.prototype.request=function(e,t,a){var o=this.getRequest(e,t,a);if(!o.config)return h.request(o.options);var s=i(this,o.config,o.options);if(!s)if(s=h.request(o.options),e){var u="instance"===o.config.scope?this.runningRequests:l;u[e]={options:o.options,xhr:s};var c=r.partial(n,this,o.name,s);s.ensure(c)}return s},e.prototype.dispose=function(){r.each(this.runningRequests,function(e){e&&e.xhr.abort()}),this.runningRequests=null},e.prototype.search=function(){throw new Error("search method is not implemented")},e.prototype.list=function(){throw new Error("list method is not implemented")},e.prototype.save=function(){throw new Error("save method is not implemented")},e.prototype.update=function(){throw new Error("update method is not implemented")},e.prototype.updateStatus=function(){throw new Error("updateStatus method is not implemented")},e.prototype.remove=r.partial(e.prototype.updateStatus,0),e.prototype.restore=r.partial(e.prototype.updateStatus,1),e.prototype.getAdvice=function(){throw new Error("getAdvice method is not implemented")},e.prototype.getRemoveAdvice=r.partial(e.prototype.getAdvice,0),e.prototype.getRestoreAdvice=r.partial(e.prototype.getAdvice,1),e.prototype.findById=function(){throw new Error("findById method is not implemented")},e}),define("ub-ria/mvc/RequestStrategy",["require"],function(){function e(){}return e.prototype.formatName=function(e){return e},e.prototype.formatURL=function(e){return e},e.prototype.formatOptions=function(e){if(!e.dataType)e.dataType="json";return e},e}),define("ub-ria/mvc/rule",["require"],function(){return{maxLength:100,mail:{maxLength:64,pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/},description:{maxLength:4e3},phone:{pattern:/^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$/},mobile:{pattern:/^(1(3|4|5|8)\d{9})?$/},url:{maxLength:1e3,pattern:/^(?:https?|ftp|wap):\/\/.+$|^(?!(?:https?|ftp|wap):\/\/).+$/},positiveInteger:{pattern:/^\d+$/},money:{pattern:/^\d+(\.\d{1,2})?$/}}}),define("ub-ria/tpl",["require","er/ajax","etpl","./util"],function(require){function e(e){for(var t=[],i={},n=/<\s*esui-([\w-]+)[^>]*>|data-ui-type="(\w+)"/g,r=n.exec(e);r;){var s=r[1]&&a.pascalize(r[1])||r[2];if(!i[s]){i[s]=!0;var l=(o[s]||"ui")+"/";t.push(l+s)}r=n.exec(e)}return t}function t(e){for(var t=[],i={},n=/data-ui-extension-[^-]+-type="(\w+)"/g,r=n.exec(e);r;){var a=r[1];if(!i[a]){i[a]=!0;var o=(s[a]||"ui/extension")+"/";t.push(o+a)}r=n.exec(e)}return t}var i=require("er/ajax"),n=require("etpl"),r=n,a=require("./util");r.addFilter("trim",a.trim),r.addFilter("pascalize",a.pascalize),r.addFilter("camelize",a.camelize),r.addFilter("dasherize",a.dasherize),r.addFilter("constlize",a.constlize),r.addFilter("pluralize",a.pluralize);var o={BoxGroup:"esui",Button:"esui",Calendar:"esui",CheckBox:"esui",CommandMenu:"esui",Crumb:"esui",Dialog:"esui",Form:"esui",Frame:"esui",Label:"esui",Link:"esui",MonthView:"esui",Pager:"esui",Panel:"esui",RangeCalendar:"esui",Region:"esui",RichCalendar:"esui",Schedule:"esui",SearchBox:"esui",Select:"esui",Tab:"esui",Table:"esui",TextBox:"esui",TextLine:"esui",Tip:"esui",TipLayer:"esui",Tree:"esui",Validity:"esui",Wizard:"esui",ActionPanel:"ef",ActionDialog:"ef",ViewPanel:"ef",TogglePanel:"ub-ria/ui",ToggleButton:"ub-ria/ui",Uploader:"ub-ria/ui",RichSelector:"ub-ria/ui",TableRichSelector:"ub-ria/ui",SelectorTreeStrategy:"ub-ria/ui",TreeRichSelector:"ub-ria/ui",AbstractBoxGroup:"ub-ria/ui",Sidebar:"ub-ria/ui",PartialForm:"ub-ria/ui"},s={AutoSort:"esui/extension",Command:"esui/extension",CustomData:"esui/extension",TableEdit:"esui/extension",AutoSubmit:"ub-ria/ui/extension",TableTip:"ub-ria/ui/extension",ExternSearch:"ub-ria/ui/extension",ExternSelect:"ub-ria/ui/extension",TableSubrow:"esui/extension",WordCount:"ub-ria/ui/extension"},l={setupTemplateEngine:function(e){r=e||n},load:function(n,a,o){function s(i){r.parse(i);var n=e(i),a=t(i),s=n.concat(a);window.require(s,function(){o(i)})}var l={method:"GET",url:a.toUrl(n),cache:!0,dataType:"text"};i.request(l).then(s)},registerControl:function(e){var t=e.lastIndexOf("/"),i=e.substring(0,t),n=e.substring(t+1);o[n]=i},registerExtension:function(e){var t=e.lastIndexOf("/"),i=e.substring(0,t),n=e.substring(t+1);s[n]=i}};return l}),define("ub-ria/ui/AbstractBoxGroup",["require","underscore","esui/lib","esui/InputControl","esui/painters","esui/main"],function(require){function e(){u.apply(this,arguments)}function t(e){return i(e,"value")}function i(e,t){return e.getAttribute("data-ui-"+t)}function n(e,t,i){e.setAttribute("data-ui-"+t,i)}function r(e){return"checked"===i(e,"checked")}function a(e,n){for(var a=e.children,o=[],s=[],l=n.boxType,h=0,u=a.length;u>h;h++){var c=a[h];if(i(c,"box-type")===l)o.push({value:t(c),text:c.innerHTML||i(c,"text")});if(r(c))s.push(c.value)}if(n.datasource=o,!n.rawValue&&!n.value)n.rawValue=s}function o(e){if(!this.disabled&&!this.readOnly){var i=e.target,n="radio"===this.boxType?[]:l.clone(this.rawValue),r=t(i);if(l.contains(n,r))n=l.without(n,r);else n.push(r);this.set("rawValue",n)}}function s(e,t,i){e.helper.clearDOMEvents();for(var n="",r=e.helper.getPartClasses("wrapper"),a=h.toDictionary(e.rawValue),s=0;s<t.length;s++){var u=t[s],d={wrapperClass:r.concat(e.helper.getPartClasses("wrapper-"+s)).join(" "),id:e.helper.getId("box-"+s),boxType:e.boxType,text:h.trim(u.text),value:u.value,checked:a[u.value]?' data-ui-checked="checked"':"",className:e.helper.getPartClasses(i).join(" ")};n+=h.format(c,d)}e.main.innerHTML=n,l.each(e.getBoxElements(),function(e){this.helper.addDOMEvent(e,"click",o)},e)}var l=require("underscore"),h=require("esui/lib"),u=require("esui/InputControl");e.prototype.type="AbstractBoxGroup",e.prototype.initOptions=function(e){var t={datasource:[],orientation:"horizontal",boxType:"radio"};if(l.extend(t,e),!t.datasource.length)a(this.main,t);if(!t.rawValue&&!t.value)t.rawValue=[];this.setProperties(t)};var c=['<div class="${wrapperClass}">','<div id="${id}" class="${className}" ${checked}','   data-ui-value="${value}" data-ui-box-type="${boxType}">',"${text}</div>","</div>"];return c=c.join(""),e.prototype.setProperties=function(e){if(!(!e.datasource&&!e.boxType||e.rawValue||e.value||this.rawValue&&this.rawValue.length))e.rawValue=[];var t=u.prototype.setProperties.apply(this,arguments);if(t.hasOwnProperty("rawValue"))this.fire("change")},e.prototype.repaint=require("esui/painters").createRepaint(u.prototype.repaint,{name:["datasource","boxType"],paint:s},{name:"rawValue",paint:function(e,i){i=i||[],e.rawValue=i;var a={};l.each(i,function(e){a[e]=!0}),l.each(e.getBoxElements(),function(i){n(i,"checked",a[t(i)]?"checked":"");var o=e.helper.getPartClasses("wrapper-checked")[0];if(r(i))h.addClass(i.parentNode,o);else h.removeClass(i.parentNode,o)})}},{name:"orientation",paint:function(e,t){e.removeState("vertical"),e.removeState("horizontal"),e.addState(t)}}),e.prototype.parseValue=function(e){return e.split(",")},e.prototype.getBoxElements=function(){var e=this.boxType;return l.filter(this.main.getElementsByTagName("div"),function(t){return i(t,"box-type")===e})},h.inherits(e,u),require("esui/main").register(e),e}),define("ub-ria/ui/extension/AutoSubmit",["require","underscore","esui/lib","esui","esui/Form","esui/Extension"],function(require){function e(e){if(e=e||{},"string"==typeof e.events)e.events=i.map(n.splitTokenList(e.events),n.trim);o.apply(this,arguments)}function t(){var e=this.resolveForm();if(e)e.validateAndSubmit()}var i=require("underscore"),n=require("esui/lib"),r=require("esui"),a=require("esui/Form"),o=require("esui/Extension");return e.prototype.type="AutoSubmit",e.prototype.form=null,e.prototype.events=["click","change","search"],e.prototype.resolveForm=function(){if(this.form)return this.target.viewContext.get(this.form);for(var e=this.target&&this.target.main&&this.target.main.parentNode;e;){var t=r.getControlByDOM(e);if(t&&t instanceof a)return t;e=e.parentNode}return null},e.prototype.activate=function(){i.each(this.events,function(e){this.target.on(e,t,this)},this),o.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){i.each(this.events,function(e){this.target.un(e,t,this)},this),o.prototype.inactivate.apply(this,arguments)},n.inherits(e,o),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/ExternSearch",["require","esui/lib","esui/Extension","esui"],function(require){function e(e){e=e||{},a.apply(this,arguments)}function t(){this.target.search()}function i(e){var t=this.resolveControl(),i={value:t.getValue()};if(t.dataKeys)i.keys=r.splitTokenList(t.dataKeys);e.filterData.push(i),e.preventDefault()}function n(){var e=this.resolveControl();e.set("text","")}var r=require("esui/lib"),a=require("esui/Extension");return e.prototype.type="ExternSearch",e.prototype.searchBox=null,e.prototype.resolveControl=function(){var e;if(!this.searchBox&&this.searchbox)this.searchBox=this.searchbox;if(this.searchBox){if(e=this.target.viewContext.get(this.searchBox),!e&&this.active)throw new Error('Cannot find related searchBox "#'+e+'" in view context')}else throw new Error("searchBox cannot be null");return e},e.prototype.activate=function(){var e=this.resolveControl();e.on("search",t,this),this.target.on("clearquery",n,this),this.target.on("search",i,this),a.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){a.prototype.inactivate.apply(this,arguments);var e=this.resolveControl();if(e)e.un("search",t,this);this.target.un("clearquery",n,this),this.target.un("search",i,this)},r.inherits(e,a),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/ExternSelect",["require","underscore","esui/lib","esui/Extension","esui"],function(require){function e(e){e=e||{},o.apply(this,arguments)}function t(){this.target.search()}function i(e){this.handleControls(function(t){var i=t.getSelectedItem();if(""!==i.value&&t.dataKey)e.filterData.push({keys:[t.dataKey],value:i.value})}),e.preventDefault()}function n(){this.handleControls(function(e){e.un("change",t,this),e.setProperties({selectedIndex:0}),e.on("change",t,this)})}var r=require("underscore"),a=require("esui/lib"),o=require("esui/Extension");return e.prototype.type="ExternSelect",e.prototype.selects=null,e.prototype.resolveControls=function(){var e=[];if(this.selects){var t;if(r.isString(this.selects))t=a.splitTokenList(this.selects);else t=this.selects;if(r.isArray(t))r.each(t,function(t){var t=this.target.viewContext.get(t);if(t)e.push(t);else if(this.active)throw new Error('Cannot find related select "#'+t+'" in view context')},this);else throw new Error("selects can only be Array or String")}else throw new Error("selects cannot be null");return e},e.prototype.activate=function(){this.handleControls(function(e){e.on("change",t,this)}),this.target.on("clearquery",n,this),this.target.on("search",i,this),o.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){o.prototype.inactivate.apply(this,arguments),this.handleControls(function(e){e.un("change",t,this)},!0),this.target.un("clearquery",n,this),this.target.un("search",i,this)},e.prototype.handleControls=function(e){var t=this.resolveControls();if(t.length)r.each(t,e,this)},a.inherits(e,o),require("esui").registerExtension(e),e}),define("ub-ria/ui/extension/TableTip",["require","esui/lib","esui","underscore","esui/Extension","esui/TipLayer"],function(require){function e(){a.apply(this,arguments)}function t(e){return o.exec(e.className)[1]}var i=require("esui/lib"),n=require("esui"),r=require("underscore"),a=require("esui/Extension");require("esui/TipLayer"),e.prototype.type="TableTip";var o=/table-operation-(\w+)/;return e.prototype.createAndAttachTip=function(e,t){var a={id:"table-operation-tip-"+r.escape(t),viewContext:this.target.viewContext,content:i.getText(e[0]),arrow:!0,skin:"table-tip"},o=n.create("TipLayer",a);o.appendTo(document.body),r.each(e,function(e){var t={targetDOM:e,showMode:"over",delayTime:200,positionOpt:{bottom:"bottom",left:"left"}};o.attachTo(t)})},e.prototype.initTips=function(){if(document.querySelectorAll){var e=document.querySelectorAll(".table-operation");r.chain(e).groupBy(t).each(r.bind(this.createAndAttachTip,this))}},e.prototype.activate=function(){a.prototype.activate.apply(this,arguments),this.target.on("afterrender",this.initTips,this)},e.prototype.inactivate=function(){this.target.un("afterrender",this.initTips,this),a.prototype.inactivate.apply(this,arguments)},i.inherits(e,a),n.registerExtension(e),e}),define("ub-ria/ui/extension/WordCount",["require","esui/lib","esui/validator/Validity","esui/Extension","esui"],function(require){function e(){r.apply(this,arguments)}function t(){var e=this.getMaxLength(),t=this.target.getValue().length,i={max:e,current:t,available:e-t},r=i.available<0?"error":"hint",a=this.getHintMessage(i),o=new n;o.setCustomValidState(r),o.setCustomMessage(a),this.target.showValidity(o)}var i=require("esui/lib"),n=require("esui/validator/Validity"),r=require("esui/Extension");return e.prototype.type="WordCount",e.prototype.initialTemplate="最多可输入${available}个字符",e.prototype.remainingTemplate="还可输入${available}个字符",e.prototype.exceededTemplate="已超出${available}个字符",e.prototype.getHintMessage=function(e){var t;if(!e.current)t=this.initialTemplate;else if(e.available>=0)t=this.remainingTemplate;else t=this.exceededTemplate,e.available=-e.available;return i.format(t,e)},e.prototype.getMaxLength=function(){if(-1===+this.target.get("maxLength"))return this.target.get("length");else return this.target.get("maxLength")},e.prototype.activate=function(){var e=this.getMaxLength();if(e)this.target.on("input",t,this),this.target.on("afterrender",t,this);r.prototype.activate.apply(this,arguments)},e.prototype.inactivate=function(){this.target.un("input",t,this),this.target.un("afterrender",t,this),r.prototype.inactivate.apply(this,arguments)},i.inherits(e,r),require("esui").registerExtension(e),e}),define("ub-ria/ui/PartialForm",["require","esui/lib","ef/ActionPanel","esui/Form","esui/validator/Validity","esui/validator/ValidityState","esui"],function(require){function e(){n.apply(this,arguments)}function t(e){var t=require("esui/Form"),n={main:i.g(e.view.container),viewContext:e.view.viewContext};return new t(n)}var i=require("esui/lib"),n=require("ef/ActionPanel");return e.prototype.type="PartialForm",e.prototype.validate=function(){var e=this.get("action");if(!e)return!0;if("function"==typeof e.validate)return e.validate();var i=e.view&&e.view.viewContext;if(!i)return!0;var n=require("esui/validator/Validity"),r=new n,a={validity:r};this.fire("beforevalidate",a);for(var o=t(e),s=o.getInputControls(),l=!0,h=0;h<s.length;h++){var u=s[h];if(!u.isDisabled())l&=u.validate();else;}if(!l)this.fire("invalid",a);return this.fire("aftervalidate",a),l},e.prototype.notifyErrors=function(e){for(var i=require("esui/validator/Validity"),n=require("esui/validator/ValidityState"),r=this.get("action"),a=t(r),o=a.getInputControls(),s=e.fields,l=0;l<o.length&&s.length>0;l++){var h=o[l];if("function"!=typeof h.notifyErrors)for(var u=0;u<s.length;u++){var c=s[u];if(h.name===c.field){var d=new n(!1,c.message),f=new i;if(f.addState("server",d),"function"==typeof h.showValidity)h.showValidity(f)}}else s=h.notifyErrors(e)||s}},e.prototype.getRawValue=function(){var e=this.get("action");if(!e)return null;if("function"==typeof e.getRawValue)return e.getRawValue();if("function"==typeof e.getValue)return e.getValue();else return void 0},e.prototype.getCategory=function(){return"input"},i.inherits(e,n),require("esui").register(e),e}),define("ub-ria/ui/RichSelector",["require","esui/Label","esui/Panel","esui/SearchBox","esui/lib","esui/painters","esui/InputControl","underscore","esui"],function(require){function e(){a.apply(this,arguments)}function t(){this.search()}function i(e){e.removeState("queried");var t=e.getSearchBox();if(t)t.set("text","")}require("esui/Label"),require("esui/Panel"),require("esui/SearchBox");var n=require("esui/lib"),r=require("esui/painters"),a=require("esui/InputControl"),o=require("underscore");return n.inherits(e,a),e.prototype.type="RichSelector",e.prototype.initOptions=function(e){var t={height:340,width:200,hasHead:!0,title:"标题名",needBatchAction:!1,batchActionLabel:"批量操作",hasSearchBox:!0,hasFoot:!0,itemName:"结果",emptyText:"没有相应的搜索结果",holdState:!1,mode:"add",multi:!0};if("false"===e.hasHead)e.hasHead=!1;if("false"===e.hasSearchBox)e.hasSearchBox=!1;if("false"===e.hasFoot)e.hasFoot=!1;if("false"===e.holdState)e.holdState=!1;if("false"===e.multi)e.multi=!1;n.extend(t,e),t.width=Math.max(200,t.width),this.setProperties(t)},e.prototype.getHeadHTML=function(){var e=this.helper,t="";if(this.needBatchAction){var i=e.getPartClassName("batch-action-link"),r=this.helper.getId("batch-action");t='<span class="'+i+'" id="'+r+'" >'+this.batchActionLabel+"</span>"}var a=['<div data-ui="type:Panel;childName:head;"',' class="${headClass}">','<h3 data-ui="type:Label;childName:title;">',"${title}</h3>","${actionLink}","</div>"].join("\n");return a=n.format(a,{headClass:e.getPartClassName("head"),title:this.title,actionLink:t})},e.prototype.getFootHTML=function(){return['<div data-ui="type:Panel;childName:foot;"',' class="'+this.helper.getPartClassName("foot")+'">','<span data-ui="type:Label;childName:totalCount">',"</span>","</div>"].join("\n")},e.prototype.initStructure=function(){var e=["${head}",'<div data-ui="type:Panel;childName:body;"',' class="${bodyClass}">',"${searchInput}",'<div data-ui="type:Panel;childName:content"',' class="${contentClass}">','<div data-ui="type:Label;childName:emptyText"',' class="${emptyTextClass}">${emptyText}</div>','<div data-ui="type:Panel;childName:queryList"',' class="${queryListClass}">',"</div>","</div>","</div>","${footInfo}"],i=this.helper,r="";if(this.hasHead)r=this.getHeadHTML();var a="";if(this.hasSearchBox){var s=this.width-45;a=['<div data-ui="type:Panel;childName:searchBoxArea"',' class="${searchWrapperClass}">','<div data-ui="type:SearchBox;childName:itemSearch;"',' data-ui-skin="magnifier"',' data-ui-width="'+s+'">',"</div>","</div>",'<div data-ui="type:Panel;','childName:generalQueryResultArea"',' class="${generalQueryResultClass}"',' id="${queryResultId}">','<span class="${linkClass}" id="${linkId}">清空</span>','共找到<span id="${queryResultCountId}"></span>个',"</div>"].join("\n"),a=n.format(a,{searchWrapperClass:i.getPartClassName("search-wrapper"),generalQueryResultClass:i.getPartClassName("query-result-general"),queryResultCountId:i.getId("result-count"),linkClass:i.getPartClassName("clear-query-link"),linkId:i.getId("clear-query")})}var l="";if(this.hasFoot)l=this.getFootHTML();if(this.main.style.width=this.width+"px",this.main.innerHTML=n.format(e.join("\n"),{head:r,bodyClass:i.getPartClassName("body"),searchInput:a,contentClass:i.getPartClassName("content-wrapper"),emptyTextClass:i.getPartClassName("empty-text"),emptyText:this.emptyText,queryListClass:i.getPartClassName("query-list"),footInfo:l}),this.initChildren(),"load"===this.mode)this.addState("load");else if("add"===this.mode)this.addState("add");else this.addState("del");var h=i.getPart("batch-action");if(h)i.addDOMEvent(h,"click",o.bind(this.batchAction,this));var u=i.getPart("clear-query");if(u)i.addDOMEvent(u,"click",o.bind(this.clearQuery,this));var c=this.getSearchBox();if(c)c.on("search",t,this);var d=this.getQueryList().main;i.addDOMEvent(d,"click",o.bind(this.eventDispatcher,this))},e.prototype.eventDispatcher=function(){return!1},e.prototype.search=function(){var e={filterData:[]};if(e=this.fire("search",e),!e.isDefaultPrevented()){var t=this.getSearchBox();if(t){var i={value:n.trim(t.getValue())};e.filterData.push(i)}}if(e.filterData.length)this.queryItem(e.filterData),this.refreshResult(),this.refreshFoot(),this.addState("queried"),this.adjustHeight();else this.clearQuery()},e.prototype.refreshResult=function(){var e=this.getCurrentStateItemsCount(),t=this.helper.getPart("result-count");if(t)t.innerHTML=e},e.prototype.clearQuery=function(){return i(this),this.clearData(),this.refreshResult(),this.refreshContent(),this.refreshFoot(),this.adjustHeight(),this.fire("clearquery"),!1},e.prototype.getContent=function(){var e=this.getChild("body");if(e)return e.getChild("content");else return null},e.prototype.getKeyword=function(){var e=this.getSearchBox(),t=this.isQuery();if(e&&t)return n.trim(e.getValue());else return null},e.prototype.getQueryList=function(){var e=this.getContent();if(e)return e.getChild("queryList");else return null},e.prototype.getSearchBox=function(){var e=this.getChild("body").getChild("searchBoxArea");if(e)return e.getChild("itemSearch");else return void 0},e.prototype.getTotalCountPanel=function(){var e=this.getChild("foot");if(!e)return null;else return e.getChild("totalCount")},e.prototype.isQuery=function(){return this.hasState("queried")},e.prototype.batchAction=function(){if("delete"===this.mode)this.deleteAll(),this.refreshFoot();else if("add"===this.mode)this.selectAll();return!1},e.prototype.deleteAll=function(){return!1},e.prototype.addAll=function(){return!1},e.prototype.adjustHeight=function(){var e=this.height,t=28,i=this.hasSearchBox?45:0,n=this.hasFoot?25:0,r=e-t-i-n;if(this.isQuery())r-=30;var a=this.getContent().main;a.style.height=r+"px"},e.prototype.adaptData=function(){},e.prototype.refresh=function(){var e=this.adaptData(),t=!0;if(this.hasSearchBox&&this.isQuery())if(this.holdState)this.search(this.getKeyword()),t=!1;else i(this);if(t)this.refreshContent(),this.processDataAfterRefresh(e),this.refreshFoot(),this.adjustHeight()},e.prototype.processDataAfterRefresh=function(){},e.prototype.refreshFoot=function(){if(this.hasFoot){var e=this.getCurrentStateItemsCount(),t=this.getTotalCountPanel();if(t){var i=o.escape(this.itemName);t.setText("共 "+e+" 个"+i)}}},e.prototype.getCurrentStateItemsCount=function(){return 0},e.prototype.repaint=r.createRepaint(a.prototype.repaint,{name:"title",paint:function(e,t){var i=e.getChild("head"),n=i&&i.getChild("title");n&&n.setText(t)}}),e.prototype.getSelectedItems=function(){return[]},e.prototype.selectItems=function(){},e.prototype.setRawValue=function(e){this.rawValue=e,this.selectItems(e,!0)},e.prototype.getRawValue=function(){return this.getSelectedItems()},e.prototype.stringifyValue=function(e){var t=[];return o.each(e,function(e){t.push(e.id)}),t.join(",")},require("esui").register(e),e}),define("ub-ria/ui/SelectorTreeStrategy",["require","esui/lib","esui/TreeStrategy"],function(require){function e(e){var i={defaultExpand:!0,orientExpand:!1};t.extend(this,i,e)}var t=require("esui/lib"),i=require("esui/TreeStrategy");return t.inherits(e,i),e.prototype.isLeafNode=function(e){return!e.children},e.prototype.shouldExpand=function(){return this.orientExpand},e.prototype.enableSelectStrategy=function(e){var t=this;e.on("select",function(e){var i=!0,n=t.isLeafNode(e.node);if("load"!==t.mode){if(t.onlyLeafSelect&&!n)i=!1}else if(!n)i=!1;if(i)this.selectNode(e.node.id)}),e.on("unselect",function(t){if(e.get("allowUnselectNode"))e.unselectNode(t.node.id)})},e}),define("ub-ria/ui/TableRichSelector",["require","esui/lib","esui/painters","underscore","../util","./RichSelector","esui"],function(require){function e(){m.apply(this,arguments)}function t(e){for(var t=e.helper.getPartClassName("head-table"),i=['<table border=0 class="'+t+'"><tr>'],n=e.fields.length,r=0;n>r;r++){var a=e.fields[r];i.push('<th class="th'+r+'" style="width:'+a.width+'px;">'+a.title||"</th>")}return i.push('<th style="width:30px;"></th>'),i.push("</tr></table>"),i.join(" ")}function i(e,t){var i=e.indexData,r=e.helper,a=r.getPartClassName("content-table"),o=['<table border=0 class="'+a+'">'],s=r.getPartClassName("row"),l=r.getPartClassName("row-selected"),h=r.getPartClassName("row-disabled");return f.each(t,function(t,r){var a=[s];if(t.isSelected)a.push(l);if(t.isDisabled)a.push(h);o.push(c.format(e.rowTpl,{rowId:e.helper.getId("row-"+t.id),rowClass:a.join(" "),index:i[t.id],content:n(e,t,r)}))}),o.push("</table>"),o.join(" ")}function n(e,t,i,n){var r=e.fields,a=[],o=e.helper.getPartClassName("row-field"),s=0;f.each(r,function(r,l){var h=r.content,u="function"==typeof h?h.call(e,t,i,l):t[h];if(n){var c=n.insertCell(l);c.style.width=r.width+"px",c.title=u,c.innerHTML=u}else{var d='<td class="'+o+'" title="'+u+'" style="width:'+r.width+'px;">'+u+"</td>";a.push(d)}s++});var l=e.helper.getPartClassName("row-action-icon"),h='<span class="'+l+'"></span>';if(n){var u=n.insertCell(s);u.style.width="30px",u.innerHTML=h}else return a.push('<td style="width:30px;">'+h+"</td>"),a.join(" ")}function r(e,t,i){var n=e.helper.getPartClassName("row-selected"),r=!1;if(c.hasClass(t,n)){if(!e.multi)a(e,i.id,!1),r=!0}else a(e,i.id,!0),r=!0;if(r)e.fire("add",{item:i}),e.fire("change")}function a(e,t,i){var n=e.indexData,r=e.allData,a=n[t],l=r[a];if(!e.multi)o(e),e.currentSelectedId=i?t:null;s(e,l,i)}function o(e){var t=e.currentSelectedId;if(t){var i=e.indexData[t],n=e.allData[i];s(e,n,!1),e.currentSelectedId=null}}function s(e,t,i){if(t){t.isSelected=i;var n=e.helper.getPart("row-"+t.id),r=i?c.addClass:c.removeClass;r(n,e.helper.getPartClassName("row-selected"))}}function l(e,t,i){h(e,i.id),e.fire("delete",{items:[i]}),e.fire("change")}function h(e,t){var i=e.indexData,n=i[t],r=[].slice.call(e.datasource,0);r.splice(n,1),e.set("datasource",r)}function u(e,t,i){var n=e.helper.getPartClassName("row-selected");if(!c.hasClass(t,n))a(e,i.id,!0),e.fire("load"),e.fire("change")}var c=require("esui/lib"),d=require("esui/painters"),f=require("underscore"),p=require("../util"),m=require("./RichSelector");return c.inherits(e,m),e.prototype.type="TableRichSelector",e.prototype.styleType="RichSelector",e.prototype.initOptions=function(e){var t={hasRowHead:!0,hasIcon:!0,firedOnIcon:!1,datasource:[],selectedData:[],fields:[{field:"name",content:"name",searchScope:"partial",isDefaultSearchField:!0}]};if("false"===e.hasRowHead)e.hasRowHead=!1;if("false"===e.hasIcon)e.hasIcon=!1;if("false"===e.firedOnIcon)e.firedOnIcon=!1;c.extend(t,e),m.prototype.initOptions.call(this,t)},e.prototype.initStructure=function(){m.prototype.initStructure.apply(this,arguments),c.addClass(this.main,"ui-table-richselector")},e.prototype.repaint=d.createRepaint(m.prototype.repaint,{name:["datasource","selectedData","disabledData"],paint:function(e){e.refresh(),e.fire("change")}}),e.prototype.adaptData=function(){var e=p.deepClone(this.datasource),t={};f.each(e,function(e,i){t[e.id]=i}),this.indexData=t;var i=this.selectedData||[];if(!this.multi)if(!f.isArray(i))this.currentSelectedId=i,i=[{id:i}];else if(i.length)this.currentSelectedId=i[0].id;f.each(i,function(i){var n=t[i.id];if(void 0!==n)e[n].isSelected=!0});var n=this.disabledData||[];f.each(n,function(i){var n=t[i.id];if(void 0!==n)e[n].isDisabled=!0}),this.allData=e,this.fieldsIndex={},this.defaultSearchFields=[],f.each(this.fields,function(e){if(this.fieldsIndex[e.field]=e,e.isDefaultSearchField)this.defaultSearchFields.push(e.field)},this)},e.prototype.refreshContent=function(){var e=this.isQuery()?this.queriedData:this.allData;if(!e||0===e.length)this.addState("empty");else this.removeState("empty");var n=[];if(this.hasRowHead)n.push(t(this));n.push(i(this,e));var r=this.getQueryList();r.setContent(n.join(""))},e.prototype.rowTpl='<tr id="${rowId}" class="${rowClass}" index="${index}">${content}</tr>',e.prototype.eventDispatcher=function(e){for(var t=e.target,i=this.helper,n=i.getPartClassName("row"),r=i.getPartClassName("row-action-icon");t&&t!==document.body;){var a;if(this.hasIcon&&this.fireOnIcon&&c.hasClass(t,r))a=t.parentNode;else if(c.hasClass(t,n))a=t;if(a)return void this.operateRow(a);t=t.parentNode}},e.prototype.operateRow=function(e){var t=this.helper.getPartClassName("row-disabled");if(!c.hasClass(e,t)){var i=parseInt(e.getAttribute("index"),10),n=this.allData[i];if(n)if("add"===this.mode)r(this,e,n);else if("delete"===this.mode)l(this,e,n);else if("load"===this.mode)u(this,e,n)}},e.prototype.selectAll=function(){var e=this.isQuery()?this.queriedData:this.allData,t=this;f.each(e,function(e){a(t,e.id,!0)}),this.fire("add"),this.fire("change")},e.prototype.selectItems=function(e,t){var i=this.allData,n=this.indexData,r=this;f.each(e,function(e){var o=void 0!==e.id?e.id:e,s=n[o];if(null!==s&&void 0!==s){var l=i[s];a(r,l.id,t)}})},e.prototype.deleteAll=function(){var e=f.clone(this.datasource);this.set("datasource",[]),this.fire("delete",{items:e}),this.fire("change")},e.prototype.queryItem=function(e){function t(e,t,i){var n=!1;if("string"==typeof t)t=c.trim(t);if("partial"===this.fieldsIndex[e].searchScope){if(-1!==i[e].indexOf(t))n=!0}else if(i[e]===t)n=!0;return n}function i(i){return!f.any(e,function(e){var n=[];if(void 0===e.keys)n=this.defaultSearchFields;else n=e.keys;return!f.any(n,function(n){return t.call(this,n,e.value,i)},this)},this)}e=e||[],this.queriedData=f.filter(this.allData,i,this),this.addState("queried"),this.refreshContent()},e.prototype.clearData=function(){this.queriedData=[]},e.prototype.getSelectedItems=function(){var e=this.datasource,t=this.allData,i=this.mode;if("delete"===i)return t;var n=f.filter(e,function(e,i){return t[i].isSelected});return n},e.prototype.getCurrentStateItemsCount=function(){var e=this.isQuery()?this.queriedData:this.allData;return e=e||[],e.length},require("esui").register(e),e}),define("ub-ria/ui/ToggleButton",["require","esui/lib","esui/InputControl","esui/painters","esui"],function(require){function e(){n.apply(this,arguments)}function t(e,t){var i=e.helper.getId(t),n=e.helper.getPartClassName("part-"+t),r='<span id="'+i+'" class="'+n+'"></span>';return r}var i=require("esui/lib"),n=require("esui/InputControl");e.prototype.type="ToggleButton",e.prototype.getCategory=function(){return"check"},e.prototype.createMain=function(){return document.createElement("div")},e.prototype.initOptions=function(e){var t={onText:"ON",offText:"OFF",checked:!1};if(i.extend(t,e),!t.title)t.title=this.main.title;if(i.isInput(this.main))this.helper.extractOptionsFromInput(this.main,t);else{var r=i.getChildren(this.main);if(r.length>1){if(!e.onText)t.onText=i.getText(r[0]);if(!e.offText)t.offText=i.getText(r[1])}}n.prototype.initOptions.call(this,t)},e.prototype.initStructure=function(){this.main.innerHTML=t(this,"on")+t(this,"off"),this.helper.addDOMEvent(this.main,"click",i.bind(this.toggle,this))};var r=require("esui/painters");return e.prototype.repaint=r.createRepaint(n.prototype.repaint,r.text("onText","on"),r.text("offText","off"),r.attribute("title"),r.style("width"),r.style("height"),r.state("checked")),e.prototype.setProperties=function(){if(this.hasOwnProperty("checked"))this.checked=!!this.checked;var e=n.prototype.setProperties.apply(this,arguments);if(e.hasOwnProperty("checked"))this.fire("change")},e.prototype.isChecked=function(){return this.checked},e.prototype.toggle=function(){this.set("checked",!this.checked)},i.inherits(e,n),require("esui").register(e),e
}),define("ub-ria/ui/TogglePanel",["require","esui/Control","esui/lib","esui","esui/Panel","esui/painters"],function(require){function e(){i.apply(this,arguments)}function t(){this.toggleContent()}var i=require("esui/Control"),n=require("esui/lib"),r=require("esui");require("esui/Panel"),e.prototype.type="TogglePanel",e.prototype.initOptions=function(e){var t={expanded:!1},i=n.extend(t,e);this.setProperties(i)},e.prototype.initStructure=function(){var e=n.getChildren(this.main),i=e[0],a=e[1],o=r.create("Panel",{main:i});this.helper.addPartClasses("title",o.main),this.addChild(o,"title"),o.render(),this.set("title",i&&i.innerHTML),o.helper.addDOMEvent(o.main,"click",n.bind(t,this));var s={main:a,childName:"content",viewContext:this.viewContext,renderOptions:this.renderOptions},l=r.create("Panel",s);this.helper.addPartClasses("content",l.main),this.addChild(l,"content"),l.render()},e.prototype.toggleContent=function(){this.toggleState("expanded"),this.fire("change")};var a=require("esui/painters");return e.prototype.repaint=a.createRepaint(i.prototype.repaint,a.state("expanded"),{name:"title",paint:function(e,t){e.getChild("title").set("content",t)}},{name:"content",paint:function(e,t){e.getChild("content").set("content",t)}}),e.prototype.isExpanded=function(){return this.hasState("expanded")},n.inherits(e,i),r.register(e),e}),define("ub-ria/ui/TreeRichSelector",["require","esui/Tree","esui/painters","esui/main","esui/lib","underscore","../util","./RichSelector","./SelectorTreeStrategy","esui"],function(require){function e(){m.apply(this,arguments)}function t(e,t,n){var r=e.getQueryList().getChild("tree"),a=e.indexData,o=a[t];if(o){if(!e.multi&&n)i(e),e.currentSeletedId=t;if(e.setItemState(t,"isSelected",n),n)r.selectNode(t,!0);else r.unselectNode(t,!0)}}function i(e){var t=e.currentSeletedId;if(t){var i=e.getQueryList().getChild("tree");i.unselectNode(t),e.currentSeletedId=null}}function n(e,i,n){if(e.needSyncParentChild){var r=e.indexData,a=i.node,o=a.children||[];f.each(o,function(i){if(t(e,i.id,n),i.children)f.each(i.children,function(i){t(e,i.id,n)})});var s=i.parentId,l=r[s];if(l){var h=l.node.children||[],u=!0;f.each(h,function(t){if(!e.getItemState(t.id,"isSelected"))u=!1}),t(e,s,u)}}}function r(e,t){var i,n=e.indexData,a=n[t],o=a.parentId,s=n[o];if(!s)i=e.allData;else i=s.node;var l=i.children||[],u=f.without(l,a.node);if(0===u.length&&o!==h(e))r(e,o);else i.children=u,e.refresh()}function a(e){var t=e.children;return f.filter(t,function(e){return this.getItemState(e.id,"isSelected")},this)}function o(e,t){var i=[],n=t.children;return f.each(n,function(t){var n;if(-1!==t.text.indexOf(e))n=f.clone(t);if(t.children&&t.children.length){var r=o(e,t);if(r.length>0){if(!n)n=f.clone(t);n.children=r}}if(n)i.push(n)}),i}function s(e){return!e.children}function l(e,t,i){var n=1;if(i){if(s(t))if(!t.id||t.id===h(e))return 0;else return 1;n=0}else if(t.id===h(e))n=0;return n+=f.reduce(t.children,function(t,n){return t+l(e,n,i)},0)}function h(e){return e.datasource.id}require("esui/Tree");var u=require("esui/painters"),c=require("esui/main"),d=require("esui/lib"),f=require("underscore"),p=require("../util"),m=require("./RichSelector"),g=require("./SelectorTreeStrategy");return d.inherits(e,m),e.prototype.type="TreeRichSelector",e.prototype.styleType="RichSelector",e.prototype.initOptions=function(e){var t={datasource:null,orientExpand:!1,wideToggleArea:!1,onlyLeafSelect:!0,allowUnselectNode:!1,hideRoot:!0,needSyncParentChild:!0};if(d.extend(t,e),"false"===t.onlyLeafSelect)t.onlyLeafSelect=!1;if("false"===t.orientExpand)t.orientExpand=!1;if("false"===t.hideRoot)t.hideRoot=!1;if("false"===t.wideToggleArea)t.wideToggleArea=!1;if("false"===t.multi)t.multi=!1;if(t.multi===!1)t.onlyLeafSelect=!0;if("false"===t.needSyncParentChild)t.needSyncParentChild=!1;m.prototype.initOptions.call(this,t)},e.prototype.initStructure=function(){if(m.prototype.initStructure.apply(this,arguments),d.addClass(this.main,"ui-tree-richselector"),this.onlyLeafSelect)this.addState("only-leaf-selectable")},e.prototype.repaint=u.createRepaint(m.prototype.repaint,{name:"datasource",paint:function(e){e.refresh()}},{name:"selectedData",paint:function(e,t){var i=e.allData;if(i&&i.children){var n=e.getSelectedItems();e.selectItems(n,!1),e.selectItems(t,!0),e.fire("add"),e.fire("change")}}}),e.prototype.adaptData=function(){var e=[];this.allData=this.datasource;var t={};if(this.allData&&this.allData.children)this.walkTree(this.allData,this.allData.children,function(i,n){if(t[n.id]={parentId:i.id,node:n,isSelected:!1},n.hasOwnProperty("isSelected"))t[n.id].isSelected=n.isSelected;if(t[n.id].isSelected===!0)e.push(n)});return this.indexData=t,{indexData:t,selectedData:e}},e.prototype.processDataAfterRefresh=function(e){if("delete"!==this.mode)this.selectItems(e.selectedData,!0)},e.prototype.refreshContent=function(){var e=this.isQuery()?this.queriedData:this.allData;if(!e||!e.children||!e.children.length)this.addState("empty");else this.removeState("empty");if(e&&e.children){var t=this.getQueryList(),i=t.getChild("tree");if(!i){var n={childName:"tree",datasource:e,allowUnselectNode:this.allowUnselectNode,strategy:new g({mode:this.mode,onlyLeafSelect:this.onlyLeafSelect,orientExpand:this.orientExpand}),wideToggleArea:this.wideToggleArea,hideRoot:this.hideRoot,selectMode:this.multi?"multiple":"single"};if(this.getItemHTML)n.getItemHTML=this.getItemHTML;if(this.itemTemplate)n.itemTemplate=this.itemTemplate;i=c.create("Tree",n),t.addChild(i),i.appendTo(t.main);var r=this;i.on("selectnode",function(e){var t=e.node;r.handlerAfterClickNode(t)}),i.on("unselectnode",function(e){r.setItemState(e.node.id,"isSelected",!1)})}else i.setProperties({datasource:p.deepClone(e),keyword:this.getKeyword()})}},e.prototype.getStateNode=function(e){return this.indexData[e]},e.prototype.getItemState=function(e,t){if(this.indexData[e]){var i=this.getStateNode(e);return i[t]}return null},e.prototype.setItemState=function(e,t,i){if(this.indexData[e]){var n=this.getStateNode(e);n[t]=i}},e.prototype.getDatasourceWithState=function(){var e=f.deepClone(this.datasource),t=this.indexData;return this.walkTree(e,e.children,function(e,i){i.isSelected=t[i.id].isSelected}),e},e.prototype.handlerAfterClickNode=function(e){var t=this.indexData[e.id];if(t)if("add"===this.mode)this.actionForAdd(t);else if("delete"===this.mode)this.actionForDelete(t);else if("load"===this.mode)this.actionForLoad(t)},e.prototype.actionForAdd=function(e){if(this.setItemState(e.node.id,"isSelected",!0),!this.multi){if(this.currentSeletedId)this.setItemState(this.currentSeletedId,"isSelected",!1);this.currentSeletedId=e.node.id}else n(this,e,!0);this.fire("add",{item:e.node}),this.fire("change")},e.prototype.selectAll=function(){var e=this.isQuery()?this.queriedData:this.allData,i=e.children,n=this.getLeafItems(i,!1),r=this;f.each(n,function(e){t(r,e.id,!0)}),this.fire("add"),this.fire("change")},e.prototype.selectItems=function(e,i){var r=this.indexData;if(r){var a=this;f.each(e,function(e){var o=void 0!==e.id?e.id:e,s=r[o];if(null!=s&&void 0!==s)t(a,o,i),n(a,s,i)})}},e.prototype.actionForDelete=function(e){var t=this.fire("delete",{items:[e.node]});if(!t.isDefaultPrevented())r(this,e.node.id),this.fire("change")},e.prototype.deleteAll=function(){var e=this.fire("delete",{items:this.allData.children});if(!e.isDefaultPrevented())this.set("datasource",null),this.fire("change")},e.prototype.actionForLoad=function(e){if(this.setItemState(e.node.id,"isActive",!0),this.currentActiveId)if(this.setItemState(this.currentActiveId,"isActive",!1),!this.getStateNode(this.currentActiveId).isSelected){var t=this.getQueryList().getChild("tree");t.unselectNode(this.currentActiveId,!0)}this.currentActiveId=e.node.id,this.fire("load",{item:e.node}),this.fire("change")},e.prototype.getLeafItems=function(e,t){e=e||this.allData&&this.allData.children||[];var i=[],n=this;return f.each(e,function(e){if(s(e)){var r=t===this.getItemState(e.id,"isSelected");if("delete"===n.mode||r)i.push(e)}else i=f.union(i,n.getLeafItems(e.children,t))},this),i},e.prototype.getSelectedItems=function(){if(!this.allData)return[];var e=[],t=this;return this.walkTree(this.allData,this.allData.children,function(i,n){if(t.getStateNode(n.id).isSelected)e.push(n)}),e},e.prototype.getSelectedTree=function(){var e=this,t=p.deepClone(this.allData),i=t.children;f.each(i,function(t){var i=a(t,e);if(i.length)t.children=i;else t.children=null});var n=f.filter(i,function(e){return e.children});return t.children=n,t},e.prototype.clearQuery=function(){if(m.prototype.clearQuery.apply(this,arguments),"delete"!==this.mode){var e=this.getSelectedItems();this.selectItems(e,!0)}return!1},e.prototype.clearData=function(){this.queriedData={}},e.prototype.queryItem=function(e){var t=e[0].value,i=[];i=o(t,this.allData),this.queriedData={id:h(this),text:"符合条件的结果",children:i},this.addState("queried"),this.refreshContent();var n=this.getSelectedItems();if("delete"!==this.mode)this.selectItems(n,!0)},e.prototype.walkTree=function(e,t,i){f.each(t,function(t){i(e,t),this.walkTree(t,t.children,i)},this)},e.prototype.getFilteredItemsCount=function(){var e=this.isQuery()?this.queriedData:this.allData,t=l(this,e,!0);return t},e.prototype.getCurrentStateItemsCount=function(){var e=this.isQuery()?this.queriedData:this.allData;if(!e)return 0;var t=l(this,e,!0);return t},require("esui").register(e),e}),define("ub-ria/ui/Uploader",["require","esui/lib","esui/controlHelper","esui/validator/Validity","esui/validator/ValidityState","esui/InputControl","underscore","esui"],function(require){function e(){s.apply(this,arguments)}function t(){this.removeState("busy"),this.addState("complete"),this.addState("uploaded");var e=this.helper.getPart("button");e.innerHTML=l.escape(this.overrideText);var t=new a;this.showValidity(t),this.fire("change")}function i(){this.removeState("busy"),this.removeState("complete"),this.removeState("uploaded"),this.helper.getPart("button").innerHTML=l.escape(this.text),this.fileInfo="";var e=document.createElement("input");e.type="file",e.id=this.helper.getId("input"),this.name&&(e.name=this.name);var t=this.helper.getPart("input");this.helper.removeDOMEvent(t,"change"),this.main.firstChild.replaceChild(e,t),this.helper.addDOMEvent(e,"change",n.bind(this.receiveFile,this))}var n=require("esui/lib"),r=require("esui/controlHelper"),a=require("esui/validator/Validity"),o=require("esui/validator/ValidityState"),s=require("esui/InputControl"),l=require("underscore");e.prototype.type="Uploader";var h={image:{".jpg":!0,".jpeg":!0,".gif":!0,".bmp":!0,".tif":!0,".tiff":!0,".png":!0},flash:{".flv":!0,".swf":!0}};return e.defaultProperties={width:80,height:25,fileType:"*",method:"POST",text:"点击上传",overrideText:"重新上传",busyText:"正在上传...",completeText:"上传完成",autoUpload:!0,extraArgs:{},action:"",mimeTypes:h},e.prototype.initOptions=function(t){var i={};if(n.extend(i,e.defaultProperties,t),n.isInput(this.main))i.accept=i.accept||n.getAttribute(this.main,"accept"),i.name=i.name||this.main.name;else if("FORM"===this.main.nodeName)if(i.action=i.action||this.main.action,!t.method&&n.hasAttribute(this.main,"method"))i.method=this.main.method;if("string"==typeof i.accept)i.accept=n.splitTokenList(i.accept);if("false"===i.autoUpload)i.autoUpload=!1;if(!i.hasOwnProperty("title")&&this.main.title)i.title=this.main.title;this.setProperties(i)},e.prototype.initStructure=function(){if("FORM"!==this.main.nodeName)this.helper.replaceMain();this.callbackName=n.getGUID("esuiShowUploadResult"),window[this.callbackName]=n.bind(this.showUploadResult,this);var e=this.helper.getPartClassName("indicator"),t=this.helper.getPartClassName("button"),i=this.helper.getId("iframe"),r=['<div id="'+this.helper.getId("input-container")+'">','<span id="'+this.helper.getId("button")+'" ','class="'+t+'">',"</span>",'<input type="hidden" name="callback" ','value="'+this.callbackName+'" ',"/>",'<input type="hidden" name="sessionToken" ','value="'+this.getSessionToken()+'" ',"/>",'<input type="file" ','id="'+this.helper.getId("input")+'" ',this.name?'name="'+this.name+'" ':" ","/>"];l.each(this.extraArgs,function(e,t){r.push('<input type="hidden" name="'+t+'" ','value="'+e+'"/>')}),r.push("</div>",'<div id="'+this.helper.getId("indicator-wrapper")+'"','class="'+e+'">','<span id="'+this.helper.getId("indicator")+'"></span>',"</div>",'<iframe id="'+i+'" name="'+i+'"',' src="about:blank"></iframe>'),this.main.innerHTML=r.join("");var a=this.helper.createPart("form","form");a.setAttribute("enctype","multipart/form-data"),a.target=i,document.body.appendChild(a);var o=this.helper.getPart("input");this.helper.addDOMEvent(o,"change",n.bind(this.receiveFile,this))},e.prototype.repaint=r.createRepaint(s.prototype.repaint,{name:["method","action"],paint:function(e,t,i){var n=e.helper.getPart("form");n.method=t,n.action=i}},{name:["text","overrideText"],paint:function(e,t,i){var n=e.helper.getPart("button"),r=e.hasState("uploaded")?l.escape(i):l.escape(t);n.innerHTML=r}},{name:["busyText","completeText"],paint:function(e,t,i){var n=e.helper.getPart("indicator"),r=e.hasState("busy")?l.escape(t):l.escape(i);n.innerHTML=r}},{name:"accept",paint:function(e,t){var i=e.helper.getPart("input");if(t)n.setAttribute(i,"accept",t.join(","));else n.removeAttribute(i,"accept")}},{name:["disabled","readOnly"],paint:function(e,t,i){var n=e.helper.getPart("input");n.disabled=t,n.readOnly=i}},{name:["width","height"],paint:function(e,t,i){var n=t+"px",r=i+"px";e.main.style.width=n,e.main.style.height=r;var a=e.helper.getPart("button");a.style.lineHeight=r;var o=e.helper.getPart("indicator");o.style.lineHeight=r}},{name:"rawValue",paint:function(e,n){if(n)if(l.isEqual(n,{}))i.call(e);else{if(!n.hasOwnProperty("type"))n.type=e.fileType;e.fileInfo=n,t.call(e,n),e.removeState("complete")}}}),e.prototype.checkFileFormat=function(e){if(this.accept){var t=e.split(".");t="."+t[t.length-1].toLowerCase();for(var i=!1,n=0;n<this.accept.length;n++){var r=this.accept[n].toLowerCase();if(r===t){i=!0;break}if("*"===r.slice(-1)[0]){var a=r.split("/")[0],o=this.mimeTypes[a];if(o&&o.hasOwnProperty(t)){i=!0;break}}}if(!i){var s=this.acceptErrorMessage||"仅接受以下文件格式："+this.accept.join(",");this.notifyFail(s)}return i}else return!0},e.prototype.submit=function(){this.showUploading();var e=this.helper.getPart("input-container"),t=this.helper.getPart("form");t.appendChild(e),t.submit(),this.main.insertBefore(e,this.main.firstChild)},e.prototype.receiveFile=function(){var e=this.helper.getPart("input"),t=e.value;if(t&&this.checkFileFormat(t))if(this.fire("receive"),this.autoUpload)this.submit()},e.prototype.showUploading=function(){this.removeState("complete"),this.addState("busy");var e=this.helper.getPart("indicator");e.innerHTML=l.escape(this.busyText)},e.prototype.showUploadResult=function(e){if(e.fields)this.fire("fail",{fields:e.fields}),this.notifyFail(e.fields[0].message);else if(e.info){if(!e.info.hasOwnProperty("type"))e.info.type=this.fileType;this.fileInfo=e.info,this.fire("complete"),this.notifyComplete(e.info)}},e.prototype.notifyFail=function(e){e=e||"上传失败";var t=new a,i=new o(!1,e);t.addState("upload",i),this.showValidity(t),this.removeState("busy")},e.prototype.notifyComplete=function(e){t.call(this,e);var i=this.helper.getPart("indicator");i.innerHTML=l.escape(this.completeText),this.timer=setTimeout(n.bind(this.removeState,this,"complete"),1e3)},e.prototype.getRawValue=function(){return this.fileInfo||null},e.prototype.getRawValueProperty=e.prototype.getRawValue,e.prototype.getFileName=function(){return this.helper.getPart("input").value||""},e.prototype.getSessionToken=function(){return""},e.prototype.dispose=function(){try{delete window[this.callbackName]}catch(e){window[this.callbackName]=void 0}var t=this.helper.getPart("form");n.removeNode(t),s.prototype.dispose.apply(this,arguments)},n.inherits(e,s),require("esui").register(e),e}),define("text",["require"],function(){return{load:function(e,t,i){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.open("GET",t.toUrl(e),!0),n.onreadystatechange=function(){if(4===+n.readyState){if(n.status>=200&&n.status<300)i(n.responseText);n.onreadystatechange=new Function,n=null}},n.send(null)}}}),define("common/text",["text"],function(e){return e}),define("ub-ria-sidebar/Sidebar",["require","underscore","esui/lib","esui","esui/Panel","etpl","text!./tpl/sidebar.tpl.html","esui/painters","eoo"],function(require){function e(e){var t=e.target;if(this.helper.isPart(t,"drop"))e.stopPropagation(),this.adjustExpandItem(this.expandItem,t.getAttribute("data-id"))}function t(){this.set("collapsed",!this.get("collapsed"))}var i=require("underscore"),n=require("esui/lib"),r=require("esui"),a=require("esui/Panel"),o=require("etpl"),s="sidebar-menu-item-expanded",l="sidebar-menu-item-active",exports={};exports.type="Sidebar",exports.listTemplate=require("text!./tpl/sidebar.tpl.html"),exports.initOptions=function(e){var t={toggleBtn:"",datasource:[],activeItems:[],expandItem:"",contents:[]};i.extend(t,e),this.setProperties(t),this.complier=o.compile(this.listTemplate)},exports.initEvents=function(){this.$super(arguments),this.helper.addDOMEvent(this.main,"click",e),this.helper.addDOMEvent(window,"resize",this._setContentPanelMaxHeight);var i=n.g(this.toggleBtn);i&&this.helper.addDOMEvent(i,"click",t)};var h=require("esui/painters").createRepaint(a.prototype.repaint,{name:"datasource",paint:function(e,t){var i=e._prepareData(t);e.disposeChildren(),e.main.innerHTML=e.complier({datasource:i}),e.initChildren(),e.adjustExpandItem("",e.expandItem),e.adjustActiveItems(null,e.activeItems),e.setContents(e.contents)}},{name:"collapsed",paint:function(e,t){if(t)e._clearContentPanelMaxHeight(),e.addState("collapsed"),n.addClass(e.toggleBtn,"sidebar-collapsed");else e._setContentPanelMaxHeight(),e.removeState("collapsed"),n.removeClass(e.toggleBtn,"sidebar-collapsed");e.fire("modechanged")}});exports.repaint=function(e,t){if(h.apply(this,arguments),t){if(t.activeItems)this.adjustActiveItems(t.activeItems.oldValue,t.activeItems.newValue);if(t.expandItem)this.adjustExpandItem(t.expandItem.oldValue,t.expandItem.newValue)}},exports.adjustExpandItem=function(e,t){this.expandItem=t;var i=this._getItemById(t);if(e!==t)this._clearContentPanelMaxHeight(),n.removeClass(this._getItemById(e),s),this._setContentPanelMaxHeight(),n.addClass(i,s);else n.toggleClass(i,s)},exports.adjustActiveItems=function(e,t){this.activeItems=t,i.each(e,function(e){n.removeClass(this._getItemById(e),l)},this),i.each(t,function(e){n.addClass(this._getItemById(e),l)},this)},exports.setContents=function(e){e=e instanceof Array?e:[e],i.each(e,function(e){var t=this.getChild(e.id+"-content");t.addChild(e.control),e.control.appendTo(t)},this)},exports._setContentPanelMaxHeight=function(){if(this.currentExpanded){var e=n.getChildren(this._getItemById(this.currentExpanded).parentNode),t=0;i.each(e,function(e){t+=e.offsetHeight});var r=this.main.clientHeight;this._getCurrentContentPanel().setStyle("maxHeight",Math.max(r-t,50)+"px")}},exports._clearContentPanelMaxHeight=function(){if(this.currentExpanded)this._getCurrentContentPanel().setStyle("maxHeight","")},exports._getItemById=function(e){return this.helper.getPart("item-"+e)},exports._getCurrentContentPanel=function(){return this.getChild(this.currentExpanded+"-content")},exports._prepareData=function(e){var t=[];return i.each(e,function(e){var n=i.escape(e.id),r=!e.isLeaf?"sidebar-menu-item-has-child ":"",a={id:n,domID:this.helper.getId("item-"+n),text:e.text,url:e.url,isLeaf:!!e.isLeaf,itemCls:r,dropCls:this.helper.getPartClassName("drop"),target:e.target||("#"===e.url.charAt(0)?"_self":"_blank"),items:e.isLeaf?null:e.items||[]};t.push(a),i.each(a.items,function(e){e.id=i.escape(e.id),e.domID=this.helper.getId("item-"+e.id)},this)},this),t};var u=require("eoo").create(a,exports);return r.register(u),u}),define("ub-ria-sidebar",["ub-ria-sidebar/Sidebar"],function(e){return e}),define("ef/ChildView",["require","underscore","esui/Control","esui/painters","er/Deferred","mini-event","eoo","esui"],function(require){function e(e){var t=require("mini-event").fromEvent(e,{preserveData:!0,syncState:!0});t.type="view@"+e.type,this.fire(t)}var t=require("underscore"),i=require("esui/Control"),exports={};exports.type="ChildView",exports.repaint=require("esui/painters").createRepaint(i.prototype.repaint,{name:"viewType",paint:function(e,i){e.disposeView();var n=require("er/Deferred");e.view=n.require([i]),e.view.then(t.bind(e.fire,e,"viewloaded")),e.view.then(t.bind(e.renderView,e))}}),exports.disposeView=function(){var e=this.get("view");if(e&&"function"==typeof e.dispose)e.dispose();this.view=null},exports.renderView=function(t){if(this.helper.isInStage("RENDERED")){this.loadedViewModule=t;var i=this.view="function"==typeof t?new t:t;i.model=this.get("model"),i.container=this.main.id,i.render(),this.fire("viewrendered"),i.on("*",e,this)}},exports.refresh=function(){var e=this.get("loadedViewModule");if(!e)throw new Error("No view module loaded yet");this.disposeView(),this.renderView(e)};var n=require("eoo").create(i,exports);return require("esui").register(n),n}),define("ef/RemoteTreeStrategy",["require","esui/lib","esui/TreeStrategy","er/ajax","eoo"],function(require){function e(e,i,n){var r=n.node;if(r.children)return void e.expandNode(r.id);var a=e.workingRequests[r.id];if(a)a.abort();a=this.requestNodeData(r),e.workingRequests[r.id]=a,a.done(t.bind(e.expandNode,e,r.id))}var t=require("esui/lib"),i=require("esui/TreeStrategy"),exports={};exports.constructor=function(e){if(e.requestMethod)e.requestMethod=e.requestMethod.toLowerCase();i.apply(this,arguments),this.workingRequests={}},exports.urlTemplate="",exports.requestMethod="get",exports.getRequestURL=function(e){return t.format(this.urlTemplate,e)},exports.getRequestData=function(){return null},exports.requestNodeData=function(e){var t=this.getRequestURL(e),i=this.getRequestData(e),n=require("er/ajax");return"get"===this.requestMethod?n.getJSON(t,i,this.useCache||!1):n.post(t,i,"json")},exports.enableToggleStrategy=function(i){i.on("expand",t.curry(e,i,this)),i.on("collapse",function(e){this.collapseNode(e.node.id,!1)})};var n=require("eoo").create(i,exports);return t.inherits(n,i),n}),define("startup/ria",[],{});