/*! 2015 Baidu Inc. All Rights Reserved */
define("audit/ListView",["require","common/util","tpl!b1c6f6b6.tpl.html","etpl","./enum","er/permission","esui/Table","common/ListView","eoo"],function(require){function e(e){var t=n.findWhere(this.model.getStatusTransitions(),{statusName:e.name});if("click"===e.triggerType)if(t){var i={id:parseInt(e.args),status:t.status};this.fire("modifystatus",i)}}function t(e){var t=e.name,i=this.getSafely("nameContainer");if("name-fetch"===t){var n=this.getSafely("addUser").getValue();this.model.data().getUsers(n).then(function(e){i.setContent(r.render("autoName",{list:e.data})),i.show()})}}function i(e){var t=e.target.getElementsByClassName("auto-name-list-name")[0]||e.target;if(t){var i=t.innerText;this.getSafely("addUser").setValue(i)}}var n=require("common/util");require("tpl!b1c6f6b6.tpl.html");var r=require("etpl"),a=require("./enum").Status,o=require("er/permission"),s=require("./enum").ModUserLevel,exports={};exports.template="auditList",exports.tableFields=[{title:"任务ID",field:"id",sortable:!0,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+e.id+"</span>"}},{title:"任务名称",field:"taskName",sortable:!1,resizable:!1,width:50,stable:!0,content:function(e){return'<a data-ui-type="Link" class="table-command-pure-text" href="#/audit/statistics~reviewTaskId='+e.id+'">'+e.taskName+"</a>"}},{title:"创建人",field:"addUser",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+e.addUser+"</span>"}},{title:"创建时间",field:"addTime",sortable:!0,resizable:!1,width:40,stable:!0,content:function(e){var t=new Date(e.addTime);return n.formatTimeToSecond(t)}},{title:"状态",field:"status",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){var t="";switch(a.fromValue(e.status).alias){case"toBegin":t="task-status-toBegin";break;case"done":t="task-status-done";break;case"doing":t="task-status-doing"}return'<span class="'+t+'">'+a.fromValue(e.status).text+"</span>"}},{title:"审核人员",field:"moduserLevel",sortable:!1,resizable:!1,width:30,stable:!0,content:function(e){return"<span>"+s.fromValue(e.moduserLevel).text+"</span>"}},{title:"操作",field:"operation",sortable:!1,resizable:!1,width:25,stable:!0,content:function(e){var t=e.moduserLevel;if(!(s.outter===t&&o.isAllow("innerMarkerRole")||s.inner===t&&o.isAllow("outerAuditRole")))if("done"===a.fromValue(e.status).alias)return'<a data-ui-type="Link" class="table-command-text" href="#/audit/statistics~reviewTaskId='+e.id+'">进入审核</a>';else return'<a data-ui-type="Link" class="table-command-text"href="#/audit/task/list~taskId='+e.id+'">进入审核</a>'}},{title:"",field:"download",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){var t=e.status;if(t===a.done&&!o.isAllow("outerAuditRole"))return'<a data-ui-type="Link" class="table-command-text" target="_blank"href="ctp/review/task/download.do?taskId='+e.id+'">下载</a>';else return void 0}},{title:"",field:"delete",sortable:!1,resizable:!1,width:15,stable:!0,content:function(e){var t=require("esui/Table"),i=null;if(o.isAllow("innerAuditRole")||o.isAllow("managerRole"))i={command:"remove",args:e.id,className:"table-command-text",text:"删除"};return t.command(i)}}],exports.uiEvents={"table:command":e,"addUser:command":t,"addUser:blur":"hideNamePanel"},exports.hideNamePanel=function(){setTimeout(function(){this.getSafely("nameContainer").hide()}.bind(this),200)},exports.enterDocument=function(){this.$super(arguments),this.hideNamePanel();var e=this.getSafely("nameContainer");if(e)e.helper.addDOMEvent(e.main,"click",n.bind(i,this))},exports.submitSearch=function(){var e=this.get("time"),t=e.getRawValue();this.fire("searchAllKey",{begin:t.begin.getTime(),end:t.end.getTime()})},exports.updateBatchButtonStatus=function(){this.$super(arguments);var e=this.getSelectedItems(),t="javascript:void(0)",i="ctp/review/task/download.do",r=n.pluck(e,"id"),s=this.getSafely("download");if(n.all(e,function(e){return e.status===a.done&&!o.isAllow("outerAuditRole")})&&e.length)i+="?taskId="+r.join(","),s.removeState("disabled"),s.set("href",i);else s.addState("disabled"),s.set("href",t)};var l=require("common/ListView"),h=require("eoo").create(l,exports);return h});